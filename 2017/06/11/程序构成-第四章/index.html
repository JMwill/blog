<!DOCTYPE html>
<html lang="en" dir="ltr">

<head prefix="og: http://ogp.me/ns#">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>ç¨‹åºæ„æˆ-ç¬¬å››ç«  â€“ Will&#39;s Blog</title>
    


<script src="/blog/js/enquire.min.dfb99dee1e029d51d6cfb672d847929890b1585402de17f5ed092edd72a688b4.js"></script>

<script defer src="/blog/js/lazysizes.min.31dd6a2d3a1ec0f78a8df007535cf23f03aeb5c70f026e6d6a19dac3b3acc340.js"></script>

<script defer src="/blog/js/fuse.min.94c78ad70b02749822921660cf4e9f0b3701bc0680c421afb784a78228de0275.js"></script>

<script defer src="/blog/js/helper/getParents.min.1618c696be7c98933f9a92677f518b512a74e55bdbb976b09936b4182e93181b.js"></script>

<script defer src="/blog/js/helper/fadeinout.min.93a331f96194789a542f33690bbe4f0c102c7e78ffc018217f5a1c33010bad91.js"></script>

<script defer src="/blog/js/helper/closest.min.js"></script>
  
<script>
  "use strict";

  
  
  if (window.NodeList && !NodeList.prototype.forEach) {
    NodeList.prototype.forEach = Array.prototype.forEach;
  }

  
  if (!String.prototype.includes) {
    String.prototype.includes = function (search, start) {
      'use strict';

      if (search instanceof RegExp) {
        throw TypeError('first argument must not be a RegExp');
      }
      if (start === undefined) { start = 0; }
      return this.indexOf(search, start) !== -1;
    };
  }

  
  Document.prototype.append = Element.prototype.append = function append() {
    this.appendChild(_mutation(arguments));
  };
  function _mutation(nodes) {
    if (!nodes.length) {
      throw new Error('DOM Exception 8');
    } else if (nodes.length === 1) {
      return typeof nodes[0] === 'string' ? document.createTextNode(nodes[0]) : nodes[0];
    } else {
      var
      fragment = document.createDocumentFragment(),
      length = nodes.length,
      index = -1,
      node;

      while (++index < length) {
        node = nodes[index];

        fragment.appendChild(typeof node === 'string' ? document.createTextNode(node) : node);
      }

      return fragment;
    }
  }

  
  if (!String.prototype.startsWith) {
    String.prototype.startsWith = function (searchString, position) {
      position = position || 0;
      return this.indexOf(searchString, position) === position;
    };
  }
  


  document.addEventListener('DOMContentLoaded', function () {
    
    var navCollapseBtn = document.querySelector('.navbar__burger');
    navCollapseBtn ? navCollapseBtn.addEventListener('click', function (e) {
      var navCollapse = document.querySelector('.navbarm__collapse');

      if (navCollapse) {
        var dataOpen = navCollapse.getAttribute('data-open');

        if (dataOpen === 'true') {
          navCollapse.setAttribute('data-open', 'false');
          navCollapse.style.maxHeight = 0;
          navCollapseBtn.classList.remove('is-active');
        } else {
          navCollapse.setAttribute('data-open', 'true');
          navCollapse.style.maxHeight = navCollapse.scrollHeight + "px";
          navCollapseBtn.classList.add('is-active');
        }
      }
    }) : null;
    


    
    var summaryContainer = document.querySelector('.summary__container');
    var searchResult = document.querySelector('.search-result');
    var searchResultCloseBtn = document.querySelector('.search-result__close');
    searchResultCloseBtn ? searchResultCloseBtn.addEventListener('click', function (e) {
      searchResult.setAttribute('data-display', 'none');
      summaryContainer.setAttribute('data-display', 'block');
    }) : null;
    


    
    document.querySelectorAll('.tab') ? 
    document.querySelectorAll('.tab').forEach(function(elem, idx) {
      var containerId = elem.getAttribute('id');
      var containerElem = elem;
      var tabLinks = elem.querySelectorAll('.tab__link');
      var tabContents = elem.querySelectorAll('.tab__content');
      var ids = [];

      tabLinks && tabLinks.length > 0 ?
      tabLinks.forEach(function(link, index, self) {
        link.onclick = function(e) {
          for (var i = 0; i < self.length; i++) {
            if (index === parseInt(i, 10)) {
              if (!self[i].classList.contains('active')) {
                self[i].classList.add('active');
                tabContents[i].style.display = 'block';
              }
            } else {
              self[i].classList.remove('active');
              tabContents[i].style.display = 'none';
            }
          }
        }
      }) : null;
    }) : null;
    


    
    document.querySelectorAll('.codetab') ? 
    document.querySelectorAll('.codetab').forEach(function(elem, idx) {
      var containerId = elem.getAttribute('id');
      var containerElem = elem;
      var codetabLinks = elem.querySelectorAll('.codetab__link');
      var codetabContents = elem.querySelectorAll('.codetab__content');
      var ids = [];

      codetabLinks && codetabLinks.length > 0 ?
      codetabLinks.forEach(function(link, index, self) {
        link.onclick = function(e) {
          for (var i = 0; i < self.length; i++) {
            if (index === parseInt(i, 10)) {
              if (!self[i].classList.contains('active')) {
                self[i].classList.add('active');
                codetabContents[i].style.display = 'block';
              }
            } else {
              self[i].classList.remove('active');
              codetabContents[i].style.display = 'none';
            }
          }
        }
      }) : null;
    }) : null;
    


    
    var gttBtn = document.getElementById("gtt");
    gttBtn.style.display = "none";
    gttBtn.addEventListener('click', function () {
      if (window.document.documentMode) {
        document.documentElement.scrollTop = 0;
      } else {
        scrollToTop(250);
      }
    });

    function scrollToTop(scrollDuration) {
      var scrollStep = -window.scrollY / (scrollDuration / 15);
      var scrollInterval = setInterval(function () {
        if (window.scrollY != 0) {
          window.scrollBy(0, scrollStep);
        }
        else clearInterval(scrollInterval);
      }, 15);
    }

    var scrollFunction = function () {
      if (document.body.scrollTop > 250 || document.documentElement.scrollTop > 250) {
        gttBtn.style.display = "block";
      } else {
        gttBtn.style.display = "none";
      }
    }
    


    
    var expandBtn = document.querySelectorAll('.expand__button');

    for (let i = 0; i < expandBtn.length; i++) {
      expandBtn[i].addEventListener("click", function () {
        var content = this.nextElementSibling;
        if (content.style.maxHeight) {
          content.style.maxHeight = null;
          this.querySelector('svg').classList.add('expand-icon__right');
          this.querySelector('svg').classList.remove('expand-icon__down');
        } else {
          content.style.maxHeight = content.scrollHeight + "px";
          this.querySelector('svg').classList.remove('expand-icon__right');
          this.querySelector('svg').classList.add('expand-icon__down');
        }
      });
    }
    


    
    var lastScrollTop = window.pageYOffset || document.documentElement.scrollTop;
    var tocElem = document.querySelector('.toc');
    var tableOfContentsElem = tocElem ? tocElem.querySelector('#TableOfContents') : null;
    var toggleTocElem = document.getElementById('toggle-toc');
    var singleContentsElem = document.querySelector('.single__contents');
    var navbar = document.querySelector('.navbar');
    var tocFlexbox = document.querySelector('.toc__flexbox');
    var tocFlexboxOuter = document.querySelector('.toc__flexbox--outer');
    var expandContents = document.querySelectorAll('.expand__content');
    var boxContents = document.querySelectorAll('.box');
    var notAllowedTitleIds = null;

    
    var tocFolding = JSON.parse("false");
    
    var tocLevels = JSON.parse("[\"h2\",\"h3\",\"h4\"]");
    
    if (tocLevels) {
      tocLevels = tocLevels.toString();
    } else {
      tocLevels = "h1, h2, h3, h4, h5, h6";
    }

    
    singleContentsElem && singleContentsElem.querySelectorAll(".tab") ?
    singleContentsElem.querySelectorAll(".tab").forEach(function (elem) {
      elem.querySelectorAll(tocLevels).forEach(function (element) {
        notAllowedTitleIds = Array.isArray(notAllowedTitleIds) ?
          notAllowedTitleIds.concat(element.getAttribute('id')) :
          [element.getAttribute('id')];
      });
    }) : null;

    
    expandContents ? expandContents.forEach(function(elem) {
      elem.querySelectorAll(tocLevels).forEach(function (element) {
        notAllowedTitleIds = Array.isArray(notAllowedTitleIds) ?
          notAllowedTitleIds.concat(element.getAttribute('id')) :
          [element.getAttribute('id')];
      });
    }) : null;

    
    boxContents ? boxContents.forEach(function(elem) {
      elem.querySelectorAll(tocLevels).forEach(function (element) {
        notAllowedTitleIds = Array.isArray(notAllowedTitleIds) ?
          notAllowedTitleIds.concat(element.getAttribute('id')) :
          [element.getAttribute('id')];
      });
    }) : null;

    
    window.onscroll = function () {
      scrollFunction();
      
      var st = window.pageYOffset || document.documentElement.scrollTop;
      if (st > lastScrollTop) { 
        if (st < 250) {
          gttBtn.style.display = "none";
        } else {
          gttBtn.style.display = "block";
        }

        if (st < 45) {
          return null;
        }
        
        if (!navbar.classList.contains('navbar--hide')) {
          navbar.classList.add('navbar--hide');
        } else if (navbar.classList.contains('navbar--show')) {
          navbar.classList.remove('navbar--show');
        }

        if (singleContentsElem) {
          if (singleContentsElem.querySelectorAll(tocLevels).length > 0) {
            singleContentsElem.querySelectorAll(tocLevels).forEach(function (elem) {
              if (toggleTocElem && !toggleTocElem.checked) {
                return null;
              }

              if (notAllowedTitleIds && notAllowedTitleIds.includes(elem.getAttribute('id'))) {
                return null;
              }
              
              if (document.documentElement.scrollTop >= elem.offsetTop) {
                if (tableOfContentsElem) {
                  var id = elem.getAttribute('id');
                  tocElem.querySelectorAll('a').forEach(function (elem) {
                    elem.classList.remove('active');
                  });
                  tocElem.querySelector('a[href="#' + id + '"]') ?
                    tocElem.querySelector('a[href="#' + id + '"]').classList.add('active') : null;

                  if (false === tocFolding) {
                    
                  } else {
                    tableOfContentsElem.querySelectorAll('ul') ?
                      tableOfContentsElem.querySelectorAll('ul').forEach(function (rootUl) {
                        rootUl.querySelectorAll('li').forEach(function (liElem) {
                          liElem.querySelectorAll('ul').forEach(function (ulElem) {
                            ulElem.style.display = 'none';
                          });
                        });
                      }) : null;
                  }

                  var curElem = tableOfContentsElem.querySelector("[href='#" + id + "']");
                  if (curElem && curElem.nextElementSibling) {
                    curElem.nextElementSibling.style.display = 'block';
                  }
                  getParents(curElem, 'ul') ?
                    getParents(curElem, 'ul').forEach(function (elem) {
                      elem.style.display = 'block';
                    }) : null;
                }
              }
            });
          } else {
            if (tocFlexbox) {
              tocFlexbox.setAttribute('data-position', '');
              if (!tocFlexbox.classList.contains('hide')) {
                tocFlexbox.classList.add('hide');
              }
            }
            if (tocFlexboxOuter) {
              tocFlexboxOuter.setAttribute('data-position', '');
              if (!tocFlexboxOuter.classList.contains('hide')) {
                tocFlexboxOuter.classList.add('hide');
              }
            }
          }
        }
      } else { 
        if (st < 250) {
          gttBtn.style.display = "none";
        }

        if (navbar.classList.contains('navbar--hide')) {
          navbar.classList.remove('navbar--hide');
        } else if (!navbar.classList.contains('navbar--show')) {
          navbar.classList.add('navbar--show');
        }

        if (singleContentsElem) {
          if (singleContentsElem.querySelectorAll(tocLevels).length > 0) {
            singleContentsElem.querySelectorAll(tocLevels).forEach(function (elem) {
              if (toggleTocElem && !toggleTocElem.checked) {
                return null;
              }
              
              if (notAllowedTitleIds && notAllowedTitleIds.includes(elem.getAttribute('id'))) {
                return null;
              }

              if (document.documentElement.scrollTop >= elem.offsetTop) {
                if (tableOfContentsElem) {
                  var id = elem.getAttribute('id');
                  tocElem.querySelectorAll('a').forEach(function (elem) {
                    elem.classList.remove('active');
                  });
                  tocElem.querySelector('a[href="#' + id + '"]') ?
                    tocElem.querySelector('a[href="#' + id + '"]').classList.add('active') : null;

                  if (false === tocFolding) {
                    
                  } else {
                    tableOfContentsElem.querySelectorAll('ul') ?
                      tableOfContentsElem.querySelectorAll('ul').forEach(function (rootUl) {
                        rootUl.querySelectorAll('li').forEach(function (liElem) {
                          liElem.querySelectorAll('ul').forEach(function (ulElem) {
                            ulElem.style.display = 'none';
                          });
                        });
                      }) : null;
                  }

                  var curElem = tableOfContentsElem.querySelector("[href='#" + id + "']");
                  if (curElem && curElem.nextElementSibling) {
                    curElem.nextElementSibling.style.display = 'block';
                  }
                  getParents(curElem, 'ul') ?
                    getParents(curElem, 'ul').forEach(function (elem) {
                      elem.style.display = 'block';
                    }) : null;
                }
              }
            });
          } else {
            if (tocFlexbox && !tocFlexbox.classList.contains('hide')) {
              tocFlexbox.classList.add('hide');
            }
            if (tocFlexboxOuter && !tocFlexboxOuter.classList.contains('hide')) {
              tocFlexboxOuter.classList.add('hide');
            }
          }
          
        }

        if (tableOfContentsElem && document.documentElement.scrollTop < 250) {
          if (false === tocFolding) {

          } else {
            tableOfContentsElem.querySelector('ul') ?
              tableOfContentsElem.querySelector('ul').querySelectorAll('li').forEach(function (liElem) {
                liElem.querySelectorAll('ul').forEach(function (ulElem) {
                  ulElem.style.display = 'none';
                });
              }) : null;
          }
        }
      }
      lastScrollTop = st <= 0 ? 0 : st;
    };
  


  
    var localTheme = localStorage.getItem('theme');
    var rootEleme = document.getElementById('root');
    var selectThemeElem = document.querySelectorAll('.select-theme');
    var selectThemeItemElem = document.querySelectorAll('.select-theme__item');

    var setMetaColor = function(themeColor) {
      var metaMsapplicationTileColor = document.getElementsByName('msapplication-TileColor')[0];
      var metaThemeColor = document.getElementsByName('theme-color')[0];
      var metaMsapplicationNavbuttonColor = document.getElementsByName('msapplication-navbutton-color')[0];
      var metaAppleMobileWebAappStatusBarStyle = document.getElementsByName('apple-mobile-web-app-status-bar-style')[0];

      if (themeColor.includes('dark')) {
        metaMsapplicationTileColor.setAttribute('content', '#fcfcfa');
        metaThemeColor.setAttribute('content', '#403E41');
        metaMsapplicationNavbuttonColor.setAttribute('content', '#403E41');
        metaAppleMobileWebAappStatusBarStyle.setAttribute('content', '#403E41');
      } else if (themeColor.includes('light')) {
        metaMsapplicationTileColor.setAttribute('content', '#555');
        metaThemeColor.setAttribute('content', '#eee');
        metaMsapplicationNavbuttonColor.setAttribute('content', '#eee');
        metaAppleMobileWebAappStatusBarStyle.setAttribute('content', '#eee');
      } else if (themeColor.includes('hacker')) {
        metaMsapplicationTileColor.setAttribute('content', '#e3cd26');
        metaThemeColor.setAttribute('content', '#252526');
        metaMsapplicationNavbuttonColor.setAttribute('content', '#252526');
        metaAppleMobileWebAappStatusBarStyle.setAttribute('content', '#252526');
      } else if (themeColor.includes('solarized')) {
        metaMsapplicationTileColor.setAttribute('content', '#d3af86');
        metaThemeColor.setAttribute('content', '#51412c');
        metaMsapplicationNavbuttonColor.setAttribute('content', '#51412c');
        metaAppleMobileWebAappStatusBarStyle.setAttribute('content', '#51412c');
      } else if (themeColor.includes('kimbie')) {
        metaMsapplicationTileColor.setAttribute('content', '#586e75');
        metaThemeColor.setAttribute('content', '#eee8d5');
        metaMsapplicationNavbuttonColor.setAttribute('content', '#eee8d5');
        metaAppleMobileWebAappStatusBarStyle.setAttribute('content', '#eee8d5');
      } 
    }
    
    if (localTheme) {
      selectThemeItemElem ? 
      selectThemeItemElem.forEach(function (elem) {
        if (elem.text.trim() === localTheme) {
          elem.classList.add('is-active');
        } else {
          elem.classList.remove('is-active');
        }
      }) : null;

      setMetaColor(localTheme);
    } else {
      setMetaColor(rootEleme.className);
    }

    selectThemeItemElem ? 
    selectThemeItemElem.forEach(function (v, i) {
      v.addEventListener('click', function (e) {
        var selectedThemeVariant = e.target.text.trim();
        localStorage.setItem('theme', selectedThemeVariant);
        setMetaColor(selectedThemeVariant);

        rootEleme.removeAttribute('class');
        rootEleme.classList.add('theme__' + selectedThemeVariant);
        selectThemeElem.forEach(function(rootElem) {
          rootElem.querySelectorAll('a').forEach(function (elem) {
            if (elem.classList) {
              if (elem.text.trim() === selectedThemeVariant) {
                if (!elem.classList.contains('is-active')) {
                  elem.classList.add('is-active');
                }
              } else {
                if (elem.classList.contains('is-active')) {
                  elem.classList.remove('is-active');
                }
              }
            }
          });
        });

        if (window.mermaid) {
          if (selectedThemeVariant === "dark" || selectedThemeVariant === "hacker") {
            mermaid.initialize({ theme: 'dark' });
            location.reload();
          } else {
            mermaid.initialize({ theme: 'default' });
            location.reload();
          }
        }

        var utterances = document.getElementById('utterances');
        if (utterances) {
          utterances.querySelector('iframe').contentWindow.postMessage({
            type: 'set-theme',
            theme: selectedThemeVariant === "dark" || selectedThemeVariant === "hacker" ? 'photon-dark' : selectedThemeVariant === 'kimbie' ? 'github-dark-orange' : 'github-light',
          }, 'https://utteranc.es');
        }

        var twitterCards = document.querySelectorAll('.twitter-timeline');
        if (twitterCards) {
          window.postMessage({
            type: 'set-twitter-theme',
            theme: selectedThemeVariant === 'light' || selectedThemeVariant === 'solarized' ? 'light' : 'dark',
          });
        }
      });
    }) : null;
  


  
    
    var permalink = JSON.parse("\"https://jmwill.github.io/blog/2017/06/11/%E7%A8%8B%E5%BA%8F%E6%9E%84%E6%88%90-%E7%AC%AC%E5%9B%9B%E7%AB%A0/\"");
    var searchResults = null;
    var searchMenu = null;
    var searchText = null;
    
    
    var enableSearchHighlight = JSON.parse("true");
    
    var searchResultPosition = JSON.parse("null");
    
    var sectionType = JSON.parse("\"posts\"");

    var fuse = null;

    (function initFuse() {
      var xhr = new XMLHttpRequest();
      xhr.open('GET', permalink + "index.json");
      xhr.setRequestHeader('Content-Type', 'application/json; charset=utf-8');
      xhr.onload = function () {
        if (xhr.status === 200) {
          fuse = new Fuse(JSON.parse(xhr.response.toString('utf-8')), {
            keys: sectionType.includes('publication') ? ['title', 'abstract'] : ['title', 'description', 'content'],
            includeMatches: enableSearchHighlight,
            shouldSort: true,
            threshold: 0.4,
            location: 0,
            distance: 100,
            maxPatternLength: 32,
            minMatchCharLength: 1,
          });
          window.fuse = fuse;
        }
        else {
          console.error('[' + xhr.status + ']Error:', xhr.statusText);
        }
      };
      xhr.send();
    })();

    function makeLi(ulElem, obj) {
      var li = document.createElement('li');
      li.className = 'search-result__item';
      
      var a = document.createElement('a');
      a.innerHTML = obj.title;
      a.setAttribute('class', 'search-result__item--title');
      a.setAttribute('href', obj.permalink);

      var descDiv = document.createElement('div');
      descDiv.setAttribute('class', 'search-result__item--desc');
      if (obj.description) {
        descDiv.innerHTML = obj.description;
      } else if (obj.content) {
        descDiv.innerHTML = obj.content.substring(0, 225);
      }
      
      li.appendChild(a);
      li.appendChild(descDiv);
      ulElem.appendChild(li);
    }

    function makeHighlightLi(ulElem, obj) {
      var li = document.createElement('li');
      li.className = 'search-result__item';
      var descDiv = null;

      var a = document.createElement('a');
      a.innerHTML = obj.item.title;
      a.setAttribute('class', 'search-result__item--title');
      a.setAttribute('href', obj.item.uri);

      if (obj.matches && obj.matches.length) {
        for (var i = 0; i < obj.matches.length; i++) {
          if ('title' === obj.matches[i].key) {
            a = document.createElement('a');
            a.innerHTML = generateHighlightedText(obj.matches[i].value, obj.matches[i].indices);
            a.setAttribute('class', 'search-result__item--title');
            a.setAttribute('href', obj.item.uri);
          }
          
          if ('description' === obj.matches[i].key) {
            descDiv = document.createElement('div');
            descDiv.setAttribute('class', 'search-result__item--desc');
            descDiv.innerHTML = generateHighlightedText(obj.item.description, obj.matches[i].indices);
          } else if ('content' === obj.matches[i].key) {
            if (!descDiv) {
              descDiv = document.createElement('div');
              descDiv.setAttribute('class', 'search-result__item--desc');
              descDiv.innerHTML = generateHighlightedText(obj.item.content.substring(0, 150), obj.matches[i].indices);
            }
          } else {
            if (obj.item.description) {
              descDiv = document.createElement('div');
              descDiv.setAttribute('class', 'search-result__item--desc');
              descDiv.innerHTML = obj.item.description;
            } else {
              descDiv = document.createElement('div');
              descDiv.setAttribute('class', 'search-result__item--desc');
              descDiv.innerHTML = obj.item.content.substring(0, 150);
            }
          }
        }

        li.appendChild(a);
        if (descDiv) {
          li.appendChild(descDiv);
        }
        if (li) {
          ulElem.appendChild(li);
        }
      }
    }

    function renderSearchResultsSide(searchText, results) {
      searchResults = document.getElementById('search-results');
      searchMenu = document.getElementById('search-menu');
      searchResults.setAttribute('class', 'dropdown is-active');
      
      var ul = document.createElement('ul');
      ul.setAttribute('class', 'dropdown-content search-content');

      if (results.length) {
        results.forEach(function (result) {
          var li = document.createElement('li');
          var a = document.createElement('a');
          a.setAttribute('href', result.uri);
          a.setAttribute('class', 'dropdown-item');
          a.appendChild(li);

          var titleDiv = document.createElement('div');
          titleDiv.innerHTML = result.title;
          titleDiv.setAttribute('class', 'menu-item__title');

          var descDiv = document.createElement('div');
          descDiv.setAttribute('class', 'menu-item__desc');
          if (result.description) {
            descDiv.innerHTML = result.description;
          } else if (result.content) {
            descDiv.innerHTML = result.content.substring(0, 150);
          }

          li.appendChild(titleDiv);
          li.appendChild(descDiv);
          ul.appendChild(a);
        });
      } else {
        var li = document.createElement('li');
        li.setAttribute('class', 'dropdown-item');
        li.innerText = 'No results found';
        ul.appendChild(li);
      }

      while (searchMenu.hasChildNodes()) {
        searchMenu.removeChild(
          searchMenu.lastChild
        );
      }
      
      searchMenu.appendChild(ul);
    }

    function renderSearchHighlightResultsSide(searchText, results) {
      searchResults = document.getElementById('search-results');
      searchMenu = document.getElementById('search-menu');
      searchResults.setAttribute('class', 'dropdown is-active');

      var ul = document.createElement('ul');
      ul.setAttribute('class', 'dropdown-content search-content');

      if (results.length) {
        results.forEach(function (result) {
          var li = document.createElement('li');
          var a = document.createElement('a');
          var descDiv = null;

          a.setAttribute('href', result.item.uri);
          a.setAttribute('class', 'dropdown-item');
          a.appendChild(li);

          var titleDiv = document.createElement('div');
          titleDiv.innerHTML = result.item.title;
          titleDiv.setAttribute('class', 'menu-item__title');
          
          if (result.matches && result.matches.length) {
            for (var i = 0; i < result.matches.length; i++) {
              if ('title' === result.matches[i].key) {
                titleDiv.innerHTML = generateHighlightedText(result.matches[i].value, result.matches[i].indices);
              }

              if ('description' === result.matches[i].key) {
                descDiv = document.createElement('div');
                descDiv.setAttribute('class', 'menu-item__desc');
                descDiv.innerHTML = generateHighlightedText(result.item.description, result.matches[i].indices);
              } else if ('content' === result.matches[i].key) {
                if (!descDiv) {
                  descDiv = document.createElement('div');
                  descDiv.setAttribute('class', 'menu-item__desc');
                  descDiv.innerHTML = generateHighlightedText(result.item.content.substring(0, 150), result.matches[i].indices);
                }
              } else {
                if (result.item.description) {
                  descDiv = document.createElement('div');
                  descDiv.setAttribute('class', 'menu-item__desc');
                  descDiv.innerHTML = result.item.description;
                } else {
                  descDiv = document.createElement('div');
                  descDiv.setAttribute('class', 'menu-item__desc');
                  descDiv.innerHTML = result.item.content.substring(0, 150);
                }
              }
            }
            
            li.appendChild(titleDiv);
            if (descDiv) {
              li.appendChild(descDiv);
            }
            ul.appendChild(a);
          }
        });
      } else {
        var li = document.createElement('li');
        li.setAttribute('class', 'dropdown-item');
        li.innerText = 'No results found';
        ul.appendChild(li);
      }

      while (searchMenu.hasChildNodes()) {
        searchMenu.removeChild(
          searchMenu.lastChild
        );
      }
      searchMenu.appendChild(ul);
    }

    function renderSearchResultsMobile(searchText, results) {
      searchResults = document.getElementById('search-mobile-results');

      var content = document.createElement('div');
      content.setAttribute('class', 'mobile-search__content');

      if (results.length > 0) {
        results.forEach(function (result) {
          var item = document.createElement('a');
          item.setAttribute('href', result.uri);
          item.innerHTML = '<div class="mobile-search__item"><div class="mobile-search__item--title">ğŸ“„ ' + result.title + '</div><div class="mobile-search__item--desc">' + (result.description ? result.description : result.content) + '</div></div>';
          content.appendChild(item);
        });
      } else {
        var item = document.createElement('span');
        content.appendChild(item);
      }

      let wrap = document.getElementById('search-mobile-results');
      while (wrap.firstChild) {
        wrap.removeChild(wrap.firstChild)
      }
      searchResults.appendChild(content);      
    }

    function renderSearchHighlightResultsMobile(searchText, results) {
      searchResults = document.getElementById('search-mobile-results');

      var ul = document.createElement('div');
      ul.setAttribute('class', 'mobile-search__content');

      if (results.length) {
        results.forEach(function (result) {
          var li = document.createElement('li');
          var a = document.createElement('a');
          var descDiv = null;

          a.setAttribute('href', result.item.uri);
          a.appendChild(li);
          li.setAttribute('class', 'mobile-search__item');

          var titleDiv = document.createElement('div');
          titleDiv.innerHTML = result.item.title;
          titleDiv.setAttribute('class', 'mobile-search__item--title');
          
          if (result.matches && result.matches.length) {
            for (var i = 0; i < result.matches.length; i++) {
              if ('title' === result.matches[i].key) {
                titleDiv.innerHTML = generateHighlightedText(result.matches[i].value, result.matches[i].indices);
              }

              if ('description' === result.matches[i].key) {
                descDiv = document.createElement('div');
                descDiv.setAttribute('class', 'mobile-search__item--desc');
                descDiv.innerHTML = generateHighlightedText(result.item.description, result.matches[i].indices);
              } else if ('content' === result.matches[i].key) {
                if (!descDiv) {
                  descDiv = document.createElement('div');
                  descDiv.setAttribute('class', 'mobile-search__item--desc');
                  descDiv.innerHTML = generateHighlightedText(result.item.content.substring(0, 150), result.matches[i].indices);
                }
              } else {
                if (result.item.description) {
                  descDiv = document.createElement('div');
                  descDiv.setAttribute('class', 'mobile-search__item--desc');
                  descDiv.innerHTML = result.item.description;
                } else {
                  descDiv = document.createElement('div');
                  descDiv.setAttribute('class', 'mobile-search__item--desc');
                  descDiv.innerHTML = result.item.content.substring(0, 150);
                }
              }
            }
            
            li.appendChild(titleDiv);
            if (descDiv) {
              li.appendChild(descDiv);
            }
            ul.appendChild(a);
          }
        });
      } else {
        var item = document.createElement('span');
        ul.appendChild(item);
      }

      let wrap = document.getElementById('search-mobile-results');
      while (wrap.firstChild) {
        wrap.removeChild(wrap.firstChild)
      }
      searchResults.appendChild(ul);
    }

    function generateHighlightedText(text, regions) {
      if (!regions) {
        return text;
      }

      var content = '', nextUnhighlightedRegionStartingIndex = 0;

      regions.forEach(function(region) {
        if (region[0] === region[1]) {
          return null;
        }
        
        content += '' +
          text.substring(nextUnhighlightedRegionStartingIndex, region[0]) +
          '<span class="search__highlight">' +
            text.substring(region[0], region[1] + 1) +
          '</span>' +
        '';
        nextUnhighlightedRegionStartingIndex = region[1] + 1;
      });

      content += text.substring(nextUnhighlightedRegionStartingIndex);

      return content;
    };

    var searchElem = document.getElementById('search');
    var searchMobile = document.getElementById('search-mobile');
    var searchResultsContainer = document.getElementById('search-results');

    searchElem ?
    searchElem.addEventListener('input', function(e) {
      if (!e.target.value | window.innerWidth < 770) {
        searchResultsContainer ? searchResultsContainer.setAttribute('class', 'dropdown') : null;
        searchResult ? searchResult.setAttribute('data-display', 'none') : null;
        summaryContainer ? summaryContainer.setAttribute('data-display', 'block') : null;
        return null;
      }

      searchText = e.target.value;
      var results = fuse.search(e.target.value);
      
      if (searchResultPosition === "main") {
        if (enableSearchHighlight) {
          renderSearchHighlightResultsMain(searchText, results);
        } else {
          renderSearchResultsMain(searchText, results);
        }
      } else {
        if (enableSearchHighlight) {
          renderSearchHighlightResultsSide(searchText, results);
        } else {
          renderSearchResultsSide(searchText, results);
        }
        
        var dropdownItems = searchResultsContainer.querySelectorAll('.dropdown-item');
        dropdownItems ? dropdownItems.forEach(function(item) {
          item.addEventListener('mousedown', function(e) {
            e.target.click();
          });
        }) : null;
      }
    }) : null;

    searchElem ? 
    searchElem.addEventListener('blur', function() {
      if (window.innerWidth < 770) {
        return null;
      }
      searchResultsContainer ? searchResultsContainer.setAttribute('class', 'dropdown') : null;
    }) : null;

    searchElem ? 
    searchElem.addEventListener('click', function(e) {
      if (window.innerWidth < 770) {
        return null;
      }
      if (!e.target.value) {
        searchResultsContainer ? searchResultsContainer.setAttribute('class', 'dropdown') : null;
        return null;
      }

      searchText = e.target.value;
      var results = fuse.search(e.target.value);

      if (searchResultPosition === "main") {
        if (enableSearchHighlight) {
          renderSearchHighlightResultsMain(searchText, results);
        } else {
          renderSearchResultsMain(searchText, results);
        }
      } else{
        if (enableSearchHighlight) {
          renderSearchHighlightResultsSide(searchText, results);
        } else {
          renderSearchResultsSide(searchText, results);
        }

        var dropdownItems = searchResultsContainer.querySelectorAll('.dropdown-item');
        dropdownItems ? dropdownItems.forEach(function (item) {
          item.addEventListener('mousedown', function (e) {
            e.target.click();
          });
        }) : null;
      }
    }) : null;

    var searchMenuElem = document.getElementById("search-menu");
    var activeItem = document.querySelector('#search-menu .dropdown-item.is-active');
    var activeIndex = null;
    var items = null;
    var searchContainerMaxHeight = 350;

    searchElem ? 
    searchElem.addEventListener('keydown', function(e) {
      if (window.innerWidth < 770) {
        return null;
      }

      if (e.key === 'Escape') {
        searchResult ? searchResult.setAttribute('data-display', 'none') : null;
        summaryContainer ? summaryContainer.setAttribute('data-display', 'block') : null;
      }

      var items = document.querySelectorAll('#search-menu .dropdown-item');
      var keyCode = e.which || e.keyCode;

      if (!items || !items.length) {
        return null;
      }
      
      if (e.key === 'ArrowDown' || keyCode === 40) {
        if (activeIndex === null) {
          activeIndex = 0;
          items[activeIndex].classList.remove('is-active');
        } else {
          items[activeIndex].classList.remove('is-active');
          activeIndex = activeIndex === items.length - 1 ? 0 : activeIndex + 1;
        }
        items[activeIndex].classList.add('is-active');

        let overflowedPixel = items[activeIndex].offsetTop + items[activeIndex].clientHeight - searchContainerMaxHeight;
        if (overflowedPixel > 0) {
          document.querySelector(".search-content").scrollTop += items[activeIndex].getBoundingClientRect().height;
        } else if (activeIndex === 0) {
          document.querySelector(".search-content").scrollTop = 0;
        }
      } else if (e.key === 'ArrowUp' || keyCode === 38) {
        if (activeIndex === null) {
          activeIndex = items.length - 1;
          items[activeIndex].classList.remove('is-active');
        } else {
          items[activeIndex].classList.remove('is-active');
          activeIndex = activeIndex === 0 ? items.length - 1 : activeIndex - 1;
        }
        items[activeIndex].classList.add('is-active');
        
        let overflowedPixel = items[activeIndex].offsetTop + items[activeIndex].clientHeight - searchContainerMaxHeight;
        if (overflowedPixel < 0) {
          document.querySelector(".search-content").scrollTop -= items[activeIndex].getBoundingClientRect().height;
        } else {
          document.querySelector(".search-content").scrollTop = overflowedPixel + items[activeIndex].getBoundingClientRect().height;
        }
      } else if (e.key === 'Enter' || keyCode === 13) {
        if (items[activeIndex] && items[activeIndex].getAttribute('href')) {
          location.href = items[activeIndex].getAttribute('href');
        }
      } else if (e.key === 'Escape' || keyCode === 27) {
        e.target.value = null;
        if (searchResults) {
          searchResults.classList.remove('is-active');
        }
      }
    }) : null;

    searchMobile ? 
    searchMobile.addEventListener('input', function(e) {
      if (!e.target.value) {
        let wrap = document.getElementById('search-mobile-results');
        while (wrap.firstChild) {
          wrap.removeChild(wrap.firstChild);
        }
        return null;
      }

      searchText = e.target.value;
      var results = fuse.search(e.target.value);
      renderSearchResultsMobile(searchText, results);
      if (enableSearchHighlight) {
        renderSearchHighlightResultsMobile(searchText, results);
      } else {
        renderSearchResultsMobile(searchText, results);
      }
    }) : null;
  


  
    var mobileSearchInputElem = document.querySelector('#search-mobile');
    var mobileSearchClassElem = document.querySelector('.mobile-search');
    var mobileSearchBtnElem = document.querySelector('#mobileSearchBtn');
    var mobileSearchCloseBtnElem = document.querySelector('#search-mobile-close');
    var mobileSearchContainer = document.querySelector('#search-mobile-container');
    var mobileSearchResultsElem = document.querySelector('#search-mobile-results');
    var htmlElem = document.querySelector('html');

    if (mobileSearchClassElem) {
      mobileSearchClassElem.style.display = 'none';
    }

    mobileSearchBtnElem ? 
    mobileSearchBtnElem.addEventListener('click', function () {
      if (mobileSearchContainer) {
        mobileSearchContainer.style.display = 'block';
      }

      if (mobileSearchInputElem) {
        mobileSearchInputElem.focus();
      }

      if (htmlElem) {
        htmlElem.style.overflowY = 'hidden';
      }
    }) : null;

    mobileSearchCloseBtnElem ? 
    mobileSearchCloseBtnElem.addEventListener('click', function() {
      if (mobileSearchContainer) {
        mobileSearchContainer.style.display = 'none';
      }

      if (mobileSearchInputElem) {
        mobileSearchInputElem.value = '';
      }
      
      if (mobileSearchResultsElem) {
        while (mobileSearchResultsElem.firstChild) {
          mobileSearchResultsElem.removeChild(mobileSearchResultsElem.firstChild);
        }
      }

      if (htmlElem) {
        htmlElem.style.overflowY = 'visible';
      }
    }) : null;

    mobileSearchInputElem ?
    mobileSearchInputElem.addEventListener('keydown', function(e) {
      var keyCode = e.which || e.keyCode;
      if (e.key === 'Escape' || keyCode === 27) {
        if (mobileSearchContainer) {
          mobileSearchContainer.style.display = 'none';
        }
        
        if (mobileSearchInputElem) {
          mobileSearchInputElem.value = '';
        }

        if (mobileSearchResultsElem) {
          while (mobileSearchResultsElem.firstChild) {
            mobileSearchResultsElem.removeChild(mobileSearchResultsElem.firstChild);
          }
        }
        if (htmlElem) {
          htmlElem.style.overflowY = 'visible';
        }
      }
    }) : null;
  


  
    function renderSearchResultsMain(searchText, results) {
      var searchBody = document.querySelector('.search-result__body');
      var originUl = searchBody.querySelector('ul');
      var ul = document.createElement('ul');
      
      if (!searchText) {
        searchResult ? searchResult.setAttribute('data-display', 'none') : null;
        summaryContainer ? summaryContainer.setAttribute('data-display', 'block') : null;
      } else if (results) {
        if (results && results.length) {
          results.forEach(function (result) {
            makeLi(ul, result);
          });

          searchResult ? searchResult.setAttribute('data-display', 'block') : null;
          summaryContainer ? summaryContainer.setAttribute('data-display', 'none') : null;
        }
      }

      originUl.parentNode.replaceChild(ul, originUl);
    }

    function renderSearchHighlightResultsMain(searchText, results) {
      var searchBody = document.querySelector('.search-result__body');
      var originUl = searchBody.querySelector('ul');
      var ul = document.createElement('ul');

      if (!searchText) {
        searchResult ? searchResult.setAttribute('data-display', 'none') : null;
        summaryContainer ? summaryContainer.setAttribute('data-display', 'block') : null;
      } else if (results) {
        if (results && results.length) {
          results.forEach(function (result) {
            makeHighlightLi(ul, result);
          });

          searchResult ? searchResult.setAttribute('data-display', 'block') : null;
          summaryContainer ? summaryContainer.setAttribute('data-display', 'none') : null;
        }
      }

      originUl.parentNode.replaceChild(ul, originUl);
    }
  
  });
</script>    
    


<link rel="stylesheet" href="/blog/css/main.min.css">


    
<meta name="description" content="JMwill&#39;s github site. Build with hugo" />


<meta name="keywords" content="è¯‘æ–‡,Design Programs">

<meta name="created" content="2017-06-11T16:57:56&#43;0800">
<meta name="modified" content="2017-06-11T16:57:56&#43;0800">
<meta property="article:published_time" content="2017-06-11T16:57:56&#43;0800">

<meta name="author" content="Will">


<meta property="og:site_name" content="Will&#39;s Blog">
<meta property="og:title" content="ç¨‹åºæ„æˆ-ç¬¬å››ç« ">
<meta property="og:url" content="https://jmwill.github.io/blog/2017/06/11/%E7%A8%8B%E5%BA%8F%E6%9E%84%E6%88%90-%E7%AC%AC%E5%9B%9B%E7%AB%A0/">
<meta property="og:type" content="article">
<meta property="og:description" content="JMwill&#39;s github site. Build with hugo">

<meta name="generator" content="Hugo 0.74.2" />
<meta name="msapplication-TileColor" content="#fff">

<meta name="theme-color" content="#fff">

<meta name="msapplication-navbutton-color" content="#fff">

<meta name="apple-mobile-web-app-status-bar-style" content="#fff">

<link rel="canonical" href="https://jmwill.github.io/blog/2017/06/11/%E7%A8%8B%E5%BA%8F%E6%9E%84%E6%88%90-%E7%AC%AC%E5%9B%9B%E7%AB%A0/">

<link rel="manifest" href="/blog/manifest.json">

  
  <link rel="shortcut icon" href="/blog/favicon.ico" type="image/x-icon">
  <link rel="icon" href="/blog/favicon.png" sizes="any" type="image/png" />
  


    <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebPage",
    "headline": "ç¨‹åºæ„æˆ-ç¬¬å››ç« ",
    "datePublished": "2017-06-11T16:57:56+08:00",
    "dateModified": "2017-06-11T16:57:56+08:00",
    "url" : "https://jmwill.github.io/blog/2017/06/11/%E7%A8%8B%E5%BA%8F%E6%9E%84%E6%88%90-%E7%AC%AC%E5%9B%9B%E7%AB%A0/",
    "description": "\u003ch2 id=\"ç¬¬å››ç« -æ•°æ®å¤„ç†\"\u003eç¬¬å››ç« : æ•°æ®å¤„ç†\u003c/h2\u003e \u003ch3 id=\"41-ä»‹ç»\"\u003e4.1 ä»‹ç»\u003c/h3\u003e \u003cp\u003eç°ä»£è®¡ç®—æœºå¯ä»¥å¤„ç†å¤§é‡è¡¨ç¤ºä¸–ç•Œè®¸å¤šæ–¹é¢çš„æ•°æ®. ä»è¿™äº›å¤§æ•°æ®é›†åˆ, æˆ‘ä»¬å¯ä»¥ä»¥å‰æ‰€æœªæœ‰çš„æ–¹å¼å­¦ä¹ åˆ°äººç±»çš„ç›¸å…³è¡Œä¸º: è¯­è¨€æ˜¯å¦‚ä½•ä½¿ç”¨çš„, æ‹æ‘„ä»€ä¹ˆç…§ç‰‡, è®¨è®ºä»€ä¹ˆè¯é¢˜, ä»¥åŠäººä»¬æ˜¯å¦‚ä½•è·Ÿä»–ä»¬å‘¨å›´çš„ç¯å¢ƒæ¥æ¥è§¦çš„. ä¸ºäº†é«˜æ•ˆåœ°å¤„ç†å¤§æ•°æ®é›†åˆ, ç¨‹åºè¢«ç»„ç»‡æˆå¯¹æœ‰åºçš„æ•°æ®æµè¿›è¡Œæ“ä½œçš„ç®¡é“. åœ¨æœ¬ç« , æˆ‘ä»¬ä¼šè€ƒè™‘ä¸€å¥— â€¦\u003c/p\u003e",
    "keywords": ["è¯‘æ–‡","Design Programs"],
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "https://jmwill.github.io/blog/"
    },
    "publisher": {
      "@type": "Organization",
      "name": "Will's Blog",
      "url": "https://jmwill.github.io/blog/"
    }
  }
</script>

    
  
  







    
</head>

<body id="root" class="theme__solarized">
    <script>
        var localTheme = localStorage.getItem('theme');
        if (localTheme) {
            document.getElementById('root').className = 'theme__' + localTheme;
        }
    </script>
    <div id="container">
        





        <div class="wrapper" data-type="posts" data-kind="page">
            <nav class="navbar" role="navigation" aria-label="main navigation" data-dir="ltr">
  <div class="navbar__brand">
    
    <a href="/blog/" title="Home" rel="home" class="navbar__logo-link">
      <img src="/blog/logo.png" alt="Home" class="navbar__logo">
    </a>
    
    
      <a href="/blog/" title="Home" rel="home" class="navbar__title-link">
        <h6 class="navbar__title">Will</h6>
      </a>
    
  </div>

  
<div class="theme theme-mobile" data-ani="true">
  <div class="dropdown">
    <button class="dropdown-trigger navbar__slide-down" aria-label="Select Theme Button" style="" data-ani="true">
      <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24"><path fill="none" d="M24 0H0v24h24V0z"/><path fill="currentColor" d="M6.34 7.93c-3.12 3.12-3.12 8.19 0 11.31C7.9 20.8 9.95 21.58 12 21.58s4.1-.78 5.66-2.34c3.12-3.12 3.12-8.19 0-11.31l-4.95-4.95c-.39-.39-1.02-.39-1.41 0L6.34 7.93zM12 19.59c-1.6 0-3.11-.62-4.24-1.76C6.62 16.69 6 15.19 6 13.59s.62-3.11 1.76-4.24L12 5.1v14.49z"/></svg>      
    </button>
    <div class="dropdown-content select-theme">
      
        
        <a href="#" class="dropdown-item select-theme__item is-active">
          solarized
        </a>
        
        <a href="#" class="dropdown-item select-theme__item ">
          dark
        </a>
        
        <a href="#" class="dropdown-item select-theme__item ">
          light
        </a>
        
        <a href="#" class="dropdown-item select-theme__item ">
          hacker
        </a>
        
        <a href="#" class="dropdown-item select-theme__item ">
          kimbie
        </a>
        
      
    </div>
  </div>
</div>


<div id="mobileSearchBtn" class="mobile-search__btn" data-ani="true">
  <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="currentColor" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M15.5 14h-.79l-.28-.27c1.2-1.4 1.82-3.31 1.48-5.34-.47-2.78-2.79-5-5.59-5.34-4.23-.52-7.79 3.04-7.27 7.27.34 2.8 2.56 5.12 5.34 5.59 2.03.34 3.94-.28 5.34-1.48l.27.28v.79l4.25 4.25c.41.41 1.08.41 1.49 0 .41-.41.41-1.08 0-1.49L15.5 14zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
</div>

<div id="search-mobile-container" class="mobile-search hide" data-dir="ltr">
  <div class="mobile-search__top">
    <input id="search-mobile" type="text" aria-label="Mobile Search" placeholder="Search" class="mobile-search__top--input"/>
    <div id="search-mobile-close" class="mobile-search__top--icon">
      <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24"><path opacity=".87" fill="none" d="M0 0h24v24H0V0z"/><path fill="currentColor" d="M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm3.59-13L12 10.59 8.41 7 7 8.41 10.59 12 7 15.59 8.41 17 12 13.41 15.59 17 17 15.59 13.41 12 17 8.41z"/></svg>
    </div>
  </div>
  <div id="search-mobile-results" class="mobile-search__body">
    
  </div>
</div>


<a role="button" class="navbar__burger" aria-label="menu" aria-expanded="false"
  data-ani="true">
  <span aria-hidden="true"></span>
  <span aria-hidden="true"></span>
  <span aria-hidden="true"></span>
</a>
<div class="navbarm__collapse" data-open="false">
  <ul dir="ltr">
    
    
      
      
      
      

      
        <li class="navbarm__menu--item active">
          <a href="/blog/posts">posts</a>
        </li>
      
      
    
      
      
      
      

      
        <li class="navbarm__menu--item ">
          <a href="/blog/archive">archive</a>
        </li>
      
      
    
      
      
      
      

      
        <li class="navbarm__menu--item ">
          <a href="/blog/about">about</a>
        </li>
      
      
    

    
      <li class="navbarm__menu--item ">
        <a href="/blog/tags" class="navbarm__menu--term" data-index="0">
          Tags
        </a>
      </li>
    
  </ul>
</div>
  <div class="navbar__menu">
  
<div class="theme" data-ani="true">
  <div class="dropdown">
    <button class="dropdown-trigger navbar__slide-down" aria-label="Select Theme Button" data-ani="true">
      <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24"><path fill="none" d="M24 0H0v24h24V0z"/><path fill="currentColor" d="M6.34 7.93c-3.12 3.12-3.12 8.19 0 11.31C7.9 20.8 9.95 21.58 12 21.58s4.1-.78 5.66-2.34c3.12-3.12 3.12-8.19 0-11.31l-4.95-4.95c-.39-.39-1.02-.39-1.41 0L6.34 7.93zM12 19.59c-1.6 0-3.11-.62-4.24-1.76C6.62 16.69 6 15.19 6 13.59s.62-3.11 1.76-4.24L12 5.1v14.49z"/></svg>      
    </button>
    <div class="dropdown-content select-theme">
      
        
        <a href="#" class="dropdown-item select-theme__item is-active">
          solarized
        </a>
        
        <a href="#" class="dropdown-item select-theme__item ">
          dark
        </a>
        
        <a href="#" class="dropdown-item select-theme__item ">
          light
        </a>
        
        <a href="#" class="dropdown-item select-theme__item ">
          hacker
        </a>
        
        <a href="#" class="dropdown-item select-theme__item ">
          kimbie
        </a>
        
      
    </div>
  </div>
</div>

  
  
  
  
  
  
  
  <a href="/blog/posts" class="navbar__menu-item navbar__slide-down active" dir="ltr" data-ani="true">posts</a>
  
  
  
  
  
  
  
  <a href="/blog/archive" class="navbar__menu-item navbar__slide-down " dir="ltr" data-ani="true">archive</a>
  
  
  
  
  
  
  
  <a href="/blog/about" class="navbar__menu-item navbar__slide-down " dir="ltr" data-ani="true">about</a>
  
  
</div>
</nav>
            
            

<main class="single__main main-main">
  
    <nav class="breadcrumb hide" aria-label="breadcrumbs">
  <script>document.querySelector('.breadcrumb').classList.remove('hide')</script>
  <ol>
    
  
  
  
  
  
  <li >
    
      <a href="https://jmwill.github.io/blog/" class="capitalize">Will&#39;s Blog</a>
    
  </li>
  
  
  <li >
    
      <a href="https://jmwill.github.io/blog/posts/" class="capitalize">Posts</a>
    
  </li>
  
  
  <li  class="is-active" >
    
      <span>ç¨‹åºæ„æˆ-ç¬¬å››ç« </span>
    
  </li>
  
  </ol>
  
</nav>
  
  
  <div class="single ">
    <div class="single__nojs">This page looks best with JavaScript enabled</div>
    <script>document.querySelector('.single').classList.remove('hide'); document.querySelector('.single__nojs').classList.add('hide');</script>
    <h2 class="single__title" data-ani="true">ç¨‹åºæ„æˆ-ç¬¬å››ç« </h2>
    <div class="single__meta">
      
<div class="single__infos">
  <time class="single__info" title="Written At">ğŸ“…&nbsp;Jun 11, 2017 </time>
  
  &nbsp;&middot;&nbsp; <span class="single__info" title="Reading Time"> â˜•&nbsp;68&nbsp;min read </span>
  
  <span class="single__info">
    
  </span>
</div>
      
<ul class="single__tags caption">
  
  ğŸ·ï¸
  

  <li><a href="https://jmwill.github.io/blog/tags/%E8%AF%91%E6%96%87/" class="single__tag" title="è¯‘æ–‡">#è¯‘æ–‡</a></li>

  <li><a href="https://jmwill.github.io/blog/tags/design-programs/" class="single__tag" title="Design Programs">#Design Programs</a></li>

</ul>
    </div>
    <article class="single__contents" data-dir="ltr" data-ani="true">
      
      <h2 id="ç¬¬å››ç« -æ•°æ®å¤„ç†">ç¬¬å››ç« : æ•°æ®å¤„ç†</h2>
<h3 id="41-ä»‹ç»">4.1 ä»‹ç»</h3>
<p>ç°ä»£è®¡ç®—æœºå¯ä»¥å¤„ç†å¤§é‡è¡¨ç¤ºä¸–ç•Œè®¸å¤šæ–¹é¢çš„æ•°æ®. ä»è¿™äº›å¤§æ•°æ®é›†åˆ, æˆ‘ä»¬å¯ä»¥ä»¥å‰æ‰€æœªæœ‰çš„æ–¹å¼å­¦ä¹ åˆ°äººç±»çš„ç›¸å…³è¡Œä¸º: è¯­è¨€æ˜¯å¦‚ä½•ä½¿ç”¨çš„, æ‹æ‘„ä»€ä¹ˆç…§ç‰‡, è®¨è®ºä»€ä¹ˆè¯é¢˜, ä»¥åŠäººä»¬æ˜¯å¦‚ä½•è·Ÿä»–ä»¬å‘¨å›´çš„ç¯å¢ƒæ¥æ¥è§¦çš„. ä¸ºäº†é«˜æ•ˆåœ°å¤„ç†å¤§æ•°æ®é›†åˆ, ç¨‹åºè¢«ç»„ç»‡æˆå¯¹æœ‰åºçš„æ•°æ®æµè¿›è¡Œæ“ä½œçš„ç®¡é“. åœ¨æœ¬ç« , æˆ‘ä»¬ä¼šè€ƒè™‘ä¸€å¥—çš„æŠ€æœ¯æ¥å¤„ç†å¹¶æ“çºµæœ‰åºæ•°æ®æµ.</p>
<p>åœ¨ç¬¬äºŒç« , æˆ‘ä»¬ä¼šå¼•å…¥åºåˆ—æ¥å£, é€šè¿‡å†…ç½®çš„æ•°æ®ç±»å‹(å¦‚åˆ—è¡¨å’ŒèŒƒå›´)æ¥åœ¨Pythonä¸­å®ç°. åœ¨è¿™ç« ä¸­, æˆ‘ä»¬å°†ä¼šæ‹“å±•åºåˆ—æ•°æ®çš„æ¦‚å¿µ, åŒ…æ‹¬ä¸å…·è¾¹ç•Œç”šè‡³æ˜¯æ— é™å¤§å°çš„é›†åˆ. ä¸¤ä¸ªæ•°å­¦ä¸Šçš„æ— é™åºåˆ—ä¾‹å­æ˜¯æ­£æ•´æ•°ä»¥åŠæ–æ³¢é‚£å¥‘æ•°åˆ—. å…·æœ‰æ— é™é•¿åº¦çš„åºåˆ—æ•°æ®é›†åˆä¹Ÿå‡ºç°åœ¨å…¶ä»–è®¡ç®—é¢†åŸŸ. ä¾‹å¦‚, é€šè¿‡ç”µè¯å¡”å‘é€çš„ç”µè¯åºåˆ—, ç”±è®¡ç®—æœºç”¨æˆ·è¿›è¡Œçš„é¼ æ ‡ç§»åŠ¨çš„åºåˆ—, ä»¥åŠé£æœºä¸Šä¼ æ„Ÿå™¨çš„åŠ é€Ÿåº¦æµ‹é‡åºåˆ—éšç€ä¸–ç•Œçš„å‘å±•è€Œæ— é™å»¶ä¼¸.</p>
<h3 id="42-éšå«åºåˆ—">4.2 éšå«åºåˆ—</h3>
<p>ä¸€ä¸ªåºåˆ—å¯ä»¥æ— éœ€å¯¹æ¯ä¸ªå…ƒç´ è¿›è¡Œæ˜ç¡®å­˜å‚¨åœ¨è®¡ç®—æœºçš„å­˜å‚¨å™¨ä¸­è€Œè¡¨ç¤ºå‡ºæ¥. ä¹Ÿå°±æ˜¯è¯´, æˆ‘ä»¬å¯ä»¥æ„é€ ä¸€ä¸ªå¯¹è±¡æ¥æä¾›è®¿é—®æŸäº›é¡ºåºæ•°æ®é›†çš„æ‰€æœ‰å…ƒç´ è€Œä¸ç”¨æå‰è®¡ç®—æ‰€æœ‰è¿™äº›å…ƒç´ å¹¶ä¿å­˜å®ƒä»¬. ç›¸å, æˆ‘ä»¬æŒ‰éœ€æ¥è®¡ç®—å…ƒç´ .</p>
<p>è¿™ä¸ªæƒ³æ³•çš„ä¸€ä¸ªç®€å•çš„ä¾‹å­å‡ºç°åœ¨ç¬¬äºŒç« ä»‹ç»çš„<code>range</code>åºåˆ—ç±»å‹ä¸­. ä¸€ä¸ª<code>range</code>è¡¨ç¤ºä¸€ä¸ªè¿ç»­, æœ‰ç•Œçš„æ•´æ•°åºåˆ—. ç„¶è€Œ, åºåˆ—çš„æ¯ä¸ªå…ƒç´ åœ¨è¿™ä¸ªæƒ…å†µä¸‹å¹¶ä¸æ˜¯æ˜ç¡®å­˜åœ¨äºå†…å­˜ä¸­çš„. ç›¸å, å½“<code>range</code>ä¸­çš„å…ƒç´ è¢«è¯·æ±‚æ—¶, å®ƒä¼šè®¡ç®—å‡ºè¿™ä¸ªå…ƒç´ . å› æ­¤, æˆ‘ä»¬å¯ä»¥è¡¨ç¤ºéå¸¸å¤§çš„æ•´æ•°è€Œä¸ç”¨å¤§å—çš„å†…å­˜. åªæœ‰<code>range</code>çš„ç»ˆç»“ç‚¹å­˜å‚¨ä¸º<code>range</code>å¯¹è±¡çš„ä¸€éƒ¨åˆ†.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="n">r</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">1000000000</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">r</span> <span class="o">=</span> <span class="p">[</span><span class="mi">45006230</span><span class="p">]</span>

<span class="mi">45006230</span>
</code></pre></td></tr></table>
</div>
</div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­, ä¸æ˜¯æ‰€æœ‰åœ¨999,990,000è¿™ä¸ªèŒƒå›´çš„æ•´æ•°åœ¨åˆ›å»ºçš„æ—¶å€™éƒ½ä¼šè¢«å­˜å‚¨. ç›¸å, èŒƒå›´å¯¹è±¡æ·»åŠ ç¬¬ä¸€ä¸ªå…ƒç´ 10,000ä¸€ç›´åˆ°åˆ°ä¸‹æ ‡45,006,230æ¥äº§å‡ºå…ƒç´ 45,016,230. ä¸€æ—¦è¯·æ±‚å°±ä¼šè®¡ç®—å€¼è€Œä¸æ˜¯ä»ä¸€ä¸ªå·²å­˜åœ¨çš„è¡¨ç¤ºæ¥æ£€ç´¢å®ƒä»¬, è¿™æ˜¯ä¸€ä¸ªæ‡’è®¡ç®—çš„ä¾‹å­. åœ¨è®¡ç®—æœºç§‘å­¦, æ‡’è®¡ç®—æè¿°ä»»ä½•å»¶è¿Ÿè®¡ç®—çš„ç¨‹åº, ç›´åˆ°éœ€è¦è¯¥å€¼ä¸ºæ­¢.</p>
<p>ä¸€ä¸ªè¿­ä»£å™¨æ˜¯ä¸€ä¸ªå¯¹è±¡, å®ƒæä¾›å¯¹åº•å±‚é¡ºåºæ•°æ®é›†çš„é¡ºåºè®¿é—®. è¿­ä»£å™¨åœ¨å¾ˆå¤šç¨‹åºä¸­æ˜¯å†…å»ºå¯¹è±¡, åŒ…æ‹¬Python. è¿­ä»£å™¨çš„æŠ½è±¡å…·æœ‰ä¸¤ä¸ªéƒ¨åˆ†, ä¸€ä¸ªåœ¨ä¸€ä¸ªåº•å±‚å…ƒç´ ä¸­æ£€ç´¢ä¸‹ä¸€ä¸ªå…ƒç´ çš„æœºåˆ¶ä»¥åŠä¸€ä¸ªå‘å‡ºå·²ç»åˆ°è¾¾åºåˆ—çš„ç»ˆç‚¹å¹¶æ²¡æœ‰æ›´å¤šå…ƒç´ çš„ä¿¡å·æœºåˆ¶. åœ¨å…·æœ‰å†…å»ºå¯¹è±¡ç³»ç»Ÿçš„ç¼–ç¨‹è¯­è¨€ä¸­, è¿™ä¸ªæŠ½è±¡é€šå¸¸æ¥è¯´å¯¹åº”åˆ°ç‰¹å®šçš„å¯ä»¥é€šè¿‡ç±»æ¥å®ç°çš„æ¥å£. Pythonæä¾›çš„è¿­ä»£å™¨æ¥å£æè¿°ä¼šåœ¨ä¸‹ä¸€èŠ‚ä¸­æè¿°.</p>
<p>è¿­ä»£å™¨çš„æœ‰ç”¨æ€§æºäºä¸€ä¸ªäº‹å®å³: è¿­ä»£å™¨çš„åº•å±‚æ•°æ®åºåˆ—å¯èƒ½ä¸ä¼šåœ¨å­˜å‚¨å™¨ä¸­æ˜ç¡®è¡¨ç¤º. è¿­ä»£å™¨æä¾›äº†ä¸€ä¸ªæœºåˆ¶æ¥é¡ºåºè€ƒé‡ä¸€ç³»åˆ—æ•°æ®çš„å€¼, ä½†åŒæ—¶æ‰€æœ‰çš„å…ƒç´ ä¸éœ€è¦å­˜å‚¨åœ¨å†…å­˜ä¸­. ç›¸å, å½“ä¸‹ä¸€ä¸ªå…ƒç´ è¢«è¿­ä»£å™¨è¯·æ±‚, å…ƒç´ å¯ä»¥æ ¹æ®éœ€è¦è®¡ç®—è€Œä¸æ˜¯ä»ç°æœ‰å†…å­˜æºä¸­æ£€ç´¢.</p>
<p>èŒƒå›´ç±»å¯ä»¥å¯¹ä¸€ä¸ªåˆ—è¡¨çš„å…ƒç´ è¿›è¡Œæ‡’è®¡ç®—å› ä¸ºæ‰€è¡¨ç¤ºçš„åºåˆ—æ˜¯å‡åŒ€çš„, åŒæ—¶ä»»ä½•å…ƒç´ éƒ½å®¹æ˜“ä»<code>range</code>çš„å¼€å§‹å’Œç»“æŸçš„è¾¹ç•Œè®¡ç®—. è¿­ä»£å™¨å…è®¸æ‡’ç”Ÿæˆæ›´å¹¿æ³›ç±»å‹çš„åº•å±‚é¡ºåºæ•°æ®é›†, å› ä¸ºå®ƒä»¬ä¸éœ€è¦æä¾›å¯¹ä»»æ„å…ƒç´ çš„åº•å±‚åºåˆ—çš„è®¿é—®. ç›¸å, è¿­ä»£å™¨åªéœ€è¦åœ¨æ¯æ¬¡è¯·æ±‚ä¸€ä¸ªå…ƒç´ æ—¶æŒ‰é¡ºåºå»è®¡ç®—è¯¥åºåˆ—ä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç´ . è™½ç„¶ä¸åƒè®¿é—®åºåˆ—çš„ä»»æ„å…ƒç´ ä¸€æ ·çµæ´»(ç§°ä¸ºéšæœºè®¿é—®), é¡ºåºè®¿é—®é¡ºåºæ•°æ®åºåˆ—é€šå¸¸æ¥è¯´è¶³ä»¥ç”¨äºæ•°æ®å¤„ç†åº”ç”¨.</p>
<h4 id="421-pythonè¿­ä»£å™¨">4.2.1 Pythonè¿­ä»£å™¨</h4>
<p>Pythonçš„è¿­ä»£å™¨æ¥å£æ˜¯ç”¨ä¸€ä¸ªå«åš<code>__next__</code>çš„æ–¹æ³•æ¥å®šä¹‰çš„, å®ƒä¼šè¿”å›å®ƒæ‰€ä»£è¡¨çš„ä¸€äº›åº•å±‚åºåˆ—æ•°æ®çš„ä¸‹ä¸€ä¸ªå…ƒç´ . å“åº”è°ƒç”¨<code>__next__</code>æ–¹æ³•, è¿­ä»£å™¨å¯ä»¥æ‰§è¡Œä»»æ„è®¡ç®—ä»¥ä¾¿æ£€ç´¢æˆ–è€…è®¡ç®—å‡ºä¸‹ä¸€ä¸ªå…ƒç´ . è°ƒç”¨<code>__next__</code>ä¼šä¸ºè¿­ä»£å™¨å¸¦æ¥çªå˜å‹çš„æ”¹å˜: å®ƒæ¨è¿›äº†è¿­ä»£å™¨çš„ä½ç½®. å› æ­¤, å¤šæ¬¡è°ƒç”¨<code>__next__</code>ä¼šè¿”å›ä¸€ä¸ªåº•å±‚åºåˆ—çš„åºåˆ—å…ƒç´ . Pythonåœ¨è°ƒç”¨<code>__next__</code>æœŸé—´é€šè¿‡å‘å‡º<code>StopInteration</code>å¼‚å¸¸çš„å½¢å¼æ¥è¡¨ç¤ºä¸€ä¸ªåº•å±‚åºåˆ—å·²ç»åˆ°è¾¾å°½å¤´.</p>
<p>ä¸‹é¢çš„<code>LetterIter</code>ç±»è¿­ä»£ä¸€ä¸ªä»¥æŸäº›å­—æ¯å¼€å¤´çš„è€Œä¸åŒ…æ‹¬æŸäº›å­—æ¯ç»“æŸçš„åº•å±‚åºåˆ—. å®ä¾‹å±æ€§<code>next_letter</code>ä¿å­˜ä¸‹ä¸€ä¸ªå­—æ¯ç”¨æ¥è¿”å›. <code>__next__</code>æ–¹æ³•è¿”å›è¿™ä¸ªå­—æ¯å¹¶ä½¿ç”¨å®ƒæ¥è®¡ç®—æ–°çš„<code>next_letter</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="k">class</span> <span class="nc">LetterIter</span><span class="p">:</span>
        <span class="s2">&#34;&#34;&#34;An iterator over letters of the alphabet in ASCII order.&#34;&#34;&#34;</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;e&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_letter</span> <span class="o">=</span> <span class="n">start</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">end</span>
        <span class="k">def</span> <span class="nf">__next__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_letter</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">end</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">StopIteration</span>
            <span class="n">letter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_letter</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_letter</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">letter</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">letter</span>
</code></pre></td></tr></table>
</div>
</div><p>ä½¿ç”¨è¿™ä¸ªç±», æˆ‘ä»¬å¯ä»¥é¡ºåºåœ°è®¿é—®å­—æ¯é€šè¿‡<code>__next__</code>æ–¹æ³•æˆ–è€…å†…å»ºçš„<code>next</code>å‡½æ•°, è¿™ä¸ªå‡½æ•°ä¼šè°ƒç”¨ä¼ å…¥çš„å‚æ•°ä¸Šçš„<code>__next__</code>æ–¹æ³•.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="n">letter_iter</span> <span class="o">=</span> <span class="n">LetterIter</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">letter_iter</span><span class="o">.</span><span class="n">__next__</span><span class="p">()</span>
<span class="s1">&#39;a&#39;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">letter_iter</span><span class="o">.</span><span class="n">__next__</span><span class="p">()</span>
<span class="s1">&#39;b&#39;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">next</span><span class="p">(</span><span class="n">letter_iter</span><span class="p">)</span>
<span class="s1">&#39;c&#39;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">letter_iter</span><span class="o">.</span><span class="n">__next__</span><span class="p">()</span>
<span class="s1">&#39;d&#39;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">letter_iter</span><span class="o">.</span><span class="n">__next__</span><span class="p">()</span>
<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s2">&#34;&lt;stdin&gt;&#34;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
  <span class="n">File</span> <span class="s2">&#34;&lt;stdin&gt;&#34;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">12</span><span class="p">,</span> <span class="ow">in</span> <span class="nb">next</span>
<span class="ne">StopIteration</span>
</code></pre></td></tr></table>
</div>
</div><p>è¿­ä»£å™¨æ˜¯å¯å˜çš„, å½“å®ƒä»¬æ¼”å˜äº‹, å®ƒä»¬ä¼šè·Ÿè¸ªæŸäº›åº•å±‚åºåˆ—å€¼çš„ä½ç½®. å½“åˆ°è¾¾æœ€åçš„å€¼æ—¶, è¿­ä»£å™¨å°±ç”¨å®Œäº†. ä¸€ä¸ª<code>LetterIter</code>å®ä¾‹åªå¯ä»¥è¢«è¿­ä»£ä¸€æ¬¡. åœ¨å®ƒçš„<code>__next__()</code>æ–¹æ³•æŠ›å‡º<code>StopIteration</code>å¼‚å¸¸ä¹‹å, ä»è¿™æ—¶èµ·è¿™ä¸ªè¿­ä»£å™¨å°±ä¼šä¸€ç›´è¿™æ ·åš. é€šå¸¸, ä¸€ä¸ªè¿­ä»£å™¨æ˜¯ä¸å¯ä»¥é‡ç½®çš„; è€Œæ˜¯åˆ›å»ºä¸€ä¸ªæ–°å®ä¾‹æ¥å¼€å§‹ä¸€ä¸ªæ–°çš„è¿­ä»£.</p>
<p>è¿­ä»£å™¨ä¹Ÿå…è®¸æˆ‘ä»¬é€šè¿‡å®ç°ä¸€ä¸ªæ°¸è¿œä¸ä¼šæŠ›å‡º<code>StopIteration</code>å¼‚å¸¸çš„<code>__next__</code>æ–¹æ³•æ¥è¡¨ç¤ºä¸€ä¸ªæ— é™åºåˆ—. ä¾‹å¦‚, ä¸‹é¢çš„<code>Positives</code>ç±»ç”¨æ¥è¿­ä»£æ— é™çš„æ­£æ•´æ•°åºåˆ—. åœ¨Pythonä¸­å†…å»ºçš„<code>next</code>æ–¹æ³•ä¼šè°ƒç”¨å®ƒå‚æ•°ä¸Šçš„<code>__next__</code>æ–¹æ³•.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="k">class</span> <span class="nc">Positives</span><span class="p">:</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_positive</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">def</span> <span class="nf">__next__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_positive</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_positive</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="n">result</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">p</span> <span class="o">=</span> <span class="n">Positives</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">next</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="mi">1</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">next</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="mi">2</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">next</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="mi">3</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="422-å¯è¿­ä»£å¯¹è±¡">4.2.2 å¯è¿­ä»£å¯¹è±¡</h4>
<p>å¦‚æœä¸€ä¸ªå¯¹è±¡åœ¨è°ƒç”¨å®ƒçš„<code>__iter__</code>æ–¹æ³•æ—¶è¿”å›ä¸€ä¸ªè¿­ä»£å™¨é‚£ä¹ˆè¿™ä¸ªå¯¹è±¡æ˜¯å¯è¿­ä»£çš„. å¯è¿­ä»£å€¼ä»£è¡¨æ•°æ®é›†, å¹¶ä¸”å®ƒä»¬æä¾›å¯èƒ½äº§ç”Ÿå¤šäºä¸€ä¸ªè¿­ä»£å™¨çš„å›ºå®šè¡¨ç¤º.</p>
<p>ä¾‹å¦‚, ä¸‹é¢çš„<code>Letters</code>ç±»çš„å®ä¾‹è¡¨ç¤ºä¸€ä¸ªè¿ç»­çš„å­—æ¯åºåˆ—. æ¯ä¸€æ¬¡å®ƒçš„<code>__iter__</code>æ–¹æ³•è¢«è°ƒç”¨, ä¸€ä¸ªæ–°çš„<code>LetterIter</code>å®ä¾‹å°±è¢«æ„é€ , å®ƒå…è®¸é¡ºåºè®¿é—®åˆ°åºåˆ—çš„å†…å®¹.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="k">class</span> <span class="nc">Letters</span><span class="p">:</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;e&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">start</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">end</span>
        <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">LetterIter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">end</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>å†…å»ºçš„<code>iter</code>å‡½æ•°è°ƒç”¨ä¼ å…¥çš„å‚æ•°ä¸Šçš„<code>__iter__</code>æ–¹æ³•. åœ¨ä¸‹é¢çš„åºåˆ—è¡¨è¾¾å¼ä¸­, ä¸¤ä¸ªè¿­ä»£å™¨è¡ç”Ÿè‡ªç›¸åŒçš„å¯è¿­ä»£çš„åºåˆ—å¹¶ç‹¬ç«‹åœ°è¿”å›åºåˆ—ä¸­çš„å­—æ¯.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="n">b_to_k</span> <span class="o">=</span> <span class="n">Letters</span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">first_iterator</span> <span class="o">=</span> <span class="n">b_to_k</span><span class="o">.</span><span class="fm">__iter__</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">next</span><span class="p">(</span><span class="n">first_iterator</span><span class="p">)</span>
<span class="s1">&#39;b&#39;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">next</span><span class="p">(</span><span class="n">first_iterator</span><span class="p">)</span>
<span class="s1">&#39;c&#39;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">second_iterator</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">b_to_k</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">second_iterator</span><span class="o">.</span><span class="n">__next__</span><span class="p">()</span>
<span class="s1">&#39;b&#39;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">first_iterator</span><span class="o">.</span><span class="n">__next__</span><span class="p">()</span>
<span class="s1">&#39;d&#39;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">first_iterator</span><span class="o">.</span><span class="n">__next__</span><span class="p">()</span>
<span class="s1">&#39;e&#39;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">second_iterator</span><span class="o">.</span><span class="n">__next__</span><span class="p">()</span>
<span class="s1">&#39;c&#39;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">second_iterator</span><span class="o">.</span><span class="n">__next__</span><span class="p">()</span>
<span class="s1">&#39;d&#39;</span>
</code></pre></td></tr></table>
</div>
</div><p>å¯è¿­ä»£çš„<code>Letters</code>å®ä¾‹<code>b_to_k</code>ä»¥åŠ<code>LetterIter</code>çš„è¿­ä»£å™¨å®ä¾‹<code>first_iterator</code>ä»¥åŠ<code>second_iterator</code>ä¸<code>Letters</code>å®ä¾‹çš„ä¸åŒä¹‹å¤„åœ¨äº<code>Letter</code>å®ä¾‹ä¸ä¼šæ›´æ”¹, è€Œè¿­ä»£å™¨å®ä¾‹ä¼šéšç€æ¯ä¸€æ¬¡<code>next</code>è°ƒç”¨(æˆ–è€…ç­‰æ•ˆçš„<code>__next__</code>è°ƒç”¨)ä¹‹åæ”¹å˜. è¿­ä»£å™¨é€šè¿‡é¡ºåºæ•°æ®è·Ÿè¸ªè¿›åº¦, è€Œå¯è¿­ä»£è¡¨ç¤ºæ•°æ®æœ¬èº«.</p>
<p>åœ¨Pythonä¸­çš„å¾ˆå¤šå†…å»ºå‡½æ•°æ¥å—å¯è¿­ä»£å‚æ•°å¹¶è¿”å›ä¸€ä¸ªè¿­ä»£å™¨. ä¾‹å¦‚, <code>map</code>å‡½æ•°, æ¥å—ä¸€ä¸ªå‡½æ•°ä»¥åŠä¸€ä¸ªå¯è¿­ä»£çš„å€¼. å®ƒè¿”å›å¯¹å¯è¿­ä»£å‚æ•°çš„æ¯ä¸ªå…ƒç´ åº”ç”¨åˆ°ä¼ å…¥å‡½æ•°åçš„è¿”å›ç»“æœç»„æˆçš„ä¸€ä¸ªè¿­ä»£å™¨.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="n">caps</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="n">b_to_k</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">next</span><span class="p">(</span><span class="n">caps</span><span class="p">)</span>
<span class="s1">&#39;B&#39;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">next</span><span class="p">(</span><span class="n">caps</span><span class="p">)</span>
<span class="s1">&#39;C&#39;</span>
</code></pre></td></tr></table>
</div>
</div><p><code>map</code>å‡½æ•°æ˜¯æƒ°æ€§å‡½æ•°, è°ƒç”¨å®ƒæ—¶å¹¶ä¸ä¼šæ‰§è¡Œè®¡ç®—å…¶å…ƒç´ ç»“æœæ‰€éœ€çš„è®¡ç®—. ç›¸å, ä¸€ä¸ªè¿­ä»£å™¨å¯¹è±¡è¢«åˆ›å»ºå, å¦‚æœä½¿ç”¨<code>next</code>å‡½æ•°æŸ¥è¯¢åˆ™å¯ä»¥è¿”å›ç»“æœ. æˆ‘ä»¬å¯ä»¥åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­è§‚å¯Ÿåˆ°è¿™ä¸ªäº‹å®, æ‰“å°çš„æ“ä½œè¢«å»¶è¿Ÿåˆ°äº†å¯¹åº”å…ƒç´ è¢«<code>doubled</code>è¿­ä»£å™¨è¯·æ±‚æ‰æ“ä½œ.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="k">def</span> <span class="nf">double_and_print</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;***&#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="s1">&#39;=&gt;&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="s1">&#39;***&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">2</span><span class="o">*</span><span class="n">x</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">s</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">doubled</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">double_and_print</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>  <span class="c1"># double_and_print not yet called</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">next</span><span class="p">(</span><span class="n">doubled</span><span class="p">)</span>                       <span class="c1"># double_and_print called once</span>
<span class="o">***</span> <span class="mi">3</span> <span class="o">=&gt;</span> <span class="mi">6</span> <span class="o">***</span>
<span class="mi">6</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">next</span><span class="p">(</span><span class="n">doubled</span><span class="p">)</span>                       <span class="c1"># double_and_print called again</span>
<span class="o">***</span> <span class="mi">4</span> <span class="o">=&gt;</span> <span class="mi">8</span> <span class="o">***</span>
<span class="mi">8</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">list</span><span class="p">(</span><span class="n">doubled</span><span class="p">)</span>                       <span class="c1"># double_and_print called twice more</span>
<span class="o">***</span> <span class="mi">5</span> <span class="o">=&gt;</span> <span class="mi">10</span> <span class="o">***</span>
<span class="o">***</span> <span class="mi">6</span> <span class="o">=&gt;</span> <span class="mi">12</span> <span class="o">***</span>
<span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">12</span><span class="p">]</span>
</code></pre></td></tr></table>
</div>
</div><p><code>filter</code>, <code>zip</code>ä»¥åŠ<code>reversed</code>å‡½æ•°ä¹Ÿæ˜¯è¿”å›è¿­ä»£å™¨çš„.</p>
<h4 id="423-å£°æ˜">4.2.3 å£°æ˜</h4>
<p>åœ¨Pythonä¸­çš„<code>for</code>å£°æ˜ç”¨äºæ“ä½œè¿­ä»£å™¨. å¯¹è±¡å¦‚æœå…·æœ‰ä¸€ä¸ª<code>__iter__</code>æ–¹æ³•, è¿”å›ä¸€ä¸ªè¿­ä»£å™¨, é‚£ä¹ˆå®ƒæ˜¯å¯ä»¥è¿­ä»£çš„(ä¸€ä¸ªæ¥å£). å¯è¿­ä»£å¯¹è±¡å¯ä»¥æ˜¯<code>for</code>å£°æ˜å¤´éƒ¨çš„<code>&lt;expression&gt;</code>ä¸­çš„å€¼:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="k">for</span> <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">expression</span><span class="o">&gt;</span><span class="p">:</span>
    <span class="o">&lt;</span><span class="n">suite</span><span class="o">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>ä¸ºäº†æ‰§è¡Œ<code>for</code>å£°æ˜, Pythonæ‰§è¡Œå¤´éƒ¨<code>&lt;expression&gt;</code>, è¿™ä¸ªexpressionå¿…é¡»è¿”å›ä¸€ä¸ªè¿­ä»£å™¨å€¼. ç„¶å, åœ¨è¯¥è‡³ä¸Šè°ƒç”¨<code>__iter__</code>æ–¹æ³•. ç›´åˆ°<code>StopIteration</code>å¼‚å¸¸è¢«æŠ›å‡º, Pythonåå¤è°ƒç”¨åœ¨è¿™ä¸ªè¿­ä»£å™¨ä¸Šçš„<code>__next__</code>æ–¹æ³•ä»¥åŠç»‘å®šç»“æœåˆ°<code>&lt;name&gt;</code>åœ¨forå£°æ˜ä¸­. ç„¶å, å®ƒæ‰§è¡Œ<code>&lt;suite&gt;</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="n">counts</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">counts</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
<span class="mi">1</span>
<span class="mi">2</span>
<span class="mi">3</span>
</code></pre></td></tr></table>
</div>
</div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­, <code>counts</code>åˆ—è¡¨ä»å®ƒçš„<code>__iter__()</code>æ–¹æ³•ä¸­è¿”å›ä¸€ä¸ªè¿­ä»£å™¨. <code>for</code>å£°æ˜ä¹‹åä¸æ–­åœ°è°ƒç”¨è¿™ä¸ªè¿­ä»£å™¨çš„<code>__next__()</code>æ–¹æ³•, åŒæ—¶æ¯æ¬¡éƒ½å°†è¿”å›å€¼åˆ†é…åˆ°<code>item</code>ä¸Š. è¿™ä¸ªè¿‡ç¨‹ä¸€ç›´æŒç»­ç›´åˆ°è¿­ä»£å™¨æŠ›å‡º<code>StopIteration</code>å¼‚å¸¸, <code>for</code>å£°æ˜åœ¨è¿™ä¸ªç‚¹ä¸Šç»“æŸæ‰§è¡Œ.</p>
<p>éšç€æˆ‘ä»¬å¯¹è¿­ä»£å™¨çš„äº†è§£, æˆ‘ä»¬å¯ä»¥ä»¥<code>while</code>, èµ‹å€¼, ä»¥åŠ<code>try</code>å£°æ˜, å®ç°æ‰§è¡Œ<code>for</code>çš„è§„åˆ™.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="n">items</span> <span class="o">=</span> <span class="n">counts</span><span class="o">.</span><span class="fm">__iter__</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">try</span><span class="p">:</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">item</span> <span class="o">=</span> <span class="n">items</span><span class="o">.</span><span class="n">__next__</span><span class="p">()</span>
            <span class="k">print</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
        <span class="k">pass</span>
<span class="mi">1</span>
<span class="mi">2</span>
<span class="mi">3</span>
</code></pre></td></tr></table>
</div>
</div><p>ä¸Šé¢, é€šè¿‡è°ƒç”¨<code>counts</code>è¿­ä»£å™¨çš„<code>__iter__</code>æ–¹æ³•å¹¶å°†è¿”å›çš„å€¼ç»‘å®šåˆ°åç§°<code>items</code>ä¸Š, è¿™æ ·å°±å¯ä»¥ä¾æ¬¡æŸ¥è¯¢æ¯ä¸ªå…ƒç´ . å¤„ç†<code>StopIteration</code>å¼‚å¸¸çš„å¤„ç†æœºåˆ¶ä»€ä¹ˆéƒ½ä¸ä¼šåš, ä½†æ˜¯è¿™ä¸ªå¤„ç†æœºåˆ¶æä¾›äº†ä¸€ä¸ªæ§åˆ¶æœºåˆ¶æ¥è·³å‡º<code>while</code>å¾ªç¯.</p>
<p>åœ¨<code>for</code>å¾ªç¯ä¸­ä½¿ç”¨ä¸€ä¸ªè¿­ä»£å™¨, è¿™ä¸ªè¿­ä»£å™¨ä¹Ÿå¿…é¡»å…·æœ‰ä¸€ä¸ª<code>__iter__</code>æ–¹æ³•. Pythonæ–‡æ¡£ä¸­çš„<a href="http://docs.python.org/3/library/stdtypes.html#iterator-types">Iterator</a>ç±»å‹ç« èŠ‚å»ºè®®ä¸€ä¸ªè¿­ä»£å™¨å…·æœ‰ä¸€ä¸ª<code>__iter__</code>æ–¹æ³•, è¿™ä¸ªæ–¹æ³•è¿”å›è¿­ä»£å™¨æœ¬èº«, å› æ­¤æ‰€æœ‰çš„è¿­ä»£å™¨éƒ½æ˜¯å¯è¿­ä»£çš„.</p>
<h4 id="424-ç”Ÿæˆå™¨ä»¥åŠyieldå£°æ˜">4.2.4 ç”Ÿæˆå™¨ä»¥åŠyieldå£°æ˜</h4>
<p>ä¸Šé¢çš„<code>Letters</code>ä»¥åŠ<code>Positives</code>å¯¹è±¡éœ€è¦æˆ‘ä»¬å»å¼•å…¥ä¸€ä¸ªæ–°çš„åŸŸ<code>self.current</code>åˆ°æˆ‘ä»¬çš„å¯¹è±¡æ¥è·Ÿè¸ªåºåˆ—è¿›åº¦. ä½¿ç”¨å¦‚ä¸Šé¢å±•ç°çš„è¿™æ ·ç®€å•çš„åºåˆ—, å¯ä»¥å¾ˆå®¹æ˜“å®Œæˆ. ç„¶è€Œå¯¹äºå¤æ‚çš„åºåˆ—, <code>__next__</code>æ–¹æ³•å°±å¾ˆéš¾åœ¨è®¡ç®—ä¸­ä¿æŒå®ƒçš„ä½ç½®. ç”Ÿæˆå™¨å…è®¸æˆ‘ä»¬åˆ©ç”¨Pythonè§£æå™¨çš„åŠŸèƒ½å»å®šä¹‰æ›´å¤æ‚çš„è¿­ä»£.</p>
<p>ç”Ÿæˆå™¨å°±æ˜¯é€šè¿‡ä¸€ä¸ªç‰¹æ®Šç±»å‹çš„å‡½æ•°è¿”å›ä¸€ä¸ªè¿­ä»£å™¨å¯¹è±¡çš„å‡½æ•°. ç”Ÿæˆå™¨å‡½æ•°æœ‰åˆ«äºå¸¸è§„çš„å‡½æ•°çš„åœ°æ–¹åœ¨äºå®ƒä»¬çš„å‡½æ•°ä½“å†…ä¸æ˜¯åŒ…å«<code>return</code>å£°æ˜, å®ƒä»¬ä½¿ç”¨<code>yield</code>å£°æ˜æ¥è¿”å›åºåˆ—çš„å…ƒç´ .</p>
<p>ç”Ÿæˆå™¨å¹¶ä¸ä½¿ç”¨å¯¹è±¡çš„å±æ€§æ¥è¿½è¸ªåºåˆ—çš„æ­¥è¿›è¿‡ç¨‹. ç›¸å, å®ƒä»¬æ§åˆ¶ç”Ÿæˆå™¨å‡½æ•°çš„æ‰§è¡Œè¿‡ç¨‹, æ¯ä¸€æ¬¡ç”Ÿæˆå™¨çš„<code>__next__</code>æ–¹æ³•è¢«è°ƒç”¨å°±ä¼šä¸€ç›´æ‰§è¡Œç›´åˆ°ä¸‹ä¸€ä¸ª<code>yield</code>å£°æ˜è¢«æ‰§è¡Œæ‰åœæ­¢. <code>Letters</code>è¿­ä»£å™¨å¯ä»¥ä½¿ç”¨ç”Ÿæˆå™¨å‡½æ•°æ¥å®ç°å¾—æ›´åŠ ç´§å‡‘.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="k">def</span> <span class="nf">letters_generator</span><span class="p">():</span>
        <span class="n">current</span> <span class="o">=</span> <span class="s1">&#39;a&#39;</span>
        <span class="k">while</span> <span class="n">current</span> <span class="o">&lt;=</span> <span class="s1">&#39;d&#39;</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">current</span>
            <span class="n">current</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">current</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">letter</span> <span class="ow">in</span> <span class="n">letters_generator</span><span class="p">():</span>
        <span class="k">print</span><span class="p">(</span><span class="n">letter</span><span class="p">)</span>
<span class="n">a</span>
<span class="n">b</span>
<span class="n">c</span>
<span class="n">d</span>
</code></pre></td></tr></table>
</div>
</div><p>å³ä½¿æˆ‘ä»¬ä»æ¥æ²¡æœ‰æ˜ç¡®åœ°å®šä¹‰<code>__iter__</code>æˆ–è€…<code>__next__</code>æ–¹æ³•, <code>yield</code>å£°æ˜æŒ‡å‡ºæˆ‘ä»¬æ­£åœ¨å£°æ˜ä¸€ä¸ªç”Ÿæˆå™¨å‡½æ•°. å½“å‡½æ•°è¢«è°ƒç”¨æ—¶, ç”Ÿæˆå™¨å‡½æ•°ä¸æ˜¯è¿”å›ä¸€ä¸ªç‰¹å®šçš„äº§ç”Ÿçš„å€¼, è€Œæ˜¯ä¸€ä¸ªç”Ÿæˆå™¨(å®ƒçš„ç±»å‹æ˜¯ä¸€ä¸ªè¿­ä»£å™¨)å®ƒæœ¬èº«å¯ä»¥è¿”å›äº§ç”Ÿçš„å€¼. ç”Ÿæˆå™¨å¯¹è±¡å…·æœ‰<code>__iter__</code>ä»¥åŠ<code>__next__</code>æ–¹æ³•, åŒæ—¶æ¯ä¸€æ¬¡è°ƒç”¨<code>__next__</code>ä¼šç»§ç»­ä»ä¸Šä¸€æ¬¡ç”Ÿæˆå™¨å‡½æ•°ç¦»å¼€çš„åœ°æ–¹ç»§ç»­æ‰§è¡Œç”Ÿæˆå™¨å‡½æ•°ç›´åˆ°å¦ä¸€ä¸ª<code>yield</code>å£°æ˜è¢«æ‰§è¡Œ.</p>
<p>ç¬¬ä¸€æ¬¡è°ƒç”¨<code>__next__</code>, ç¨‹åºä¼šæ‰§è¡Œæ¥è‡ª<code>letters_generator</code>å‡½æ•°ä¸»ä½“çš„è¯­å¥, ç›´åˆ°å®ƒé‡åˆ°<code>yield</code>å£°æ˜. ç„¶å, å®ƒæš‚åœå¹¶è¿”å›å€¼ç»™<code>current</code>. <code>yield</code>å£°æ˜å¹¶ä¸ä¼šé”€æ¯æœ€æ–°åˆ›å»ºçš„ç¯å¢ƒ, å®ƒä»¬å°†ä¿ç•™ä¸‹æ¥. å½“<code>__next__</code>å†æ¬¡è¢«è°ƒç”¨, æ‰§è¡Œè¿‡ç¨‹æ¢å¤åˆ°å®ƒåœæ­¢çš„åœ°æ–¹, <code>current</code>çš„ç»“æœä»¥åŠå…¶ä»–åœ¨è¿™ä¸ª<code>letters_generator</code>åŸŸä¹‹ä¸­ç»‘å®šäº†çš„åç§°éƒ½ä¼šä¿ç•™ç›´åˆ°éšåçš„<code>__next__</code>è°ƒç”¨.</p>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡æ‰‹åŠ¨è°ƒç”¨<code>__next__()</code>æ¥éå†ç”Ÿæˆå™¨:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="n">letters</span> <span class="o">=</span> <span class="n">letters_generator</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">type</span><span class="p">(</span><span class="n">letters</span><span class="p">)</span>
<span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">generator</span><span class="s1">&#39;&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">letters</span><span class="o">.</span><span class="n">__next__</span><span class="p">()</span>
<span class="s1">&#39;a&#39;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">letters</span><span class="o">.</span><span class="n">__next__</span><span class="p">()</span>
<span class="s1">&#39;b&#39;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">letters</span><span class="o">.</span><span class="n">__next__</span><span class="p">()</span>
<span class="s1">&#39;c&#39;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">letters</span><span class="o">.</span><span class="n">__next__</span><span class="p">()</span>
<span class="s1">&#39;d&#39;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">letters</span><span class="o">.</span><span class="n">__next__</span><span class="p">()</span>
<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s2">&#34;&lt;stdin&gt;&#34;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">StopIteration</span>
</code></pre></td></tr></table>
</div>
</div><p>ç”Ÿæˆå™¨ä¸ä¼šå¼€å§‹æ‰§è¡Œå…¶ç”Ÿæˆå‡½æ•°çš„ä»»ä½•bodyè¯­å¥, ç›´åˆ°<code>__next__</code>ç¬¬ä¸€æ¬¡è¢«è°ƒç”¨. å½“ç”Ÿæˆå™¨ç»“æŸæ—¶ä¼šæŠ›å‡º<code>StopIteration</code>å¼‚å¸¸.</p>
<h4 id="425-åˆ›å»ºå¸¦æœ‰yieldçš„å¯è¿­ä»£å¯¹è±¡">4.2.5 åˆ›å»ºå¸¦æœ‰yieldçš„å¯è¿­ä»£å¯¹è±¡</h4>
<p>åœ¨Python, è¿­ä»£å™¨åªèƒ½å•å‘é€šè¿‡åº•å±‚è¿­ä»£åºåˆ—çš„å…ƒç´ . åœ¨è¿™ä¹‹å, è¿­ä»£å™¨åœ¨<code>__next__</code>å†æ¬¡è¢«è°ƒç”¨æ—¶ä¼šç»§ç»­æŠ›å‡º<code>StopIteration</code>å¼‚å¸¸. å¾ˆå¤šç¨‹åºéœ€è¦é‡å¤å…ƒç´ å¤šæ¬¡. ä¾‹å¦‚, æˆ‘ä»¬è¦è¿­ä»£åˆ—è¡¨å¤šæ¬¡æ¥æšä¸¾æ‰€æœ‰å…ƒç´ å¯¹.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="k">def</span> <span class="nf">all_pairs</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">item1</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">item2</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
                <span class="k">yield</span> <span class="p">(</span><span class="n">item1</span><span class="p">,</span> <span class="n">item2</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">list</span><span class="p">(</span><span class="n">all_pairs</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]))</span>
<span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)]</span>
</code></pre></td></tr></table>
</div>
</div><p>åºåˆ—æœ¬èº«å¹¶ä¸æ˜¯è¿­ä»£å™¨, è€Œæ˜¯å¯è¿­ä»£å¯¹è±¡. åœ¨Pythonä¸­çš„å¯è¿­ä»£æ¥å£ç”±å•ä¸ªæ¶ˆæ¯ç»„æˆ, <code>__iter__</code>, å®ƒè¿”å›ä¸€ä¸ªè¿­ä»£å™¨. åœ¨Pythonä¸­çš„å†…å»ºåºåˆ—ç±»å‹åœ¨å®ƒä»¬çš„<code>__iter__</code>æ–¹æ³•è¢«è°ƒç”¨æ—¶è¿”å›æ–°çš„è¿­ä»£å™¨çš„å®ä¾‹. å¦‚æœä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡æ¯æ¬¡<code>__iter__</code>æ–¹æ³•è¢«è°ƒç”¨æ—¶å°±è¿”å›ä¸€ä¸ªæ–°çš„å®ä¾‹, é‚£ä¹ˆå®ƒå°±å¯ä»¥è¿­ä»£å¤šæ¬¡.</p>
<p>æ–°çš„å¯è¿­ä»£ç±»å¯ä»¥é€šè¿‡å®ç°å¯è¿­ä»£æ¥å£æ¥å®šä¹‰. ä¾‹å¦‚, ä¸‹é¢çš„_å¯è¿­ä»£_<code>LettersWithYield</code>ç±»æ¯æ¬¡åœ¨<code>__iter__</code>è¢«è°ƒç”¨æ—¶è¿”å›ä¸€ä¸ªæ–°çš„å»ºç«‹åœ¨å­—æ¯ä¸Šçš„è¿­ä»£å™¨.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="k">class</span> <span class="nc">LettersWithYield</span><span class="p">:</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;e&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">start</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">end</span>
        <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">next_letter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span>
            <span class="k">while</span> <span class="n">next_letter</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">end</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">next_letter</span>
                <span class="n">next_letter</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">next_letter</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p><code>__iter__</code>æ–¹æ³•æ˜¯ä¸€ä¸ªç”Ÿæˆå™¨å‡½æ•°; å®ƒè¿”å›ä¸€ä¸ªç”Ÿæˆå™¨å¯¹è±¡è¿™ä¸ªç”Ÿæˆå™¨å¯¹è±¡è¿”å›å­—æ¯<code>a</code>åˆ°<code>d</code>ç„¶åå°±åœæ­¢. æ¯æ¬¡æˆ‘ä»¬è°ƒç”¨è¿™ä¸ªæ–¹æ³•, ä¸€ä¸ªæ–°çš„ç”Ÿæˆå™¨ä¼šå¼€å§‹è¿­ä»£ä¸€ä¸ªæ–°çš„åºåˆ—æ•°æ®.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="n">letters</span> <span class="o">=</span> <span class="n">LettersWithYield</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">list</span><span class="p">(</span><span class="n">all_pairs</span><span class="p">(</span><span class="n">letters</span><span class="p">))[:</span><span class="mi">5</span><span class="p">]</span>
<span class="p">[(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)]</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="426-æµ">4.2.6 æµ</h4>
<p>æµé€šå¸¸æ˜¯éšå«åœ°è¡¨ç¤ºåºåˆ—æ•°æ®çš„å¦ä¸€ç§æ–¹å¼. æµæ˜¯ä¸€ä¸ªæ‡’è®¡ç®—çš„é“¾æ¥åˆ—è¡¨. è·Ÿç¬¬äºŒç« çš„<code>Link</code>ç±»ç±»ä¼¼, <code>Stream</code>å®ä¾‹å“åº”è¯·æ±‚å®ƒçš„ç¬¬ä¸€ä¸ªå…ƒç´ ä»¥åŠæµå‰©ä¸‹çš„å…ƒç´ . è·Ÿ<code>Link</code>ç±»ç±»ä¼¼, <code>Stream</code>å‰©ä¸‹çš„éƒ¨åˆ†ä¹Ÿæ˜¯<code>Stream</code>. è·Ÿ<code>Link</code>ä¸ç›¸ä¼¼çš„æ˜¯ä¸€ä¸ªæµå‰©ä¸‹çš„éƒ¨åˆ†åªåœ¨å®ƒè¢«æŸ¥è¯¢çš„æ—¶å€™æ‰è®¡ç®—, è€Œä¸æ˜¯æå‰å­˜å‚¨èµ·æ¥. ä¹Ÿå°±æ˜¯è¯´, æµå‰©ä¸‹æ¥çš„éƒ¨åˆ†æ˜¯æ‡’è®¡ç®—çš„.</p>
<p>è¦å®ç°è¿™ä¸ªæ‡’è¿ç®—, æµéœ€è¦ä¿å­˜ä¸€ä¸ªå‡½æ•°, è¿™ä¸ªå‡½æ•°è®¡ç®—æµå‰©ä¸‹çš„éƒ¨åˆ†. æ— è®ºä½•æ—¶å‡½æ•°è¢«è°ƒç”¨, å®ƒè¿”å›çš„å€¼ä¼šä½œä¸ºæµçš„ä¸€éƒ¨åˆ†è¢«å­˜å‚¨åˆ°ä¸€ä¸ªå«åš<code>_rest</code>çš„å±æ€§ä¸Š, ä»¥ä¸‹åˆ’çº¿æ¥å‘½åæ˜¯ä¸ºäº†æ ‡è¯†å®ƒä¸åº”è¯¥è¢«ç›´æ¥è®¿é—®.</p>
<p>å¯è®¿é—®çš„å±æ€§<code>rest</code>æ˜¯ä¸€ä¸ªå±æ€§æ–¹æ³•, å®ƒè¿”å›æµå‰©ä¸‹çš„éƒ¨åˆ†, åœ¨å¿…è¦æ—¶è¿›è¡Œè®¡ç®—. æœ‰äº†è¿™ä¸ªè®¾è®¡, æµå­˜å‚¨äº†å¦‚ä½•è®¡ç®—æµçš„å‰©ä½™éƒ¨åˆ†, è€Œä¸ç”¨æ€»æ˜¯æ˜ç¡®åœ°ä¿å­˜å‰©ä½™çš„éƒ¨åˆ†.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="k">class</span> <span class="nc">Stream</span><span class="p">:</span>
        <span class="s2">&#34;&#34;&#34;A lazily computed linked list.&#34;&#34;&#34;</span>
        <span class="k">class</span> <span class="nc">empty</span><span class="p">:</span>
            <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">return</span> <span class="s1">&#39;Stream.empty&#39;</span>
        <span class="n">empty</span> <span class="o">=</span> <span class="n">empty</span><span class="p">()</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">first</span><span class="p">,</span> <span class="n">compute_rest</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">empty</span><span class="p">):</span>
            <span class="k">assert</span> <span class="nb">callable</span><span class="p">(</span><span class="n">compute_rest</span><span class="p">),</span> <span class="s1">&#39;compute_rest must be callable.&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">first</span> <span class="o">=</span> <span class="n">first</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_compute_rest</span> <span class="o">=</span> <span class="n">compute_rest</span>
        <span class="nd">@property</span>
        <span class="k">def</span> <span class="nf">rest</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="s2">&#34;&#34;&#34;Return the rest of the stream, computing it if necessary.&#34;&#34;&#34;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_rest</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_rest</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_rest</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_compute_rest</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rest</span>
        <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="s1">&#39;Stream({0}, &lt;...&gt;)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first</span><span class="p">))</span>
</code></pre></td></tr></table>
</div>
</div><p>é“¾è¡¨æ˜¯é€šè¿‡åµŒå¥—è¡¨è¾¾å¼æ¥å®šä¹‰çš„. ä¾‹å¦‚, æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªä¸‹é¢çš„è¡¨ç¤ºå…·æœ‰å…ƒç´ 1, ç„¶åæ˜¯å…ƒç´ 5çš„<code>Link</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="n">r</span> <span class="o">=</span> <span class="n">Link</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Link</span><span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Link</span><span class="p">(</span><span class="mi">9</span><span class="p">)))</span>
</code></pre></td></tr></table>
</div>
</div><p>åŒæ ·åœ°, æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ª<code>Stream</code>è¡¨ç¤ºç›¸åŒçš„åºåˆ—, <code>Stream</code>å®é™…ä¸Šå¹¶ä¸è®¡ç®—ç¬¬äºŒä¸ªå…ƒç´ 5, ç›´åˆ°å‰©ä½™çš„streamè¢«è¯·æ±‚, æˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ›å»ºåŒ¿åå‡½æ•°æ¥è¾¾åˆ°è¿™ä¸ªæ•ˆæœ.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="n">s</span> <span class="o">=</span> <span class="n">Stream</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">Stream</span><span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">3</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">Stream</span><span class="p">(</span><span class="mi">9</span><span class="p">)))</span>
</code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œ, 1æ˜¯æµçš„ç¬¬ä¸€ä¸ªå…ƒç´ , ç„¶åæ¥ä¸‹æ¥çš„<code>lambda</code>è¡¨è¾¾å¼è¿”å›ä¸€ä¸ªå‡½æ•°æ¥è®¡ç®—å‰©ä½™çš„æµ.</p>
<p>è®¿é—®é“¾è¡¨rçš„å…ƒç´ è·Ÿæµsçš„å…ƒç´ çš„è¿‡ç¨‹æ˜¯ç›¸ä¼¼çš„. ç„¶è€Œ, 5å·²ç»å­˜åœ¨ré‡Œé¢, è€Œsæ˜¯åœ¨ç¬¬ä¸€æ¬¡è¢«è¯·æ±‚çš„æ—¶å€™æŒ‰éœ€æ±‚æ¥è¿›è¡ŒåŠ æ³•è®¡ç®—çš„.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="n">r</span><span class="o">.</span><span class="n">first</span>
<span class="mi">1</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">s</span><span class="o">.</span><span class="n">first</span>
<span class="mi">1</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">r</span><span class="o">.</span><span class="n">rest</span><span class="o">.</span><span class="n">first</span>
<span class="mi">5</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">s</span><span class="o">.</span><span class="n">rest</span><span class="o">.</span><span class="n">first</span>
<span class="mi">5</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">r</span><span class="o">.</span><span class="n">rest</span>
<span class="n">Link</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">Link</span><span class="p">(</span><span class="mi">9</span><span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">s</span><span class="o">.</span><span class="n">rest</span>
<span class="n">Stream</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="o">&lt;...&gt;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>è€Œrçš„<code>rest</code>æ˜¯ä¸€ä¸ªå…·æœ‰ä¸¤ä¸ªå…ƒç´ çš„é“¾è¡¨, è€Œsçš„<code>rest</code>åˆ™åŒ…æ‹¬ä¸€ä¸ªç”¨äºè®¡ç®—å‰©ä½™éƒ¨åˆ†çš„å‡½æ•°; è€Œå®ƒå°†ä¼šè¿”å›ä¸€ä¸ªç©ºçš„æµçš„äº‹å®å¯èƒ½å°šæœªè¢«å‘ç°.</p>
<p>å½“ä¸€ä¸ª<code>Stream</code>å®ä¾‹æ„å»ºå, <code>self._rest</code>åŒºåŸŸæ˜¯<code>None</code>, è¡¨ç¤ºå‰©ä½™çš„<code>Stream</code>éƒ¨åˆ†å°šæœªè¢«è®¡ç®—. å½“<code>rest</code>å±æ€§è¢«é€šè¿‡ç‚¹è¡¨è¾¾å¼è¯·æ±‚, <code>rest</code>å±æ€§æ–¹æ³•è¢«è°ƒç”¨å°±ä¼šè§¦å‘<code>self._rest = self._compute_rest()</code>æ‰§è¡Œè¿ç®—. å› ä¸º<code>Stream</code>çš„ç¼“å­˜æœºåˆ¶, <code>compute_rest</code>å‡½æ•°åªä¼šè°ƒç”¨ä¸€æ¬¡, ç„¶åä¼šè¢«ä¸¢å¼ƒ.</p>
<p><code>compute_rest</code>å‡½æ•°çš„åŸºæœ¬å±æ€§æ˜¯å®ƒä¸éœ€è¦å‚æ•°, åŒæ—¶å®ƒè¿”å›ä¸€ä¸ª<code>Stream</code>æˆ–è€…<code>Stream.empty</code>.</p>
<p>æ‡’æƒ°æ‰§è¡Œè®©æˆ‘ä»¬æœ‰èƒ½åŠ›å»ç”¨æµæ¥è¡¨ç¤ºä¸€ä¸ªæ— é™åºåˆ—æ•°æ®é›†. ä¾‹å¦‚, æˆ‘ä»¬å¯ä»¥è¡¨ç¤ºå¢é•¿çš„æ•´æ•°, ä»¥ä»»ä½•<code>first</code>å€¼å¼€å§‹.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="k">def</span> <span class="nf">integer_stream</span><span class="p">(</span><span class="n">first</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">compute_rest</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">integer_stream</span><span class="p">(</span><span class="n">first</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Stream</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">compute_rest</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">positives</span> <span class="o">=</span> <span class="n">integer_stream</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">positives</span>
<span class="n">Stream</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">&lt;...&gt;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">positives</span><span class="o">.</span><span class="n">first</span>
<span class="mi">1</span>
</code></pre></td></tr></table>
</div>
</div><p>å½“<code>integer_stream</code>ç¬¬ä¸€æ¬¡è¢«è°ƒç”¨, å®ƒè¿”å›ä¸€ä¸ªæµ, è¿™ä¸ªæµçš„<code>first</code>æ˜¯åœ¨åºåˆ—ä¸­çš„ç¬¬ä¸€ä¸ªæ•´æ•°. ç„¶è€Œ, <code>integer_stream</code>å®é™…ä¸Šæ˜¯é€’å½’çš„, å› ä¸ºè¿™ä¸ªæµçš„<code>compute_rest</code>ä¼šå†æ¬¡ä»¥ä¸€ä¸ªå¢é•¿äº†çš„å‚æ•°æ¥è°ƒç”¨<code>integer_stream</code>. æˆ‘ä»¬è¯´<code>integer_stream</code>æ˜¯æ‡’æƒ°çš„æ˜¯å› ä¸ºé€’å½’è°ƒç”¨<code>integer_stream</code>åªä¼šåœ¨å‰©ä¸‹æ•´æ•°æµè¢«è¯·æ±‚çš„æ—¶å€™æ‰ä¼šè°ƒç”¨.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="n">positives</span><span class="o">.</span><span class="n">first</span>
<span class="mi">1</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">positives</span><span class="o">.</span><span class="n">rest</span><span class="o">.</span><span class="n">first</span>
<span class="mi">2</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">positives</span><span class="o">.</span><span class="n">rest</span><span class="o">.</span><span class="n">rest</span>
<span class="n">Stream</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="o">&lt;...&gt;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>åŒæ ·ç”¨æ¥å¤„ç†åºåˆ—çš„é«˜é˜¶å‡½æ•° &ndash;<code>map</code>ä»¥åŠ<code>filter</code>&ndash; åŒæ ·ä¹Ÿå¯ä»¥åº”ç”¨åˆ°æµä¸Šå», å³ä½¿å®ƒä»¬çš„å®ç°å¿…é¡»è¦æ”¹æˆæƒ°æ€§åœ°åº”ç”¨å®ƒä»¬çš„å‚æ•°å‡½æ•°. å‡½æ•°<code>map_stream</code>æ˜ å°„å‡½æ•°åˆ°æ•´ä¸ªæµä¸Š, è¿™ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„æµ. å†…éƒ¨å®šä¹‰çš„<code>compute_rest</code>å‡½æ•°ç¡®ä¿åœ¨å‰©ä¸‹çš„æµè¢«è®¡ç®—æ—¶å‡½æ•°ä¼šè¢«æ˜ å°„åˆ°å‰©ä½™çš„æµä¸­å».</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="k">def</span> <span class="nf">map_stream</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
	<span class="k">if</span> <span class="n">s</span> <span class="ow">is</span> <span class="n">Stream</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
	    <span class="k">return</span> <span class="n">s</span>
	<span class="k">def</span> <span class="nf">compute_rest</span><span class="p">():</span>
	    <span class="k">return</span> <span class="n">map_stream</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">rest</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">Stream</span><span class="p">(</span><span class="n">fn</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">first</span><span class="p">),</span> <span class="n">compute_rest</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>æµå¯ä»¥é€šè¿‡å®šä¹‰	ä¸€ä¸ª<code>compute_rest</code>å‡½æ•°æ¥åº”ç”¨è¿‡æ»¤å‡½æ•°åˆ°å‰©ä½™çš„æµä¸­æ¥è¿›è¡Œè¿‡æ»¤. å¦‚æœè¿‡æ»¤å‡½æ•°æ‹’ç»æµçš„ç¬¬ä¸€ä¸ªå…ƒç´ , å‰©ä¸‹æ¥çš„ä¼šé©¬ä¸Šè¢«è®¡ç®—. å› ä¸º<code>filter_stream</code>æ˜¯é€’å½’çš„, å‰©ä¸‹çš„æµå¯èƒ½ä¼šè¢«è®¡ç®—æ•°æ¬¡, ç›´åˆ°ç¬¬ä¸€ä¸ªæœ‰æ•ˆçš„å€¼è¢«æ‰¾åˆ°.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="k">def</span> <span class="nf">filter_stream</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">s</span> <span class="ow">is</span> <span class="n">Stream</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">s</span>
        <span class="k">def</span> <span class="nf">compute_rest</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">filter_stream</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">rest</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fn</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">first</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">Stream</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="n">compute_rest</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">compute_rest</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><p><code>map_stream</code>ä»¥åŠ<code>filter_stream</code>å‡½æ•°å±•ç¤ºäº†æµå¤„ç†çš„å…±åŒæ¨¡å¼: æœ¬åœ°å®šä¹‰<code>compute_rest</code>å‡½æ•°æ¯å½“åœ¨éœ€è¦è®¡ç®—å‰©ä½™éƒ¨åˆ†çš„æ—¶å€™é€’å½’åœ°åº”ç”¨è¿‡ç¨‹å‡½æ•°åˆ°æµå‰©ä½™çš„éƒ¨åˆ†ä¸­.</p>
<p>ä¸ºäº†æ£€æŸ¥æµé‡Œé¢çš„å†…å®¹, æˆ‘ä»¬å¯ä»¥å°†ç¬¬ä¸€ä¸ªå…ƒç´ å¼ºåˆ¶è½¬ä¸ºPythonä¸­çš„<code>list</code>ç±»å‹.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="k">def</span> <span class="nf">first_k_as_list</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="n">first_k</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="n">s</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">Stream</span><span class="o">.</span><span class="n">empty</span> <span class="ow">and</span> <span class="n">k</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">first_k</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">first</span><span class="p">)</span>
            <span class="n">s</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">rest</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="mi">1</span>
        <span class="k">return</span> <span class="n">first_k</span>
</code></pre></td></tr></table>
</div>
</div><p>è¿™äº›ä¾¿åˆ©å‡½æ•°å…è®¸æˆ‘ä»¬å»æ ¡éªŒæˆ‘ä»¬çš„<code>map_stream</code>å®ç°, ä¸€ä¸ªç®€å•çš„ä¾‹å­å°±æ˜¯å°†ä»3åˆ°7çš„æ•´æ•°è¿›è¡Œå¹³æ–¹.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="n">s</span> <span class="o">=</span> <span class="n">integer_stream</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">s</span>
<span class="n">Stream</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="o">&lt;...&gt;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">m</span> <span class="o">=</span> <span class="n">map_stream</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">m</span>
<span class="n">Stream</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="o">&lt;...&gt;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">first_k_as_list</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">49</span><span class="p">]</span>
</code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æˆ‘ä»¬çš„<code>filter_stream</code>å‡½æ•°é€šè¿‡ä½¿ç”¨<code>Eratosthenes</code>çš„ç­›å­æ¥å®šä¹‰ä¸€ä¸ªç´ æ•°æµ, å®ƒè¿‡æ»¤æ•´æ•°æµæ¥ç§»é™¤æ‰€æœ‰æ˜¯ç¬¬ä¸€ä¸ªå…ƒç´ çš„å€æ•°çš„æ‰€æœ‰æ•°å­—. é€šè¿‡è¿ç»­è¿‡æ»¤æ¯ä¸ªç´ æ•°ï¼Œä»æµä¸­åˆ é™¤æ‰€æœ‰å¤åˆæ•°ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="k">def</span> <span class="nf">primes</span><span class="p">(</span><span class="n">pos_stream</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">not_divible</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">x</span> <span class="o">%</span> <span class="n">pos_stream</span><span class="o">.</span><span class="n">first</span> <span class="o">!=</span> <span class="mi">0</span>
        <span class="k">def</span> <span class="nf">compute_rest</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">primes</span><span class="p">(</span><span class="n">filter_stream</span><span class="p">(</span><span class="n">not_divible</span><span class="p">,</span> <span class="n">pos_stream</span><span class="o">.</span><span class="n">rest</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">Stream</span><span class="p">(</span><span class="n">pos_stream</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="n">compute_rest</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>é€šè¿‡æˆªæ–­<code>primes</code>æµ, æˆ‘ä»¬å¯ä»¥åˆ—ä¸¾ä»»ä½•ç´ æ•°çš„å‰ç¼€</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="n">prime_numbers</span> <span class="o">=</span> <span class="n">primes</span><span class="p">(</span><span class="n">integer_stream</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">first_k_as_list</span><span class="p">(</span><span class="n">prime_numbers</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
<span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">17</span><span class="p">]</span>
</code></pre></td></tr></table>
</div>
</div><p>æµä¸è¿­ä»£å™¨ä¸åŒçš„æ˜¯å®ƒä»¬å¯ä»¥è¢«ä¼ é€’ç»™çº¯å‡½æ•°å¤šæ¬¡å¹¶ä¸”æ¯æ¬¡éƒ½è¿”å›ç›¸åŒçš„ç»“æœ. ç´ æ•°æµé€šè¿‡å°†å…¶è½¬æ¢æˆåˆ—è¡¨æ—¶å¹¶æ²¡æœ‰è¢«&quot;ç”¨å®Œ&rdquo;. ä¹Ÿå°±æ˜¯è¯´, <code>prime_numbers</code>ç¬¬ä¸€ä¸ªå…ƒç´ åœ¨è½¬æ¢æµçš„å‰ç¼€ä¸ºåˆ—è¡¨ä¹‹åä¾æ—§æ˜¯2.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="n">prime_numbers</span><span class="o">.</span><span class="n">first</span>
<span class="mi">2</span>
</code></pre></td></tr></table>
</div>
</div><p>å°±åƒé“¾è¡¨æä¾›ç®€å•çš„åºåˆ—æŠ½è±¡å®ç°ä¸€æ ·, æµé€šè¿‡ä½¿ç”¨é«˜é˜¶å‡½æ•°å®ç°æ‡’æƒ°è®¡ç®—ä»è€Œæä¾›ç®€å•, åŠŸèƒ½å¼ºå¤§çš„é€’å½’å¼æ•°æ®ç»“æ„.</p>
<h3 id="43-å£°æ˜å¼ç¼–ç¨‹">4.3 å£°æ˜å¼ç¼–ç¨‹</h3>
<p>é™¤äº†æµä»¥å¤–, æ•°æ®å€¼é€šå¸¸ä¹Ÿä¿å­˜åœ¨å¤§å‹çš„åº“ä¸­, è¿™ä¸ªåº“ç§°ä¸ºæ•°æ®åº“. æ•°æ®åº“ç”±åŒ…å«æ•°æ®å€¼çš„æ•°æ®å­˜å‚¨ä»¥åŠç”¨äºæ£€ç´¢å’Œè½¬æ¢è¿™äº›å€¼çš„æ¥å£. æ¯ä¸ªå­˜å‚¨åœ¨æ•°æ®åº“ä¸­çš„å€¼éƒ½è¢«ç§°ä¸º_è®°å½•_. è®°å½•å…·æœ‰ç›¸ä¼¼çš„ç»“æ„ä¸”è¢«åˆ†ç»„æˆè¡¨. è®°å½•ä½¿ç”¨æŸ¥è¯¢(è¿™æ˜¯ä¸€ç§æŸ¥è¯¢è¯­è¨€)æ¥è¿›è¡Œæ£€ç´¢å’Œè½¬æ¢. åˆ°ç›®å‰ä¸ºæ­¢, è¿™æ˜¯ä½¿ç”¨æœ€å¹¿æ³›çš„æŸ¥è¯¢è¯­è¨€è¢«ç§°ä¸ºç»“æ„åŒ–æŸ¥è¯¢è¯­è¨€æˆ–è€…SQL(è¯»ä½œ &ldquo;sequel&rdquo;).</p>
<p>SQLæ˜¯å£°æ˜å¼ç¼–ç¨‹è¯­è¨€çš„ä¸€ä¸ªä¾‹å­. å£°æ˜å¹¶ä¸ç›´æ¥æè¿°è®¡ç®—, è€Œæ˜¯æè¿°æœŸæœ›çš„æŸäº›è®¡ç®—ç»“æœ. è¿™æ˜¯æ•°æ®åº“ç³»ç»ŸæŸ¥è¯¢è§£æå™¨çš„ä½œç”¨æ˜¯è®¾è®¡å¹¶æ‰§è¡Œè®¡ç®—è¿‡ç¨‹æ¥äº§å‡ºè¿™æ ·çš„ç»“æœ.</p>
<p>è¿™ç§äº¤äº’ä¸Pythonæˆ–Schemeè¿™æ ·çš„ç¨‹åºç¼–ç¨‹èŒƒä¾‹æœ‰å¾ˆå¤§çš„ä¸åŒ. åœ¨Python, è®¡ç®—è¿‡ç¨‹æ˜¯ç”±ç¨‹åºå‘˜æ¥ç›´æ¥æŒ‡å®šçš„, è€Œå£°æ˜å¼è¯­è¨€æŠ½è±¡ç¨‹åºç»†èŠ‚, è€Œä¸æ˜¯å…³æ³¨ç»“æœçš„å½¢å¼.</p>
<h4 id="43-è¡¨">4.3 è¡¨</h4>
<p>SQLè¯­è¨€æ˜¯æ ‡å‡†åŒ–çš„, ä½†æ˜¯å¤§å¤šæ•°æ•°æ®åº“ç³»ç»Ÿä¼šå®ç°ä¸€äº›è¯­è¨€çš„è‡ªå®šä¹‰å˜ä½“, å…¶å¸¦æœ‰æŸäº›ä¸“æœ‰åŠŸèƒ½. åœ¨æœ¬æ–‡ä¸­, æˆ‘ä»¬ä¼šæè¿°SQLçš„ä¸€ä¸ªå°çš„é›†åˆå®ƒè¢«å®ç°åœ¨<a href="http://sqlite.org/">Sqlite</a>ä¸­. ä½ å¯ä»¥é€šè¿‡<a href="http://sqlite.org/download.html">ä¸‹è½½Sqlite</a>æˆ–è€…ä½¿ç”¨<a href="http://kripken.github.io/sql.js/GUI/">åœ¨çº¿çš„SQLè§£æå™¨</a>.</p>
<p>è¡¨, ä¹Ÿç§°ä¸ºå…³è”, å…·æœ‰å›ºå®šæ•°é‡çš„å‘½åå’Œç±»å‹åˆ—, è¡¨çš„æ¯ä¸€è¡Œè¡¨ç¤ºä¸€ä¸ªæ•°æ®è®°å½•ä¸”æ¯åˆ—éƒ½å…·æœ‰ä¸€ä¸ªå€¼. ä¾‹å¦‚, ä¸€ä¸ªåŸå¸‚çš„è¡¨å¯èƒ½ä¼šå…·æœ‰çš„åˆ—æœ‰<code>latitude</code>, <code>longitude</code>ä¸¤è€…æ‰€æŒæœ‰çš„éƒ½æ˜¯æ•°å€¼å‹çš„å€¼, è¿˜æœ‰ä¸€åˆ—ä¸º<code>name</code>æ‰€æŒæœ‰çš„å€¼ä¸ºå­—ç¬¦ä¸². æ¯ä¸€è¡Œé€šè¿‡å®ƒçš„çº¬åº¦ä»¥åŠç»åº¦å€¼æ¥è¡¨ç¤ºä¸€ä¸ªåŸå¸‚çš„åæ ‡ä½ç½®.</p>
<table>
<thead>
<tr>
<th>Latitude</th>
<th>Longitude</th>
<th>Name</th>
</tr>
</thead>
<tbody>
<tr>
<td>38</td>
<td>122</td>
<td>Berkeley</td>
</tr>
<tr>
<td>42</td>
<td>71</td>
<td>Cambridge</td>
</tr>
<tr>
<td>45</td>
<td>93</td>
<td>Minneapolis</td>
</tr>
</tbody>
</table>
<p>å¯ä»¥é€šè¿‡SQLè¯­è¨€ä¸­çš„<code>select</code>å£°æ˜æ¥åˆ›å»ºä¸€ä¸ªè¡¨ä¸­çš„å•ä¸ªè¡Œ, è¡Œä¸­å€¼æ˜¯è¢«é€—å·ç»™åˆ†éš”å¼€çš„, åæ¥ä¸€ä¸ªå…³é”®è¯&quot;as&quot;ä»¥åŠç´§éšçš„æ¯åˆ—çš„åç§°. æ‰€æœ‰çš„SQLå£°æ˜éƒ½ä»¥åˆ†å·ä½œä¸ºç»“å°¾.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">select</span> <span class="mi">38</span> <span class="k">as</span> <span class="n">latitude</span><span class="p">,</span> <span class="mi">122</span> <span class="k">as</span> <span class="n">longitude</span><span class="p">,</span> <span class="s2">&#34;Berkeley&#34;</span> <span class="k">as</span> <span class="n">name</span><span class="p">;</span>
<span class="mi">38</span><span class="o">|</span><span class="mi">122</span><span class="o">|</span><span class="n">Berkeley</span>
</code></pre></td></tr></table>
</div>
</div><p>ç¬¬äºŒè¡Œæ˜¯è¾“å‡º, æ¯ä¸€æ¡åŒ…å«ç”±ç«–çº¿åˆ†éš”å¼€çš„åˆ—æ¥ç»„æˆ.</p>
<p>å¤šè¡Œè¡¨æ ¼å¯ä»¥é€šè¿‡_union_æ¥æ„é€ , è¿™ç”¨æ¥ç»„åˆä¸¤ä¸ªè¡¨çš„è¡Œ. å·¦è¾¹çš„è¡¨æ ¼çš„åˆ—ååœ¨æ„å»ºçš„è¡¨ä¸­ä½¿ç”¨. è€Œé—´éš”åœ¨ä¸€è¡Œä¹‹å†…å¹¶ä¸å½±å“ç»“æœ.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">select</span> <span class="mi">38</span> <span class="k">as</span> <span class="n">latitude</span><span class="p">,</span> <span class="mi">122</span> <span class="k">as</span> <span class="n">longitude</span><span class="p">,</span> <span class="s2">&#34;Berkeley&#34;</span> <span class="k">as</span> <span class="n">name</span> <span class="k">union</span>
   <span class="p">...</span><span class="o">&gt;</span> <span class="k">select</span> <span class="mi">42</span><span class="p">,</span>             <span class="mi">71</span><span class="p">,</span>               <span class="s2">&#34;Cambridge&#34;</span>        <span class="k">union</span>
   <span class="p">...</span><span class="o">&gt;</span> <span class="k">select</span> <span class="mi">45</span><span class="p">,</span>             <span class="mi">93</span><span class="p">,</span>               <span class="s2">&#34;Minneapolis&#34;</span><span class="p">;</span>
<span class="mi">38</span><span class="o">|</span><span class="mi">122</span><span class="o">|</span><span class="n">Berkeley</span>
<span class="mi">42</span><span class="o">|</span><span class="mi">71</span><span class="o">|</span><span class="n">Cambridge</span>
<span class="mi">45</span><span class="o">|</span><span class="mi">93</span><span class="o">|</span><span class="n">Minneapolis</span>
</code></pre></td></tr></table>
</div>
</div><p>è¡¨æ ¼å¯ä»¥ç”¨<code>create table</code>å£°æ˜æ¥ç»™å®šä¸€ä¸ªåç§°. è€Œè¿™ä¸ªå£°æ˜ä¹Ÿå¯ä»¥ç”¨æ¥åˆ›å»ºç©ºè¡¨, æˆ‘ä»¬å°†ä¼šå…³æ³¨ç»™å®šåç§°ç»™ä¸€ä¸ªå·²ç»é€šè¿‡<code>select</code>å£°æ˜å®šä¹‰çš„å­˜åœ¨çš„è¡¨æ ¼è¿™ç§å½¢å¼.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">create</span> <span class="k">table</span> <span class="n">cities</span> <span class="k">as</span>
   <span class="p">...</span><span class="o">&gt;</span>    <span class="k">select</span> <span class="mi">38</span> <span class="k">as</span> <span class="n">latitude</span><span class="p">,</span> <span class="mi">122</span> <span class="k">as</span> <span class="n">longitude</span><span class="p">,</span> <span class="s2">&#34;Berkeley&#34;</span> <span class="k">as</span> <span class="n">name</span> <span class="k">union</span>
   <span class="p">...</span><span class="o">&gt;</span>    <span class="k">select</span> <span class="mi">42</span><span class="p">,</span>             <span class="mi">71</span><span class="p">,</span>               <span class="s2">&#34;Cambridge&#34;</span>        <span class="k">union</span>
   <span class="p">...</span><span class="o">&gt;</span>    <span class="k">select</span> <span class="mi">45</span><span class="p">,</span>             <span class="mi">93</span><span class="p">,</span>               <span class="s2">&#34;Minneapolis&#34;</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><p>ä¸€æ—¦ä¸€ä¸ªè¡¨æ ¼è¢«å‘½åäº†, è¿™ä¸ªåç§°å¯ä»¥ç”¨åœ¨<code>select</code>å£°æ˜çš„<code>from</code>å­å¥ä¸­. è¡¨æ ¼ä¸­çš„æ‰€æœ‰åˆ—å¯ä»¥ä½¿ç”¨ç‰¹æ®Šå½¢å¼çš„<code>select *</code>æ¥å±•ç¤º.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">cities</span><span class="p">;</span>
<span class="mi">38</span><span class="o">|</span><span class="mi">122</span><span class="o">|</span><span class="n">Berkeley</span>
<span class="mi">42</span><span class="o">|</span><span class="mi">71</span><span class="o">|</span><span class="n">Cambridge</span>
<span class="mi">45</span><span class="o">|</span><span class="mi">93</span><span class="o">|</span><span class="n">Minneapolis</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="432-selectå£°æ˜">4.3.2 Selectå£°æ˜</h4>
<p><code>select</code>å£°æ˜å®šä¹‰ä¸€ä¸ªæ–°çš„è¡¨, é€šè¿‡åˆ—å‡ºå€¼åœ¨å•ä¸€çš„ä¸€è¡Œæˆ–è€…æ›´ä¸€èˆ¬åœ°é€šè¿‡<code>from</code>å­å¥æŠ•å½±å·²ç»å­˜åœ¨çš„è¡¨:</p>
<p><code>select [column description] from [existing table name]</code></p>
<p>ç»“æœè¡¨ä¸­çš„åˆ—é€šè¿‡ä¸€ä¸ªä»¥é€—å·åˆ†éš”çš„è¡¨è¾¾å¼åˆ—è¡¨æ¥æè¿°, å¯¹ç°æœ‰è¾“å…¥è¡¨çš„æ¯ä¸€è¡Œæ‰§è¡Œè¿ç®—.</p>
<p>ä¾‹å¦‚, æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸¤åˆ—çš„è¡¨, è¿™ä¸ªè¡¨æè¿°äº†æ¯ä¸ªåŸå¸‚è·ç¦»ä¼¯å…‹åˆ©çš„åŒ—éƒ¨æˆ–è€…å—éƒ¨æœ‰å¤šè¿œ. æ¯ä¸ªçº¬åº¦çš„æ¯ä¸€åº¦è¡¨ç¤ºè·ç¦»åŒ—æ–¹60æµ·é‡Œ.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">name</span><span class="p">,</span> <span class="mi">60</span><span class="o">*</span><span class="k">abs</span><span class="p">(</span><span class="n">latitude</span><span class="o">-</span><span class="mi">38</span><span class="p">)</span> <span class="k">from</span> <span class="n">cities</span><span class="p">;</span>
<span class="n">Berkeley</span><span class="o">|</span><span class="mi">0</span>
<span class="n">Cambridge</span><span class="o">|</span><span class="mi">240</span>
<span class="n">Minneapolis</span><span class="o">|</span><span class="mi">420</span>
</code></pre></td></tr></table>
</div>
</div><p>åˆ—æè¿°åœ¨è¯­è¨€ä¸­æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼å®ƒåˆ†äº«äº†Pythonä¸­çš„è®¸å¤šç‰¹æ€§, æ·»åŠ æ“ä½œç¬¦å¦‚<code>+</code>ä»¥åŠ<code>%</code>, å†…å»ºå‡½æ•°å¦‚<code>abs</code>ä»¥åŠ<code>round</code>, ä»¥åŠæ‹¬å·ç”¨æ¥æè¿°è¿ç®—çš„é¡ºåº. åœ¨è¿™äº›è¡¨è¾¾å¼ä¸­çš„åç§°, ä¾‹å¦‚ä¸Šé¢çš„<code>latitude</code>, æ‰§è¡Œåå¾—åˆ°åˆ—çš„å€¼æ¥å½¢æˆæ•°æ®è¡Œ.</p>
<p>å¯é€‰åœ°, æ¯ä¸ªè¡¨è¾¾å¼å¯ä»¥åæ¥å…³é”®å­—<code>as</code>ä»¥åŠä¸€ä¸ªåˆ—çš„åç§°. å½“æ•´ä¸ªè¡¨æ ¼è¢«èµ‹äºˆä¸€ä¸ªåç§°æ—¶, é€šå¸¸ç»™æ¯ä¸ªåˆ—ä¸€ä¸ªåç§°æ˜¯å¾ˆæœ‰ç”¨çš„, è¿™æ–¹ä¾¿å°†æ¥åœ¨<code>select</code>è¯­å¥ä¸­è¢«å¼•ç”¨. ç”±ç®€å•åç§°æè¿°çš„åˆ—å°†ä¼šè‡ªåŠ¨å‘½å.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">create</span> <span class="k">table</span> <span class="n">distances</span> <span class="k">as</span>
   <span class="p">...</span><span class="o">&gt;</span>   <span class="k">select</span> <span class="n">name</span><span class="p">,</span> <span class="mi">60</span><span class="o">*</span><span class="k">abs</span><span class="p">(</span><span class="n">latitude</span><span class="o">-</span><span class="mi">38</span><span class="p">)</span> <span class="k">as</span> <span class="n">distance</span> <span class="k">from</span> <span class="n">cities</span><span class="p">;</span>
<span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">distance</span><span class="o">/</span><span class="mi">5</span><span class="p">,</span> <span class="n">name</span> <span class="k">from</span> <span class="n">distances</span><span class="p">;</span>
<span class="mi">0</span><span class="o">|</span><span class="n">Berkeley</span>
<span class="mi">48</span><span class="o">|</span><span class="n">Cambridge</span>
<span class="mi">84</span><span class="o">|</span><span class="n">Minneapolis</span>
</code></pre></td></tr></table>
</div>
</div><p><strong><code>Where</code>å­å¥</strong>, <code>select</code>å£°æ˜ä¹Ÿå¯ä»¥åŒ…å«å…·æœ‰è¿‡æ»¤è¡¨è¾¾å¼çš„<code>where</code>å­å¥. è¿™è¡¨è¾¾å¼è¿‡æ»¤æ˜ å°„çš„è¡Œ. åªæœ‰ç»è¿‡æ»¤è¡¨è¾¾å¼è¿ç®—åå¾—åˆ°çš„å€¼ä¸ºçœŸçš„è¡Œæ‰ä¼šè¢«ç”¨äºåœ¨ç»“æœè¡¨ä¸­ç”Ÿæˆä¸€è¡Œè®°å½•.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">create</span> <span class="k">table</span> <span class="n">cold</span> <span class="k">as</span>
   <span class="p">...</span><span class="o">&gt;</span>   <span class="k">select</span> <span class="n">name</span> <span class="k">from</span> <span class="n">cities</span> <span class="k">where</span> <span class="n">latitude</span> <span class="o">&gt;</span> <span class="mi">43</span><span class="p">;</span>
<span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">name</span><span class="p">,</span> <span class="s2">&#34;is cold!&#34;</span> <span class="k">from</span> <span class="n">cold</span><span class="p">;</span>
<span class="n">Minneapolis</span><span class="o">|</span><span class="k">is</span> <span class="n">cold</span><span class="o">!</span>
</code></pre></td></tr></table>
</div>
</div><p><strong><code>Order</code>å­å¥</strong>. <code>select</code>å£°æ˜ä¹Ÿå¯ä»¥å¯¹ç»“æœè¡¨è¿›è¡Œæ’åº. <code>order</code>å­å¥åŒ…å«ä¸€ä¸ªæ’åºè¡¨è¾¾å¼, è¿™è¡¨è¾¾å¼å¯¹æ¯ä¸ªæœªç»è¿‡æ»¤çš„è¡Œæ‰§è¡Œè¿ç®—. è¿™ä¸ªè¡¨è¾¾å¼çš„ç»“æœå€¼ç”¨ä½œç»“æœè¡¨çš„æ’åºæ ‡å‡†.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">distance</span><span class="p">,</span> <span class="n">name</span> <span class="k">from</span> <span class="n">distances</span> <span class="k">order</span> <span class="k">by</span> <span class="o">-</span><span class="n">distance</span><span class="p">;</span>
<span class="mi">84</span><span class="o">|</span><span class="n">Minneapolis</span>
<span class="mi">48</span><span class="o">|</span><span class="n">Cambridge</span>
<span class="mi">0</span><span class="o">|</span><span class="n">Berkeley</span>
</code></pre></td></tr></table>
</div>
</div><p>è¿™äº›ç‰¹æ€§çš„ç»„åˆå…è®¸<code>select</code>è¯­å¥å°†è¾“å…¥è¡¨çš„å„ç§æ˜ å°„è¡¨è¾¾åˆ°ç›¸å…³çš„è¾“å‡ºè¡¨ä¸­.</p>
<h4 id="433-è¿æ¥">4.3.3 è¿æ¥</h4>
<p>é€šå¸¸æ¥è¯´, æ•°æ®åº“ä¼šåŒ…å«å¤šä¸ªè¡¨åŒæ—¶æŸ¥è¯¢å¯ä»¥è¦æ±‚åŒ…å«åœ¨ä¸åŒçš„è¡¨ä¸­çš„ä¿¡æ¯æ¥è®¡ç®—å‡ºæœŸæœ›çš„ç»“æœ. ä¾‹å¦‚, æˆ‘ä»¬å¯èƒ½ä¼šæœ‰ç¬¬äºŒè¡¨æè¿°äº†ä¸åŒåŸå¸‚çš„å¹³å‡æ—¥é«˜æ¸©.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">create</span> <span class="k">table</span> <span class="n">temps</span> <span class="k">as</span>
   <span class="p">...</span><span class="o">&gt;</span>   <span class="k">select</span> <span class="s2">&#34;Berkeley&#34;</span> <span class="k">as</span> <span class="n">city</span><span class="p">,</span> <span class="mi">68</span> <span class="k">as</span> <span class="n">temp</span> <span class="k">union</span>
   <span class="p">...</span><span class="o">&gt;</span>   <span class="k">select</span> <span class="s2">&#34;Chicago&#34;</span>         <span class="p">,</span> <span class="mi">59</span>         <span class="k">union</span>
   <span class="p">...</span><span class="o">&gt;</span>   <span class="k">select</span> <span class="s2">&#34;Minneapolis&#34;</span>     <span class="p">,</span> <span class="mi">55</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><p>é€šè¿‡å°†å¤šä¸ªè¡¨è¿æ¥åœ¨ä¸€èµ·æ¥ç»„åˆæ•°æ®, è¿™æ˜¯æ•°æ®åº“ç³»ç»Ÿçš„åŸºæœ¬æ“ä½œ. æœ‰å¾ˆå¤šæ–¹æ³•æ¥è¿›è¡Œè¿æ¥, æ‰€æœ‰éƒ½æ˜¯å¯†åˆ‡ç›¸å…³çš„, ä½†æ˜¯åœ¨æœ¬æ–‡ä¸­æˆ‘ä»¬ä¼šåªä¸“æ³¨äºä¸€ä¸ªæ–¹æ³•. å½“è¡¨è¢«è¿æ¥æ—¶ç»“æœè¡¨åŒ…å«æ‰€æœ‰è¾“å…¥çš„è¡¨ç»„åˆè€Œæˆçš„æ–°çš„è¡Œ. å¦‚æœä¸¤ä¸ªè¡¨è¢«è¿æ¥åŒæ—¶å·¦è¾¹çš„è¡¨å…·æœ‰<code>m</code>è¡Œ, å³è¾¹çš„è¡¨å…·æœ‰<code>n</code>è¡Œ, é‚£ä¹ˆè¿æ¥åçš„è¡¨å°±ä¼šå…·æœ‰<code>m*n</code>è¡Œ. è¿æ¥åœ¨SQLä¸­çš„è¡¨è¾¾æ˜¯é€šè¿‡åœ¨<code>select</code>è¯­å¥ä¸­çš„<code>from</code>å­å¥ä¸­ç”¨é€—å·åˆ†éš”è¡¨æ ¼åç§°æ¥å®ç°çš„.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">cities</span><span class="p">,</span> <span class="n">temps</span><span class="p">;</span>
<span class="mi">38</span><span class="o">|</span><span class="mi">122</span><span class="o">|</span><span class="n">Berkeley</span><span class="o">|</span><span class="n">Berkeley</span><span class="o">|</span><span class="mi">68</span>
<span class="mi">38</span><span class="o">|</span><span class="mi">122</span><span class="o">|</span><span class="n">Berkeley</span><span class="o">|</span><span class="n">Chicago</span><span class="o">|</span><span class="mi">59</span>
<span class="mi">38</span><span class="o">|</span><span class="mi">122</span><span class="o">|</span><span class="n">Berkeley</span><span class="o">|</span><span class="n">Minneapolis</span><span class="o">|</span><span class="mi">55</span>
<span class="mi">42</span><span class="o">|</span><span class="mi">71</span><span class="o">|</span><span class="n">Cambridge</span><span class="o">|</span><span class="n">Berkeley</span><span class="o">|</span><span class="mi">68</span>
<span class="mi">42</span><span class="o">|</span><span class="mi">71</span><span class="o">|</span><span class="n">Cambridge</span><span class="o">|</span><span class="n">Chicago</span><span class="o">|</span><span class="mi">59</span>
<span class="mi">42</span><span class="o">|</span><span class="mi">71</span><span class="o">|</span><span class="n">Cambridge</span><span class="o">|</span><span class="n">Minneapolis</span><span class="o">|</span><span class="mi">55</span>
<span class="mi">45</span><span class="o">|</span><span class="mi">93</span><span class="o">|</span><span class="n">Minneapolis</span><span class="o">|</span><span class="n">Berkeley</span><span class="o">|</span><span class="mi">68</span>
<span class="mi">45</span><span class="o">|</span><span class="mi">93</span><span class="o">|</span><span class="n">Minneapolis</span><span class="o">|</span><span class="n">Chicago</span><span class="o">|</span><span class="mi">59</span>
<span class="mi">45</span><span class="o">|</span><span class="mi">93</span><span class="o">|</span><span class="n">Minneapolis</span><span class="o">|</span><span class="n">Minneapolis</span><span class="o">|</span><span class="mi">55</span>
</code></pre></td></tr></table>
</div>
</div><p>è¿æ¥ä¸€èˆ¬ä¼šä¼´éšæœ‰<code>where</code>å­å¥æ¥è¡¨è¾¾ä¸¤ä¸ªè¡¨ä¹‹é—´çš„å…³ç³». ä¾‹å¦‚, å¦‚æœæˆ‘ä»¬æƒ³è¦æ”¶é›†æ•°æ®åˆ°ä¸€ä¸ªè¡¨ä¸­, è¿™ä¸ªè¡¨å…è®¸æˆ‘ä»¬å…³è”çº¬åº¦ä»¥åŠæ¸©åº¦, æˆ‘ä»¬ä¼šä»è¿æ¥ä¸­é€‰æ‹©é‚£äº›ä¸¤ä¸ªè¡¨ä¸­éƒ½æåŠåˆ°çš„åŸå¸‚æ¥ç»„æˆè¡Œ. åœ¨<code>cities</code>è¡¨ä¸­, åŸå¸‚çš„åç§°è¢«ä¿å­˜åœ¨åä¸º<code>name</code>çš„åˆ—ä¸­. åœ¨<code>temps</code>è¡¨ä¸­, åŸå¸‚åç§°è¢«ä¿å­˜åœ¨åä¸º<code>city</code>çš„åˆ—ä¸­. <code>where</code>å­å¥åœ¨è¿æ¥è¡¨ä¸­é€‰æ‹©é‚£äº›å€¼ç›¸ç­‰çš„è¡Œ. åœ¨SQL, ä½¿ç”¨å•ä¸ª<code>=</code>ç¬¦å·æ¥æµ‹è¯•æ•°å­—ç­‰å¼.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">name</span><span class="p">,</span> <span class="n">latitude</span><span class="p">,</span> <span class="n">temp</span> <span class="k">from</span> <span class="n">cities</span><span class="p">,</span> <span class="n">temps</span> <span class="k">where</span> <span class="n">name</span> <span class="o">=</span> <span class="n">city</span><span class="p">;</span>
<span class="n">Berkeley</span><span class="o">|</span><span class="mi">38</span><span class="o">|</span><span class="mi">68</span>
<span class="n">Minneapolis</span><span class="o">|</span><span class="mi">45</span><span class="o">|</span><span class="mi">55</span>
</code></pre></td></tr></table>
</div>
</div><p>è¡¨å¯èƒ½ä¼šå…·æœ‰é‡å çš„åˆ—åç§°, å› æ­¤æˆ‘ä»¬éœ€è¦ä¸€ç§é€šè¿‡è¡¨æ¥æ¶ˆé™¤åˆ—åç§°æ­§ä¹‰çš„æ–¹æ³•, ä¸€ä¸ªè¡¨ä¹Ÿå¯èƒ½ä¸å®ƒè‡ªå·±æ¥è¿›è¡Œè¿æ¥, å› æ­¤æˆ‘ä»¬éœ€è¦ä¸€ç§æ–¹æ³•æ¥æ¶ˆé™¤è¡¨åç§°çš„æ­§ä¹‰. ä¸ºäº†è¿™æ ·åš, SQLå…è®¸æˆ‘ä»¬åœ¨<code>from</code>å­å¥ä¸­ç”¨<code>as</code>å…³é”®å­—æ¥ä¸ºè¡¨æ ¼èµ·åˆ«åå¹¶é€šè¿‡ä½¿ç”¨ç‚¹è¡¨è¾¾å¼æ¥åœ¨ç‰¹å®šè¡¨æ ¼ä¸­å¼•ç”¨åˆ—åç§°. ä¸‹é¢çš„<code>select</code>è¯­å¥è®¡ç®—ä¸¤ä¸ªä¸ç›¸ç­‰çš„åŸå¸‚çš„æ¸©åº¦å·®. åœ¨<code>where</code>å­å¥ä¸­å…·æœ‰æŒ‰ä¹‹æ¯é¡ºåºçš„çº¦æŸç¡®ä¿æ¯ä¸€å¯¹æ•°æ®åªä¼šåœ¨ç»“æœä¸­å‡ºç°ä¸€æ¬¡.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">a</span><span class="p">.</span><span class="n">city</span><span class="p">,</span> <span class="n">b</span><span class="p">.</span><span class="n">city</span><span class="p">,</span> <span class="n">a</span><span class="p">.</span><span class="n">temp</span> <span class="o">-</span> <span class="n">b</span><span class="p">.</span><span class="n">temp</span>
   <span class="p">...</span><span class="o">&gt;</span>        <span class="k">from</span> <span class="n">temps</span> <span class="k">as</span> <span class="n">a</span><span class="p">,</span> <span class="n">temps</span> <span class="k">as</span> <span class="n">b</span> <span class="k">where</span> <span class="n">a</span><span class="p">.</span><span class="n">city</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">.</span><span class="n">city</span><span class="p">;</span>
<span class="n">Berkeley</span><span class="o">|</span><span class="n">Chicago</span><span class="o">|</span><span class="mi">10</span>
<span class="n">Berkeley</span><span class="o">|</span><span class="n">Minneapolis</span><span class="o">|</span><span class="mi">15</span>
<span class="n">Chicago</span><span class="o">|</span><span class="n">Minneapolis</span><span class="o">|</span><span class="mi">5</span>
</code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬åœ¨SQLä¸­ç»„åˆè¡¨çš„ä¸¤ç§æ–¹æ³•, è¿æ¥ä»¥åŠåˆå¹¶(<code>join</code>ä»¥åŠ<code>union</code>), å…è®¸è¯­å¥å…·æœ‰æå¤§çš„è¡¨ç°åŠ›.</p>
<h4 id="434-è§£é‡Šsql">4.3.4 è§£é‡ŠSQL</h4>
<p>ä¸ºäº†åˆ›å»ºè¿„ä»Šä¸ºæ­¢ä»‹ç»çš„ä¸€ä¸ªSQLå­é›†çš„è§£æå™¨, æˆ‘ä»¬éœ€è¦åˆ›å»ºè¡¨æ ¼çš„è¡¨ç¤º, ç”¨æ–‡æœ¬å†™æˆçš„è¯­å¥çš„è§£æå™¨ä»¥åŠè§£æè¯­å¥çš„æ‰§è¡Œå™¨. <a href="http://composingprograms.com/examples/sql/sql_exec.py"><code>sql</code></a>è§£æå™¨çš„ä¾‹å­ä»‹ç»äº†æ‰€æœ‰è¿™äº›éƒ¨åˆ†, æä¾›ç®€å•ä½†æ˜¯èƒ½æ¼”ç¤ºåŠŸèƒ½çš„å£°æ˜å¼è¯­è¨€è§£æå™¨.</p>
<p>åœ¨è¿™ä¸ªå®ç°ä¸­, æ¯ä¸ªè¡¨å…·æœ‰å®ƒè‡ªå·±çš„ç±», åœ¨è¡¨ä¸­çš„æ¯è¡Œæ•°æ®é€šè¿‡è¿™ä¸ªè¡¨æ ¼ç±»çš„å®ä¾‹æ¥è¿›è¡Œè¡¨ç¤º. è¡Œåœ¨è¡¨ä¸­çš„æ¯ä¸€åˆ—éƒ½å…·æœ‰ä¸€ä¸ªå±æ€§, åŒæ—¶, è¡¨æ ¼æ˜¯ä¸€ç³»åˆ—çš„è¡Œ.</p>
<p>è¡¨æ ¼çš„ç±»æ˜¯ä½¿ç”¨Pythonæ ‡å‡†åº“ä¸­çš„<code>collections</code>åŒ…ä¸­<a href="https://docs.python.org/3/library/collections.html#collections.namedtuple"><code>namedtuple</code></a>å‡½æ•°æ¥åˆ›å»ºçš„, å®ƒä¼šè¿”å›ä¸€ä¸ªæ–°çš„<code>tuple</code>çš„å­ç±», å¹¶ç»™å…ƒç»„ä¸­çš„æ¯ä¸ªå…ƒç´ å‘½å.</p>
<p>æƒ³ä¸€ä¸‹æ¥è‡ªå‰é¢ç« èŠ‚çš„<code>cities</code>è¡¨, è¡¨ç¤ºå¦‚ä¸‹.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">create</span> <span class="k">table</span> <span class="n">cities</span> <span class="k">as</span>
   <span class="p">...</span><span class="o">&gt;</span>    <span class="k">select</span> <span class="mi">38</span> <span class="k">as</span> <span class="n">latitude</span><span class="p">,</span> <span class="mi">122</span> <span class="k">as</span> <span class="n">longitude</span><span class="p">,</span> <span class="s2">&#34;Berkeley&#34;</span> <span class="k">as</span> <span class="n">name</span> <span class="k">union</span>
   <span class="p">...</span><span class="o">&gt;</span>    <span class="k">select</span> <span class="mi">42</span><span class="p">,</span>             <span class="mi">71</span><span class="p">,</span>               <span class="s2">&#34;Cambridge&#34;</span>        <span class="k">union</span>
   <span class="p">...</span><span class="o">&gt;</span>    <span class="k">select</span> <span class="mi">45</span><span class="p">,</span>             <span class="mi">93</span><span class="p">,</span>               <span class="s2">&#34;Minneapolis&#34;</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><p>ä¸‹é¢çš„Pythonè¯­å¥æ„é€ äº†è¿™è¡¨æ ¼çš„è¡¨ç¤º</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">CitiesRow</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s2">&#34;Row&#34;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&#34;latitude&#34;</span><span class="p">,</span> <span class="s2">&#34;longitude&#34;</span><span class="p">,</span> <span class="s2">&#34;name&#34;</span><span class="p">])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">cities</span> <span class="o">=</span> <span class="p">[</span><span class="n">CitiesRow</span><span class="p">(</span><span class="mi">38</span><span class="p">,</span> <span class="mi">122</span><span class="p">,</span> <span class="s2">&#34;Berkeley&#34;</span><span class="p">),</span>
              <span class="n">CitiesRow</span><span class="p">(</span><span class="mi">42</span><span class="p">,</span>  <span class="mi">71</span><span class="p">,</span> <span class="s2">&#34;Cambridge&#34;</span><span class="p">),</span>
              <span class="n">CitiesRow</span><span class="p">(</span><span class="mi">43</span><span class="p">,</span>  <span class="mi">93</span><span class="p">,</span> <span class="s2">&#34;Minneapolis&#34;</span><span class="p">)]</span>
</code></pre></td></tr></table>
</div>
</div><p><code>select</code>è¯­å¥çš„ç»“æœå¯ä»¥ç”¨åºåˆ—æ“ä½œæ¥è¿›è¡Œè§£æ. å›æƒ³ä¸€ä¸‹æ¥è‡ªå‰é¢ç« èŠ‚çš„<code>distances</code>è¡¨, è¡¨ç¤ºå¦‚ä¸‹.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">create</span> <span class="k">table</span> <span class="n">distances</span> <span class="k">as</span>
   <span class="p">...</span><span class="o">&gt;</span>   <span class="k">select</span> <span class="n">name</span><span class="p">,</span> <span class="mi">60</span><span class="o">*</span><span class="k">abs</span><span class="p">(</span><span class="n">latitude</span><span class="o">-</span><span class="mi">38</span><span class="p">)</span> <span class="k">as</span> <span class="n">distance</span> <span class="k">from</span> <span class="n">cities</span><span class="p">;</span>
<span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">distance</span><span class="o">/</span><span class="mi">5</span><span class="p">,</span> <span class="n">name</span> <span class="k">from</span> <span class="n">distances</span><span class="p">;</span>
<span class="mi">0</span><span class="o">|</span><span class="n">Berkeley</span>
<span class="mi">48</span><span class="o">|</span><span class="n">Cambridge</span>
<span class="mi">84</span><span class="o">|</span><span class="n">Minneapolis</span>
</code></pre></td></tr></table>
</div>
</div><p>è¿™ä¸ªè¡¨æ ¼æ˜¯ç”±<code>cities</code>è¡¨æ ¼ä¸­çš„<code>name</code>ä»¥åŠ<code>latitude</code>åˆ—äº§ç”Ÿçš„. è¿™ç»“æœåˆ—è¡¨å¯ä»¥é€šè¿‡åœ¨è¾“å…¥è¡¨çš„è¡Œä¸Šæ˜ å°„å‡½æ•°æ¥å½¢æˆ, è¿™ä¸ªå‡½æ•°ä¸ºæ¯ä¸€ä¸ª<code>CitiesRow</code>è¿”å›<code>DistancesRow</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="n">DistancesRow</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s2">&#34;Row&#34;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&#34;name&#34;</span><span class="p">,</span> <span class="s2">&#34;distance&#34;</span><span class="p">])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">def</span> <span class="nf">select</span><span class="p">(</span><span class="n">cities_row</span><span class="p">):</span>
        <span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">cities_row</span>
        <span class="k">return</span> <span class="n">DistancesRow</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="mi">60</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">latitude</span><span class="o">-</span><span class="mi">38</span><span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">distances</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">select</span><span class="p">,</span> <span class="n">cities</span><span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">distances</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
<span class="n">Row</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Berkeley&#39;</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">Row</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Cambridge&#39;</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="mi">240</span><span class="p">)</span>
<span class="n">Row</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Minneapolis&#39;</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬çš„SQLè§£æå™¨çš„è®¾è®¡æ¦‚æ‹¬äº†è¿™ä¸ªæ–¹æ³•. <code>select</code>è¯­å¥è¡¨ç¤ºä¸ºç”±<code>select</code>å­å¥æ„é€ çš„ç±»<code>Select</code>çš„å®ä¾‹.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="k">class</span> <span class="nc">Select</span><span class="p">:</span>
        <span class="s2">&#34;&#34;&#34;select [columns] from [tables] where [condition] order by [order].&#34;&#34;&#34;</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">tables</span><span class="p">,</span> <span class="n">condition</span><span class="p">,</span> <span class="n">order</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">columns</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tables</span> <span class="o">=</span> <span class="n">tables</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">condition</span> <span class="o">=</span> <span class="n">condition</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">order</span> <span class="o">=</span> <span class="n">order</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">make_row</span> <span class="o">=</span> <span class="n">create_make_row</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">env</span><span class="p">):</span>
            <span class="s2">&#34;&#34;&#34;Join, filter, sort, and map rows from tables to columns.&#34;&#34;&#34;</span>
            <span class="n">from_rows</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
            <span class="n">filtered_rows</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="p">,</span> <span class="n">from_rows</span><span class="p">)</span>
            <span class="n">ordered_rows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">filtered_rows</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">make_row</span><span class="p">,</span> <span class="n">ordered_rows</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">condition</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">eval</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">condition</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">True</span>
        <span class="k">def</span> <span class="nf">sort</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rows</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">order</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="nb">eval</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">order</span><span class="p">,</span> <span class="n">r</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">rows</span>
</code></pre></td></tr></table>
</div>
</div><p><code>execute</code>æ–¹æ³•è¿æ¥è¾“å…¥è¡¨, è¿‡æ»¤å¹¶æ’åºç»“æœè¡Œ, ç„¶åæ˜ å°„å‡½æ•°<code>make_row</code>è°ƒç”¨åˆ°è¿™äº›ç»“æœè¡Œä¸­. <code>make_row</code>å‡½æ•°æ˜¯åœ¨<code>Select</code>æ„é€ å™¨ä¸­é€šè¿‡è°ƒç”¨<code>create_make_row</code>æ¥åˆ›å»ºçš„, è¿™ä¸ªé«˜é˜¶å‡½æ•°ä¸ºç»“æœè¡¨åˆ›å»ºä¸€ä¸ªæ–°çš„ç±»å¹¶å®šä¹‰å¦‚ä½•å°†è¾“å…¥è¡ŒæŠ•å½±åˆ°è¾“å‡ºè¡Œ. (è¿™ä¸ªå‡½æ•°å…·æœ‰æ›´å¤šé”™è¯¯å¤„ç†ä»¥åŠç‰¹æ®Šæƒ…å†µçš„ç‰ˆæœ¬å‡ºç°åœ¨<a href="http://composingprograms.com/examples/sql/sql_exec.py"><code>sql</code></a>ä¸­.)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="k">def</span> <span class="nf">create_make_row</span><span class="p">(</span><span class="n">description</span><span class="p">):</span>
        <span class="s2">&#34;&#34;&#34;Return a function from an input environment (dict) to an output row.
</span><span class="s2">        description -- a comma-separated list of [expression] as [column name]
</span><span class="s2">        &#34;&#34;&#34;</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="n">description</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&#34;, &#34;</span><span class="p">)</span>
        <span class="n">expressions</span><span class="p">,</span> <span class="n">names</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&#34; as &#34;</span> <span class="ow">in</span> <span class="n">column</span><span class="p">:</span>
                <span class="n">expression</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">column</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&#34; as &#34;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">expression</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">column</span><span class="p">,</span> <span class="n">column</span>
            <span class="n">expressions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">expression</span><span class="p">)</span>
            <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">row</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s2">&#34;Row&#34;</span><span class="p">,</span> <span class="n">names</span><span class="p">)</span>
        <span class="k">return</span> <span class="k">lambda</span> <span class="n">env</span><span class="p">:</span> <span class="n">row</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="nb">eval</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">expressions</span><span class="p">])</span>
</code></pre></td></tr></table>
</div>
</div><p>æœ€å, æˆ‘ä»¬éœ€è¦å®šä¹‰<code>join</code>å‡½æ•°æ¥åˆ›å»ºè¾“å…¥è¡Œ. ç»™å®šä¸€ä¸ª<code>env</code>å­—å…¸åŒ…å«ç°æœ‰è¡¨(è¡Œçš„åˆ—è¡¨)å¹¶ä»¥å®ƒä»¬çš„åå­—ä½œä¸ºkeyå€¼, <code>join</code>å‡½æ•°å°†æ‰€æœ‰è¡Œçš„ç»„åˆ, ç”¨<code>itertools</code>åŒ…ä¸­çš„<a href="https://docs.python.org/3/library/itertools.html#itertools.product"><code>product</code></a>å‡½æ•°ç»„åˆåˆ°è¾“å‡ºè¡¨ä¸­. å®ƒæ˜ å°„ä¸€ä¸ªå«åš<code>make_env</code>çš„å‡½æ•°åˆ°å·²ç»è¿æ¥å®Œæˆçš„è¡Œå½“ä¸­å», è¿™ä¸ªå‡½æ•°å°†æ¯ä¸ªè¡Œçš„ç»„åˆè½¬æ¢ä¸ºå­—å…¸, ä»¥ä¾¿å®ƒå¯ä»¥ç”¨æ¥æ‰§è¡Œè¡¨è¾¾å¼. (è¿™ä¸ªå‡½æ•°å…·æœ‰æ›´å¤šé”™è¯¯å¤„ç†ä»¥åŠç‰¹æ®Šæƒ…å†µçš„ç‰ˆæœ¬å‡ºç°åœ¨<a href="http://composingprograms.com/examples/sql/sql_exec.py"><code>sql</code></a>ä¸­)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">product</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">def</span> <span class="nf">join</span><span class="p">(</span><span class="n">tables</span><span class="p">,</span> <span class="n">env</span><span class="p">):</span>
        <span class="s2">&#34;&#34;&#34;Return an iterator over dictionaries from names to values in a row.
</span><span class="s2">        tables -- a comma-separate sequences of table names
</span><span class="s2">        env    -- a dictionary from global names to tables
</span><span class="s2">        &#34;&#34;&#34;</span>
        <span class="n">names</span> <span class="o">=</span> <span class="n">tables</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&#34;, &#34;</span><span class="p">)</span>
        <span class="n">joined_rows</span> <span class="o">=</span> <span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">env</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">])</span>
        <span class="k">return</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">rows</span><span class="p">:</span> <span class="n">make_env</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">names</span><span class="p">),</span> <span class="n">joined_rows</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">def</span> <span class="nf">make_env</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">names</span><span class="p">):</span>
        <span class="s2">&#34;&#34;&#34;Create an environment of names bound to values.&#34;&#34;&#34;</span>
        <span class="n">env</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">rows</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">row</span><span class="o">.</span><span class="n">_fields</span><span class="p">:</span>
                <span class="n">env</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">env</span>
</code></pre></td></tr></table>
</div>
</div><p>ä¸Šé¢, <code>row._fields</code>æ±‚åŒ…å«è¯¥è¡Œçš„è¡¨çš„åˆ—åç§°çš„å€¼. <code>_fields</code>å±æ€§çš„å­˜åœ¨æ˜¯å› ä¸º<code>row</code>çš„ç±»å‹æ˜¯<code>namedtuple</code>ç±».</p>
<p>æˆ‘ä»¬çš„è§£æå™¨å·²ç»è¶³å¤Ÿæ‰§è¡Œ<code>select</code>è¯­å¥äº†. ä¾‹å¦‚æˆ‘ä»¬å¯ä»¥è®¡ç®—ä»&quot;Berkeley&quot;åˆ°å…¶ä»–æ‰€æœ‰åŸå¸‚çš„çº¬åº¦è·ç¦», å¹¶ä»¥å®ƒä»¬çš„ç»åº¦æ¥æ’åº.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="n">env</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;cities&#34;</span><span class="p">:</span> <span class="n">cities</span><span class="p">}</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">select</span> <span class="o">=</span> <span class="n">Select</span><span class="p">(</span><span class="s2">&#34;name, 60*abs(latitude-38) as distance&#34;</span><span class="p">,</span>
                    <span class="s2">&#34;cities&#34;</span><span class="p">,</span> <span class="s2">&#34;name != &#39;Berkeley&#39;&#34;</span><span class="p">,</span> <span class="s2">&#34;-longitude&#34;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">select</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">env</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
<span class="n">Row</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Minneapolis&#39;</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
<span class="n">Row</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Cambridge&#39;</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="mi">240</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>ä¸Šé¢çš„ä¾‹å­ç­‰äºæ¥ä¸‹æ¥çš„SQLè¯­å¥.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">name</span><span class="p">,</span> <span class="mi">60</span><span class="o">*</span><span class="k">abs</span><span class="p">(</span><span class="n">latitude</span><span class="o">-</span><span class="mi">38</span><span class="p">)</span> <span class="k">as</span> <span class="n">distance</span>
   <span class="p">...</span><span class="o">&gt;</span>        <span class="k">from</span> <span class="n">cities</span> <span class="k">where</span> <span class="n">name</span> <span class="o">!=</span> <span class="s2">&#34;Berkeley&#34;</span> <span class="k">order</span> <span class="k">by</span> <span class="o">-</span><span class="n">longitude</span><span class="p">;</span>
<span class="n">Minneapolis</span><span class="o">|</span><span class="mi">420</span>
<span class="n">Cambridge</span><span class="o">|</span><span class="mi">240</span>
</code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥ä¿å­˜è¿™ä¸ªç»“æœè¡¨åˆ°ç¯å¢ƒä¸­å¹¶å°†å®ƒè·Ÿ<code>cities</code>è¡¨è¿›è¡Œè¿æ¥, å¹¶æ£€ç´¢æ¯ä¸ªåŸå¸‚çš„ç»åº¦.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="n">env</span><span class="p">[</span><span class="s2">&#34;distances&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">select</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">env</span><span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">joined</span> <span class="o">=</span> <span class="n">Select</span><span class="p">(</span><span class="s2">&#34;cities.name as name, distance, longitude&#34;</span><span class="p">,</span> <span class="s2">&#34;cities, distances&#34;</span><span class="p">,</span>
                    <span class="s2">&#34;cities.name == distances.name&#34;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">joined</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">env</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
<span class="n">Row</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Cambridge&#39;</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="mi">240</span><span class="p">,</span> <span class="n">longitude</span><span class="o">=</span><span class="mi">71</span><span class="p">)</span>
<span class="n">Row</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Minneapolis&#39;</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">longitude</span><span class="o">=</span><span class="mi">93</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>ä¸Šé¢çš„ä¾‹å­ç­‰åŒäºä¸‹é¢çš„SQLè¯­å¥.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">cities</span><span class="p">.</span><span class="n">name</span> <span class="k">as</span> <span class="n">name</span><span class="p">,</span> <span class="n">distance</span><span class="p">,</span> <span class="n">longitude</span>
   <span class="p">...</span><span class="o">&gt;</span> <span class="k">from</span> <span class="n">cities</span><span class="p">,</span> <span class="n">distances</span> <span class="k">where</span> <span class="n">cities</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">distances</span><span class="p">.</span><span class="n">name</span>
</code></pre></td></tr></table>
</div>
</div><p>å®Œæ•´çš„<a href="http://composingprograms.com/examples/sql/sql_exec.py"><code>sql</code></a>ä¾‹å­ç¨‹åºä¹ŸåŒ…å«ä¸€ä¸ªç”¨äº<code>select</code>è¯­å¥çš„ç®€å•è§£æå™¨, ä»¥åŠ<code>create table</code>å’Œ<code>union</code>çš„<code>execute</code>æ–¹æ³•. è§£æå™¨å¯ä»¥æ­£ç¡®åœ°æ‰§è¡Œæ‰€æœ‰çš„SQLè¯­å¥åŒ…æ‹¬æœ¬æ–‡ç›®å‰ä¸ºæ­¢æ‰€åŒ…å«çš„. è€Œè¿™ä¸ªç®€å•çš„è§£æå™¨åªå®ç°äº†å°‘é‡å®Œæ•´çš„ç»“æ„åŒ–æŸ¥è¯¢è¯­è¨€, å®ƒçš„ç»“æ„æ¼”ç¤ºäº†åºåˆ—å¤„ç†æ“ä½œä»¥åŠæŸ¥è¯¢è¯­è¨€ä¹‹é—´çš„å…³ç³».</p>
<p><strong>æŸ¥è¯¢è®¡åˆ’</strong>. å£°æ˜å¼è¯­è¨€æè¿°äº†ç»“æœçš„å½¢å¼, ä½†æ˜¯æ²¡æœ‰æ˜ç¡®åœ°æè¿°è¿™ä¸ªç»“æœåº”è¯¥å¦‚ä½•è¢«è®¡ç®—å¾—åˆ°. è¿™ä¸ªè§£æå™¨æ€»æ˜¯è¿æ¥, è¿‡æ»¤, æ’åº, ç„¶åæŠ•å½±è¾“å…¥è¡Œç”¨ä»¥è®¡ç®—ç»“æœè¡Œ. ç„¶è€Œ, æ›´æœ‰æ•ˆç‡çš„è®¡ç®—ç›¸åŒç»“æœçš„æ–¹å¼å¯èƒ½æ˜¯å­˜åœ¨çš„, åŒæ—¶æŸ¥è¯¢è§£æå™¨ä¹Ÿå¯ä»¥è‡ªç”±åœ°åœ¨å®ƒä»¬ä¹‹é—´åšé€‰æ‹©. ä¸ºè®¡ç®—æŸ¥è¯¢ç»“æœé€‰æ‹©é«˜æ•ˆè¿‡ç¨‹ä¹Ÿæ˜¯æ•°æ®åº“ç³»ç»Ÿçš„æ ¸å¿ƒåŠŸèƒ½.</p>
<p>ä¾‹å¦‚, æ€è€ƒä¸€ä¸‹ä¸Šé¢æœ€åçš„é€‰æ‹©è¯­å¥. å¹¶éæ˜¯è®¡ç®—è¿æ¥åçš„<code>cities</code>ä»¥åŠ<code>distances</code>ç„¶åè¿‡æ»¤å‡ºç»“æœ, è€Œæ˜¯ç›¸åŒçš„ç»“æœå¯èƒ½é¦–å…ˆå¯¹ä¸¤ä¸ªè¡¨éƒ½ä»¥<code>name</code>åˆ—æ¥è¿›è¡Œæ’åº, ç„¶ååªè¿æ¥å…·æœ‰ç›¸åŒåç§°çš„è¡Œ, ä»¥çº¿æ€§çš„æ–¹å¼è¿‡ä¸€éå·²ç»æ’åºè¿‡çš„è¡Œ. å½“è¡¨æ ¼æ˜¯å·¨å¤§çš„æ—¶å€™, æŸ¥è¯¢è®¡åˆ’é€‰æ‹©å¯ä»¥å…·æœ‰å¾ˆå¤§çš„æ•ˆç‡å¢ç›Š.</p>
<h4 id="435-é€’å½’é€‰æ‹©è¯­å¥">4.3.5 é€’å½’é€‰æ‹©è¯­å¥</h4>
<p>é€‰æ‹©è¯­å¥å¯ä»¥é€‰æ‹©æ€§åœ°åŒ…å«<code>with</code>å­å¥æ¥ç”Ÿæˆä»¥åŠå‘½åå¦å¤–çš„ç”¨æ¥è®¡ç®—æœ€ç»ˆç»“æœçš„è¡¨. selectè¯­å¥çš„å®Œæ•´è¯­æ³•, ä¸åŒ…æ‹¬è”åˆ(unions), å…·æœ‰ä»¥ä¸‹çš„å½¢å¼:</p>
<p><code>with [tables] select [columns] from [names] where [condition] order by [order]</code></p>
<p>æˆ‘ä»¬å·²ç»å±•ç¤ºäº†[columns]å’Œ[names]çš„å…è®¸å€¼. [condition]ä»¥åŠ[order]æ˜¯å¯ä»¥ç”¨æ¥æ‰§è¡Œè®¡ç®—è¾“å…¥è¡Œçš„è¡¨è¾¾å¼. [tables]éƒ¨åˆ†æ˜¯ä¸€ä¸ªç”¨é€—å·åˆ†å‰²çš„ç”¨æ¥æè¿°è¡¨æ ¼å½¢å¼çš„åˆ—è¡¨.</p>
<p><code>[table name]([column names]) as ([select statement])</code></p>
<p>ä»»ä½•<code>select</code>è¯­å¥éƒ½å¯ä»¥è¢«ç”¨æ¥åœ¨[tables]ä¸­æè¿°ä¸€ä¸ªè¡¨</p>
<p>ä¾‹å¦‚, ä¸‹é¢çš„<code>with</code>å­å¥å£°æ˜äº†ä¸€ä¸ªè¡¨<code>states</code>åŒ…å«åŸå¸‚ä»¥åŠå®ƒä»¬çš„çŠ¶æ€. <code>select</code>è¯­å¥è®¡ç®—åŒä¸€å·å†…çš„åŸå¸‚å¯¹.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">with</span>
   <span class="p">...</span><span class="o">&gt;</span>   <span class="n">states</span><span class="p">(</span><span class="n">city</span><span class="p">,</span> <span class="k">state</span><span class="p">)</span> <span class="k">as</span> <span class="p">(</span>
   <span class="p">...</span><span class="o">&gt;</span>     <span class="k">select</span> <span class="s2">&#34;Berkeley&#34;</span><span class="p">,</span>  <span class="s2">&#34;California&#34;</span>    <span class="k">union</span>
   <span class="p">...</span><span class="o">&gt;</span>     <span class="k">select</span> <span class="s2">&#34;Boston&#34;</span><span class="p">,</span>    <span class="s2">&#34;Massachusetts&#34;</span> <span class="k">union</span>
   <span class="p">...</span><span class="o">&gt;</span>     <span class="k">select</span> <span class="s2">&#34;Cambridge&#34;</span><span class="p">,</span> <span class="s2">&#34;Massachusetts&#34;</span> <span class="k">union</span>
   <span class="p">...</span><span class="o">&gt;</span>     <span class="k">select</span> <span class="s2">&#34;Chicago&#34;</span><span class="p">,</span>   <span class="s2">&#34;Illinois&#34;</span>      <span class="k">union</span>
   <span class="p">...</span><span class="o">&gt;</span>     <span class="k">select</span> <span class="s2">&#34;Pasadena&#34;</span><span class="p">,</span>  <span class="s2">&#34;California&#34;</span>
   <span class="p">...</span><span class="o">&gt;</span>   <span class="p">)</span>
   <span class="p">...</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">a</span><span class="p">.</span><span class="n">city</span><span class="p">,</span> <span class="n">b</span><span class="p">.</span><span class="n">city</span><span class="p">,</span> <span class="n">a</span><span class="p">.</span><span class="k">state</span> <span class="k">from</span> <span class="n">states</span> <span class="k">as</span> <span class="n">a</span><span class="p">,</span> <span class="n">states</span> <span class="k">as</span> <span class="n">b</span>
   <span class="p">...</span><span class="o">&gt;</span>        <span class="k">where</span> <span class="n">a</span><span class="p">.</span><span class="k">state</span> <span class="o">=</span> <span class="n">b</span><span class="p">.</span><span class="k">state</span> <span class="k">and</span> <span class="n">a</span><span class="p">.</span><span class="n">city</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">.</span><span class="n">city</span><span class="p">;</span>
<span class="n">Berkeley</span><span class="o">|</span><span class="n">Pasadena</span><span class="o">|</span><span class="n">California</span>
<span class="n">Boston</span><span class="o">|</span><span class="n">Cambridge</span><span class="o">|</span><span class="n">Massachusetts</span>
</code></pre></td></tr></table>
</div>
</div><p>ä¸€ä¸ªå®šä¹‰åœ¨<code>with</code>å­å¥ä¸­çš„è¡¨å¯èƒ½ä¼šå…·æœ‰é€’å½’çš„æƒ…å†µ, å®ƒæ ¹æ®å…¶ä»–è¾“å‡ºè¡Œæ¥å®šä¹‰è¾“å‡ºè¡Œ. ä¾‹å¦‚, ä¸‹é¢çš„<code>with</code>å­å¥å®šä¹‰ä¸€ä¸ªå…·æœ‰5åˆ°15çš„æ•´æ•°çš„è¡¨, è€Œå¥‡æ•°å€¼ä¼šè¢«é€‰æ‹©å¹¶è¿›è¡Œå¹³æ–¹.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">with</span>
   <span class="p">...</span><span class="o">&gt;</span>   <span class="n">ints</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">as</span> <span class="p">(</span>
   <span class="p">...</span><span class="o">&gt;</span>     <span class="k">select</span> <span class="mi">5</span> <span class="k">union</span>
   <span class="p">...</span><span class="o">&gt;</span>     <span class="k">select</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span> <span class="k">from</span> <span class="n">ints</span> <span class="k">where</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">15</span>
   <span class="p">...</span><span class="o">&gt;</span>   <span class="p">)</span>
   <span class="p">...</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="o">*</span><span class="n">n</span> <span class="k">from</span> <span class="n">ints</span> <span class="k">where</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="mi">5</span><span class="o">|</span><span class="mi">25</span>
<span class="mi">7</span><span class="o">|</span><span class="mi">49</span>
<span class="mi">9</span><span class="o">|</span><span class="mi">81</span>
<span class="mi">11</span><span class="o">|</span><span class="mi">121</span>
<span class="mi">13</span><span class="o">|</span><span class="mi">169</span>
<span class="mi">15</span><span class="o">|</span><span class="mi">225</span>
</code></pre></td></tr></table>
</div>
</div><p>å¤šä¸ªè¡¨å¯ä»¥è¢«å®šä¹‰åœ¨<code>with</code>å­å¥ä¸­, ç”¨é€—å·éš”å¼€. ä¸‹é¢çš„ä¾‹å­è®¡ç®—æ‰€æœ‰çš„æ¥è‡ªè¡¨ä¸­çš„æ•´æ•°çš„æ¯•è¾¾å“¥æ–¯æ‹‰ä¸‰è§’æ•°, å®ƒä»¬çš„å¹³æ–¹, ä»¥åŠå¹³æ–¹å¯¹çš„å’Œ. æ¯•è¾¾å“¥æ–¯æ‹‰ä¸‰è§’æ•°ç”±æ•´æ•°<code>a</code>, <code>b</code>ä»¥åŠ<code>c</code>æ¥ç»„æˆè¿™æ ·çš„å…¬å¼\(a^2 + b^2 = c^2\)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">with</span>
   <span class="p">...</span><span class="o">&gt;</span>   <span class="n">ints</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">as</span> <span class="p">(</span>
   <span class="p">...</span><span class="o">&gt;</span>     <span class="k">select</span> <span class="mi">1</span> <span class="k">union</span> <span class="k">select</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span> <span class="k">from</span> <span class="n">ints</span> <span class="k">where</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">20</span>
   <span class="p">...</span><span class="o">&gt;</span>   <span class="p">),</span>
   <span class="p">...</span><span class="o">&gt;</span>   <span class="n">squares</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">xx</span><span class="p">)</span> <span class="k">as</span> <span class="p">(</span>
   <span class="p">...</span><span class="o">&gt;</span>     <span class="k">select</span> <span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="o">*</span><span class="n">n</span> <span class="k">from</span> <span class="n">ints</span>
   <span class="p">...</span><span class="o">&gt;</span>   <span class="p">),</span>
   <span class="p">...</span><span class="o">&gt;</span>   <span class="n">sum_of_squares</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="k">sum</span><span class="p">)</span> <span class="k">as</span> <span class="p">(</span>
   <span class="p">...</span><span class="o">&gt;</span>     <span class="k">select</span> <span class="n">a</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">b</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">.</span><span class="n">xx</span> <span class="o">+</span> <span class="n">b</span><span class="p">.</span><span class="n">xx</span>
   <span class="p">...</span><span class="o">&gt;</span>            <span class="k">from</span> <span class="n">squares</span> <span class="k">as</span> <span class="n">a</span><span class="p">,</span> <span class="n">squares</span> <span class="k">as</span> <span class="n">b</span> <span class="k">where</span> <span class="n">a</span><span class="p">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">.</span><span class="n">x</span>
   <span class="p">...</span><span class="o">&gt;</span>   <span class="p">)</span>
   <span class="p">...</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">x</span> <span class="k">from</span> <span class="n">squares</span><span class="p">,</span> <span class="n">sum_of_squares</span> <span class="k">where</span> <span class="k">sum</span> <span class="o">=</span> <span class="n">xx</span><span class="p">;</span>
<span class="mi">3</span><span class="o">|</span><span class="mi">4</span><span class="o">|</span><span class="mi">5</span>
<span class="mi">6</span><span class="o">|</span><span class="mi">8</span><span class="o">|</span><span class="mi">10</span>
<span class="mi">5</span><span class="o">|</span><span class="mi">12</span><span class="o">|</span><span class="mi">13</span>
<span class="mi">9</span><span class="o">|</span><span class="mi">12</span><span class="o">|</span><span class="mi">15</span>
<span class="mi">8</span><span class="o">|</span><span class="mi">15</span><span class="o">|</span><span class="mi">17</span>
<span class="mi">12</span><span class="o">|</span><span class="mi">16</span><span class="o">|</span><span class="mi">20</span>
</code></pre></td></tr></table>
</div>
</div><p>è®¾è®¡é€’å½’æŸ¥è¯¢æ¶‰åŠåˆ°ç¡®ä¿æ¯ä¸ªè¾“å…¥è¡Œçš„ç›¸åº”ä¿¡æ¯å¯ç”¨äºè®¡ç®—è¾“å‡ºè¡Œ. ä¾‹å¦‚, è®¡ç®—æ–æ³¢é‚£å¥‘æ•°, è¾“å…¥è¡Œä¸ºäº†è¦è®¡ç®—å‡ºä¸‹ä¸€ä¸ªå…ƒç´ éœ€è¦çš„ä¸ä»…æ˜¯å½“å‰å…ƒç´ , åŒæ—¶å‰ä¸€ä¸ªå…ƒç´ ä¹Ÿéœ€è¦.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">with</span>
   <span class="p">...</span><span class="o">&gt;</span>   <span class="n">fib</span><span class="p">(</span><span class="n">previous</span><span class="p">,</span> <span class="k">current</span><span class="p">)</span> <span class="k">as</span> <span class="p">(</span>
   <span class="p">...</span><span class="o">&gt;</span>     <span class="k">select</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span> <span class="k">union</span>
   <span class="p">...</span><span class="o">&gt;</span>     <span class="k">select</span> <span class="k">current</span><span class="p">,</span> <span class="n">previous</span><span class="o">+</span><span class="k">current</span> <span class="k">from</span> <span class="n">fib</span>
   <span class="p">...</span><span class="o">&gt;</span>     <span class="k">where</span> <span class="k">current</span> <span class="o">&lt;=</span> <span class="mi">100</span>
   <span class="p">...</span><span class="o">&gt;</span>   <span class="p">)</span>
   <span class="p">...</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">previous</span> <span class="k">from</span> <span class="n">fib</span><span class="p">;</span>
<span class="mi">0</span>
<span class="mi">1</span>
<span class="mi">1</span>
<span class="mi">2</span>
<span class="mi">3</span>
<span class="mi">5</span>
<span class="mi">8</span>
<span class="mi">13</span>
<span class="mi">21</span>
<span class="mi">34</span>
<span class="mi">55</span>
<span class="mi">89</span>
</code></pre></td></tr></table>
</div>
</div><p>è¿™äº›ä¾‹å­è¯æ˜äº†é€’å½’æ˜¯å¼ºå¤§çš„ç»„åˆæ‰‹æ®µ, ç”šè‡³æ˜¯åœ¨å£°æ˜å¼è¯­è¨€ä¸­.</p>
<p><strong>å»ºé€ å­—ç¬¦ä¸²</strong>. ä¸¤ä¸ªå­—ç¬¦ä¸²å¯ä»¥é€šè¿‡ä½¿ç”¨åœ¨SQLä¸­çš„<code>||</code>æ“ä½œç¬¦çº§è”æˆæ›´é•¿çš„å­—ç¬¦ä¸².</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">with</span> <span class="n">wall</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">as</span> <span class="p">(</span>
  <span class="p">....</span><span class="o">&gt;</span>   <span class="k">select</span> <span class="mi">99</span> <span class="k">union</span> <span class="k">select</span> <span class="mi">98</span> <span class="k">union</span> <span class="k">select</span> <span class="mi">97</span>
  <span class="p">....</span><span class="o">&gt;</span> <span class="p">)</span>
  <span class="p">....</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">n</span> <span class="o">||</span> <span class="s2">&#34; bottles&#34;</span> <span class="k">from</span> <span class="n">wall</span><span class="p">;</span>
<span class="mi">99</span> <span class="n">bottles</span>
<span class="mi">98</span> <span class="n">bottles</span>
<span class="mi">97</span> <span class="n">bottles</span>
</code></pre></td></tr></table>
</div>
</div><p>è¿™ä¸ªç‰¹æ€§å¯ä»¥ç”¨æ¥é€šè¿‡çŸ­è¯­ä»è€Œæ„é€ å¥å­. ä¾‹å¦‚, æ„é€ è‹±æ–‡å¥å­çš„ä¸€ç§æ–¹å¼æ˜¯çº§è”ä¸€ä¸ªä¸»é¢˜åè¯çŸ­è¯­, ä¸€ä¸ªåŠ¨è¯, ä»¥åŠä¸€ä¸ªå¯¹è±¡åè¯çŸ­è¯­.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">create</span> <span class="k">table</span> <span class="n">nouns</span> <span class="k">as</span>
  <span class="p">....</span><span class="o">&gt;</span>   <span class="k">select</span> <span class="s2">&#34;the dog&#34;</span> <span class="k">as</span> <span class="n">phrase</span> <span class="k">union</span>
  <span class="p">....</span><span class="o">&gt;</span>   <span class="k">select</span> <span class="s2">&#34;the cat&#34;</span>           <span class="k">union</span>
  <span class="p">....</span><span class="o">&gt;</span>   <span class="k">select</span> <span class="s2">&#34;the bird&#34;</span><span class="p">;</span>
<span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">subject</span><span class="p">.</span><span class="n">phrase</span> <span class="o">||</span> <span class="s2">&#34; chased &#34;</span> <span class="o">||</span> <span class="k">object</span><span class="p">.</span><span class="n">phrase</span>
  <span class="p">....</span><span class="o">&gt;</span>        <span class="k">from</span> <span class="n">nouns</span> <span class="k">as</span> <span class="n">subject</span><span class="p">,</span> <span class="n">nouns</span> <span class="k">as</span> <span class="k">object</span>
  <span class="p">....</span><span class="o">&gt;</span>        <span class="k">where</span> <span class="n">subject</span><span class="p">.</span><span class="n">phrase</span> <span class="o">!=</span> <span class="k">object</span><span class="p">.</span><span class="n">phrase</span><span class="p">;</span>
<span class="n">the</span> <span class="n">bird</span> <span class="n">chased</span> <span class="n">the</span> <span class="n">cat</span>
<span class="n">the</span> <span class="n">bird</span> <span class="n">chased</span> <span class="n">the</span> <span class="n">dog</span>
<span class="n">the</span> <span class="n">cat</span> <span class="n">chased</span> <span class="n">the</span> <span class="n">bird</span>
<span class="n">the</span> <span class="n">cat</span> <span class="n">chased</span> <span class="n">the</span> <span class="n">dog</span>
<span class="n">the</span> <span class="n">dog</span> <span class="n">chased</span> <span class="n">the</span> <span class="n">bird</span>
<span class="n">the</span> <span class="n">dog</span> <span class="n">chased</span> <span class="n">the</span> <span class="n">cat</span>
</code></pre></td></tr></table>
</div>
</div><p>ä½œä¸ºç»ƒä¹ , ä½¿ç”¨ä¸€ä¸ªæœ¬åœ°é€’å½’è¡¨æ¥æ„å»ºå¥å­, å¦‚: &ldquo;the dog that chased the cat that chased the bird also chased the bird.&rdquo;</p>
<h4 id="436-èšåˆä¸åˆ†ç»„">4.3.6 èšåˆä¸åˆ†ç»„</h4>
<p>åˆ°ç›®å‰ä¸ºæ­¢æˆ‘ä»¬ä»‹ç»çš„<code>select</code>è¯­å¥å¯ä»¥è¿æ¥, æŠ•å°„, æ“çºµå•ä¸ªè¡Œ. é™¤æ­¤ä¹‹å¤–, <code>select</code>è¯­å¥è¿˜å¯ä»¥æ‰§è¡Œå¤šè¡Œèšåˆæ“ä½œ. èšåˆå‡½æ•°<code>max</code>, <code>min</code>, <code>count</code>ä»¥åŠ<code>sum</code>è¿”å›åˆ—ä¸­çš„æœ€å¤§, æœ€å°, æ•°å­—ä»¥åŠæ€»å’Œå€¼. å¤šç§èšåˆå‡½æ•°å¯ä»¥é€šè¿‡å®šä¹‰å¤šä¸ªåˆ—åº”ç”¨åˆ°ç›¸åŒçš„è¡Œé›†åˆé‡Œé¢. åªæœ‰åŒ…å«åœ¨<code>where</code>å­å¥ä¸­çš„åˆ—æ‰ä¼šè¢«è®¤ä¸ºæ˜¯åœ¨è¿™ä¸ªé›†åˆä¸­.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">create</span> <span class="k">table</span> <span class="n">animals</span> <span class="k">as</span>
  <span class="p">....</span><span class="o">&gt;</span>   <span class="k">select</span> <span class="s2">&#34;dog&#34;</span> <span class="k">as</span> <span class="n">name</span><span class="p">,</span> <span class="mi">4</span> <span class="k">as</span> <span class="n">legs</span><span class="p">,</span> <span class="mi">20</span> <span class="k">as</span> <span class="n">weight</span> <span class="k">union</span>
  <span class="p">....</span><span class="o">&gt;</span>   <span class="k">select</span> <span class="s2">&#34;cat&#34;</span>        <span class="p">,</span> <span class="mi">4</span>        <span class="p">,</span> <span class="mi">10</span>           <span class="k">union</span>
  <span class="p">....</span><span class="o">&gt;</span>   <span class="k">select</span> <span class="s2">&#34;ferret&#34;</span>     <span class="p">,</span> <span class="mi">4</span>        <span class="p">,</span> <span class="mi">10</span>           <span class="k">union</span>
  <span class="p">....</span><span class="o">&gt;</span>   <span class="k">select</span> <span class="s2">&#34;t-rex&#34;</span>      <span class="p">,</span> <span class="mi">2</span>        <span class="p">,</span> <span class="mi">12000</span>        <span class="k">union</span>
  <span class="p">....</span><span class="o">&gt;</span>   <span class="k">select</span> <span class="s2">&#34;penguin&#34;</span>    <span class="p">,</span> <span class="mi">2</span>        <span class="p">,</span> <span class="mi">10</span>           <span class="k">union</span>
  <span class="p">....</span><span class="o">&gt;</span>   <span class="k">select</span> <span class="s2">&#34;bird&#34;</span>       <span class="p">,</span> <span class="mi">2</span>        <span class="p">,</span> <span class="mi">6</span><span class="p">;</span>
<span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">select</span> <span class="k">max</span><span class="p">(</span><span class="n">legs</span><span class="p">)</span> <span class="k">from</span> <span class="n">animals</span><span class="p">;</span>
<span class="mi">4</span>
<span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">select</span> <span class="k">sum</span><span class="p">(</span><span class="n">weight</span><span class="p">)</span> <span class="k">from</span> <span class="n">animals</span><span class="p">;</span>
<span class="mi">12056</span>
<span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">select</span> <span class="k">min</span><span class="p">(</span><span class="n">legs</span><span class="p">),</span> <span class="k">max</span><span class="p">(</span><span class="n">weight</span><span class="p">)</span> <span class="k">from</span> <span class="n">animals</span> <span class="k">where</span> <span class="n">name</span> <span class="o">&lt;&gt;</span> <span class="s2">&#34;t-rex&#34;</span><span class="p">;</span>
<span class="mi">2</span><span class="o">|</span><span class="mi">20</span>
</code></pre></td></tr></table>
</div>
</div><p><code>distinct</code>å…³é”®å­—ç¡®ä¿èšåˆä¸­æ²¡æœ‰åŒ…å«åˆ—ä¸­é‡å¤çš„å€¼. åœ¨<code>animals</code>è¡¨ä¸­çš„<code>legs</code>åªå‡ºç°äº†ä¸¤ä¸ªä¸åŒçš„å€¼. ç‰¹æ®Šçš„<code>count(*)</code>å¥æ³•ç»Ÿè®¡è¡Œçš„æ•°é‡.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">select</span> <span class="k">count</span><span class="p">(</span><span class="n">legs</span><span class="p">)</span> <span class="k">from</span> <span class="n">animals</span><span class="p">;</span>
<span class="mi">6</span>
<span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">select</span> <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">from</span> <span class="n">animals</span><span class="p">;</span>
<span class="mi">6</span>
<span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">select</span> <span class="k">count</span><span class="p">(</span><span class="k">distinct</span> <span class="n">legs</span><span class="p">)</span> <span class="k">from</span> <span class="n">animals</span><span class="p">;</span>
<span class="mi">2</span>
</code></pre></td></tr></table>
</div>
</div><p>æ¯ä¸€ä¸ª<code>select</code>è¯­å¥éƒ½äº§å‡ºå…·æœ‰ä¸€è¡Œæ•°æ®çš„è¡¨. <code>select</code>è¯­å¥ä¸­çš„<code>group by</code>ä»¥åŠ<code>having</code>å­å¥æ˜¯ç”¨æ¥å°†è¡Œåˆ†æˆç»„å¹¶ä»…é€‰æ‹©ç»„çš„ä¸€ä¸ªå­é›†. ä»»ä½•åœ¨<code>having</code>å­å¥ä¸­çš„èšåˆå‡½æ•°æˆ–è€…åˆ—æè¿°ä¼šè¢«å•ç‹¬åœ°åº”ç”¨åˆ°æ¯ä¸€ç»„, è€Œä¸æ˜¯è¡¨ä¸­çš„æ•´ä¸ªè¡Œçš„é›†åˆ.</p>
<p>ä¾‹å¦‚, è®¡ç®—æ¥è‡ªè¿™ä¸ªè¡¨çš„æ‰€æœ‰å››æ¡è…¿ä»¥åŠä¸¤æ¡è…¿çš„åŠ¨ç‰©ä¸­é‡é‡æœ€å¤§çš„é‚£ä¸ª, ä¸‹é¢çš„ç¬¬ä¸€ä¸ªè¯­å¥å°†ç‹—å’ŒçŒ«ç»„åˆåœ¨ä¸€èµ·ä¸ºä¸€ä¸ªç»„, åŒæ—¶é¸Ÿä½œä¸ºä¸€ä¸ªåˆ†ç»„. ç»“æœè¡¨æ˜æœ€å¤§é‡é‡çš„ä¸¤æ¡è…¿çš„åŠ¨ç‰©æ˜¯3(é¸Ÿ), è€Œå¯¹äºå››æ¡è…¿çš„åŠ¨ç‰©åˆ™æ˜¯20(ç‹—). ç¬¬äºŒä¸ªæŸ¥è¯¢åˆ—å‡ºäº†è‡³å°‘æœ‰ä¸¤ä¸ªä¸åŒåç§°çš„<code>legs</code>åˆ—ä¸­çš„å€¼.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">legs</span><span class="p">,</span> <span class="k">max</span><span class="p">(</span><span class="n">weight</span><span class="p">)</span> <span class="k">from</span> <span class="n">animals</span> <span class="k">group</span> <span class="k">by</span> <span class="n">legs</span><span class="p">;</span>
<span class="mi">2</span><span class="o">|</span><span class="mi">12000</span>
<span class="mi">4</span><span class="o">|</span><span class="mi">20</span>
<span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">weight</span> <span class="k">from</span> <span class="n">animals</span> <span class="k">group</span> <span class="k">by</span> <span class="n">weight</span> <span class="k">having</span> <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">;</span>
<span class="mi">10</span>
</code></pre></td></tr></table>
</div>
</div><p>å¤šåˆ—ä»¥åŠå®Œæ•´è¡¨è¾¾å¯ä»¥å‡ºç°åœ¨<code>group by</code>å­å¥ä¸­, åŒæ—¶, ç»„å°†ä¸ºæ¯ä¸ªç‹¬ç‰¹çš„ç»„åˆå€¼å½¢æˆç»“æœ. é€šå¸¸, ç”¨åœ¨åˆ†ç»„çš„è¡¨è¾¾å¼ä¹Ÿä¼šå‡ºç°åˆ—æè¿°, å› æ­¤è¿™å¾ˆå®¹æ˜“å»ç¡®å®šæ¯ä¸ªç»„äº§ç”Ÿçš„ç»“æœè¡Œ.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">select</span> <span class="k">max</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="k">from</span> <span class="n">animals</span> <span class="k">group</span> <span class="k">by</span> <span class="n">legs</span><span class="p">,</span> <span class="n">weight</span> <span class="k">order</span> <span class="k">by</span> <span class="n">name</span><span class="p">;</span>
<span class="n">bird</span>
<span class="n">dog</span>
<span class="n">ferret</span>
<span class="n">penguin</span>
<span class="n">t</span><span class="o">-</span><span class="n">rex</span>
<span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">select</span> <span class="k">max</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">legs</span><span class="p">,</span> <span class="n">weight</span> <span class="k">from</span> <span class="n">animals</span> <span class="k">group</span> <span class="k">by</span> <span class="n">legs</span><span class="p">,</span> <span class="n">weight</span>
  <span class="p">....</span><span class="o">&gt;</span>   <span class="k">having</span> <span class="k">max</span><span class="p">(</span><span class="n">weight</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">;</span>
<span class="n">bird</span><span class="o">|</span><span class="mi">2</span><span class="o">|</span><span class="mi">6</span>
<span class="n">penguin</span><span class="o">|</span><span class="mi">2</span><span class="o">|</span><span class="mi">10</span>
<span class="n">ferret</span><span class="o">|</span><span class="mi">4</span><span class="o">|</span><span class="mi">10</span>
<span class="n">dog</span><span class="o">|</span><span class="mi">4</span><span class="o">|</span><span class="mi">20</span>
<span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">select</span> <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="n">weight</span><span class="o">/</span><span class="n">legs</span> <span class="k">from</span> <span class="n">animals</span> <span class="k">group</span> <span class="k">by</span> <span class="n">weight</span><span class="o">/</span><span class="n">legs</span><span class="p">;</span>
<span class="mi">2</span><span class="o">|</span><span class="mi">2</span>
<span class="mi">1</span><span class="o">|</span><span class="mi">3</span>
<span class="mi">2</span><span class="o">|</span><span class="mi">5</span>
<span class="mi">1</span><span class="o">|</span><span class="mi">6000</span>
</code></pre></td></tr></table>
</div>
</div><p><code>having</code>ä½œä¸º<code>where</code>çš„å­å¥å¯ä»¥åŒ…å«ç›¸åŒçš„è¿‡æ»¤, ä½†æ˜¯ä¹Ÿå¯ä»¥åŒ…å«è°ƒç”¨èšåˆå‡½æ•°. ä¸ºäº†æœ€å¿«åœ°æ‰§è¡Œçš„åŒæ—¶æ¸…æ™°ä½¿ç”¨è¿™é—¨è¯­è¨€, åŸºäºå…¶å†…å®¹è¿‡æ»¤å•ä¸ªè¡Œçš„æ¡ä»¶åº”æ˜¾ç¤ºåœ¨<code>where</code>å­å¥ä¸­, è€Œ<code>having</code>å­å¥åº”è¯¥åªåœ¨èšåˆéœ€è¦æ¡ä»¶è¯­å¥æ—¶ä½¿ç”¨(ä¾‹å¦‚, ç¡®å®šç»„çš„æœ€å°çš„<code>count</code>)</p>
<p>å½“ä½¿ç”¨<code>group by</code>å­å¥, åˆ—æè¿°å¯ä»¥åŒ…å«éèšåˆçš„è¡¨è¾¾å¼, åœ¨æŸäº›æƒ…å†µä¸‹, <code>SQL</code>è§£æå™¨å°†ä»åŒ…å«èšåˆçš„å¦ä¸€åˆ—å¯¹åº”çš„è¡Œä¸­é€‰æ‹©å€¼. ä¾‹å¦‚, ä¸‹é¢çš„è¯­å¥ç»™å‡ºæœ€å¤§<code>weight</code>çš„åŠ¨ç‰©çš„<code>name</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">name</span><span class="p">,</span> <span class="k">max</span><span class="p">(</span><span class="n">weight</span><span class="p">)</span> <span class="k">from</span> <span class="n">animals</span><span class="p">;</span>
<span class="n">t</span><span class="o">-</span><span class="n">rex</span><span class="o">|</span><span class="mi">12000</span>
<span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">name</span><span class="p">,</span> <span class="n">legs</span><span class="p">,</span> <span class="k">max</span><span class="p">(</span><span class="n">weight</span><span class="p">)</span> <span class="k">from</span> <span class="n">animals</span> <span class="k">group</span> <span class="k">by</span> <span class="n">legs</span><span class="p">;</span>
<span class="n">t</span><span class="o">-</span><span class="n">rex</span><span class="o">|</span><span class="mi">2</span><span class="o">|</span><span class="mi">12000</span>
<span class="n">dog</span><span class="o">|</span><span class="mi">4</span><span class="o">|</span><span class="mi">20</span>
</code></pre></td></tr></table>
</div>
</div><p>ç„¶è€Œ, æ¯å½“å¯¹åº”äºèšåˆçš„è¡Œæ˜¯ä¸ç¡®å®šçš„æ—¶å€™(ä¾‹å¦‚, å½“ç”¨<code>count</code>è€Œä¸æ˜¯<code>max</code>èšåˆæ—¶), é€‰æ‹©çš„å€¼å¯èƒ½æ˜¯ä»»æ„çš„. ä¸ºäº†æœ€æ¸…æ™°åŒæ—¶æœ€å¯é¢„æµ‹åœ°ä½¿ç”¨è¿™é—¨è¯­è¨€, <code>select</code>è¯­å¥åŒ…å«<code>group by</code>å­å¥çš„è¯è‡³å°‘åº”è¯¥åŒ…å«èšåˆåˆ—åŒæ—¶åªæœ‰å½“éèšåˆåˆ—çš„å†…å®¹å¯ä»¥ä»èšåˆä¸­é¢„æµ‹æ—¶, æ‰å»åŒ…å«å®ƒ.</p>
<h3 id="44-é€»è¾‘ç¼–ç¨‹">4.4 é€»è¾‘ç¼–ç¨‹</h3>
<p>åœ¨è¿™ä¸€ç« ä¸­, æˆ‘ä»¬ä»‹ç»ä¸€ä¸ªå£°æ˜å¼æŸ¥è¯¢è¯­è¨€, å®ƒå«åš<code>logic</code>, ç‰¹åˆ«ä¸ºæœ¬æ–‡æ¥è®¾è®¡çš„. å®ƒå»ºç«‹åœ¨<a href="http://en.wikipedia.org/wiki/Prolog"><code>Prolog</code></a>ä»¥åŠåœ¨<a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-29.html#%25_sec_4.4.1">è®¡ç®—æœºç¨‹åºæ„é€ ä¸è§£æ</a>å£°æ˜å¼è¯­è¨€ä¹‹ä¸Š. æ•°æ®è®°å½•æ˜¯ä½œä¸ºSchemeåˆ—è¡¨æ¥è¡¨ç¤ºçš„, åŒæ—¶æŸ¥è¯¢è¡¨ç¤ºä¸ºSchemeå€¼. <a href="http://composingprograms.com/examples/logic/logic.py.html"><code>logic</code></a>è§£æå™¨æ˜¯ä¸€ä¸ªåŸºäºå‰ä¸€ç« çš„Schemeé¡¹ç›®ä¹‹ä¸Šçš„å®Œæ•´å®ç°.</p>
<h4 id="441-äº‹å®å’Œç–‘é—®">4.4.1 äº‹å®å’Œç–‘é—®</h4>
<p>æ•°æ®å­˜å‚¨è®°å½•ä»£è¡¨ç³»ç»Ÿä¸­çš„äº‹å®. æŸ¥è¯¢è§£æå™¨çš„ç›®çš„æ˜¯ç›´æ¥æ£€ç´¢ä»æ•°æ®åº“è®°å½•ä¸­æŠ½å–çš„äº‹å®çš„é›†åˆ, ä»¥åŠä½¿ç”¨é€»è¾‘æ¨ç†ä»æ•°æ®åº“ä¸­æ¨æ–­å‡ºæ–°çš„äº‹å®. åœ¨<code>logic</code>è¯­è¨€ä¸­çš„<code>fact</code>è¯­å¥åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªéµå¾ªå…³é”®å­—<code>fact</code>çš„åˆ—è¡¨. ä¸€ä¸ªç®€å•çš„äº‹å®æ˜¯å•ä¸€çš„ä¸€ä¸ªåˆ—è¡¨. å¯¹ç¾å›½æ€»ç»Ÿæ„Ÿå…´è¶£çš„ç‹—é¥²å…»å‘˜å¯ä»¥ä½¿ç”¨<code>logic</code>è¯­è¨€è®°å½•å¥¹æ”¶é›†çš„ç‹—çš„å®¶è°±, å¦‚ä¸‹:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-scheme" data-lang="scheme"><span class="p">(</span><span class="nf">fact</span> <span class="p">(</span><span class="nf">parent</span> <span class="nv">abraham</span> <span class="nv">barack</span><span class="p">))</span>
<span class="p">(</span><span class="nf">fact</span> <span class="p">(</span><span class="nf">parent</span> <span class="nv">abraham</span> <span class="nv">clinton</span><span class="p">))</span>
<span class="p">(</span><span class="nf">fact</span> <span class="p">(</span><span class="nf">parent</span> <span class="nv">delano</span> <span class="nv">herbert</span><span class="p">))</span>
<span class="p">(</span><span class="nf">fact</span> <span class="p">(</span><span class="nf">parent</span> <span class="nv">fillmore</span> <span class="nv">abraham</span><span class="p">))</span>
<span class="p">(</span><span class="nf">fact</span> <span class="p">(</span><span class="nf">parent</span> <span class="nv">fillmore</span> <span class="nv">delano</span><span class="p">))</span>
<span class="p">(</span><span class="nf">fact</span> <span class="p">(</span><span class="nf">parent</span> <span class="nv">fillmore</span> <span class="nv">grover</span><span class="p">))</span>
<span class="p">(</span><span class="nf">fact</span> <span class="p">(</span><span class="nf">parent</span> <span class="nv">eisenhower</span> <span class="nv">fillmore</span><span class="p">))</span>
</code></pre></td></tr></table>
</div>
</div><p>åœ¨Schemeè¡¨è¾¾å¼ä¸­, æ¯ä¸ª<code>fact</code>ä¸æ˜¯ä¸€ä¸ªåº”ç”¨ç¨‹åº, è€Œæ˜¯å£°æ˜çš„å…³ç³». &ldquo;Abrahamç‹—æ˜¯Barackç‹—çš„çˆ¶äº²,&rdquo; å£°æ˜ç¬¬ä¸€ä¸ªäº‹å®. å…³ç³»ç±»å‹ä¸éœ€è¦æå‰å®šä¹‰. å…³ç³»å¹¶ä¸æ˜¯ç”¨æ¥åº”ç”¨, è€Œæ˜¯ç”¨äºåŒ¹é…æŸ¥è¯¢.</p>
<p>ä¸€ä¸ªæŸ¥è¯¢ä¹Ÿç”±ä¸€ä¸ªæˆ–å¤šä¸ªåˆ—è¡¨ç»„æˆä½†æ˜¯ä»¥å…³é”®å­—<code>query</code>å¼€å¤´. ä¸€ä¸ªæŸ¥è¯¢å¯èƒ½åŒ…å«å˜é‡, å®ƒä»¥é—®å·ç¬¦å·ä½œä¸ºå¼€å¤´. å˜é‡é€šè¿‡æŸ¥è¯¢è§£æå™¨ä¸äº‹å®è¿›è¡ŒåŒ¹é….</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-scheme" data-lang="scheme"><span class="p">(</span><span class="nf">query</span> <span class="p">(</span><span class="nf">parent</span> <span class="nv">abraham</span> <span class="nv">?child</span><span class="p">))</span>
<span class="nv">Success!</span>
<span class="nv">child:</span> <span class="nv">barack</span>
<span class="nv">child:</span> <span class="nv">clinton</span>
</code></pre></td></tr></table>
</div>
</div><p>æŸ¥è¯¢è§£æå™¨ä»¥<code>Success!</code>ä½œä¸ºå“åº”æ¥è¡¨æ˜æŸ¥è¯¢åŒ¹é…æŸäº›äº‹å®. æ¥ä¸‹æ¥çš„å‡ è¡Œå±•ç¤ºå˜é‡<code>?child</code>çš„æ›¿æ¢åŒ¹é…åœ¨æ•°æ®åº“ä¸­æŸ¥è¯¢çš„äº‹å®.</p>
<p><strong>å¤åˆäº‹å®</strong>. äº‹å®å¯èƒ½ä¹Ÿä¼šåŒ…å«å˜é‡ä»¥åŠå¤šä¸ªå­è¡¨è¾¾å¼. ä¸€ä¸ªå¤šè¡¨è¾¾å¼äº‹å®ä»ç»“è®ºå¼€å§‹, å…¶æ¬¡æ˜¯å‡è®¾. è¦æƒ³ç»“è®ºæ˜¯çœŸå®çš„, é‚£ä¹ˆæ‰€æœ‰çš„å‡è®¾å¿…é¡»è¦æ»¡è¶³:</p>
<p><code>(fact &lt;conclusion&gt; &lt;hypothesis0&gt; &lt;hypothesis1&gt; ... &lt;hypothesisN&gt;)</code></p>
<p>ä¾‹å¦‚, å…³äºå­©å­çš„äº‹å®å¯ä»¥ä»¥å·²ç»å­˜åœ¨æ•°æ®ä¸­çš„çˆ¶çº§çš„äº‹å®ä¸ºåŸºç¡€æ¥å£°æ˜:</p>
<p><code>(fact (child ?c ?p) (parent ?p ?c))</code></p>
<p>ä¸Šé¢çš„äº‹å®å¯ä»¥è¢«è¯»ä½œ: &ldquo;?c æ˜¯ ?p çš„å­©å­. å€˜è‹¥ ?p æ˜¯ ?c çš„çˆ¶çº§.&rdquo; ä¸€ä¸ªæŸ¥è¯¢ç°åœ¨å¯ä»¥è¢«ç´¢å¼•åˆ°è¿™ä¸ªäº‹å®:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-scheme" data-lang="scheme"><span class="p">(</span><span class="nf">query</span> <span class="p">(</span><span class="nf">child</span> <span class="nv">?child</span> <span class="nv">fillmore</span><span class="p">))</span>
<span class="nv">Success!</span>
<span class="nv">child:</span> <span class="nv">abraham</span>
<span class="nv">child:</span> <span class="nv">delano</span>
<span class="nv">child:</span> <span class="nv">grover</span>
</code></pre></td></tr></table>
</div>
</div><p>ä¸Šé¢çš„æŸ¥è¯¢éœ€è¦æŸ¥è¯¢è§£æå™¨æ¥ç»„åˆé‚£äº›å„ä¸ªçˆ¶çº§äº‹å®è¢«å®šä¹‰ä¸ºfillmoreçš„å­çº§çš„äº‹å®. è¯­è¨€çš„ç”¨æˆ·ä¸éœ€è¦çŸ¥é“è¿™äº›ä¿¡æ¯æ˜¯å¦‚ä½•è¢«ç»„åˆçš„, åªéœ€è¦çŸ¥é“ç»“æœå…·æœ‰ç‰¹å®šçš„å½¢å¼. è¿™æ˜¯ç”±æŸ¥è¯¢è§£æå™¨æ¥è¯æ˜åœ¨ç»™å®šçš„å¯ç”¨äº‹å®ä¸‹<code>(child abraham fillmore)</code>æ˜¯å¯¹çš„.</p>
<p>æŸ¥è¯¢ä¸éœ€è¦åŒ…æ‹¬å˜é‡; å®ƒå¯èƒ½åªæ˜¯ç®€å•åœ°éªŒè¯ä¸€ä¸ªäº‹å®:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-scheme" data-lang="scheme"><span class="p">(</span><span class="nf">query</span> <span class="p">(</span><span class="nf">child</span> <span class="nv">herbert</span> <span class="nv">delano</span><span class="p">))</span>
<span class="nv">Success!</span>
</code></pre></td></tr></table>
</div>
</div><p>æŸ¥è¯¢å¦‚æœæ²¡æœ‰åŒ¹é…ä»»ä½•çš„äº‹å®ä¼šè¿”å›å¤±è´¥(æ¶ˆæ¯):</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-scheme" data-lang="scheme"><span class="p">(</span><span class="nf">query</span> <span class="p">(</span><span class="nf">child</span> <span class="nv">eisenhower</span> <span class="nv">?parent</span><span class="p">))</span>
<span class="nv">Failed</span><span class="o">.</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>å¦å®š</strong>. æˆ‘ä»¬å¯ä»¥ç”¨å…³é”®è¯<code>not</code>æ¥æ£€æŸ¥æŸ¥è¯¢è¯­å¥æ˜¯å¦æ²¡æœ‰åŒ¹é…ä»»ä½•çš„äº‹å®:</p>
<p><code>(query (not &lt;relation&gt;))</code></p>
<p>å¦‚æœ<code>&lt;relation&gt;</code>å¤±è´¥, åˆ™æŸ¥è¯¢æˆåŠŸ, å¦‚æœ<code>&lt;relation&gt;</code>æˆåŠŸ, åˆ™æŸ¥è¯¢å¤±è´¥. è¿™ä¸€æ€æƒ³è¢«ç§°ä¸ºå¦å®šä¸ºå¤±è´¥.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-scheme" data-lang="scheme"><span class="p">(</span><span class="nf">query</span> <span class="p">(</span><span class="nb">not </span><span class="p">(</span><span class="nf">parent</span> <span class="nv">abraham</span> <span class="nv">clinton</span><span class="p">)))</span>
<span class="nv">Failed</span><span class="o">.</span>

<span class="p">(</span><span class="nf">query</span> <span class="p">(</span><span class="nb">not </span><span class="p">(</span><span class="nf">parent</span> <span class="nv">abraham</span> <span class="nv">barack</span><span class="p">)))</span>
<span class="nv">Failed</span><span class="o">.</span>
</code></pre></td></tr></table>
</div>
</div><p>æœ‰æ—¶å€™, å¦å®šä¸ºå¤±è´¥å¯¹äºæœŸæœ›å¦å®šèƒ½å¤Ÿæœ‰æ•ˆæ˜¯æœ‰æ‚–å¸¸ç†çš„. æƒ³ä¸€ä¸‹ä¸‹é¢çš„æŸ¥è¯¢çš„ç»“æœ:</p>
<p><code>(query (not (parent abraham ?who)))</code></p>
<p>ä¸ºä»€ä¹ˆè¿™ä¸ªæŸ¥è¯¢ä¼šå¤±è´¥? å¯ä»¥è‚¯å®šçš„æ˜¯è¿™é‡Œæœ‰è®¸å¤šç¬¦å·å¯ä»¥ç»‘å®šåˆ°è¿™ä¸ªè¢«ä¿ç•™çš„å˜é‡<code>?who</code>ä¸­. ç„¶è€Œ, å¦å®šçš„æ­¥éª¤è¡¨æ˜æˆ‘ä»¬é¦–å…ˆæ£€æŸ¥çš„å…³ç³»æ˜¯<code>(parent abraham ?who).</code> è¿™ä¸ªå…³è”æ˜¯æˆåŠŸçš„, å› ä¸º<code>?who</code>å¯ä»¥è¢«ç»‘å®šåˆ°<code>barack</code>æˆ–è€…<code>clinton</code>ä¸­. ç”±äºè¿™ä¸ªå…³è”æˆåŠŸäº†, è¿™ä¸ªå…³è”çš„å¦å®šåˆ™å¿…ç„¶å¤±è´¥.</p>
<h4 id="442-é€’å½’äº‹å®">4.4.2 é€’å½’äº‹å®</h4>
<p><code>logic</code>è¯­è¨€ä¹Ÿå…è®¸é€’å½’äº‹å®. ä¹Ÿå°±æ˜¯è¯´, äº‹å®çš„ç»“è®ºå¯èƒ½å–å†³äºä¸€ä¸ªå‡è®¾, è¿™ä¸ªå‡è®¾åŒ…å«äº†ç›¸åŒçš„ç¬¦å·. ä¾‹å¦‚, ç¥–å…ˆå…³ç³»è¢«å®šä¹‰ä¸ºä¸¤ä¸ªäº‹å®. æŸäº›<code>?a</code>å¦‚æœæ˜¯<code>?y</code>çš„çˆ¶çº§æˆ–è€…æ˜¯<code>?y</code>çš„ç¥–å…ˆçš„çˆ¶çº§, åˆ™å®ƒæ˜¯<code>?y</code>çš„ç¥–å…ˆ.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-scheme" data-lang="scheme"><span class="p">(</span><span class="nf">fact</span> <span class="p">(</span><span class="nf">ancestor</span> <span class="nv">?a</span> <span class="nv">?y</span><span class="p">)</span> <span class="p">(</span><span class="nf">parent</span> <span class="nv">?a</span> <span class="nv">?y</span><span class="p">))</span>
<span class="p">(</span><span class="nf">fact</span> <span class="p">(</span><span class="nf">ancestor</span> <span class="nv">?a</span> <span class="nv">?y</span><span class="p">)</span> <span class="p">(</span><span class="nf">parent</span> <span class="nv">?a</span> <span class="nv">?z</span><span class="p">)</span> <span class="p">(</span><span class="nf">ancestor</span> <span class="nv">?z</span> <span class="nv">?y</span><span class="p">))</span>
</code></pre></td></tr></table>
</div>
</div><p>å•ä¸ªæŸ¥è¯¢å¯ä»¥åˆ—å‡ºæ‰€æœ‰çš„<code>herbert</code>çš„ç¥–å…ˆ:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-scheme" data-lang="scheme"><span class="p">(</span><span class="nf">query</span> <span class="p">(</span><span class="nf">ancestor</span> <span class="nv">?a</span> <span class="nv">herbert</span><span class="p">))</span>
<span class="nv">Success!</span>
<span class="nv">a:</span> <span class="nv">delano</span>
<span class="nv">a:</span> <span class="nv">fillmore</span>
<span class="nv">a:</span> <span class="nv">eisenhower</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>å¤åˆæŸ¥è¯¢</strong>. æŸ¥è¯¢å¯èƒ½å…·æœ‰å¤šä¸ªå­è¡¨è¾¾å¼, åœ¨è¿™ç§æƒ…å†µä¸‹, æ‰€æœ‰è¿™äº›éƒ½å¿…é¡»åŒæ—¶é€šè¿‡å°†ç¬¦å·åˆ†é…åˆ°å˜é‡æ¥åŒæ—¶æ»¡è¶³. å¦‚æœä¸€ä¸ªå˜é‡åœ¨ä¸€æ¬¡æŸ¥è¯¢ä¸­å‡ºç°å¤šäºä¸€æ¬¡, é‚£ä¹ˆå®ƒå¿…é¡»åœ¨æ¯ä¸ªä¸Šä¸‹æ–‡ä¸­éƒ½å…·æœ‰ç›¸åŒçš„å€¼. æ¥ä¸‹æ¥çš„æŸ¥è¯¢æŸ¥æ‰¾<code>herbert</code>ä»¥åŠ<code>barack</code>çš„å…±åŒç¥–å…ˆ:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-scheme" data-lang="scheme"><span class="p">(</span><span class="nf">query</span> <span class="p">(</span><span class="nf">ancestor</span> <span class="nv">?a</span> <span class="nv">barack</span><span class="p">)</span> <span class="p">(</span><span class="nf">ancestor</span> <span class="nv">?a</span> <span class="nv">herbert</span><span class="p">))</span>
<span class="nv">Success!</span>
<span class="nv">a:</span> <span class="nv">fillmore</span>
<span class="nv">a:</span> <span class="nv">eisenhower</span>
</code></pre></td></tr></table>
</div>
</div><p>é€’å½’äº‹å®å¯èƒ½éœ€è¦ä¸€é•¿ä¸²çš„æ¨è®ºæ¥å°†æŸ¥è¯¢ä¸æ•°æ®åº“ä¸­çš„ç°æœ‰äº‹å®ç›¸åŒ¹é…. ä¾‹å¦‚, è¦è¯æ˜äº‹å®(fillmore herbertçš„ç¥–å…ˆ), æˆ‘ä»¬å¿…é¡»è¦è¯æ˜æ¯ä¸€ä¸ªå…·æœ‰ç»§æ‰¿æ€§çš„ä¸‹åˆ—äº‹å®:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-scheme" data-lang="scheme"><span class="p">(</span><span class="nf">parent</span> <span class="nv">delano</span> <span class="nv">herbert</span><span class="p">)</span>       <span class="c1">; (1), a simple fact</span>
<span class="p">(</span><span class="nf">ancestor</span> <span class="nv">delano</span> <span class="nv">herbert</span><span class="p">)</span>     <span class="c1">; (2), from (1) and the 1st ancestor fact</span>
<span class="p">(</span><span class="nf">parent</span> <span class="nv">fillmore</span> <span class="nv">delano</span><span class="p">)</span>      <span class="c1">; (3), a simple fact</span>
<span class="p">(</span><span class="nf">ancestor</span> <span class="nv">fillmore</span> <span class="nv">herbert</span><span class="p">)</span>   <span class="c1">; (4), from (2), (3), &amp; the 2nd ancestor fact</span>
</code></pre></td></tr></table>
</div>
</div><p>é€šè¿‡è¿™ç§æ–¹å¼, æŸä¸ªäº‹å®å¯ä»¥æ„å‘³ç€ä¸€å¤§å †é¢å¤–çš„äº‹å®, ç”šè‡³æ˜¯æ— é™å¤šçš„, åªè¦è¿™ä¸ªæŸ¥è¯¢è§£æå™¨èƒ½å¤Ÿå‘ç°å®ƒä»¬.</p>
<p><strong>åˆ†çº§äº‹å®</strong>. åˆ°ç›®å‰ä¸ºæ­¢, æ¯ä¸ªäº‹å®ä»¥åŠæŸ¥è¯¢è¡¨è¾¾å¼éƒ½æ˜¯ç¬¦å·åˆ—è¡¨. é™¤æ­¤ä¹‹å¤–, äº‹å®ä»¥åŠæŸ¥è¯¢åˆ—è¡¨å¯ä»¥åŒ…å«åˆ—è¡¨, æä¾›äº†ä¸€ç§æ–¹å¼æ¥è¡¨ç¤ºåˆ†çº§æ•°æ®. æ¯åªç‹—çš„é¢œè‰²å¯èƒ½ä¼šä¸åç§°ä¸€èµ·å­˜å‚¨åœ¨é™„åŠ è®°å½•ä¸­:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-scheme" data-lang="scheme"><span class="p">(</span><span class="nf">fact</span> <span class="p">(</span><span class="nf">dog</span> <span class="p">(</span><span class="nf">name</span> <span class="nv">abraham</span><span class="p">)</span> <span class="p">(</span><span class="nf">color</span> <span class="nv">white</span><span class="p">)))</span>
<span class="p">(</span><span class="nf">fact</span> <span class="p">(</span><span class="nf">dog</span> <span class="p">(</span><span class="nf">name</span> <span class="nv">barack</span><span class="p">)</span> <span class="p">(</span><span class="nf">color</span> <span class="nv">tan</span><span class="p">)))</span>
<span class="p">(</span><span class="nf">fact</span> <span class="p">(</span><span class="nf">dog</span> <span class="p">(</span><span class="nf">name</span> <span class="nv">clinton</span><span class="p">)</span> <span class="p">(</span><span class="nf">color</span> <span class="nv">white</span><span class="p">)))</span>
<span class="p">(</span><span class="nf">fact</span> <span class="p">(</span><span class="nf">dog</span> <span class="p">(</span><span class="nf">name</span> <span class="nv">delano</span><span class="p">)</span> <span class="p">(</span><span class="nf">color</span> <span class="nv">white</span><span class="p">)))</span>
<span class="p">(</span><span class="nf">fact</span> <span class="p">(</span><span class="nf">dog</span> <span class="p">(</span><span class="nf">name</span> <span class="nv">eisenhower</span><span class="p">)</span> <span class="p">(</span><span class="nf">color</span> <span class="nv">tan</span><span class="p">)))</span>
<span class="p">(</span><span class="nf">fact</span> <span class="p">(</span><span class="nf">dog</span> <span class="p">(</span><span class="nf">name</span> <span class="nv">fillmore</span><span class="p">)</span> <span class="p">(</span><span class="nf">color</span> <span class="nv">brown</span><span class="p">)))</span>
<span class="p">(</span><span class="nf">fact</span> <span class="p">(</span><span class="nf">dog</span> <span class="p">(</span><span class="nf">name</span> <span class="nv">grover</span><span class="p">)</span> <span class="p">(</span><span class="nf">color</span> <span class="nv">tan</span><span class="p">)))</span>
<span class="p">(</span><span class="nf">fact</span> <span class="p">(</span><span class="nf">dog</span> <span class="p">(</span><span class="nf">name</span> <span class="nv">herbert</span><span class="p">)</span> <span class="p">(</span><span class="nf">color</span> <span class="nv">brown</span><span class="p">)))</span>
</code></pre></td></tr></table>
</div>
</div><p>æŸ¥è¯¢å¯ä»¥è¡¨è¾¾å±‚æ¬¡ç»“æ„çš„å®Œæ•´ç»“æ„, æˆ–è€…å®ƒä»¬å¯ä»¥å°†å˜é‡åŒ¹é…åˆ°æ•´ä¸ªåˆ—è¡¨:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-scheme" data-lang="scheme"><span class="p">(</span><span class="nf">query</span> <span class="p">(</span><span class="nf">dog</span> <span class="p">(</span><span class="nf">name</span> <span class="nv">clinton</span><span class="p">)</span> <span class="p">(</span><span class="nf">color</span> <span class="nv">?color</span><span class="p">)))</span>
<span class="nv">Success!</span>
<span class="nv">color:</span> <span class="nv">white</span>

<span class="p">(</span><span class="nf">query</span> <span class="p">(</span><span class="nf">dog</span> <span class="p">(</span><span class="nf">name</span> <span class="nv">clinton</span><span class="p">)</span> <span class="nv">?info</span><span class="p">))</span>
<span class="nv">Success!</span>
<span class="nv">info:</span> <span class="p">(</span><span class="nf">color</span> <span class="nv">white</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>æ•°æ®åº“ä¸­çš„å¤§éƒ¨åˆ†åŠŸèƒ½åœ¨äºæŸ¥è¯¢è§£æå™¨åœ¨ä¸€æ¬¡æŸ¥è¯¢ä¸­å°†å¤šç§äº‹å®è¿æ¥çš„èƒ½åŠ›. ä¸‹é¢çš„æŸ¥è¯¢å¯»æ‰¾æ‰€æœ‰çš„ä»¥ä¸€å¯¹å½¢å¼ç»„æˆçš„ç‹—, å…¶ä¸­ä¸€ä¸ªæ˜¯å¦ä¸€ä¸ªçš„ç¥–å…ˆ, å¹¶ä¸”å®ƒä»¬å…±äº«åŒä¸€ç§é¢œè‰²:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-scheme" data-lang="scheme"><span class="p">(</span><span class="nf">query</span> <span class="p">(</span><span class="nf">dog</span> <span class="p">(</span><span class="nf">name</span> <span class="nv">?name</span><span class="p">)</span> <span class="p">(</span><span class="nf">color</span> <span class="nv">?color</span><span class="p">))</span>
       <span class="p">(</span><span class="nf">ancestor</span> <span class="nv">?ancestor</span> <span class="nv">?name</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">dog</span> <span class="p">(</span><span class="nf">name</span> <span class="nv">?ancestor</span><span class="p">)</span> <span class="p">(</span><span class="nf">color</span> <span class="nv">?color</span><span class="p">)))</span>
<span class="nv">Success!</span>
<span class="nv">name:</span> <span class="nv">barack</span>	<span class="nv">color:</span> <span class="nv">tan</span>	<span class="nv">ancestor:</span> <span class="nv">eisenhower</span>
<span class="nv">name:</span> <span class="nv">clinton</span>	<span class="nv">color:</span> <span class="nv">white</span>	<span class="nv">ancestor:</span> <span class="nv">abraham</span>
<span class="nv">name:</span> <span class="nv">grover</span>	<span class="nv">color:</span> <span class="nv">tan</span>	<span class="nv">ancestor:</span> <span class="nv">eisenhower</span>
<span class="nv">name:</span> <span class="nv">herbert</span>	<span class="nv">color:</span> <span class="nv">brown</span>	<span class="nv">ancestor:</span> <span class="nv">fillmore</span>
</code></pre></td></tr></table>
</div>
</div><p>å˜é‡å¯ä»¥åœ¨åˆ†å±‚è®°å½•ä¸­å¼•ç”¨åˆ—è¡¨, è€Œä¸”è¿˜ä½¿ç”¨ç‚¹ç¬¦å·. ä¸€ä¸ªå˜é‡ç´§è·Ÿç€ä¸€ä¸ªç‚¹ç¬¦å·å°†ä¼šåŒ¹é…åˆ—è¡¨ä¸­çš„å…¶ä»–çš„äº‹å®. å¸¦ç‚¹çš„åˆ—è¡¨å¯ä»¥å‡ºç°åœ¨äº‹å®æˆ–è€…æŸ¥è¯¢ä¸­. ä¸‹é¢çš„ä¾‹å­é€šè¿‡åˆ—å‡ºå®ƒä»¬çš„ç¥–å…ˆé“¾æ¥æ„å»ºç‹—çš„è¡€ç»Ÿ. å¹´è½»çš„<code>barack</code>å¾ªç€è‘—åçš„æ€»ç»Ÿå® ç‰©çš„è¿™æ¡çº¿ä¸Š:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-scheme" data-lang="scheme"><span class="p">(</span><span class="nf">fact</span> <span class="p">(</span><span class="nf">pedigree</span> <span class="nv">?name</span><span class="p">)</span> <span class="p">(</span><span class="nf">dog</span> <span class="p">(</span><span class="nf">name</span> <span class="nv">?name</span><span class="p">)</span> <span class="o">.</span> <span class="nv">?details</span><span class="p">))</span>
<span class="p">(</span><span class="nf">fact</span> <span class="p">(</span><span class="nf">pedigree</span> <span class="nv">?child</span> <span class="nv">?parent</span> <span class="o">.</span> <span class="nv">?rest</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">parent</span> <span class="nv">?parent</span> <span class="nv">?child</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">pedigree</span> <span class="nv">?parent</span> <span class="o">.</span> <span class="nv">?rest</span><span class="p">))</span>

<span class="p">(</span><span class="nf">query</span> <span class="p">(</span><span class="nf">pedigree</span> <span class="nv">barack</span> <span class="o">.</span> <span class="nv">?lineage</span><span class="p">))</span>
<span class="nv">Success!</span>
<span class="nv">lineage:</span> <span class="p">()</span>
<span class="nv">lineage:</span> <span class="p">(</span><span class="nf">abraham</span><span class="p">)</span>
<span class="nv">lineage:</span> <span class="p">(</span><span class="nf">abraham</span> <span class="nv">fillmore</span><span class="p">)</span>
<span class="nv">lineage:</span> <span class="p">(</span><span class="nf">abraham</span> <span class="nv">fillmore</span> <span class="nv">eisenhower</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>å£°æ˜å¼æˆ–è€…é€»è¾‘å¼ç¼–ç¨‹å¯ä»¥ä»¥æ˜¾è‘—çš„æ•ˆç‡è¡¨è¾¾äº‹å®ä¹‹é—´çš„å…³ç³». ä¾‹å¦‚, å¦‚æœæˆ‘ä»¬å¸Œæœ›è¡¨è¾¾ä¸¤ä¸ªåˆ—è¡¨å¯ä»¥é™„åŠ å½¢æˆä¸€ä¸ªæ›´é•¿çš„åˆ—è¡¨ä»¥ç¬¬ä¸€ä¸ªåˆ—è¡¨çš„å…ƒç´ ä¸ºå…ˆéšåè·Ÿç€çš„å…ƒç´ æ˜¯ç¬¬äºŒä¸ªåˆ—è¡¨çš„, ä¸ºæ­¤æˆ‘ä»¬å£°æ˜ä¸¤ä¸ªè§„åˆ™. é¦–å…ˆ, åŸºç¡€æƒ…å†µæ˜¯å£°æ˜å°†ç©ºåˆ—è¡¨æ·»åŠ åˆ°ä»»ä½•åˆ—è¡¨ä¸­å¹¶è¿”å›è¿™ä¸ªåˆ—è¡¨:</p>
<p><code>(fact (append-to-form () ?x ?x))</code></p>
<p>æ¥ç€, ä¸€ä¸ªé€’å½’äº‹å®å£°æ˜å…·æœ‰ç¬¬ä¸€ä¸ªå…ƒç´ ä¸º<code>?a</code>ä»¥åŠä½™ä¸‹å…ƒç´ <code>?r</code>çš„åˆ—è¡¨é™„åŠ åˆ°åˆ—è¡¨<code>?y</code>ä¸­æ¥å½¢æˆä¸€ä¸ªåˆ—è¡¨, å®ƒå…·æœ‰çš„ç¬¬ä¸€ä¸ªå…ƒç´ ä¸º<code>?a</code>ä»¥åŠä½™ä¸‹è¢«é™„åŠ çš„<code>?z</code>. ä¸ºäº†ä¿æŒè¿™ç§å…³ç³», å®ƒå¿…é¡»è¦æ˜¯<code>?r</code>å’Œ<code>?y</code>é™„åŠ å½¢æˆ<code>?z</code>è¿™ç§æƒ…å†µ:</p>
<p><code>(fact (append-to-form (?a . ?r) ?y (?a . ?z)) (append-to-form ?r ?y ?z))</code></p>
<p>ä½¿ç”¨è¿™ä¸¤ä¸ªäº‹å®, æŸ¥è¯¢è§£æå™¨å¯ä»¥è®¡ç®—é™„åŠ ä»»æ„ä¸¤ä¸ªåˆ—è¡¨åˆ°ä¸€èµ·çš„ç»“æœ:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-scheme" data-lang="scheme"><span class="p">(</span><span class="nf">query</span> <span class="p">(</span><span class="nf">append-to-form</span> <span class="p">(</span><span class="nf">a</span> <span class="nv">b</span> <span class="nv">c</span><span class="p">)</span> <span class="p">(</span><span class="nf">d</span> <span class="nv">e</span><span class="p">)</span> <span class="nv">?result</span><span class="p">))</span>
<span class="nv">Success!</span>
<span class="nv">result:</span> <span class="p">(</span><span class="nf">a</span> <span class="nv">b</span> <span class="nv">c</span> <span class="nv">d</span> <span class="nv">e</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>æ­¤å¤–, å®ƒè¿˜å¯ä»¥è®¡ç®—<code>?left</code>ä»¥åŠ<code>?right</code>çš„æ‰€æœ‰å¯èƒ½çš„åˆ—è¡¨å¯¹æ¥é™„åŠ å½¢æˆåˆ—è¡¨(a b c d e):</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-scheme" data-lang="scheme"><span class="p">(</span><span class="nf">query</span> <span class="p">(</span><span class="nf">append-to-form</span> <span class="nv">?left</span> <span class="nv">?right</span> <span class="p">(</span><span class="nf">a</span> <span class="nv">b</span> <span class="nv">c</span> <span class="nv">d</span> <span class="nv">e</span><span class="p">)))</span>
<span class="nv">Success!</span>
<span class="nv">left:</span> <span class="p">()</span>	<span class="nv">right:</span> <span class="p">(</span><span class="nf">a</span> <span class="nv">b</span> <span class="nv">c</span> <span class="nv">d</span> <span class="nv">e</span><span class="p">)</span>
<span class="nv">left:</span> <span class="p">(</span><span class="nf">a</span><span class="p">)</span>	<span class="nv">right:</span> <span class="p">(</span><span class="nf">b</span> <span class="nv">c</span> <span class="nv">d</span> <span class="nv">e</span><span class="p">)</span>
<span class="nv">left:</span> <span class="p">(</span><span class="nf">a</span> <span class="nv">b</span><span class="p">)</span>	<span class="nv">right:</span> <span class="p">(</span><span class="nf">c</span> <span class="nv">d</span> <span class="nv">e</span><span class="p">)</span>
<span class="nv">left:</span> <span class="p">(</span><span class="nf">a</span> <span class="nv">b</span> <span class="nv">c</span><span class="p">)</span>	<span class="nv">right:</span> <span class="p">(</span><span class="nf">d</span> <span class="nv">e</span><span class="p">)</span>
<span class="nv">left:</span> <span class="p">(</span><span class="nf">a</span> <span class="nv">b</span> <span class="nv">c</span> <span class="nv">d</span><span class="p">)</span>	<span class="nv">right:</span> <span class="p">(</span><span class="nf">e</span><span class="p">)</span>
<span class="nv">left:</span> <span class="p">(</span><span class="nf">a</span> <span class="nv">b</span> <span class="nv">c</span> <span class="nv">d</span> <span class="nv">e</span><span class="p">)</span>	<span class="nv">right:</span> <span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><p>å°½ç®¡çœ‹èµ·æ¥æˆ‘ä»¬çš„æŸ¥è¯¢è§£æå™¨å¾ˆæ™ºèƒ½, ä½†æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®ƒé€šè¿‡ä¸€ä¸ªç®€å•çš„æ“ä½œé‡å¤å¾ˆå¤šæ¬¡æ¥æŸ¥æ‰¾è¿™äº›ç»„åˆ: åŒ¹é…åœ¨ç¯å¢ƒä¸­åŒ…å«å˜é‡çš„ä¸¤ä¸ªåˆ—è¡¨.</p>
<h3 id="45-ç»Ÿä¸€">4.5 ç»Ÿä¸€</h3>
<p>æœ¬èŠ‚æè¿°ä¸€ä¸ªèƒ½å¤Ÿæ‰§è¡Œæ¨ç†<code>logic</code>è¯­è¨€çš„æŸ¥è¯¢è§£æå™¨çš„å®ç°. è¿™ä¸ªè§£æå™¨æ˜¯ä¸€ä¸ªä¸€èˆ¬é—®é¢˜çš„è§£å†³è€…, ä½†æ˜¯åœ¨å®ƒå¯ä»¥è§£å†³çš„é—®é¢˜çš„è§„æ¨¡ä»¥åŠç±»å‹ä¸Šå…·æœ‰å®è´¨æ€§çš„é™åˆ¶. å­˜åœ¨ç€æ›´åŠ å¤æ‚é€»è¾‘ç¼–ç¨‹è¯­è¨€, ä½†æ˜¯é«˜æ•ˆæ¨ç†ç¨‹åºçš„æ„å»ºä»ç„¶æ˜¯è®¡ç®—æœºç§‘å­¦ç§¯æç ”ç©¶çš„è¯¾é¢˜.</p>
<p>é€šè¿‡æŸ¥è¯¢è§£æå™¨æ‰§è¡Œçš„åŸºæœ¬æ“ä½œè¢«ç§°ä¸ºç»Ÿä¸€. ç»Ÿä¸€æ˜¯åŒ¹é…æŸ¥è¯¢åˆ°ä¸€ä¸ªäº‹å®çš„ä¸€èˆ¬æ–¹æ³•, æ¯ä¸€ä¸ªéƒ½å¯èƒ½åŒ…å«å˜é‡. æŸ¥è¯¢è§£æå™¨åå¤åœ°åº”ç”¨è¿™ä¸ªæ“ä½œ, é¦–å…ˆå»åŒ¹é…åŸå§‹çš„æŸ¥è¯¢æ¥å¯¹åšå‡ºäº‹å®çš„ç»“è®º, ç„¶ååŒ¹é…äº‹å®å¯¹äºåœ¨æ•°æ®åº“ä¸­çš„å…¶ä»–ç»“è®ºçš„å‡è®¾. åœ¨è¿™æ ·åšä¹‹å, æŸ¥è¯¢è§£æå™¨é€šè¿‡æ‰€æœ‰ä¸äº‹å®æŸ¥è¯¢æœ‰å…³çš„äº‹å®ä¹‹é—´æ¥æ‰§è¡Œæœç´¢. å¦‚æœå®ƒæ‰¾åˆ°ä¸€ä¸ªæ–¹æ³•æ¥æ”¯æŒä½¿ç”¨èµ‹å€¼ç»™å˜é‡è¿›è¡ŒæŸ¥è¯¢, å®ƒä¼šå°†è¯¥å·¥ä½œä½œä¸ºæˆåŠŸçš„ç»“æœè¿”å›.</p>
<h4 id="451-æ¨¡å¼åŒ¹é…">4.5.1 æ¨¡å¼åŒ¹é…</h4>
<p>ä¸ºäº†è¿”å›åŒ¹é…æŸ¥è¯¢çš„ç®€å•äº‹å®, è§£æå™¨å¿…é¡»è¦åŒ¹é…åŒ…å«ä¸å…·æœ‰äº‹å®çš„å˜é‡çš„æŸ¥è¯¢. ä¾‹å¦‚, æŸ¥è¯¢<code>(query (parent abraham ?child))</code>ä»¥åŠå¦‚æœå˜é‡<code>?child</code>å…·æœ‰å€¼<code>barack</code>é‚£ä¹ˆäº‹å®<code>(fact (parent abraham barack))</code>ä¸ä¹‹åŒ¹é….</p>
<p>ä¸€èˆ¬æ¥è¯´, ä¸€ä¸ªæ¨¡å¼åŒ¹é…æŸäº›è¡¨è¾¾å¼(ä¸€ä¸ªå¯èƒ½çš„åµŒå¥—Schemeåˆ—è¡¨), å¦‚æœæœ‰å˜é‡åä¸å€¼çš„ç»‘å®š, å°†è¿™äº›å€¼è½¬æ¢ä¸ºæ¨¡å¼, åˆ™ä¼šç”Ÿæˆè¡¨è¾¾å¼.</p>
<p>ä¾‹å¦‚, è¡¨è¾¾å¼<code>((a b) c (a b))</code>åŒ¹é…æ¨¡å¼<code>(?x c ?x)</code>å…¶ä¸­<code>?x</code>ç»‘å®šåˆ°å€¼<code>(a b)</code>. ç›¸ä¼¼çš„è¡¨è¾¾å¼åŒ¹é…æ¨¡å¼<code>((a ?y) ?z (a b))</code>å…¶ä¸­å˜é‡<code>?y</code>ç»‘å®šåˆ°<code>b</code>åŒæ—¶<code>?z</code>ç»‘å®šåˆ°<code>c</code>.</p>
<h4 id="452-ä»£è¡¨äº‹å®å’ŒæŸ¥è¯¢">4.5.2 ä»£è¡¨äº‹å®å’ŒæŸ¥è¯¢</h4>
<p>ä¸‹é¢çš„ä¾‹å­å¯ä»¥é€šè¿‡å¼•å…¥æä¾›çš„<a href="http://composingprograms.com/examples/logic/logic.py.html"><code>logic</code></a>ä¾‹å­ç¨‹åºæ¥å¤ç°.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">logic</span> <span class="kn">import</span> <span class="o">*</span>
</code></pre></td></tr></table>
</div>
</div><p>æ‰€æœ‰çš„æŸ¥è¯¢ä»¥åŠäº‹å®éƒ½ä½¿ç”¨åœ¨é€»è¾‘è¯­è¨€ä¸­çš„<code>Scheme</code>åˆ—è¡¨æ¥è¡¨ç¤º, ä½¿ç”¨ä¹‹å‰ç« èŠ‚ä¸­ç›¸åŒçš„<code>Pair</code>ç±»ä»¥åŠ<code>nil</code>å¯¹è±¡. ä¾‹å¦‚, æŸ¥è¯¢è¡¨è¾¾å¼<code>(?x c ?x)</code>æ˜¯è¢«è¡¨ç¤ºä¸ºåµŒå¥—çš„<code>Pair</code>å®ä¾‹.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="n">read_line</span><span class="p">(</span><span class="s2">&#34;(?x c ?x)&#34;</span><span class="p">)</span>
<span class="n">Pair</span><span class="p">(</span><span class="s1">&#39;?x&#39;</span><span class="p">,</span> <span class="n">Pair</span><span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="n">Pair</span><span class="p">(</span><span class="s1">&#39;?x&#39;</span><span class="p">,</span> <span class="n">nil</span><span class="p">))))</span>
</code></pre></td></tr></table>
</div>
</div><p>å°±åƒåœ¨Schemeé¡¹ç›®ä¸­ä¸€æ ·, å°†ç¬¦å·ç»‘å®šåˆ°å€¼çš„ç¯å¢ƒç”¨<code>Frame</code>ç±»çš„å®ä¾‹æ¥è¡¨ç¤º, å®ƒå…·æœ‰ä¸€ä¸ªç§°ä¸º<code>bindings</code>çš„å±æ€§.</p>
<p>åœ¨<code>logic</code>è¯­è¨€ä¸­æ‰§è¡Œæ¨¡å¼åŒ¹é…çš„å‡½æ•°è¢«å«åš<code>unify</code>. å®ƒæ¥å—ä¸¤ä¸ªè¾“å…¥, <code>e</code>å’Œ<code>f</code>, ä»¥åŠä¸€ä¸ªè®°å½•äº†å°†å˜é‡ç»‘å®šåˆ°å€¼çš„<code>env</code>ç¯å¢ƒ.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="n">e</span> <span class="o">=</span> <span class="n">read_line</span><span class="p">(</span><span class="s2">&#34;((a b) c (a b))&#34;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">f</span> <span class="o">=</span> <span class="n">read_line</span><span class="p">(</span><span class="s2">&#34;(?x c ?x)&#34;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">env</span> <span class="o">=</span> <span class="n">Frame</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">unify</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
<span class="bp">True</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">env</span><span class="o">.</span><span class="n">bindings</span>
<span class="p">{</span><span class="s1">&#39;?x&#39;</span><span class="p">:</span> <span class="n">Pair</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">Pair</span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">nil</span><span class="p">))}</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="s1">&#39;?x&#39;</span><span class="p">))</span>
<span class="p">(</span><span class="n">a</span> <span class="n">b</span><span class="p">))</span>
</code></pre></td></tr></table>
</div>
</div><p>ä¸Šé¢, æ¥è‡ª<code>unify</code>çš„è¿”å›å€¼<code>True</code>è¡¨æ˜æ¨¡å¼<code>f</code>èƒ½å¤ŸåŒ¹é…è¡¨è¾¾å¼<code>e</code>. ç»“æœç»Ÿä¸€çš„ç»“æœè¢«è®°å½•åœ¨ä»¥ç»‘å®šåˆ°çº¦æŸåœ¨<code>env</code>ä¸­çš„<code>(a b)</code>åˆ°<code>?x</code>.</p>
<h4 id="453-ç»Ÿä¸€ç®—æ³•">4.5.3 ç»Ÿä¸€ç®—æ³•</h4>
<p>ç»Ÿä¸€æ˜¯æ¦‚æ‹¬æ¨¡å¼åŒ¹é…ä¸­å°è¯•å»å¯»æ‰¾ä¸¤ä¸ªå¯èƒ½éƒ½å…·æœ‰å˜é‡çš„è¡¨è¾¾å¼ä¹‹é—´çš„æ˜ å°„. <code>unify</code>å‡½æ•°é€šè¿‡ä¸€ä¸ªé€’å½’è¿‡ç¨‹åœ¨ä¸¤ä¸ªè¡¨è¾¾å¼çš„ç›¸åº”éƒ¨åˆ†æ‰§è¡Œç»Ÿä¸€ç›´åˆ°é‡åˆ°çŸ›ç›¾æˆ–è€…å»ºç«‹å¯¹æ‰€æœ‰å˜é‡çš„å¯è¡Œçº¦æŸæ¥å®ç°ç»Ÿä¸€.</p>
<p>è®©æˆ‘ä»¬ä»¥ä¸€ä¸ªä¾‹å­æ¥ä½œä¸ºå¼€å§‹, æ¨¡å¼<code>(?x ?x)</code>å¯ä»¥åŒ¹é…æ¨¡å¼<code>((a ?y c) (a b ?z))</code>å› ä¸ºæœ‰ä¸€ä¸ªæ²¡æœ‰å˜é‡çš„è¡¨è¾¾å¼å¯ä»¥åŒ¹é…å®ƒä»¬ä¸¤è€…: <code>((a b c) (a b c))</code>. ç»Ÿä¸€é€šè¿‡ä¸‹é¢çš„æ­¥éª¤æ¥è¯†åˆ«è¿™ä¸€è§£å†³æ–¹æ¡ˆ:</p>
<ol>
<li>åŒ¹é…æ¯ä¸ªæ¨¡å¼çš„ç¬¬ä¸€ä¸ªå…ƒç´ , å˜é‡<code>?x</code>è¢«ç»‘å®šåˆ°è¡¨è¾¾å¼<code>(a ?y c)</code>.</li>
<li>åŒ¹é…æ¯ä¸ªæ¨¡å¼çš„ç¬¬äºŒä¸ªå…ƒç´ , é¦–å…ˆå˜é‡<code>?x</code>è¢«å®ƒçš„å€¼ç»™æ›¿ä»£. ç„¶å, é€šè¿‡ç»‘å®š<code>?y</code>åˆ°<code>b</code>ä»¥åŠ<code>?z</code>åˆ°<code>c</code>ä½¿å¾—<code>(a ?y c)</code>è·Ÿ<code>(a b ?z)</code>ç›¸ç¬¦åˆ.</li>
</ol>
<p>å› æ­¤, ä¼ é€’ç»™<code>unify</code>çš„ç»‘å®šç¯å¢ƒåŒ…å«äº†æ¡ç›®<code>?x</code>, <code>?y</code>, ä»¥åŠ<code>?z</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="n">e</span> <span class="o">=</span> <span class="n">read_line</span><span class="p">(</span><span class="s2">&#34;(?x ?x)&#34;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">f</span> <span class="o">=</span> <span class="n">read_line</span><span class="p">(</span><span class="s2">&#34; ((a ?y c) (a b ?z))&#34;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">env</span> <span class="o">=</span> <span class="n">Frame</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">unify</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
<span class="bp">True</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">env</span><span class="o">.</span><span class="n">bindings</span>
<span class="p">{</span><span class="s1">&#39;?z&#39;</span><span class="p">:</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;?y&#39;</span><span class="p">:</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;?x&#39;</span><span class="p">:</span> <span class="n">Pair</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">Pair</span><span class="p">(</span><span class="s1">&#39;?y&#39;</span><span class="p">,</span> <span class="n">Pair</span><span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="n">nil</span><span class="p">)))}</span>
</code></pre></td></tr></table>
</div>
</div><p>ç»Ÿä¸€çš„ç»“æœå¯èƒ½ä¼šç»‘å®šå˜é‡åˆ°ä¸€ä¸ªè¡¨è¾¾å¼, è¿™ä¸ªè¡¨è¾¾å¼æœ¬èº«ä¹Ÿå¯èƒ½åŒ…å«å˜é‡, å°±åƒæˆ‘ä»¬ä¸Šé¢çœ‹åˆ°çš„<code>?x</code>ç»‘å®šä¸º<code>(a ?y c)</code>. <code>bind</code>å‡½æ•°é€’å½’ä¸”é‡å¤åœ°åœ¨ä¸€ä¸ªè¡¨è¾¾å¼ä¸Šç»‘å®šå®ƒä»¬çš„å€¼åˆ°æ‰€æœ‰çš„å˜é‡ä¸Šç›´åˆ°æ²¡æœ‰é—ç•™éœ€è¦ç»‘å®šçš„å˜é‡.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="n">bind</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">env</span><span class="p">))</span>
<span class="p">((</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span><span class="p">)</span> <span class="p">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span><span class="p">))</span>
</code></pre></td></tr></table>
</div>
</div><p>ä¸€èˆ¬æ¥è¯´, ç»Ÿä¸€é€šè¿‡æ£€æŸ¥å‡ ä¸ªæ¡ä»¶æ¥æ‰§è¡Œ. <code>unify</code>çš„å®ç°ç›´æ¥éµå¾ªä¸‹é¢çš„æè¿°.</p>
<ol>
<li>è¾“å…¥<code>e</code>ä»¥åŠ<code>f</code>å¦‚æœå®ƒä»¬ä¸¤è€…æ˜¯å˜é‡åˆ™å®ƒä»¬ä¼šè¢«å€¼ç»™æ›¿æ¢</li>
<li>å¦‚æœ<code>e</code>ä»¥åŠ<code>f</code>ç›¸ç­‰, ç»Ÿä¸€åˆ™æˆåŠŸæ‰§è¡Œ.</li>
<li>å¦‚æœ<code>e</code>æ˜¯ä¸€ä¸ªå˜é‡, ç»Ÿä¸€æˆåŠŸæ‰§è¡ŒåŒæ—¶<code>e</code>è¢«ç»‘å®šåˆ°<code>f</code>.</li>
<li>å¦‚æœ<code>f</code>æ˜¯ä¸€ä¸ªå˜é‡, ç»Ÿä¸€æˆåŠŸæ‰§è¡ŒåŒæ—¶<code>f</code>è¢«ç»‘å®šåˆ°<code>e</code>.</li>
<li>å¦‚æœä¸¤è€…éƒ½ä¸æ˜¯ä¸€ä¸ªå˜é‡, éƒ½ä¸æ˜¯ä¸€ä¸ªåˆ—è¡¨, åŒæ—¶å®ƒä»¬ä¹Ÿä¸ç›¸ç­‰, é‚£ä¹ˆ<code>e</code>ä»¥åŠ<code>f</code>å°±ä¸èƒ½ç»Ÿä¸€, å› æ­¤ç»Ÿä¸€æ‰§è¡Œå¤±è´¥.</li>
<li>å¦‚æœè¿™äº›æƒ…å†µéƒ½ä¸æˆç«‹, é‚£ä¹ˆ<code>e</code>å’Œ<code>f</code>éƒ½æ˜¯<code>pairs</code>, å› æ­¤ç»Ÿä¸€åˆ™éœ€è¦åœ¨å®ƒç¬¬ä¸€å’Œç¬¬äºŒä¸ªå¯¹åº”çš„éƒ¨åˆ†ä¸Šæ‰§è¡Œ.</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="k">def</span> <span class="nf">unify</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">env</span><span class="p">):</span>
        <span class="s2">&#34;&#34;&#34;Destructively extend ENV so as to unify (make equal) e and f, returning
</span><span class="s2">        True if this succeeds and False otherwise.  ENV may be modified in either
</span><span class="s2">        case (its existing bindings are never changed).&#34;&#34;&#34;</span>
        <span class="n">e</span> <span class="o">=</span> <span class="n">lookup</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">lookup</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">e</span> <span class="o">==</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">elif</span> <span class="n">isvar</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
            <span class="n">env</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">elif</span> <span class="n">isvar</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
            <span class="n">env</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">elif</span> <span class="n">scheme_atomp</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="ow">or</span> <span class="n">scheme_atomp</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">unify</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span> <span class="ow">and</span> <span class="n">unify</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">second</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">second</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="454-è¯æ˜">4.5.4 è¯æ˜</h4>
<p>æ€è€ƒé€»è¾‘è¯­è¨€çš„ä¸€ç§æ–¹å¼æ˜¯åœ¨æ­£å¼çš„ç³»ç»Ÿä¸­ä»¥æ–­è¨€æ¥è¿›è¡Œè¯æ˜. æ¯ä¸€ä¸ªå£°æ˜çš„äº‹å®éƒ½æ˜¯å»ºç«‹åœ¨ä¸€ä¸ªæ­£å¼ç³»ç»Ÿä¸Šçš„å…¬ç†ä¸­, åŒæ—¶æ¯ä¸ªæŸ¥è¯¢å¿…é¡»è¦ç”±æŸ¥è¯¢è§£æå™¨æ¥åœ¨è¿™äº›å…¬ç†ä¹‹ä¸Šå»ºç«‹. ä¹Ÿå°±æ˜¯è¯´, æ¯ä¸ªæŸ¥è¯¢å£°æ˜å¯¹å…¶å˜é‡æœ‰ä¸€äº›èµ‹å€¼, ä½¿å¾—å®ƒçš„æ‰€æœ‰å­è¡¨è¾¾å¼åŒæ—¶éµå¾ªç³»ç»Ÿçš„äº‹å®. è€ŒæŸ¥è¯¢è§£æå™¨çš„è§’è‰²å°±æ˜¯å»éªŒè¯çš„ç¡®æ˜¯è¿™æ ·çš„.</p>
<p>ä¾‹å¦‚, ç»™å®šæœ‰å…³ç‹—çš„ä¸€ç³»åˆ—äº‹å®, æˆ‘ä»¬ä¼šæ–­è¨€åœ¨è¿™é‡Œ<code>Clinton</code>ä»¥åŠä¸€æ¡æ£•è‰²çš„ç‹—å…·æœ‰ç›¸åŒçš„ç¥–å…ˆ. æŸ¥è¯¢è§£æå™¨åªè¾“å‡º<code>Success!</code>å¦‚æœå®ƒèƒ½å¤Ÿç¡®å®šè¿™ä¸ªæ–­è¨€æ˜¯çœŸçš„. ä½œä¸ºå‰¯äº§å“, å®ƒå‘ŠçŸ¥æˆ‘ä»¬è¿™ä¸ªå…±åŒç¥–å…ˆä»¥åŠæ£•è‰²çš„ç‹—çš„åå­—:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-scheme" data-lang="scheme"><span class="p">(</span><span class="nf">query</span> <span class="p">(</span><span class="nf">ancestor</span> <span class="nv">?a</span> <span class="nv">clinton</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">ancestor</span> <span class="nv">?a</span> <span class="nv">?brown-dog</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">dog</span> <span class="p">(</span><span class="nf">name</span> <span class="nv">?brown-dog</span><span class="p">)</span> <span class="p">(</span><span class="nf">color</span> <span class="nv">brown</span><span class="p">)))</span>
<span class="nv">Success!</span>
<span class="nv">a:</span> <span class="nv">fillmore</span>	<span class="nv">brown-dog:</span> <span class="nv">herbert</span>
<span class="nv">a:</span> <span class="nv">eisenhower</span>	<span class="nv">brown-dog:</span> <span class="nv">fillmore</span>
<span class="nv">a:</span> <span class="nv">eisenhower</span>	<span class="nv">brown-dog:</span> <span class="nv">herbert</span>
</code></pre></td></tr></table>
</div>
</div><p>å±•ç¤ºåœ¨ç»“æœä¸­çš„ä¸‰ä¸ªä»»åŠ¡ä¸­çš„æ¯ä¸€ä¸ªéƒ½æ˜¯ç”¨æ¥è·Ÿè¸ªåœ¨ç»™å®šçš„äº‹å®ä¸‹æ¥æ›´å¤§åœ°è¯æ˜æŸ¥è¯¢æ˜¯çœŸå®çš„. ä¸€ä¸ªå……åˆ†çš„è¯æ˜åŒ…æ‹¬æ‰€æœ‰ä½¿ç”¨çš„äº‹å®, ä¾‹å¦‚åŒ…å«<code>(parent abraham clinton)</code>ä»¥åŠ<code>(parent fillmore abraham)</code>.</p>
<h4 id="455-æœç´¢">4.5.5 æœç´¢</h4>
<p>ä¸ºäº†åœ¨ç³»ç»Ÿä¸­å·²ç»å»ºç«‹çš„äº‹å®ä¸­å»ºç«‹ä¸€ä¸ªæŸ¥è¯¢, æŸ¥è¯¢è§£æå™¨åœ¨æ‰€æœ‰å¯èƒ½çš„äº‹å®ç©ºé—´ä¸­æ‰§è¡Œä¸€ä¸ªæŸ¥è¯¢. ç»Ÿä¸€æ˜¯åŸå§‹æ“ä½œ, å®ƒå¯¹ä¸¤ä¸ªè¡¨è¾¾å¼è¿›è¡Œæ¨¡å¼åŒ¹é…. åœ¨æŸ¥è¯¢è§£æå™¨ä¸­çš„æœç´¢è¿‡ç¨‹é€‰æ‹©ç”¨å“ªä¸ªè¡¨è¾¾å¼æ¥è¿›è¡Œç»Ÿä¸€, ä»¥ä¾¿æ‰¾åˆ°é“¾æ¥åœ¨ä¸€èµ·ä»¥å»ºç«‹æŸ¥è¯¢çš„ä¸€ç»„äº‹å®.</p>
<p><code>search</code>é€’å½’å‡½æ•°ä¸º<code>logic</code>è¯­è¨€å®ç°æŸ¥è¯¢è¿‡ç¨‹. å®ƒå°†åœ¨æŸ¥è¯¢ä¸­çš„Schemeåˆ—è¡¨ä¸­çš„<code>clauses</code>ä½œä¸ºè¾“å…¥, ç¯å¢ƒ<code>env</code>åŒ…å«å½“å‰ç»‘å®šäº†å€¼(åˆå§‹ä¸ºç©º)çš„ç¬¦å·, è€Œä¸”<code>depth</code>è§„åˆ™é“¾ä¹Ÿå·²ç»è¿æ¥åˆ°ä¸€èµ·äº†.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="k">def</span> <span class="nf">search</span><span class="p">(</span><span class="n">clauses</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">depth</span><span class="p">):</span>
        <span class="s2">&#34;&#34;&#34;Search for an application of rules to establish all the CLAUSES,
</span><span class="s2">        non-destructively extending the unifier ENV.  Limit the search to
</span><span class="s2">        the nested application of DEPTH rules.&#34;&#34;&#34;</span>
        <span class="k">if</span> <span class="n">clauses</span> <span class="ow">is</span> <span class="n">nil</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">env</span>
        <span class="k">elif</span> <span class="n">DEPTH_LIMIT</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">depth</span> <span class="o">&lt;=</span> <span class="n">DEPTH_LIMIT</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">clauses</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">first</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;not&#39;</span><span class="p">,</span> <span class="s1">&#39;~&#39;</span><span class="p">):</span>
                <span class="n">clause</span> <span class="o">=</span> <span class="n">ground</span><span class="p">(</span><span class="n">clauses</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">second</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="nb">next</span><span class="p">(</span><span class="n">search</span><span class="p">(</span><span class="n">clause</span><span class="p">,</span> <span class="n">glob</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
                <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
                    <span class="n">env_head</span> <span class="o">=</span> <span class="n">Frame</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">search</span><span class="p">(</span><span class="n">clauses</span><span class="o">.</span><span class="n">second</span><span class="p">,</span> <span class="n">env_head</span><span class="p">,</span> <span class="n">depth</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                        <span class="k">yield</span> <span class="n">result</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">fact</span> <span class="ow">in</span> <span class="n">facts</span><span class="p">:</span>
                    <span class="n">fact</span> <span class="o">=</span> <span class="n">rename_variables</span><span class="p">(</span><span class="n">fact</span><span class="p">,</span> <span class="n">get_unique_id</span><span class="p">())</span>
                    <span class="n">env_head</span> <span class="o">=</span> <span class="n">Frame</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">unify</span><span class="p">(</span><span class="n">fact</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="n">clauses</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="n">env_head</span><span class="p">):</span>
                        <span class="k">for</span> <span class="n">env_rule</span> <span class="ow">in</span> <span class="n">search</span><span class="p">(</span><span class="n">fact</span><span class="o">.</span><span class="n">second</span><span class="p">,</span> <span class="n">env_head</span><span class="p">,</span> <span class="n">depth</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                            <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">search</span><span class="p">(</span><span class="n">clauses</span><span class="o">.</span><span class="n">second</span><span class="p">,</span> <span class="n">env_rule</span><span class="p">,</span> <span class="n">depth</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                                <span class="k">yield</span> <span class="n">result</span>
</code></pre></td></tr></table>
</div>
</div><p>æ»¡è¶³æ‰€æœ‰å­å¥çš„æŸ¥è¯¢åŒæ—¶ä¹Ÿå¼€å§‹äºç¬¬ä¸€ä¸ªå­å¥, åœ¨æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªå­å¥è¢«å¦å®šçš„ç‰¹æ®Šæƒ…å†µä¸‹, ä¸æ˜¯è¯•å›¾å°†æŸ¥è¯¢çš„ç¬¬ä¸€ä¸ªå­å¥ä¸äº‹å®ç»Ÿä¸€èµ·æ¥, è€Œæ˜¯æˆ‘ä»¬é€šè¿‡é€’å½’è°ƒç”¨<code>search</code>æ¥æ£€æŸ¥è¿™é‡Œæ²¡æœ‰è¿™æ ·çš„ç»Ÿä¸€çš„å¯èƒ½. å¦‚æœè¿™ä¸ªé€’å½’è°ƒç”¨æ²¡æœ‰è¿”å›ä»»ä½•ä¸œè¥¿, æˆ‘ä»¬ä»¥å‰©ä½™çš„å­å¥æ¥ç»§ç»­è¿™ä¸ªæŸ¥è¯¢è¿‡ç¨‹, å¦‚æœç»Ÿä¸€æ˜¯å¯èƒ½çš„, é‚£æˆ‘ä»¬å°±ç«‹å³å¤±è´¥äº†.</p>
<p>å¦‚æœæˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªå­å¥æ²¡æœ‰è¢«å¦å®š, é‚£ä¹ˆå¯¹äºæ•°æ®åº“ä¸­çš„æ¯ä¸€ä¸ªäº‹å®, <code>search</code>éƒ½å°è¯•å»å°†äº‹å®çš„ç¬¬ä¸€ä¸ªå­å¥è·ŸæŸ¥è¯¢çš„ç¬¬ä¸€ä¸ªå­å¥ç»Ÿä¸€èµ·æ¥. ç»Ÿä¸€æ˜¯åœ¨æ–°çš„ç¯å¢ƒ<code>env_head</code>ä¸­æ‰§è¡Œçš„. ä½œä¸ºç»Ÿä¸€çš„å‰¯ä½œç”¨, å˜é‡è¢«ç»‘å®šåˆ°<code>env_head</code>ä¸­çš„å€¼ä¸­.</p>
<p>å¦‚æœç»Ÿä¸€æˆåŠŸäº†, é‚£ä¹ˆ, å­å¥åŒ¹é…å½“å‰è§„åˆ™çš„ç»“è®º. æ¥ä¸‹æ¥çš„<code>for</code>è¯­å¥å°è¯•å»å»ºç«‹è§„åˆ™çš„å‡è®¾, å› æ­¤ç»“è®ºå¯ä»¥è¢«å»ºç«‹. åœ¨è¿™é‡Œ, é€’å½’è§„åˆ™çš„å‡è®¾å°†è¢«é€’å½’åœ°ä¼ é€’ä»¥ä¾¿å»ºç«‹è¿›è¡Œ<code>search</code>.</p>
<p>æœ€å, å¯¹æ¯ä¸ª<code>fact.second</code>çš„æˆåŠŸæœç´¢, ç»“æœé‚£ç¯å¢ƒç»‘å®šåˆ°<code>env_rule</code>. ç»™å®šè¿™äº›å€¼çš„ç»‘å®šåˆ°å˜é‡, æœ€åçš„<code>for</code>è¯­å¥æœç´¢å»ºç«‹åˆå§‹æŸ¥è¯¢çš„å‰©ä½™å­å¥. ä»»ä½•æˆåŠŸçš„ç»“æœéƒ½æ˜¯é€šè¿‡å†…éƒ¨çš„<code>yield</code>è¯­å¥è¿”å›çš„.</p>
<p><strong>å”¯ä¸€åç§°</strong>. ç»Ÿä¸€æ“ä½œå‡è®¾åœ¨<code>e</code>ä»¥åŠ<code>f</code>ä¹‹é—´æ²¡æœ‰å…±äº«å˜é‡. ç„¶è€Œ, æˆ‘ä»¬å¸¸å¸¸åœ¨<code>logic</code>è¯­è¨€çš„äº‹å®ä»¥åŠæŸ¥è¯¢ä¸­å¤ç”¨å˜é‡å. æˆ‘ä»¬ä¸ä¼šæƒ³å°†ä¸€ä¸ªäº‹å®ä¸­çš„<code>?x</code>ä¸å¦å¤–ä¸€ä¸ªäº‹å®ä¸­çš„<code>?x</code>æ··æ·†; è¿™äº›å˜é‡æ˜¯ä¸ç›¸å…³çš„. åœ¨ä¸€ä¸ªäº‹å®ä¼ å…¥åˆ°ç»Ÿä¸€å‰ç¡®ä¿åç§°æ˜¯ä¸è¿·æƒ‘çš„, å…¶å˜é‡åç§°ç”±ä½¿ç”¨<code>rename_variables</code>å‡½æ•°é€šè¿‡ä¸ºäº‹å®é™„åŠ ä¸€ä¸ªå”¯ä¸€çš„æ•´æ•°æ›¿æ¢ä¸ºå”¯ä¸€çš„åç§°.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="k">def</span> <span class="nf">rename_variables</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="s2">&#34;&#34;&#34;Rename all variables in EXPR with an identifier N.&#34;&#34;&#34;</span>
        <span class="k">if</span> <span class="n">isvar</span><span class="p">(</span><span class="n">expr</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">expr</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">scheme_pairp</span><span class="p">(</span><span class="n">expr</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">Pair</span><span class="p">(</span><span class="n">rename_variables</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span>
                        <span class="n">rename_variables</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">second</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">expr</span>
</code></pre></td></tr></table>
</div>
</div><p>å…¶ä½™çš„ç»†èŠ‚, åŒ…æ‹¬åœ¨<code>logic</code>è¯­è¨€ä¸­çš„ç”¨æˆ·æ¥å£ä»¥åŠå„ç§å¸®ç»„å‡½æ•°çš„å®šä¹‰, éƒ½å‡ºç°åœ¨<a href="http://composingprograms.com/examples/logic/logic.py.html"><code>logic</code></a>çš„ä¾‹å­ä¸­.</p>
<h3 id="46-åˆ†å¸ƒå¼è®¡ç®—">4.6 åˆ†å¸ƒå¼è®¡ç®—</h3>
<p>å¤§å‹æ•°æ®å¤„ç†ç¨‹åºé€šå¸¸ä¼šåœ¨å¤šä¸ªè®¡ç®—æœºä¹‹é—´å¯¹æœ‰ç»„ç»‡çš„æ´»åŠ¨è¿›è¡Œåè°ƒ. åˆ†å¸ƒå¼è®¡ç®—ç¨‹åºæ˜¯ä¸€ä¸ªåœ¨å¤šä¸ªç›¸äº’è¿æ¥ä½†ç‹¬ç«‹è®¡ç®—æœºä¹‹é—´è”åˆåè°ƒè®¡ç®—è¿‡ç¨‹çš„ç¨‹åº.</p>
<p>ä¸åŒçš„è®¡ç®—æœºåœ¨æŸç§æ„ä¹‰ä¸Šè®²æ˜¯ç‹¬ç«‹çš„å› ä¸ºå®ƒä»¬å¹¶ä¸ç›´æ¥å…±äº«å†…å­˜. ç›¸å, å®ƒä»¬ç”¨_æ¶ˆæ¯_æ¥å½¼æ­¤é€šä¿¡, é€šè¿‡ç½‘ç»œå°†æ¶ˆæ¯ä»ä¸€å°è®¡ç®—æœºä¼ é€’åˆ°å¦ä¸€å°è®¡ç®—æœº.</p>
<h4 id="461-æ¶ˆæ¯">4.6.1 æ¶ˆæ¯</h4>
<p>åœ¨è®¡ç®—æœºä¹‹é—´å‘é€çš„æ¶ˆæ¯æ˜¯ä¸€ç³»åˆ—çš„ä½. å‘é€ä»¥åŠæ¥æ”¶çš„è®¡ç®—æœºéƒ½å¿…é¡»è¦å¯¹æ¶ˆæ¯çš„å«ä¹‰è¿›è¡Œåå•†æ¥ä½¿å¾—äº¤æµèƒ½å¤ŸæˆåŠŸ. å¾ˆå¤šæ¶ˆæ¯åè®®æŒ‡å®šæ¶ˆæ¯å¿…é¡»éµå¾ªç‰¹å®šçš„æ ¼å¼ä½¿å¾—åœ¨ç‰¹å®šä½ç½®çš„ä½è¡¨ç¤ºç‰¹å®šçš„æ¡æ¬¾. å…¶ä»–ä½¿ç”¨ç‰¹æ®Šä¸€ä¸ªä½æˆ–å‡ ä¸ªä½åºåˆ—æ¥ç•Œå®šæ¶ˆæ¯çš„å„ä¸ªéƒ¨åˆ†, å°±åƒåœ¨ç¼–ç¨‹è¯­è¨€ä¸­ç”¨æ ‡ç‚¹ç¬¦å·æ¥ç•Œå®šå­è¡¨è¾¾å¼.</p>
<p>æ¶ˆæ¯åè®®å¹¶éç‰¹å®šçš„ç¨‹åºæˆ–è€…è½¯ä»¶åº“. ç›¸åå®ƒä»¬æ˜¯å¯ä»¥è¢«åº”ç”¨åˆ°å¤šç§ç¨‹åºä¸­çš„è§„åˆ™, ç”šè‡³å¯ä»¥ç”¨ä¸åŒçš„ç¼–ç¨‹è¯­è¨€æ¥ç¼–å†™. å› æ­¤, å…·æœ‰æå¤§ä¸åŒçš„è½¯ä»¶ç³»ç»Ÿå¯ä»¥ç®€å•åœ°é€šè¿‡éµä»æ”¯é…æ•´ä¸ªç³»ç»Ÿçš„æ¶ˆæ¯åè®®æ¥å‚ä¸åˆ°ç›¸åŒçš„åˆ†å‘ç³»ç»Ÿä¸­.</p>
<p><strong>TCP/IPåè®®</strong>. åœ¨ç½‘ç»œä¸Š, æ¶ˆæ¯ä½¿ç”¨<a href="http://en.wikipedia.org/wiki/Internet_Protocol">ç½‘ç»œåè®®</a>(IP)æ¥ä»ä¸€ä¸ªæœºå™¨åˆ°å¦ä¸€ä¸ªæœºå™¨ä¸Šä¼ é€’, è¿™ä¸ªåè®®å…·ä½“è¯´æ˜äº†å¦‚ä½•åœ¨ä¸åŒçš„ç½‘ç»œä¸­ä¼ è¾“<em>åŒ…</em>æ¥å…è®¸å…¨çƒç½‘ç»œé€šä¿¡. IPæ˜¯è®¾è®¡åœ¨å‡è®¾ç½‘ç»œå†…éƒ¨æœ¬èº«åœ¨ä»»ä½•æ—¶é—´ç‚¹ä»¥åŠåŠ¨æ€ç»“æ„ä¸‹éƒ½æ˜¯ä¸å€¼å¾—ä¿¡ä»»çš„, æ­¤å¤–, å®ƒä¸ä¼šå‡è®¾æœ‰ä»»ä½•é€šä¿¡ä¸Šçš„ä¸­éƒ¨è·Ÿè¸ªæˆ–è€…ç›‘æ§çš„å­˜åœ¨. æ¯ä¸€ä¸ªåŒ…éƒ½åŒ…å«ä¸€ä¸ªå¤´éƒ¨, è¿™ä¸ªå¤´éƒ¨åŒ…å«ç›®çš„IPåœ°å€, ä»¥åŠå…¶ä»–æ¶ˆæ¯. æ‰€æœ‰çš„åŒ…éƒ½æ˜¯åœ¨æ•´ä¸ªç½‘ç»œä¸­å‘ç€ç›®çš„åœ°ä½¿ç”¨ç®€å•çš„è·¯ç”±åè®®ä»¥æœ€å¤§åŠªåŠ›äº¤ä»˜ä¸ºåŸºç¡€æ¥è¿›è¡Œè½¬å‘çš„.</p>
<p>è¿™ä¸ªè®¾è®¡åœ¨é€šè®¯ä¸Šæ–½åŠ é™åˆ¶. åŒ…ä¼ è¾“ä½¿ç”¨IPæ¨¡å¼å®ç°(IPv4ä»¥åŠIPv6)å…¶å…·æœ‰æœ€å¤§å¤§å°ä¸º65,535ä½. æ›´å¤§çš„æ•°æ®å€¼å¿…é¡»åˆ‡åˆ†ä¸ºå¤šä¸ªæ•°æ®åŒ…. IPåè®®å¹¶ä¸ä¿è¯åŒ…ä¼šä»¥å…¶å‘é€çš„ç›¸åŒçš„é¡ºåºæ¥è¢«æ¥æ”¶. ä¸€äº›åŒ…å¯èƒ½ä¼šä¸¢å¤±, æŸäº›åŒ…å¯èƒ½ä¼šè¢«ä¼ è¾“å¤šæ¬¡.</p>
<p><a href="http://en.wikipedia.org/wiki/Transmission_Control_Protocol">ä¼ è¾“æ§åˆ¶åè®®</a>æ˜¯æ ¹æ®IPåè®®æ¥æŠ½è±¡å®šä¹‰çš„ç”¨äºæä¾›å¯é æœ‰åºä¼ è¾“ä»»æ„å¤§å°å­—èŠ‚æµçš„åè®®. è¿™ä¸ªåè®®é€šè¿‡æ­£ç¡®æ’åºIPåè®®çš„æ­£ç¡®çš„åŒ…æ¥æä¾›è¿™ä¸ªä¿è¯, åˆ é™¤é‡å¤ä»¥åŠè¯·æ±‚ä¸¢å¤±äº†çš„åŒ…. è¿™ç§æ”¹è¿›çš„å¯é æ€§ä»¥ç‰ºç‰²å»¶è¿Ÿä¸ºä»£ä»·, å³å°†æ¶ˆæ¯ä»ä¸€ä¸ªç‚¹å‘é€åˆ°å¦ä¸€ä¸ªç‚¹æ‰€éœ€çš„æ—¶é—´.</p>
<p>TCPå°†æµæ•°æ®åˆ‡åˆ†ä¸ºTCPæ®µ, æ¯ä¸ªéƒ½åŒ…å«å‰é¢å¸¦æœ‰æ ‡é¢˜çš„æ•°æ®çš„ä¸€éƒ¨åˆ†, å…¶åŒ…å«åºåˆ—ä»¥åŠçŠ¶æ€ä¿¡æ¯æ¥æ”¯æŒæœ‰åº, å¯é çš„æ•°æ®ä¼ è¾“. æŸäº›TCPæ®µä¸åŒ…å«ä¸€ç‚¹æ•°æ®, åªæ˜¯ç”¨äºå»ºç«‹æˆ–è€…ç»“æŸä¸¤ä¸ªè®¡ç®—æœºä¹‹é—´çš„æ²Ÿé€šé€šè®¯.</p>
<p>åœ¨ä¸¤å°è®¡ç®—æœº<code>A</code>ä»¥åŠ<code>B</code>ä¹‹é—´å»ºç«‹é“¾æ¥éœ€è¦æ‰§è¡Œä¸€ä¸‹ä¸‰ä¸ªæ­¥éª¤:</p>
<ol>
<li>å‘é€è¯·æ±‚åˆ°<code>B</code>çš„ç«¯å£æ¥å»ºç«‹TCPé“¾æ¥, æä¾›ä¸€ä¸ª_ç«¯å£å·_æ¥æŒ‡å®šå“åº”å‘é€çš„ç«¯å£å·.</li>
<li><code>B</code>å‘é€ä¸€ä¸ªå“åº”åˆ°<code>A</code>æŒ‡å®šçš„ç«¯å£å·å¹¶ç­‰å¾…å®ƒçš„å“åº”è¢«ç¡®è®¤.</li>
<li><code>A</code>å‘é€å“åº”ç¡®è®¤, éªŒè¯æ•°æ®å¯ä»¥è¿›è¡ŒåŒå‘ä¼ è¾“.</li>
</ol>
<p>åœ¨è¿›è¡Œè¿™ä¸‰æ­¥&quot;æ¡æ‰‹&quot;ä¹‹å, TCPè¿æ¥å°±å»ºç«‹äº†, <code>A</code>ä»¥åŠ<code>B</code>å¯ä»¥äº’ç›¸ä¹‹é—´å‘é€æ•°æ®. ç»ˆæ­¢TCPè¿æ¥ä¹Ÿéœ€è¦ä¸€ç³»åˆ—çš„æ­¥éª¤æ¥è¿›è¡Œ, å…¶ä¸­å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯éƒ½è¯·æ±‚å¹¶ç¡®è®¤è¿æ¥çš„ç»“æŸ.</p>
<h4 id="462-å®¢æˆ·ç«¯æœåŠ¡å™¨æ¶æ„">4.6.2 å®¢æˆ·ç«¯/æœåŠ¡å™¨æ¶æ„</h4>
<p>å®¢æˆ·ç«¯/æœåŠ¡å™¨æ¶æ„æ˜¯ä»ä¸­å¤®æºåˆ†é…æœåŠ¡çš„ä¸€ç§æ–¹å¼, æœåŠ¡å™¨æä¾›ä¸€ä¸ªæœåŠ¡åŒæ—¶å¤šä¸ªå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨é€šä¿¡æ¥æ¶ˆè´¹è¯¥æœåŠ¡. åœ¨è¿™ä¸­æ¶æ„ä¸‹, å®¢æˆ·ç«¯ä»¥åŠæœåŠ¡å™¨æ‰®æ¼”ä¸åŒçš„è§’è‰². æœåŠ¡å™¨çš„è§’è‰²æ˜¯å»å“åº”æ¥è‡ªå®¢æˆ·ç«¯çš„æœåŠ¡è¯·æ±‚, è€Œå®¢æˆ·ç«¯çš„è§’è‰²æ˜¯å»å‘èµ·è¯·æ±‚ä»¥åŠä½¿ç”¨æœåŠ¡å™¨çš„å“åº”æ¥æ‰§è¡ŒæŸäº›ä»»åŠ¡. ä¸‹é¢çš„å›¾è¡¨è¯´æ˜äº†è¿™ä¸ªæ¶æ„.</p>
<p><img src="http://composingprograms.com/img/clientserver.png" alt="client server architecture" /></p>
<p>ä½¿ç”¨è¿™ç§æ¨¡å‹ä¸”æœ€æœ‰å½±å“åŠ›çš„æ˜¯ç°ä»£ä¸‡ç»´ç½‘(World Wide Web). å½“ç½‘ç»œæµè§ˆå™¨å±•ç°ç½‘é¡µçš„å†…å®¹æ—¶, è¿è¡Œåœ¨ç‹¬ç«‹è®¡ç®—æœºä¸Šçš„å¤šä¸ªç¨‹åºä½¿ç”¨å®¢æˆ·ç«¯/æµè§ˆå™¨æ¶æ„æ¥è¿›è¡Œäº¤äº’. è¿™ä¸€èŠ‚ä»‹ç»è¯·æ±‚ç½‘é¡µçš„è¿‡ç¨‹ç”¨ä»¥è¯´æ˜å®¢æˆ·ç«¯/æœåŠ¡å™¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„ä¸­å¿ƒæ€æƒ³.</p>
<p><strong>è§’è‰²</strong>. åœ¨ç½‘ç»œç”¨æˆ·è®¡ç®—æœºä¸Šçš„ç½‘ç»œæµè§ˆå™¨åº”ç”¨å½“å…¶è¯·æ±‚ä¸€ä¸ªç½‘é¡µçš„æ—¶å€™æ‰®æ¼”çš„æ˜¯å®¢æˆ·ç«¯çš„è§’è‰². å½“ä»ä¸€ä¸ªå› ç‰¹ç½‘ä¸Šçš„åŸŸåè¯·æ±‚å†…å®¹æ—¶, ä¾‹å¦‚<code>www.nytimes.com</code>, å®ƒå¿…é¡»è¦è·Ÿè‡³å°‘ä¸¤ä¸ªä¸åŒçš„æœåŠ¡å™¨è¿›è¡Œé€šä¿¡.</p>
<p>ç”¨æˆ·æœ€å¼€å§‹ä»åŸŸåæœåŠ¡å™¨(DNS)è¯·æ±‚ä½äºè¯¥åŸŸåçš„çš„è®¡ç®—æœºçš„äº’è”ç½‘åè®®(IP)åœ°å€. DNSæä¾›æ˜ å°„åŸŸååˆ°IPåœ°å€çš„æœåŠ¡, IPåœ°å€æ˜¯å› ç‰¹ç½‘ä¸Šæœºå™¨çš„æ•°å­—æ ‡è¯†ç¬¦. Pythonå¯ä»¥ç›´æ¥ä½¿ç”¨å¥—æ¥å­—(socket)æ¨¡å—æå‡ºè¿™æ ·çš„è¯·æ±‚.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">socket</span> <span class="kn">import</span> <span class="n">gethostbyname</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">gethostbyname</span><span class="p">(</span><span class="s1">&#39;www.nytimes.com&#39;</span><span class="p">)</span>
<span class="s1">&#39;170.149.172.130&#39;</span>
</code></pre></td></tr></table>
</div>
</div><p>æ¥ç€å®¢æˆ·ç«¯ä¼šä»ä½äºå¯¹åº”IPåœ°å€çš„æœåŠ¡å™¨è¯·æ±‚ç½‘é¡µçš„å†…å®¹. åœ¨è¿™ç§æƒ…å†µä¸‹çš„å“åº”æ˜¯<a href="http://en.wikipedia.org/wiki/HTML"><code>HTML</code></a>æ–‡ä»¶, è¿™ä¸ªæ–‡ä»¶åŒ…å«æ ‡é¢˜å’Œä»Šæ—¥æ–°é—»çš„æ–‡ç« æ‘˜è¦, ä»¥åŠè¡¨è¾¾å¹¶æŒ‡å‡ºç½‘ç»œæµè§ˆå™¨åº”è¯¥å¦‚ä½•åœ¨å®¢æˆ·ç•Œé¢ä¸Šæ˜¾ç¤ºå†…å®¹. Pythonå¯ä»¥ä½¿ç”¨<code>urllib.request</code>æ¨¡å—æ¥å‘èµ·ä¸¤ä¸ªè¯·æ±‚å»è·å–è¿™äº›å†…å®¹.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">urllib.request</span> <span class="kn">import</span> <span class="n">urlopen</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">response</span> <span class="o">=</span> <span class="n">urlopen</span><span class="p">(</span><span class="s1">&#39;http://www.nytimes.com&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">response</span><span class="p">[:</span><span class="mi">15</span><span class="p">]</span>
<span class="sa">b</span><span class="s1">&#39;&lt;!DOCTYPE html&gt;&#39;</span>
</code></pre></td></tr></table>
</div>
</div><p>æ”¶åˆ°æ­¤å›å¤, æµè§ˆå™¨ä¸ºå›¾ç‰‡, è§†é¢‘ä»¥åŠé¡µé¢çš„å…¶ä»–éƒ¨åˆ†å‘èµ·é¢å¤–çš„è¯·æ±‚. è¿™äº›è¯·æ±‚è¢«å‘èµ·æ˜¯å› ä¸ºåŸå§‹çš„HTMLæ–‡ä»¶åŒ…å«æœ‰é¢å¤–å†…å®¹çš„åœ°å€ä»¥åŠå¦‚ä½•å°†å®ƒä»¬å†…åµŒè¿›é¡µé¢çš„æè¿°.</p>
<p><strong>HTTPè¯·æ±‚</strong>. è¶…æ–‡æœ¬ä¼ è¾“åè®®(HTTP)æ˜¯ä¸€ä¸ªä½¿ç”¨TCPå®ç°çš„åè®®, å®ƒæ˜¯ç”¨æ¥ç®¡ç†ä¸‡ç»´ç½‘(WWW)é€šè®¯çš„åè®®. å®ƒå‡è®¾ç½‘ç»œæµè§ˆå™¨ä»¥åŠç½‘ç»œæœåŠ¡å™¨ä¹‹é—´æ˜¯å®¢æˆ·ç«¯/æœåŠ¡å™¨æ¶æ„å½¢å¼. HTTPæŒ‡å®šæµè§ˆå™¨ä¸æœåŠ¡å™¨ä¹‹é—´çš„æ¶ˆæ¯äº¤æ¢çš„æ ¼å¼. æ‰€æœ‰ç½‘ç»œæµè§ˆå™¨ä½¿ç”¨çš„æ˜¯HTTPæ ¼å¼æ¥ä»ç½‘ç»œæœåŠ¡å™¨è¯·æ±‚é¡µé¢, åŒæ—¶æ‰€æœ‰çš„ç½‘ç»œæœåŠ¡å™¨ä½¿ç”¨HTTPæ ¼å¼æ¥è¿”å›å®ƒä»¬çš„å“åº”.</p>
<p>HTTPè¯·æ±‚å…·æœ‰å‡ ç§ç±»å‹, æœ€å¸¸ç”¨çš„æ˜¯ä½¿ç”¨GETè¯·æ±‚æŒ‡å®šçš„ç½‘é¡µ. GETè¯·æ±‚æŒ‡å®šä¸€ä¸ªä½ç½®. ä¾‹å¦‚, è¾“å…¥åœ°å€<code>http://en.wikipedia.org/wiki/UC_Berkeley</code>åˆ°Webæµè§ˆå™¨ä¸­å‘<code>en.wikipedia.org</code>æ‰€åœ¨çš„WebæœåŠ¡å™¨çš„ç«¯å£80å‘èµ·ä¸€ä¸ªHTTPçš„GETè¯·æ±‚è·å–ä½äº<code>/wiki/UC_Berkeley</code>çš„å†…å®¹.</p>
<p>æœåŠ¡å™¨è¿”å›HTTPå“åº”:</p>
<pre><code>HTTP/1.1 200 OK
Date: Mon, 23 May 2011 22:38:34 GMT
Server: Apache/1.3.3.7 (Unix) (Red-Hat/Linux)
Last-Modified: Wed, 08 Jan 2011 23:11:55 GMT
Content-Type: text/html; charset=UTF-8

... web page content ...
</code></pre><p>åœ¨ç¬¬ä¸€è¡Œ, æ–‡æœ¬<code>200 OK</code>è¡¨æ˜åœ¨å“åº”è¯·æ±‚çš„è¿‡ç¨‹ä¸­æ²¡æœ‰é”™è¯¯å‘ç”Ÿ. åœ¨å¤´éƒ¨çš„åç»­è¡Œä¸­ç»™å®šå…³äºæœåŠ¡å™¨, æ—¥æœŸä»¥åŠè¿”å›çš„å†…å®¹ç±»å‹çš„ä¿¡æ¯.</p>
<p>å¦‚æœä½ è¾“å…¥ä¸€ä¸ªé”™è¯¯çš„webåœ°å€æˆ–è€…ç‚¹å‡»ä¸€ä¸ªåäº†çš„åœ°å€, ä½ å¯èƒ½ä¼šçœ‹åˆ°è¿™æ ·çš„æ¶ˆæ¯, å¦‚è¿™ä¸ªé”™è¯¯:</p>
<pre><code>404 Error File Not Found
</code></pre><p>è¿™æ„å‘³ç€æœåŠ¡å™¨è¿”å›ä¸€ä¸ªä»¥ä¸‹é¢æ‰€ç¤ºå¼€å§‹çš„HTTPå¤´:</p>
<pre><code>HTTP/1.1 404 Not Found
</code></pre><p>æ•°å­—200ä»¥åŠ404æ˜¯HTTPå“åº”ç . ä¸€ç»„å›ºå®šçš„å“åº”ç æ˜¯æ¶ˆæ¯åè®®çš„å…±åŒç‰¹å¾. åè®®çš„è®¾è®¡è€…å°è¯•å»é¢„æµ‹å¸¸ç”¨çš„ä¼šé€šè¿‡åè®®å‘é€å¹¶åˆ†é…å›ºå®šç ä»¥å‡å°‘ä¼ è¾“æ•°æ®é‡çš„å¤§å°åŒæ—¶å»ºç«‹å…¬å…±æ¶ˆæ¯è¯­ä¹‰çš„æ¶ˆæ¯. åœ¨HTTPåè®®ä¸­, 200å“åº”ç è¡¨æ˜æˆåŠŸ, è€Œ404æŒ‡ç¤ºèµ„æºæ²¡æœ‰æ‰¾åˆ°çš„é”™è¯¯. å…¶ä»–å„ç§å„æ ·çš„<a href="http://en.wikipedia.org/wiki/List_of_HTTP_status_codes">å“åº”ç </a>å­˜åœ¨äºHTTP1.1æ ‡å‡†ä¸­.</p>
<p><strong>æ¨¡å—åŒ–</strong>å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨çš„æ¦‚å¿µæ˜¯å¼ºå¤§çš„æŠ½è±¡. æœåŠ¡å™¨æœ‰å¯èƒ½åŒæ—¶å¯¹å¤šä¸ªå®¢æˆ·ç«¯æä¾›æœåŠ¡, è€Œä¸”å®¢æˆ·ç«¯æ¶ˆè´¹è¯¥æœåŠ¡. å®¢æˆ·ç«¯ä¸éœ€è¦çŸ¥é“æœåŠ¡æ˜¯å¦‚ä½•è¢«æä¾›çš„ç»†èŠ‚, æˆ–è€…å®ƒä»¬æ¥æ”¶çš„æ•°æ®æ˜¯å¦‚ä½•è¢«å­˜å‚¨ä»¥åŠè®¡ç®—çš„, ä»¥åŠæœåŠ¡å™¨ä¸éœ€è¦çŸ¥é“å®ƒçš„å“åº”å°†ä¼šå¦‚ä½•è¢«ä½¿ç”¨.</p>
<p>åœ¨Webä¸Š, æˆ‘ä»¬è®¤ä¸ºå®¢æˆ·ç«¯ä»¥åŠæœåŠ¡å™¨ä½äºä¸åŒçš„æœºå™¨ä¸Š, ä½†å³ä½¿æ˜¯åœ¨å•ä¸€çš„æœºå™¨ä¸Šçš„ç³»ç»Ÿä¹Ÿå¯ä»¥å…·æœ‰å®¢æˆ·ç«¯/æœåŠ¡å™¨æ¶æ„. ä¾‹å¦‚, æ¥è‡ªè®¡ç®—æœºä¸Šçš„è¾“å…¥è®¾å¤‡çš„ä¿¡å·é€šå¸¸éœ€è¦å¯ç”¨äºè®¡ç®—æœºä¸Šè¿è¡Œçš„ç¨‹åº. ç¨‹åºæ˜¯å®¢æˆ·ç«¯, å®ƒä¼šæ¶ˆè€—é¼ æ ‡ä»¥åŠé”®ç›˜çš„è¾“å…¥æ•°æ®. æ“ä½œç³»ç»Ÿçš„è®¾å¤‡é©±åŠ¨ç¨‹åºæ˜¯æœåŠ¡å™¨, æ¥å—ç‰©ç†ä¿¡å·åŒæ—¶ä¸ºå®ƒä»¬æä¾›å¯ç”¨çš„è¾“å…¥. æ­¤å¤–, ä¸­å¤®å¤„ç†å•å…ƒ(CPU)ä»¥åŠä¸“é—¨çš„å›¾å½¢å¤„ç†å•å…ƒ(GPU)é€šå¸¸ä¹Ÿå‚ä¸è¿›å®¢æˆ·ç«¯/æœåŠ¡å™¨æ¶æ„, å…¶ä¸­CPUä½œä¸ºå®¢æˆ·ç«¯è€ŒGPUåˆ™ä½œä¸ºå›¾å½¢çš„æœåŠ¡å™¨.</p>
<p>å®¢æˆ·ç«¯/æœåŠ¡å™¨ç³»ç»Ÿçš„ç¼ºç‚¹æ˜¯æœåŠ¡å™¨æ˜¯å•ç‚¹æ•…éšœ. å®ƒæ˜¯å”¯ä¸€å…·æœ‰å‘æ”¾æœåŠ¡èƒ½åŠ›çš„ç»„ä»¶. å®¢æˆ·ç«¯çš„æ•°é‡å¯ä»¥æ˜¯ä»»æ„çš„, å½¼æ­¤é—´å¯ä»¥äº’æ¢, å¹¶æ ¹æ®éœ€è¦åŠ è¿›æ¥æˆ–è€…é™¤å».</p>
<p>å¦ä¸€ä¸ªå®¢æˆ·ç«¯-æœåŠ¡å™¨ç³»ç»Ÿçš„ç¼ºç‚¹æ˜¯å¦‚æœå®¢æˆ·ç«¯è¿‡å¤šçš„è¯åˆ™è®¡ç®—èµ„æºä¼šå˜å¾—ç¨€ç¼º. å®¢æˆ·ç«¯å¢åŠ å¯¹ç³»ç»Ÿçš„éœ€æ±‚, è€Œä¸è´¡çŒ®ä»»ä½•è®¡ç®—èµ„æº.</p>
<h4 id="463-ç‚¹å¯¹ç‚¹ç³»ç»Ÿ">4.6.3 ç‚¹å¯¹ç‚¹ç³»ç»Ÿ</h4>
<p>å®¢æˆ·ç«¯/æœåŠ¡å™¨æ¨¡å¼å¾ˆé€‚åˆé¢å‘æœåŠ¡çš„æƒ…å†µ. ç„¶è€Œ, å¯¹äºè¿˜æœ‰å…¶ä»–è®¡ç®—ç›®æ ‡çš„ç³»ç»Ÿè€Œè¨€æ›´åŠ å¹³ç­‰çš„åˆ†å·¥æ˜¯ä¸€ä¸ªæ›´å¥½çš„é€‰æ‹©. æœ¯è¯­_ç‚¹å¯¹ç‚¹_æ˜¯ç”¨æ¥å½¢å®¹åˆ†å¸ƒå¼ç³»ç»Ÿçš„, å…¶ä¸­çš„å·¥ä½œå‡åˆ†åœ¨ç³»ç»Ÿçš„æ‰€æœ‰éƒ¨åˆ†ä¸­. æ‰€æœ‰çš„è®¡ç®—æœºéƒ½å‘é€å¹¶æ¥æ”¶æ•°æ®, åŒæ—¶å®ƒä»¬éƒ½è´¡çŒ®ä¸€å®šçš„å¤„ç†èƒ½åŠ›ä»¥åŠå­˜å‚¨. éšç€åˆ†å¸ƒå¼ç³»ç»Ÿçš„è§„æ¨¡è¶Šæ¥è¶Šå¤§, å…¶è®¡ç®—èµ„æºçš„èƒ½åŠ›ä¹Ÿéšä¹‹ä¸Šå‡. åœ¨ä¸€ä¸ªç‚¹å¯¹ç‚¹ç³»ç»Ÿä¸­, ç³»ç»Ÿçš„æ‰€æœ‰éƒ¨åˆ†éƒ½è´¡çŒ®ä¸€äº›å¤„ç†èƒ½åŠ›å’Œå†…å­˜åˆ°åˆ†å¸ƒå¼è®¡ç®—ä¸­.</p>
<p>åœ¨æ‰€æœ‰çš„å‚ä¸è€…å½“ä¸­å‡åˆ†åŠ³åŠ¨é‡æ˜¯è¯†åˆ«ç‚¹å¯¹ç‚¹ç³»ç»Ÿçš„ç‰¹å¾. è¿™æ„å‘³ç€ç‚¹éœ€è¦èƒ½å¤Ÿå½¼æ­¤ä¹‹é—´è¿›è¡Œå¯é çš„é€šä¿¡. ä¸ºäº†ç¡®ä¿æ¶ˆæ¯èƒ½å¤Ÿå‡†ç¡®åˆ°è¾¾ç›®çš„åœ°, ç‚¹å¯¹ç‚¹ç³»ç»Ÿéœ€è¦å…·æœ‰ä¸€ä¸ªæœ‰ç»„ç»‡çš„ç½‘ç»œç»“æ„. åœ¨è¿™äº›ç³»ç»Ÿä¸­çš„ç»„æˆéƒ¨ä»¶åˆä½œç»´æŠ¤è¶³å¤Ÿçš„å…³äºå…¶ä»–éƒ¨ä»¶çš„ä½ç½®çš„ä¿¡æ¯æ¥å‘é€æ¶ˆæ¯åˆ°ç›®çš„åœ°.</p>
<p>åœ¨æŸäº›ç‚¹å¯¹ç‚¹ç³»ç»Ÿä¸­, ä¿æŒç½‘ç»œå¥åº·çš„å·¥ä½œæ˜¯ç”±ä¸€ç»„ä¸“é—¨çš„ç»„ä»¶æ¥è¿›è¡Œçš„. è¿™æ ·çš„ç³»ç»Ÿå¹¶ä¸æ˜¯çº¯ç²¹çš„ç‚¹å¯¹ç‚¹ç³»ç»Ÿ, å› ä¸ºä»–ä»¬å…·æœ‰ä¸åŒç±»å‹çš„ç»„ä»¶æ¥æä¾›ä¸åŒçš„åŠŸèƒ½. è¿™æ ·çš„éƒ¨ä»¶åƒè„šæ‰‹æ¶ä¸€æ ·æ”¯æ’‘ç‚¹å¯¹ç‚¹ç³»ç»Ÿ: å®ƒä»¬å¸®åŠ©ç½‘ç»œä¿æŒè¿æ¥, å®ƒä»¬ç»´æŠ¤å…³äºä¸åŒè®¡ç®—æœºä½ç½®çš„ä¿¡æ¯, åŒæ—¶å®ƒä»¬å¸®åŠ©æ–°åŠ å…¥çš„æˆå‘˜åœ¨å®ƒä»¬çš„é‚»å±…ä¸­å æ®å®ƒä»¬è‡ªå·±çš„ä½ç½®.</p>
<p>æœ€å¸¸ç”¨çš„ç‚¹å¯¹ç‚¹ç³»ç»Ÿåº”ç”¨æ˜¯æ•°æ®ä¼ è¾“ä»¥åŠæ•°æ®å­˜å‚¨. å¯¹äºæ•°æ®ä¼ è¾“æ¥è¯´, æ¯ä¸ªåœ¨ç³»ç»Ÿä¸­çš„è®¡ç®—æœºéƒ½å¸®åŠ©åœ¨ç½‘ç»œä¸Šå‘é€æ•°æ®. å¦‚æœç›®çš„åœ°è®¡ç®—æœºåœ¨æ˜¯åœ¨æŸä¸ªç‰¹å®šçš„è®¡ç®—æœºé™„è¿‘, é‚£ä¹ˆè¿™ä¸ªè®¡ç®—æœºä¹Ÿä¼šå¸®åŠ©å‘é€æ•°æ®. å¯¹äºæ•°æ®å­˜å‚¨è€Œè¨€, æ•°æ®é›†å¯èƒ½å¯¹äºä»»ä½•å•å°è®¡ç®—æœºæ¥è¯´éƒ½æ˜¯è¿‡äºå·¨å¤§çš„, æˆ–è€…æ•°æ®è¿‡äºè´µé‡æ— æ³•ä»…å­˜å‚¨äºä¸€ä¸ªè®¡ç®—æœºä¸Š. æ¯ä¸ªè®¡ç®—æœºéƒ½å­˜å‚¨æ•°æ®çš„ä¸€å°éƒ¨åˆ†, åŒæ—¶ç›¸åŒçš„æ•°æ®å¯èƒ½æœ‰å¤šä¸ªå‰¯æœ¬åˆ†å¸ƒåœ¨ä¸åŒçš„è®¡ç®—æœºä¸Š. å½“ä¸€ä¸ªè®¡ç®—æœºå‡ºç°æ•…éšœæ—¶, å…¶ä¸Šçš„æ•°æ®å¯ä»¥ä»å…¶ä»–å‰¯æœ¬æ¢å¤, å¹¶åœ¨æ›¿æ¢åˆ°è¾¾æ—¶æ”¾å›å».</p>
<p><code>Skype</code>, è¯­éŸ³ä»¥åŠè§†é¢‘èŠå¤©æœåŠ¡, æ˜¯ç‚¹å¯¹ç‚¹æ¶æ„çš„æ•°æ®ä¼ è¾“åº”ç”¨çš„ä¸€ä¸ªä¾‹å­. å½“ä¸¤ä¸ªåœ¨ä¸åŒè®¡ç®—æœºä¸Šçš„äººè¿›è¡Œ<code>Skype</code>ä¼šè¯æ—¶, ä»–ä»¬çš„å¯¹è¯ä¼šé€šè¿‡ç‚¹å¯¹ç‚¹ç½‘ç»œè¿›è¡Œä¼ è¾“. è¯¥ç½‘ç»œç”±è¿è¡Œ<code>Skype</code>åº”ç”¨ç¨‹åºçš„å…¶ä»–è®¡ç®—æœºç»„æˆ. æ¯ä¸ªè®¡ç®—æœºéƒ½çŸ¥é“ä¸€äº›ä¸´è¿‘çš„å…¶ä»–è®¡ç®—æœºçš„ä½ç½®. ä¸€ä¸ªè®¡ç®—æœºé€šè¿‡ä¼ è¾“æ•°æ®åˆ°å®ƒçš„é‚»å±…èŠ‚ç‚¹æ¥å¸®åŠ©å‘é€æ•°æ®åŒ…åˆ°ç›®çš„åœ°, è€Œå®ƒçš„é‚»å±…èŠ‚ç‚¹ä¹Ÿä¼šä¼ è¾“æ•°æ®åˆ°ç›¸åº”çš„é‚»å±…èŠ‚ç‚¹ç­‰ç­‰, ä¸€ç›´åˆ°åŒ…åˆ°è¾¾å®ƒçš„é¢„è®¢ç›®çš„åœ°. <code>Skype</code>å¹¶ä¸æ˜¯ä¸€ä¸ªçº¯ç²¹çš„ç‚¹å¯¹ç‚¹ç³»ç»Ÿ, è¶…çº§èŠ‚ç‚¹çš„è„šæ‰‹æ¶ç½‘ç»œè´Ÿè´£ç™»å½•å’Œæ³¨é”€ç”¨æˆ·. ç»´æŠ¤æœ‰å…³äºè®¡ç®—æœºä½ç½®çš„ä¿¡æ¯ä»¥åŠåœ¨ç”¨æˆ·è¿›å…¥å’Œé€€å‡ºæ—¶ä¿®æ”¹ç½‘ç»œç»“æ„.</p>
<h3 id="47-åˆ†å¸ƒå¼æ•°æ®å¤„ç†">4.7 åˆ†å¸ƒå¼æ•°æ®å¤„ç†</h3>
<p>åˆ†å¸ƒå¼ç³»ç»Ÿé€šå¸¸ç”¨æ¥æ”¶é›†, è®¿é—®, ä»¥åŠæ“ä½œå¤§å‹æ•°æ®é›†. ä¾‹å¦‚, å‰é¢ç« èŠ‚æè¿°çš„æ•°æ®åº“ç³»ç»Ÿå¯ä»¥æ“ä½œä¿å­˜åœ¨å¤šä¸ªæœºå™¨ä¸Šçš„æ•°æ®é›†. æ²¡æœ‰ä¸€å°æœºå™¨å¯èƒ½åŒ…å«å“åº”æŸ¥è¯¢æ‰€éœ€çš„æ•°æ®, å› æ­¤éœ€è¦é€šä¿¡æ‰èƒ½å¯¹è¯·æ±‚è¿›è¡ŒæœåŠ¡.</p>
<p>è¿™ä¸€èŠ‚æ¢è®¨ä¸€ä¸ªå…¸å‹çš„å¤§æ•°æ®å¤„ç†åœºæ™¯, å…¶ä¸­ç”±äºæ•°æ®é›†å¤ªå¤§è€Œä¸èƒ½è¢«å•ä¸ªæœºå™¨å¤„ç†, è€Œæ˜¯åˆ†å¸ƒåœ¨è®¸å¤šæœºå™¨ä¹‹é—´, æ¯ä¸ªæœºå™¨å¤„ç†æ•°æ®é›†ä¸­çš„ä¸€éƒ¨åˆ†. è®¡ç®—çš„ç»“æœå¿…é¡»ç»å¸¸åœ¨æœºå™¨ä¹‹é—´èšåˆ, å› æ­¤ä¸€å°æœºå™¨çš„è®¡ç®—ç»“æœå¯ä»¥ä¸å…¶ä»–æœºå™¨ç»„åˆ. ä¸ºäº†åè°ƒè¿™ç§åˆ†å¸ƒå¼æ•°æ®å¤„ç†, æˆ‘ä»¬ä¼šè®¨è®ºä¸€ä¸ªç§°ä¸º<a href="http://en.wikipedia.org/wiki/MapReduce"><code>MapReduce</code></a>çš„ç¼–ç¨‹æ¡†æ¶.</p>
<p>ä½¿ç”¨MapReduceæ¥åˆ›å»ºä¸€ä¸ªåˆ†å¸ƒå¼æ•°æ®å¤„ç†åº”ç”¨ç»“åˆäº†æœ¬æ–‡ä¸­æå‡ºçš„è®¸å¤šæƒ³æ³•. åº”ç”¨ç¨‹åºç”¨çº¯å‡½æ•°è¡¨ç¤º, ç”¨äºæ˜ å°„å¤§å‹æ•°æ®é›†, ç„¶åå°†æ˜ å°„çš„å€¼çš„åºåˆ—ä¸æ–­å‡å°‘ç›´åˆ°å¾—åˆ°æœ€ç»ˆç»“æœ.</p>
<p>å‡½æ•°å¼ç¼–ç¨‹ä¸­çš„ç†Ÿæ‚‰æ¦‚å¿µç”¨äºMapReduceç¨‹åºä¸­å…·æœ‰å·¨å¤§çš„å¥½å¤„. MapReduceè¦æ±‚ç”¨äºæ˜ å°„å’Œå‡å°‘æ•°æ®çš„å‡½æ•°æ˜¯çº¯å‡½æ•°. ä¸€èˆ¬æ¥è¯´, ä»…åœ¨çº¯åŠŸèƒ½æ–¹é¢è¡¨è¾¾çš„ç¨‹åºåœ¨å¦‚ä½•æ‰§è¡Œæ–¹é¢å…·æœ‰å¾ˆå¤§çš„çµæ´»æ€§. å­è¡¨è¾¾å¼å¯ä»¥å¹¶è¡Œæ‰§è¡Œå¹¶ä»¥ä»»æ„çš„é¡ºåºè®¡ç®—è€Œä¸å½±å“æœ€ç»ˆç»“æœ. ä¸€ä¸ªMapReduceåº”ç”¨èƒ½å¤Ÿå¹¶è¡Œè¿è¡Œè®¸å¤šçº¯å‡½æ•°, é‡æ–°æ’åºåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­æœ‰æ•ˆæ‰§è¡Œçš„è®¡ç®—.</p>
<p>MapReduceçš„ä¸»è¦ä¼˜åŠ¿æ˜¯å®ƒæŠŠåˆ†å¸ƒå¼æ•°æ®å¤„ç†åº”ç”¨ç¨‹åºçš„ä¸¤ä¸ªéƒ¨åˆ†ä¹‹é—´çš„é—®é¢˜è¿›è¡Œäº†åˆ†ç¦»:</p>
<ol>
<li>mapä»¥åŠreduceå‡½æ•°ç”¨äºå¤„ç†æ•°æ®å¹¶å°†ç»“æœè¿›è¡Œç»„åˆ.</li>
<li>æœºå™¨ä¹‹é—´çš„æ²Ÿé€šå’Œåè°ƒ.</li>
</ol>
<p>åè°ƒæœºåˆ¶å¤„ç†åˆ†å¸ƒå¼è®¡ç®—ä¸­å‡ºç°çš„è®¸å¤šé—®é¢˜, ä¾‹å¦‚, æœºå™¨æ•…éšœ, ç½‘ç»œæ•…éšœ, ä»¥åŠè¿›åº¦ç›‘æ§. è€Œç®¡ç†è¿™äº›é—®é¢˜ä¸ºMapReduceåº”ç”¨ç¨‹åºå¼•å…¥äº†ä¸€äº›å¤æ‚æ€§, è€Œè¿™äº›å¤æ‚æ€§æ²¡æœ‰æš´éœ²ç»™åº”ç”¨ç¨‹åºå¼€å‘äººå‘˜. ç›¸å, æ„å»ºä¸€ä¸ªMapReduceåº”ç”¨åªéœ€è¦æŒ‡å®šä¸Šé¢(1)ä¸­æåˆ°çš„mapä»¥åŠreduceå‡½æ•°å³å¯; åˆ†å¸ƒå¼è®¡ç®—çš„æŒ‘æˆ˜æ˜¯å¦‚ä½•é€šè¿‡æŠ½è±¡æ¥å®ç°éšè—.</p>
<h4 id="471-mapreduce">4.7.1 MapReduce</h4>
<p>MapReduceæ¡†æ¶å‡å®šè¾“å…¥æ˜¯å·¨å¤§, æ— åºçš„ä»»æ„ç±»å‹çš„è¾“å…¥å€¼æµ. ä¾‹å¦‚, æ¯ä¸ªè¾“å…¥å¯èƒ½æ˜¯æŸäº›æµ©ç€šçš„è¯­æ–™åº“ä¸­çš„ä¸€è¡Œæ–‡æœ¬. è®¡ç®—è¿‡ç¨‹åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤.</p>
<ol>
<li>mapå‡½æ•°åº”ç”¨åˆ°æ¯ä¸ªè¾“å…¥ä¸­, å®ƒä¼šè¾“å‡ºé›¶ä¸ªæˆ–è€…æ›´å¤šä»»æ„ç±»å‹çš„ä¸­é—´é”®å€¼å¯¹.</li>
<li>æ‰€æœ‰ä¸­é—´é”®å€¼å¯¹éƒ½æŒ‰ç…§é”®æ¥è¿›è¡Œåˆ†ç»„, å› æ­¤å…·æœ‰ç›¸åŒé”®çš„å¯¹å¯ä»¥è¢«å‡å°‘åˆå¹¶åœ¨ä¸€èµ·.</li>
<li>reduceå‡½æ•°å¯¹ç»™å®šçš„é”®<code>k</code>çš„å€¼ç»„åˆåœ¨ä¸€èµ·; å®ƒä¼šè¾“å‡ºé›¶ä¸ªæˆ–è€…æ›´å¤šçš„å€¼, å®ƒä»¬å„è‡ªä¸æœ€ç»ˆè¾“å‡ºä¸­çš„<code>k</code>ç›¸å…³è”.</li>
</ol>
<p>ä¸ºäº†æ‰§è¡Œè¿™ä¸ªè®¡ç®—, MapReduceæ¡†æ¶åˆ›å»ºåœ¨è®¡ç®—æœºä¸­æ‰§è¡Œå„ç§è§’è‰²çš„ä»»åŠ¡(å¯èƒ½åœ¨ä¸åŒçš„æœºå™¨ä¸Š). _map_ä»»åŠ¡ä¼šåº”ç”¨mapå‡½æ•°åˆ°æŸäº›å­é›†çš„è¾“å…¥æ•°æ®ä¸Šå¹¶è¾“å‡ºä¸­é—´é”®å€¼å¯¹. _reduce_ä»»åŠ¡é€šè¿‡é”®æ¥æ’åºå¹¶ç»„åˆé”®å€¼å¯¹, ç„¶ååº”ç”¨reduceå‡½æ•°åˆ°æ¯ä¸ªé”®çš„å€¼ä¸Š. æ‰€æœ‰åœ¨mapä»¥åŠreduceä»»åŠ¡ä¹‹é—´çš„é€šä¿¡ç”±æ¡†æ¶æ¥å¤„ç†, æŒ‰é”®åˆ†ç»„ä¸­é—´é”®å€¼å¯¹çš„ä»»åŠ¡ä¹Ÿæ˜¯å¦‚æ­¤.</p>
<p>ä¸ºäº†åœ¨MapReduceåº”ç”¨ä¸­åˆ©ç”¨å¤šå°æœºå™¨, å¤šä¸ªmappersä¼šå¹¶è¡Œè¿è¡Œåœ¨ä¸€ä¸ªmapå‘¨æœŸä¸­, è€Œå¤šä¸ªreducerså¹¶è¡Œè¿è¡Œåœ¨ä¸€ä¸ªreduceå‘¨æœŸä¸­. åœ¨è¿™äº›å‘¨æœŸä¹‹é—´, sortå‘¨æœŸé€šè¿‡å¯¹å®ƒä»¬è¿›è¡Œæ’åºæ¥å°†é”®å€¼å¯¹ç»„åˆåœ¨ä¸€èµ·, å› æ­¤å…·æœ‰ç›¸åŒé”®çš„æ‰€æœ‰é”®å€¼å¯¹éƒ½ç›¸é‚».</p>
<p>æ€è€ƒä¸‹å…³äºè®¡ç®—æ–‡æœ¬è¯­æ–™åº“ä¸­çš„å…ƒéŸ³æ•°é‡çš„é—®é¢˜. æˆ‘ä»¬å¯ä»¥ä½¿ç”¨MapReduceæ¡†æ¶é€šè¿‡é€‰æ‹©åˆé€‚çš„mapä»¥åŠreduceå‡½æ•°æ¥è§£å†³è¿™ä¸ªé—®é¢˜. mapå‡½æ•°æ¥å—ä¸€ä¸ªæ–‡æœ¬è¡Œä½œä¸ºè¾“å…¥å¹¶è¾“å‡ºé”®å€¼å¯¹, é”®å€¼å¯¹ä¸­å…ƒéŸ³ä½œä¸ºé”®è€Œå€¼åˆ™æ˜¯æ•°é‡. ä»è¾“å‡ºä¸­çœç•¥é›¶è®¡æ•°:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">count_vowels</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
    <span class="s2">&#34;&#34;&#34;A map function that counts the vowels in a line.&#34;&#34;&#34;</span>
    <span class="k">for</span> <span class="n">vowel</span> <span class="ow">in</span> <span class="s1">&#39;aeiou&#39;</span><span class="p">:</span>
        <span class="n">count</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">vowel</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">emit</span><span class="p">(</span><span class="n">vowel</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>reduceå‡½æ•°åœ¨Pythonä¸­æ˜¯å†…å»ºçš„sumå‡½æ•°, å®ƒä»¥ä¸€ä¸ªå»ºç«‹åœ¨å€¼(å¯¹äºç»™å®šé”®çš„æ‰€æœ‰å€¼)ä¹‹ä¸Šçš„è¿­ä»£å™¨ä½œä¸ºè¾“å…¥å¹¶è¿”å›å®ƒä»¬çš„æ€»æ•°.</p>
<h4 id="472-æœ¬åœ°å®ç°">4.7.2 æœ¬åœ°å®ç°</h4>
<p>ä¸ºäº†è¯¦è¿°MapReduceåº”ç”¨, æˆ‘ä»¬éœ€è¦å®ç°ä¸€ä¸ªå¯ä»¥è®©æˆ‘ä»¬æ’å…¥mapä»¥åŠreduceå‡½æ•°çš„MapReduceæ¡†æ¶. åœ¨æ¥ä¸‹æ¥çš„éƒ¨åˆ†ä¸­, æˆ‘ä»¬ä¼šä½¿ç”¨å¼€æºçš„<a href="http://en.wikipedia.org/wiki/Hadoop"><code>Hadoop</code></a>å®ç°. åœ¨è¿™ä¸€éƒ¨åˆ†, æˆ‘ä»¬ä¼šä½¿ç”¨Unixæ“ä½œç³»ç»Ÿå†…å»ºçš„å·¥å…·å¼€å‘ä¸€ä¸ªæœ€å°å®ç°.</p>
<p>Unixæ“ä½œç³»ç»Ÿåœ¨è®¡ç®—æœºçš„åº•å±‚ç¡¬ä»¶ä»¥åŠç”¨æˆ·ç¨‹åºä¸­åˆ›å»ºäº†ä¸€ä¸ªæŠ½è±¡å±éšœ. å®ƒä¸ºç¨‹åºç›¸äº’ä¹‹é—´çš„æ²Ÿé€šæä¾›äº†ä¸€ä¸ªæœºåˆ¶, å°¤å…¶æ˜¯å…è®¸ä¸€ä¸ªç¨‹åºæ¶ˆè€—å¦ä¸€ä¸ªç¨‹åºçš„è¾“å‡º, åœ¨ä»–ä»¬å…³äºUnixç¼–ç¨‹ç²¾ç²¹çš„æ–‡æœ¬ä¸­, Kernighamä»¥åŠPikeå®£ç§°, &ldquo;ç³»ç»Ÿçš„èƒ½åŠ›æ›´å¤šåœ°æ¥è‡ªäºç¨‹åºä¹‹é—´çš„å…³ç³»è€Œä¸æ˜¯ç¨‹åºæœ¬èº«.&rdquo;</p>
<p>Pythonæ–‡ä»¶å¯ä»¥é€šè¿‡åœ¨ç¬¬ä¸€è¡Œæ·»åŠ ä¸€ä¸ªæ³¨é‡Šæ¥è¡¨æ˜è¯¥ç¨‹åºåº”è¯¥ä½¿ç”¨Python3è§£æå™¨æ‰§è¡Œæ¥ä»è€Œå°†å…¶è½¬æ¢æˆUnixç¨‹åº. Unixç¨‹åºçš„è¾“å…¥æ˜¯ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡, ç§°ä¹‹ä¸º_æ ‡å‡†è¾“å…¥_å¹¶å¯é€šè¿‡<code>sys.stdin</code>æ¥è®¿é—®. åœ¨è¿™ä¸ªå¯¹è±¡ä¹‹ä¸Šè®¿é—®ä¼šäº§ç”Ÿå­—ç¬¦ä¸²å€¼çš„æ–‡æœ¬è¡Œ. Unixç¨‹åºçš„è¾“å‡ºè¢«ç§°ä¸º_æ ‡å‡†è¾“å‡º_å¹¶å¯é€šè¿‡<code>sys.stdout</code>æ¥è®¿é—®. å†…å»ºçš„<code>print</code>å‡½æ•°å†™å…¥ä¸€è¡Œæ–‡æœ¬åˆ°æ ‡å‡†è¾“å‡ºä¸­. ä¸‹é¢çš„Unixç¨‹åºå°†å…¶è¾“å…¥çš„æ¯ä¸€è¡Œçš„é¡ºåºåè½¬åå†™å…¥åˆ°å…¶è¾“å‡ºä¸­:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="ch">#!/usr/bin/env python3</span>

<span class="kn">import</span> <span class="nn">sys</span>

<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</code></pre></td></tr></table>
</div>
</div><p>å¦‚æœæˆ‘ä»¬ä¿å­˜è¿™ä¸ªç¨‹åºåˆ°ä¸€ä¸ªåä¸º<code>rev.py</code>çš„æ–‡ä»¶ä¸­, æˆ‘ä»¬å¯ä»¥å°†å®ƒä½œä¸ºä¸€ä¸ªUnixç¨‹åºæ¥æ‰§è¡Œ. é¦–å…ˆ, æˆ‘ä»¬éœ€è¦å‘Šè¯‰æ“ä½œç³»ç»Ÿæˆ‘ä»¬å·²ç»åˆ›å»ºäº†ä¸€ä¸ªå¯æ‰§è¡Œç¨‹åº:</p>
<p><code>$ chmod u+x rev.py</code></p>
<p>æ¥ä¸‹æ¥, æˆ‘ä»¬å°†ä¸€äº›è¾“å…¥ä¼ è¾“åˆ°è¿™ä¸ªç¨‹åºä¸­. ä¸€ä¸ªç¨‹åºçš„è¾“å…¥å¯ä»¥æ¥è‡ªäºå¦ä¸€ä¸ªç¨‹åº. è¦è¾¾åˆ°è¿™ä¸ªæ•ˆæœæˆ‘ä»¬ä¼šä½¿ç”¨<code>|</code>ç¬¦å·(ç§°ä¸º&quot;ç®¡é“/pipe&rdquo;), å®ƒç”¨æ¥å°†ä½äºç®¡é“ä¹‹å‰çš„ç¨‹åºçš„è¾“å‡ºç”¨ä½œä½äºç®¡é“ä¹‹åçš„ç¨‹åºçš„è¾“å…¥. ç¨‹åº<code>nslookup</code>è¾“å‡ºIPåœ°å€çš„ä¸»æœºåç§°(è¿™ä¸ªä¾‹å­ä¸­ç”¨çš„æ˜¯çº½çº¦æ—¶æŠ¥):</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">$ nslookup 170.149.172.130 <span class="p">|</span> ./rev.py
moc.semityn.www
</code></pre></td></tr></table>
</div>
</div><p><code>cat</code>ç¨‹åºç”¨äºè¾“å‡ºæ–‡ä»¶çš„å†…å®¹. å› æ­¤, <code>rev.py</code>ç¨‹åºå¯ä»¥ç”¨æ¥æ¥æ”¶<code>rev.py</code>æ–‡ä»¶æœ¬èº«çš„å†…å®¹:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">$ cat rev.py <span class="p">|</span> ./rev.py
3nohtyp vne/nib/rsu/!#

sys tropmi

:nidts.sys ni enil rof
<span class="o">)]</span>1-::<span class="o">[)</span><span class="s1">&#39;n\&#39;</span><span class="o">(</span>pirts.enil<span class="o">(</span>tnirp
</code></pre></td></tr></table>
</div>
</div><p>è¿™äº›å·¥å…·å·²ç»è¶³å¤Ÿè®©æˆ‘ä»¬å®ç°ä¸€ä¸ªåŸºæœ¬çš„MapReduceæ¡†æ¶. è¿™ä¸ªç‰ˆæœ¬åªæœ‰å•ä¸€çš„mapä»»åŠ¡ä»¥åŠå•ä¸€çš„reduceä»»åŠ¡, å®ƒä»¬éƒ½æ˜¯ç”¨Pythonå®ç°çš„Unixç¨‹åº. æˆ‘ä»¬ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥è¿è¡Œæ•´ä¸ªMapReduceåº”ç”¨:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">$ cat input <span class="p">|</span> ./mapper.py <span class="p">|</span> sort <span class="p">|</span> ./reducer.py
</code></pre></td></tr></table>
</div>
</div><p><code>mapper.py</code>ä»¥åŠ<code>reducer.py</code>ç¨‹åºå¿…é¡»å®ç°mapå‡½æ•°ä»¥åŠreduceå‡½æ•°, ä»¥åŠä¸€äº›ç®€å•çš„è¾“å…¥å’Œè¾“å‡ºè¡Œä¸º. ä¾‹å¦‚, ä¸ºäº†å®ç°ä¸Šé¢è¯´åˆ°çš„ç»Ÿè®¡å…ƒéŸ³æ•°é‡çš„ç¨‹åº, æˆ‘ä»¬ä¼šç¼–å†™æ¥ä¸‹æ¥çš„<code>count_vowels_mappers.py</code>ç¨‹åº:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="ch">#!/usr/bin/env python3</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">mr</span> <span class="kn">import</span> <span class="n">emit</span>

<span class="k">def</span> <span class="nf">count_vowels</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
    <span class="s2">&#34;&#34;&#34;A map function that counts the vowels in a line.&#34;&#34;&#34;</span>
    <span class="k">for</span> <span class="n">vowel</span> <span class="ow">in</span> <span class="s1">&#39;aeiou&#39;</span><span class="p">:</span>
        <span class="n">count</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">vowel</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">emit</span><span class="p">(</span><span class="n">vowel</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>

<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="p">:</span>
    <span class="n">count_vowels</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>æ­¤å¤–, æˆ‘ä»¬è¿˜ä¼šç¼–å†™ä¸‹é¢çš„<code>sum_reducer.py</code>ç¨‹åº:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="ch">#!/usr/bin/env python3</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">mr</span> <span class="kn">import</span> <span class="n">values_by_key</span><span class="p">,</span> <span class="n">emit</span>

<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value_iterator</span> <span class="ow">in</span> <span class="n">values_by_key</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="p">):</span>
    <span class="n">emit</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="n">value_iterator</span><span class="p">))</span>
</code></pre></td></tr></table>
</div>
</div><p><a href="http://composingprograms.com/examples/mapreduce/mr.py"><code>mr æ¨¡å—</code></a>æ˜¯æœ¬æ–‡çš„é…å¥—æ¨¡å—, å®ƒæä¾›å‡½æ•°<code>emit</code>æ¥å‘å‡ºé”®å€¼å¯¹ä»¥åŠ<code>group_values_by_key</code>æ¥å°†å…·æœ‰ç›¸åŒé”®çš„å€¼ç»„åˆåœ¨ä¸€èµ·. è¿™ä¸ªæ¨¡å—è¿˜åŒ…æ‹¬æœ‰MapReduceçš„Hadoopåˆ†å¸ƒå¼å®ç°çš„æ¥å£.</p>
<p>æœ€å, å‡è®¾æˆ‘ä»¬æœ‰ä¸‹é¢çš„è¾“å…¥æ–‡ä»¶å«åš<code>haiku.txt</code>:</p>
<pre><code>Google MapReduce
Is a Big Data framework
For batch processing
</code></pre><p>ä½¿ç”¨Unixç®¡é“ç¬¦æ¥è¿›è¡Œæœ¬åœ°æ‰§è¡Œè®©æˆ‘ä»¬å¯ä»¥çŸ¥é“æ¯ä¸ªå¥å­ä¸­çš„å…ƒéŸ³æ•°é‡:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">$ cat haiku.txt <span class="p">|</span> ./count_vowels_mapper.py <span class="p">|</span> sort <span class="p">|</span> ./sum_reducer.py
<span class="s1">&#39;a&#39;</span>   <span class="m">6</span>
<span class="s1">&#39;e&#39;</span>   <span class="m">5</span>
<span class="s1">&#39;i&#39;</span>   <span class="m">2</span>
<span class="s1">&#39;o&#39;</span>   <span class="m">5</span>
<span class="s1">&#39;u&#39;</span>   <span class="m">1</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="473-åˆ†å¸ƒå¼å®ç°">4.7.3 åˆ†å¸ƒå¼å®ç°</h4>
<p><a href="http://en.wikipedia.org/wiki/Hadoop"><code>Hadoop</code></a>æ˜¯ä¸€ä¸ªå¼€æºå®ç°çš„MapReduceæ¡†æ¶çš„åç§°, è¿™ä¸ªæ¡†æ¶åœ¨ä¸€ç»„æœºå™¨ä¸Šæ‰§è¡ŒMapReduceåº”ç”¨ç¨‹åº, åˆ†å‘è¾“å…¥æ•°æ®å¹¶è®¡ç®—æœ‰æ•ˆçš„å¹¶è¡Œå¤„ç†. å®ƒçš„æµæ¥å£å…è®¸ä»»æ„çš„Unixç¨‹åºå»å®šä¹‰mapä»¥åŠreduceå‡½æ•°. å®é™…ä¸Š, æˆ‘ä»¬çš„<code>count_vowels_mappers.py</code>ä»¥åŠ<code>sum_reducer.py</code>å¯ä»¥ç›´æ¥ä½¿ç”¨Hadoopè¿›è¡Œå®‰è£…æ¥è®¡ç®—å¤§æ–‡æœ¬è¯­æ–™åº“ä¸Šçš„å…ƒéŸ³æ•°é‡.</p>
<p>Hadoopåœ¨æˆ‘ä»¬ç®€å•çš„æœ¬åœ°MapReduceå®ç°ä¸Šæä¾›äº†å‡ ä¸ªä¼˜ç‚¹. é¦–å…ˆæ˜¯é€Ÿåº¦: mapä»¥åŠreduceå‡½æ•°æ˜¯åŒæ—¶åœ¨ä¸åŒä»»åŠ¡, ä¸åŒçš„æœºå™¨ä¸Šå¹¶è¡Œè°ƒç”¨çš„. ç¬¬äºŒä¸ªæ˜¯å®¹é”™: å½“ä»»åŠ¡å› ä¸ºä»»æ„åŸå› è€Œå¤±è´¥, å®ƒçš„ç»“æœå¯ä»¥è¢«å…¶ä»–ä»»åŠ¡æ¥é‡æ–°è®¡ç®—æ¥å®Œæˆæ•´ä½“è®¡ç®—. ç¬¬ä¸‰ä¸ªæ˜¯ç›‘æ§: æ¡†æ¶æä¾›ä¸€ä¸ªç”¨æˆ·æ¥å£æ¥è¿½è¸ªMapReduceåº”ç”¨ç¨‹åºçš„è¿›åº¦.</p>
<p>ä¸ºäº†ä½¿ç”¨å·²æä¾›çš„<code>mapreduce.py</code>æ¨¡å—æ¥è¿è¡Œå…ƒéŸ³ç»Ÿè®¡ç¨‹åº, éœ€è¦å®‰è£…Hadoop, ä¿®æ”¹<code>HADOOP</code>èµ‹å€¼è¯­å¥ä¸ºæœ¬åœ°å®‰è£…çš„æ ¹ç›®å½•, å¤åˆ¶æ–‡æœ¬æ–‡ä»¶çš„é›†åˆåˆ°<code>Hadoop</code>çš„åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ, ç„¶åè¿è¡Œ:</p>
<p><code>$ python3 mr.py run count_vowels_mapper.py sum_reducer.py [input] [output]</code></p>
<p>è¿™é‡Œçš„<code>[input]</code>ä»¥åŠ<code>[output]</code>æ˜¯Hadoopæ–‡ä»¶ç³»ç»Ÿä¸­çš„ç›®å½•.</p>
<p>æƒ³è¦è·å–æ›´å¤šå…³äºHadoopæµæ¥å£çš„ä¿¡æ¯ä»¥åŠç³»ç»Ÿçš„ä½¿ç”¨æ–¹æ³•, å¯ä»¥å‚è€ƒ<a href="http://hadoop.apache.org/docs/stable/streaming.html">Hadoopæµæ–‡æ¡£</a>.</p>
<h3 id="48-å¹¶è¡Œè®¡ç®—">4.8 å¹¶è¡Œè®¡ç®—</h3>
<p>ä»20ä¸–çºª70å¹´ä»£åˆ°2000å¹´ä»£ä¸­æœŸ, å•ä¸ªå¤„ç†å™¨å†…æ ¸çš„é€Ÿåº¦åœ¨ä»¥æŒ‡æ•°çº§å¢é•¿. è¿™é€Ÿåº¦æ–¹é¢çš„å¢é•¿å¤§éƒ¨åˆ†é€šè¿‡å¢åŠ æ—¶é’Ÿé¢‘ç‡æ¥å®ç°, ä¹Ÿå°±æ˜¯å¤„ç†å™¨æ‰§è¡ŒåŸºæœ¬æ“ä½œçš„é€Ÿç‡. ç„¶è€Œåœ¨2000å¹´ä»£ä¸­æœŸ, è¿™ç§æŒ‡æ•°çº§å¢é•¿ç”±äºåŠŸç‡å’Œçƒ­é™åˆ¶çªç„¶ä¹‹é—´å°±åœæ­¢äº†, åŒæ—¶ä»é‚£æ—¶èµ·å•ä¸ªå¤„ç†å™¨å†…æ ¸çš„é€Ÿåº¦çš„å¢é•¿å°±æ…¢å¾—å¤šäº†. ä½œä¸ºä»£æ›¿, CPUåˆ¶é€ å•†å¼€å§‹åœ¨å•ä¸ªå¤„ç†å™¨ä¸Šæ·»åŠ å¤šä¸ªå†…æ ¸, ä½¿æ›´å¤šçš„æ“ä½œèƒ½å¤ŸåŒæ—¶æ‰§è¡Œ.</p>
<p>å¹¶è¡Œæ€§å¹¶ä¸æ˜¯ä¸€ä¸ªæ–°çš„æ¦‚å¿µ, å¤§å‹çš„å¹¶è¡Œè®¡ç®—æœºå™¨å·²ç»ä½¿ç”¨äº†å‡ åå¹´äº†, å…¶ä¸»è¦ç”¨äºç§‘å­¦è®¡ç®—ä»¥åŠæ•°æ®åˆ†æ. å³ä½¿åœ¨å…·æœ‰å•ä¸ªå¤„ç†å™¨æ ¸å¿ƒçš„ä¸ªäººç”µè„‘ä¸­, æ“ä½œç³»ç»Ÿä»¥åŠè§£æå™¨ä¹Ÿæä¾›äº†å¹¶å‘çš„æŠ½è±¡å®ç°. è¿™æ˜¯é€šè¿‡ä¸Šä¸‹æ–‡åˆ‡æ¢æ¥å®Œæˆçš„, æˆ–è€…å¿«é€Ÿåˆ‡æ¢ä¸åŒä»»åŠ¡, æ— éœ€ç­‰å¾…å®Œæˆ. å› æ­¤, å¤šä¸ªç¨‹åºå¯ä»¥åŒæ—¶åœ¨ç›¸åŒçš„æœºå™¨ä¸Šè¿è¡Œ, å³ä½¿è¿™ä¸ªæœºå™¨åªæœ‰å•ä¸ªå¤„ç†å™¨æ ¸å¿ƒ.</p>
<p>é‰´äºç›®å‰å¤„ç†å™¨æ ¸å¿ƒæ•°é‡å¢åŠ çš„è¶‹åŠ¿, ç°åœ¨çš„ä¸ªäººåº”ç”¨å¿…é¡»è¦åˆ©ç”¨å¹¶è¡Œæ€§æ¥è¿è¡Œå¾—æ›´å¿«. åœ¨å•ä¸ªç¨‹åºä¸­, å¿…é¡»å¯¹è®¡ç®—è¿›è¡Œå®‰æ’æ¥è®©å°½å¯èƒ½å¤šçš„å·¥ä½œå¹¶è¡Œå®Œæˆ. ç„¶è€Œ, å¹¶è¡Œæ€§å¯¹ç¼–å†™æ­£ç¡®çš„ä»£ç å¼•å…¥äº†æ–°çš„æŒ‘æˆ˜, ç‰¹åˆ«æ˜¯å­˜åœ¨å…±äº«çš„, å¯å˜çŠ¶æ€çš„æƒ…å†µä¸‹.</p>
<p>è¿™é—®é¢˜å¯ä»¥åœ¨å‡½æ•°å¼æ¨¡å‹ä¸­æœ‰æ•ˆåœ°è§£å†³, ç”±äºæ²¡æœ‰å…±äº«çš„å¯å˜çŠ¶æ€, å¹¶è¡Œæ€§å¼•å…¥çš„é—®é¢˜å°±ä¼šå°‘äº†å¾ˆå¤š. çº¯å‡½æ•°æä¾›äº†_é€æ˜çš„å‚è€ƒ_, è¿™æ„å‘³ç€è¡¨è¾¾å¼å¯ä»¥ç”¨å®ƒä»¬çš„å€¼ä»£æ›¿è€Œä¸å½±å“ç¨‹åºçš„è¡Œä¸º, åŒæ—¶åè¿‡æ¥ä¹ŸåŒæ ·èƒ½å¤Ÿæˆç«‹. è¿™ä½¿å¾—å¯ä»¥å¹¶è¡Œè¿è¡Œä¸ä¾èµ–äºå½¼æ­¤çš„è¡¨è¾¾å¼. å¦‚ä¸Šä¸€èŠ‚æ‰€è®²çš„, MapReduceæ¡†æ¶å…è®¸ç¨‹åºå‘˜ä»¥æœ€å°çš„å·¥å¤«æ¥å®ç°å¹¶è¡ŒæŒ‡å®šä¸è¿è¡Œå‡½æ•°å¼ç¨‹åº.</p>
<p>ä¸å¹¸çš„æ˜¯, ä¸æ˜¯æ‰€æœ‰çš„é—®é¢˜éƒ½å¯ä»¥ç”¨å‡½æ•°å¼ç¼–ç¨‹æ¥æœ‰æ•ˆåœ°è§£å†³çš„. ä¼¯å…‹åˆ©çš„è§†è§‰é¡¹ç›®å·²ç»ç¡®å®šäº†å‡ºç°åœ¨ç§‘å­¦å’Œå·¥ç¨‹æ–¹é¢çš„<a href="http://view.eecs.berkeley.edu/wiki/Dwarf_Mine">åä¸‰ç§å¸¸è§çš„è®¡ç®—æ¨¡å¼</a>, å…¶ä¸­åªæœ‰ä¸€ç§æ˜¯MapReduceç±»å‹çš„. è€Œå‰©ä½™çš„æ¨¡å¼éƒ½éœ€è¦å…±äº«çŠ¶æ€.</p>
<p>åœ¨æœ¬èŠ‚çš„å…¶ä½™éƒ¨åˆ†, æˆ‘ä»¬å°†ä¼šçœ‹åˆ°å¯å˜å…±äº«çŠ¶æ€æ˜¯å¦‚ä½•åœ¨å¹¶è¡Œç¨‹åºä¸­å¼•å…¥å„ç§bugä»¥åŠå¦‚ä½•é‡‡å–ä¸€äº›æ–¹æ³•é¿å…è¿™äº›bugçš„å‡ºç°. æˆ‘ä»¬å°†åœ¨ä¸¤ä¸ªåº”ç”¨ç¨‹åºçš„ä¸Šä¸‹æ–‡ä¸­ç ”ç©¶è¿™äº›æŠ€æœ¯, ä¸€ä¸ª<a href="http://composingprograms.com/examples/parallel/crawler.py.html">ç½‘ç»œçˆ¬è™«</a>ä»¥åŠä¸€ä¸ªç²’å­<a href="http://composingprograms.com/examples/parallel/particle.py.html">æ¨¡æ‹Ÿå™¨</a>.</p>
<h4 id="481-pythonä¸­çš„å¹¶è¡Œæ€§">4.8.1 Pythonä¸­çš„å¹¶è¡Œæ€§</h4>
<p>åœ¨æˆ‘ä»¬æ›´æ·±å…¥åœ°äº†è§£å¹¶è¡Œæ€§çš„ç»†èŠ‚ä¹‹å‰, è®©æˆ‘ä»¬é¦–å…ˆæ¢è®¨ä¸‹Pythonå¯¹å¹¶è¡Œè®¡ç®—çš„æ”¯æŒ. Pythonæä¾›ä¸¤ç§å¹¶è¡Œæ‰§è¡Œçš„æ‰‹æ®µ: çº¿ç¨‹ä»¥åŠå¤šè¿›ç¨‹.</p>
<p><strong>çº¿ç¨‹</strong>. åœ¨<em>çº¿ç¨‹</em>ä¸­, å¤šä¸ª&quot;çº¿ç¨‹&quot;çš„æ‰§è¡Œå­˜åœ¨äºå•ä¸ªè§£æå™¨ä¸­. æ¯ä¸ªçº¿ç¨‹ç‹¬ç«‹äºå…¶ä»–çš„çº¿ç¨‹æ¥æ‰§è¡Œä»£ç , è™½ç„¶å®ƒä»¬å…±äº«ç›¸åŒçš„æ•°æ®. ç„¶è€Œ, CPythonè§£æå™¨, Pythonè§£æå™¨ä¸­çš„ä¸»è¦å®ç°, ä¸€æ¬¡åªèƒ½åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­è§£é‡Šä»£ç , å¹¶åœ¨å®ƒä»¬ä¹‹é—´åˆ‡æ¢ä»¥æä¾›å¹¶è¡Œæ€§çš„é”™è§‰. å¦ä¸€æ–¹é¢, åœ¨è§£æå™¨å¤–éƒ¨æ‰§è¡Œçš„æ“ä½œ, ä¾‹å¦‚ç­‰å¾…æ–‡ä»¶æˆ–è€…è®¿é—®ç½‘ç»œ, ä¹Ÿå¯èƒ½æ˜¯å¹¶è¡Œè¿è¡Œçš„.</p>
<p><code>threading</code>æ¨¡å—åŒ…å«èƒ½å¤Ÿåˆ›å»ºå’ŒåŒæ­¥çº¿ç¨‹çš„ç±». ä¸‹é¢æ˜¯å¤šçº¿ç¨‹ç¨‹åºçš„ç®€å•ç¤ºä¾‹:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">threading</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">def</span> <span class="nf">thread_hello</span><span class="p">():</span>
        <span class="n">other</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">thread_say_hello</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">())</span>
        <span class="n">other</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="n">thread_say_hello</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">def</span> <span class="nf">thread_say_hello</span><span class="p">():</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;hello from&#39;</span><span class="p">,</span> <span class="n">threading</span><span class="o">.</span><span class="n">current_thread</span><span class="p">()</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">thread_hello</span><span class="p">()</span>
<span class="n">hello</span> <span class="kn">from</span> <span class="nn">Thread</span><span class="o">-</span><span class="mi">1</span>
<span class="n">hello</span> <span class="kn">from</span> <span class="nn">MainThread</span>
</code></pre></td></tr></table>
</div>
</div><p><code>Thread</code>æ„é€ å™¨åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹. å®ƒéœ€è¦ä¸€ä¸ªç›®æ ‡å‡½æ•°æ¥è®©æ–°çº¿ç¨‹æ‰§è¡Œ, ä»¥åŠä¼ è¾“ç»™å‡½æ•°çš„å¯¹åº”å‚æ•°. åœ¨<code>Thread</code>å¯¹è±¡è°ƒç”¨<code>start</code>æ¥æ ‡è®°å®ƒå·²ç»å‡†å¤‡å¥½æ‰§è¡Œ. <code>current_thread</code>å‡½æ•°è¿”å›ä¸å½“å‰æ‰§è¡Œçº¿ç¨‹ç›¸å…³è”çš„<code>Thread</code>å¯¹è±¡.</p>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­, è¾“å‡ºå¯ä»¥ä»¥ä»»æ„é¡ºåºå‘ç”Ÿ, å› ä¸ºæˆ‘ä»¬å¹¶æ²¡æœ‰ä»¥ä»»ä½•æ–¹å¼æ¥åŒæ­¥å®ƒä»¬.</p>
<p><strong>å¤šè¿›ç¨‹</strong>. Pythonä¹Ÿå¯ä»¥æ”¯æŒ_å¤šè¿›ç¨‹_, ä¹Ÿå°±æ˜¯å…è®¸ç¨‹åºäº§ç”Ÿå¤šä¸ªè§£æå™¨, æˆ–è€…_è¿›ç¨‹_, æ¯ä¸ªéƒ½å¯ä»¥ç‹¬ç«‹æ‰§è¡Œä»£ç . è¿™äº›è¿›ç¨‹é€šå¸¸ä¸ä¼šå…±äº«æ•°æ®, å› æ­¤ä»»ä½•å…±äº«çŠ¶æ€å¿…é¡»åœ¨è¿›ç¨‹ä¹‹é—´è¿›è¡Œæ²Ÿé€š. å¦ä¸€æ–¹é¢, è¿›ç¨‹çš„å¹¶è¡Œéœ€è¦æ ¹æ®åº•å±‚æ“ä½œç³»ç»Ÿä»¥åŠç¡¬ä»¶æä¾›çš„å¹¶è¡Œçº§åˆ«æ¥æ‰§è¡Œ. å› æ­¤, å¦‚æœCPUå…·æœ‰å¤šä¸ªå¤„ç†æ ¸å¿ƒ, Pythonè¿›ç¨‹å¯ä»¥çœŸæ­£åœ°å¹¶å‘è¿è¡Œ.</p>
<p><code>multiprocessing</code>æ¨¡å—åŒ…å«åˆ›å»ºä¸åŒæ­¥è¿›ç¨‹çš„ç±». ä¸‹é¢å°±æ˜¯ä½¿ç”¨è¿›ç¨‹çš„helloä¾‹å­.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">multiprocessing</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">def</span> <span class="nf">process_hello</span><span class="p">():</span>
        <span class="n">other</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">process_say_hello</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">())</span>
        <span class="n">other</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="n">process_say_hello</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">def</span> <span class="nf">process_say_hello</span><span class="p">():</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;hello from&#39;</span><span class="p">,</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">current_process</span><span class="p">()</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">process_hello</span><span class="p">()</span>
<span class="n">hello</span> <span class="kn">from</span> <span class="nn">MainProcess</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">hello</span> <span class="kn">from</span> <span class="nn">Process</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>å¦‚æœ¬ä¾‹æ‰€ç¤º, <code>multiprocessing</code>ä¸­çš„è®¸å¤šç±»ä»¥åŠå‡½æ•°éƒ½è·Ÿ<code>threading</code>ç›¸ä¼¼. è¿™ä¸ªä¾‹å­ä¹Ÿæ¼”ç¤ºäº†ç¼ºä¹åŒæ­¥æ˜¯å¦‚ä½•å½±å“å…±äº«çŠ¶æ€çš„, å› ä¸ºæ˜¾ç¤ºå™¨å¯ä»¥è¢«è®¤ä¸ºæ˜¯å…±äº«çŠ¶æ€. è¿™é‡Œ, æ¥è‡ªäº¤äº’è¿›ç¨‹çš„çš„è§£æå™¨æç¤ºå‡ºç°åœ¨å…¶ä»–è¿›ç¨‹æ‰“å°çš„è¾“å‡ºä¹‹å‰.</p>
<h4 id="482-å…±äº«çŠ¶æ€çš„é—®é¢˜">4.8.2 å…±äº«çŠ¶æ€çš„é—®é¢˜</h4>
<p>ä¸ºäº†è¯´æ˜å…±äº«çŠ¶æ€çš„é—®é¢˜, è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªç®€å•çš„å…±äº«åœ¨ä¸¤ä¸ªçº¿ç¨‹ä¹‹é—´çš„è®¡æ•°å™¨çš„ä¾‹å­:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>

<span class="n">counter</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">increment</span><span class="p">():</span>
    <span class="n">count</span> <span class="o">=</span> <span class="n">counter</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">sleep</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># try to force a switch to the other thread</span>
    <span class="n">counter</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span>

<span class="n">other</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">increment</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">())</span>
<span class="n">other</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="n">increment</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;count is now: &#39;</span><span class="p">,</span> <span class="n">counter</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</code></pre></td></tr></table>
</div>
</div><p>è¿™æ˜¯ä¸€ä¸ªç¨‹åº, ä¸¤ä¸ªçº¿ç¨‹å°è¯•å»è®©åŒä¸€ä¸ªè®¡æ•°å™¨åŠ ä¸€. CPythonè§£æå™¨å‡ ä¹å¯ä»¥åœ¨ä»»ä½•æ—¶é—´åœ¨çº¿ç¨‹ä¹‹é—´è¿›è¡Œåˆ‡æ¢. åªæœ‰æœ€åŸºæœ¬çš„æ“ä½œæ˜¯åŸå­çš„, è¿™æ„å‘³ç€å®ƒä»¬çš„ä¼¼ä¹æ˜¯å³åˆ»å‘ç”Ÿçš„, åœ¨å®ƒä»¬è¿è¡Œæˆ–è€…æ‰§è¡ŒæœŸé—´æ˜¯æ²¡æœ‰å¯èƒ½è¿›è¡Œåˆ‡æ¢çš„. å¢é•¿è®¡æ•°å™¨éœ€è¦å¤šä¸ªåŸºæœ¬çš„æ“ä½œ: è¯»å…¥æ—§çš„å€¼, å¯¹å®ƒè¿›è¡ŒåŠ ä¸€, ç„¶åå†™å…¥æ–°çš„å€¼. è§£æå™¨å¯ä»¥åœ¨è¿™äº›æ“ä½œæœŸé—´åˆ‡æ¢åˆ°ä»»æ„çš„çº¿ç¨‹.</p>
<p>ä¸ºäº†å»æ˜¾ç¤ºå½“è§£æå™¨åœ¨ä¸æ­£ç¡®çš„æ—¶é—´ç‚¹å†…åˆ‡æ¢äº†çº¿ç¨‹ä¼šå‘ç”Ÿä»€ä¹ˆ, æˆ‘ä»¬è¯•å›¾é€šè¿‡åœæ­¢0ç§’æ¥å¼ºåˆ¶æ‰§è¡Œåˆ‡æ¢. å½“è¿™ä¸ªä»£ç è¿è¡Œæ—¶, è§£æå™¨é€šå¸¸åœ¨çº¿ç¨‹è°ƒç”¨<code>sleep</code>æ—¶è¿›è¡Œåˆ‡æ¢. è¿™å¯èƒ½å¯¼è‡´ä»¥ä¸‹æ“ä½œé¡ºåº:</p>
<pre><code>Thread 0                    Thread 1
read counter[0]: 0
                            read counter[0]: 0
calculate 0 + 1: 1
write 1 -&gt; counter[0]
                            calculate 0 + 1: 1
                            write 1 -&gt; counter[0]
</code></pre><p>æœ€ç»ˆçš„ç»“æœæ˜¯è®¡æ•°å™¨å¾—åˆ°çš„å€¼æ˜¯1, å³ä½¿å®ƒè¢«å¢åŠ äº†ä¸¤æ¬¡! å¤šä¹ˆç³Ÿç³•, è§£æå™¨å¯èƒ½å¾ˆå°‘åœ¨é”™è¯¯çš„æ—¶é—´è¿›è¡Œåˆ‡æ¢, è¿™å°±å¯¼è‡´äº†å¾ˆéš¾å»è°ƒè¯•. å³ä½¿æ˜¯æœ‰è°ƒç”¨<code>sleep</code>, è¿™ä¸ªç¨‹åºæœ‰æ—¶å€™ä¹Ÿä¼šäº§å‡ºæ­£ç¡®çš„ç»Ÿè®¡æ•°2è€Œæœ‰æ—¶å€™æ˜¯é”™è¯¯çš„ç»Ÿè®¡æ•°1.</p>
<p>è¿™ä¸ªé—®é¢˜åªå‡ºç°åœ¨å…±äº«æ•°æ®å­˜åœ¨å¯èƒ½åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­è¿›è¡Œæ”¹å˜çš„æ—¶å€™å¦ä¸€ä¸ªçº¿ç¨‹åˆè®¿é—®äº†å®ƒ. è¿™æ ·çš„å†²çªç§°ä¸º_ç«äº‰æ¡ä»¶_, è¿™æ˜¯ä¸€ä¸ªä»…å­˜åœ¨äºå¹¶è¡Œä¸–ç•Œä¸­çš„é”™è¯¯ä¾‹å­.</p>
<p>ä¸ºäº†é¿å…ç«äº‰æ¡ä»¶, å¯èƒ½ä¼šè¢«å¤šä¸ªçº¿ç¨‹æ”¹å˜ä¸è®¿é—®çš„å…±äº«æ•°æ®å¿…é¡»è¦è¢«ä¿æŠ¤èµ·æ¥ä»¥æ‹’ç»åŒæ—¶è®¿é—®. ä¾‹å¦‚, å¦‚æœæˆ‘ä»¬å¯ä»¥ç¡®ä¿çº¿ç¨‹1åªåœ¨çº¿ç¨‹0è®¿é—®å®Œæˆåæ‰è®¿é—®è®¡æ•°å™¨æˆ–è€…åè¿‡æ¥, æˆ‘ä»¬å°±å¯ä»¥ä¿è¯å¾—å‡ºçš„ç»“æœæ˜¯æ­£ç¡®çš„. å¦‚æœå…±äº«æ•°æ®åœ¨å¹¶å‘è®¿é—®æ—¶æ˜¯è¢«ä¿æŠ¤çš„, æˆ‘ä»¬å°±å¯ä»¥è¯´å…±äº«æ•°æ®æ˜¯åŒæ­¥çš„. åœ¨æ¥ä¸‹æ¥çš„å‡ ä¸ªå°èŠ‚ä¸­, æˆ‘ä»¬å°†ä¼šçœ‹åˆ°æä¾›åŒæ­¥çš„å¤šç§æœºåˆ¶.</p>
<h4 id="483-ä»€ä¹ˆæ—¶å€™ä¸åŒæ­¥æ˜¯å¿…è¦çš„">4.8.3 ä»€ä¹ˆæ—¶å€™ä¸åŒæ­¥æ˜¯å¿…è¦çš„</h4>
<p>åœ¨æŸäº›æƒ…å†µä¸‹, è®¿é—®å…±äº«æ•°æ®å¹¶ä¸éœ€è¦åŒæ­¥è¿›è¡Œ, å¦‚æœæ˜¯å¹¶å‘è®¿é—®çš„è¯åˆ™ä¸èƒ½æœ‰å¯¼è‡´é”™è¯¯çš„è¡Œä¸º. æœ€ç®€å•çš„ä¾‹å­æ˜¯åªè¯»æ•°æ®. ç”±äºè¿™æ ·çš„æ•°æ®å¹¶ä¸ä¼šçªå˜, å› æ­¤æ‰€æœ‰çš„çº¿ç¨‹ä¸ç®¡åœ¨ä»€ä¹ˆæ—¶å€™è®¿é—®æ•°æ®éƒ½æ€»æ˜¯ä¼šè¯»åˆ°ç›¸åŒçš„æ•°æ®å€¼.</p>
<p>åœ¨æå°‘æ•°æƒ…å†µä¸‹, çªå˜çš„å…±äº«æ•°æ®å¯èƒ½ä¸éœ€è¦åŒæ­¥. ç„¶è€Œ, åœ¨è¿™ç§æƒ…å†µä¸‹éœ€è¦æ·±å…¥äº†è§£è§£æå™¨å’Œåº•å±‚è½¯ä»¶ä¸ç¡¬ä»¶çš„å·¥ä½œåŸç†. è€ƒè™‘ä¸‹ä¸‹é¢çš„ä¾‹å­:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">flag</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">def</span> <span class="nf">consume</span><span class="p">():</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="n">flag</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;items is&#39;</span><span class="p">,</span> <span class="n">items</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">produce</span><span class="p">():</span>
    <span class="n">consumer</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">consume</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">())</span>
    <span class="n">consumer</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
        <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">flag</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;go&#39;</span><span class="p">)</span>

<span class="n">produce</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><p>åœ¨è¿™é‡Œ, producerçº¿ç¨‹æ·»åŠ å…ƒç´ åˆ°<code>items</code>é‡Œå», è€Œconsumberç­‰å¾…ç›´åˆ°<code>flag</code>éç©ºä¸ºæ­¢. å½“producerå®Œæˆæ·»åŠ å…ƒç´ çš„å·¥ä½œå, å®ƒæ·»åŠ ä¸€ä¸ªå…ƒç´ åˆ°<code>flag</code>ä¸­, å…è®¸consumerç»§ç»­æ‰§è¡Œ.</p>
<p>åœ¨å¤§å¤šæ•°Pythonçš„å®ç°ä¸­, è¿™ä¸ªä¾‹å­ä¼šæ­£ç¡®æ‰§è¡Œ. ç„¶è€Œ, åœ¨å…¶ä»–çš„ç¼–è¯‘å™¨ä»¥åŠè§£æå™¨çš„å¸¸è§ä¼˜åŒ–ä¸­, ç”šè‡³æ˜¯ç¡¬ä»¶æœ¬èº«, éƒ½æ˜¯åœ¨ä¸ä¾èµ–æ•°æ®çš„å•ä¸ªçº¿ç¨‹ä¸­é‡æ–°æ’åºæ“ä½œçš„. åœ¨è¿™æ ·çš„ä¸€ä¸ªç³»ç»Ÿä¸­, è¯­å¥<code>flag.append('go')</code>å¯èƒ½ä¼šè¢«ç§»åŠ¨åˆ°å¾ªç¯ä¹‹å‰, å› ä¸ºä¸¤è€…éƒ½ä¸å–å†³äºå…¶ä»–æ•°æ®. ä¸€èˆ¬æ¥è¯´, ä½ åº”è¯¥é¿å…ç¼–å†™åƒè¿™æ ·çš„ç¨‹åºé™¤éä½ ç¡®å®šåŸºç¡€ç³»ç»Ÿä¸ä¼šé‡æ–°æ’åºç›¸å…³æ“ä½œ.</p>
<h4 id="484-åŒæ­¥æ•°æ®ç»“æ„">4.8.4 åŒæ­¥æ•°æ®ç»“æ„</h4>
<p>å…±äº«æ•°æ®çš„æœ€ç®€å•çš„æ–¹æ³•æ˜¯å»ä½¿ç”¨æä¾›åŒæ­¥æ“ä½œçš„æ•°æ®ç»“æ„. <code>queue</code>æ¨¡å—åŒ…å«ä¸€ä¸ª<code>Queue</code>ç±», è¿™ä¸ªç±»æä¾›å…ˆè¿›å…ˆå‡ºçš„åŒæ­¥æ•°æ®è®¿é—®. <code>put</code>æ–¹æ³•æ·»åŠ ä¸€ä¸ªå…ƒç´ åˆ°<code>Queue</code>ä¸­, <code>get</code>æ–¹æ³•æ£€ç´¢ä¸€ä¸ªå…ƒç´ . ç±»æœ¬èº«ç¡®ä¿è¿™äº›æ–¹æ³•æ˜¯åŒæ­¥çš„, å› æ­¤æ— è®ºçº¿ç¨‹æ“ä½œå¦‚ä½•äº¤é”™, å…ƒç´ éƒ½ä¸ä¼šä¸¢å¤±. è¿™é‡Œæœ‰ä¸€ä¸ªä½¿ç”¨<code>Queue</code>å®ç°çš„ç”Ÿäº§è€…/æ¶ˆè´¹è€…å½¢å¼çš„ä¾‹å­.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">queue</span> <span class="kn">import</span> <span class="n">Queue</span>

<span class="n">queue</span> <span class="o">=</span> <span class="n">Queue</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">synchronized_consume</span><span class="p">():</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;got an item:&#39;</span><span class="p">,</span> <span class="n">queue</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>
        <span class="n">queue</span><span class="o">.</span><span class="n">task_done</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">synchronized_produce</span><span class="p">():</span>
    <span class="n">consumer</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">synchronized_consume</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">())</span>
    <span class="n">consumer</span><span class="o">.</span><span class="n">daemon</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">consumer</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
        <span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">queue</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>

<span class="n">synchronized_produce</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><p>é™¤äº†<code>Queue</code>å’Œ<code>get</code>ä»¥åŠ<code>put</code>è°ƒç”¨ä¹‹å¤–, è¿˜è¦å¯¹ä»£ç è¿›è¡Œä¸€äº›ä¿®æ”¹. æˆ‘ä»¬å·²ç»æ ‡è®°consumerçº¿ç¨‹ä½œä¸ºå®ˆæŠ¤è¿›ç¨‹, ä¹Ÿå°±æ„å‘³ç€è¿™ä¸ªç¨‹åºåœ¨é€€å‡ºä¹‹å‰ä¸ä¼šç­‰å¾…çº¿ç¨‹çš„ç»“æŸ. è¿™å…è®¸æˆ‘ä»¬åœ¨consumerä¸­ä½¿ç”¨ä¸€ä¸ªæ— é™å¾ªç¯. ç„¶è€Œ, æˆ‘ä»¬éœ€è¦ç¡®ä¿ä¸»çº¿ç¨‹èƒ½åœ¨æ‰€æœ‰é¡¹ç›®éƒ½å·²ä»Queueæ¶ˆè€—ä¹‹å. consumerè°ƒç”¨<code>task_done</code>æ–¹æ³•æ¥é€šçŸ¥<code>Queue</code>å¤„ç†ä¸€ä¸ªé¡¹ç›®, å¹¶ä¸”ä¸»çº¿ç¨‹è°ƒç”¨joinæ–¹æ³•, è¯¥æ–¹æ³•ç­‰å¾…ç›´åˆ°æ‰€æœ‰é¡¹ç›®éƒ½è¢«å¤„ç†, ç¡®ä¿ç¨‹åºåœ¨æ­¤ä¹‹åé€€å‡º.</p>
<p>ä¸€ä¸ªæ›´åŠ å¤æ‚çš„ä½¿ç”¨<code>Queue</code>çš„ä¾‹å­æ˜¯ä¸€ä¸ªå¹¶è¡Œçš„web<a href="http://composingprograms.com/examples/parallel/crawler.py.html">çˆ¬è™«</a>, å®ƒç”¨äºæœç´¢ç½‘ç«™ä¸Šçš„æ­»é“¾æ¥. è¿™ä¸ªçˆ¬è™«ä¼šè·Ÿè¸ªæ‰€æœ‰ç”±ç›¸åŒç½‘ç«™æ‰˜ç®¡çš„é“¾æ¥, å› æ­¤å®ƒå¿…é¡»å¤„ç†ä¸€äº›URL, ä¸æ–­åœ°æ·»åŠ æ–°çš„åˆ°<code>Queue</code>ä¸­å¹¶åˆ é™¤æ‰è¦å¤„ç†çš„URL. é€šè¿‡ä½¿ç”¨åŒæ­¥<code>Queue</code>, å¤šçº¿ç¨‹å¯ä»¥å®‰å…¨åœ°åŒæ—¶ä»æ•°æ®ç»“æ„ä¸­æ·»åŠ ä»¥åŠç§»é™¤æ•°æ®.</p>
<h4 id="485-é”">4.8.5 é”</h4>
<p>å½“å¯¹ç‰¹å®šæ•°æ®çš„åŒæ­¥ç‰ˆæœ¬ä¸å¯ç”¨æ—¶, æˆ‘ä»¬å¿…é¡»è¦æä¾›è‡ªå·±çš„åŒæ­¥ç‰ˆæœ¬. _é”_æ˜¯å®ç°è¿™æ ·åšçš„åŸºç¡€æœºåˆ¶. å®ƒæœ€å¤šå¯ä»¥è¢«ä¸€ä¸ªçº¿ç¨‹è·å–, ä¹‹åæ²¡æœ‰å…¶ä»–çš„çº¿ç¨‹å¯ä»¥è·å–å®ƒ, ç›´åˆ°è¢«å…ˆå‰è·å–çš„çº¿ç¨‹é‡Šæ”¾æ‰å¯ä»¥.</p>
<p>åœ¨Pythonä¸­, <code>threading</code>æ¨¡å—åŒ…å«<code>Lock</code>ç±»æ¥æä¾›é”çš„åŠŸèƒ½. ä¸€ä¸ª<code>Lock</code>å…·æœ‰<code>acquire</code>ä»¥åŠ<code>release</code>æ–¹æ³•æ¥è·å–ä»¥åŠé‡Šæ”¾é”, åŒæ—¶ç±»ä¿è¯ä¸€æ¬¡åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è®¿é—®åˆ°å®ƒ. æ‰€æœ‰å…¶ä»–å°è¯•å»è·å–å·²ç»é”å®šçš„é”çš„çº¿ç¨‹éƒ½ä¼šè¢«è¿«ç­‰å¾…ç›´åˆ°é”è¢«é‡Šæ”¾.</p>
<p>ç”±äºé”ä¼šä¿æŠ¤ç‰¹å®šé›†åˆçš„æ•°æ®, æ‰€æœ‰çš„çº¿ç¨‹éƒ½éœ€è¦è¢«ç¼–ç¨‹ä¸ºéµå¾ªä»¥ä¸‹è§„åˆ™: æ²¡æœ‰çº¿ç¨‹ä¼šè®¿é—®åˆ°ä»»ä½•çš„å…±äº«æ•°æ®, é™¤éå®ƒå…·æœ‰ç‰¹å®šçš„é”. å®é™…ä¸Š, æ‰€æœ‰çº¿ç¨‹åœ¨è°ƒç”¨é”çš„<code>acquire</code>ä»¥åŠ<code>release</code>æ—¶éƒ½éœ€è¦åŒ…è£…å®ƒä»¬å¯¹å…±äº«æ•°æ®çš„æ“ä½œ.</p>
<p>åœ¨å¹¶è¡Œçš„web<a href="http://composingprograms.com/examples/parallel/crawler.py.html">çˆ¬è™«</a>ä¸­, æœ‰ä¸€ä¸ªsetæ˜¯ç”¨æ¥ä¿æŒè¿½è¸ªæ‰€æœ‰å·²ç»è¢«å…¶ä»–çº¿ç¨‹é‡åˆ°çš„URLçš„, ä»¥ä¾¿èƒ½å¤Ÿé¿å…å¤„ç†ç‰¹å®šçš„URLæ¬¡æ•°å¤šäºä¸€æ¬¡(å¹¶å¯èƒ½é™·å…¥æ­»å¾ªç¯)çš„æƒ…å†µ. ç„¶è€Œ, Pythonå¹¶æ²¡æœ‰æä¾›ä¸€ä¸ªåŒæ­¥çš„set, å› æ­¤æˆ‘ä»¬å¿…é¡»ä½¿ç”¨é”æ¥ä¿æŠ¤å¯¹æ­£å¸¸setçš„è®¿é—®:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">seen</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<span class="n">seen_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">already_seen</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
    <span class="n">seen_lock</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">if</span> <span class="n">item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span>
        <span class="n">seen</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">seen_lock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></td></tr></table>
</div>
</div><p>åœ¨è¿™é‡Œé”æ˜¯å¿…é¡»çš„, è¿™æ˜¯ä¸ºäº†é˜²æ­¢å¦ä¸€ä¸ªçº¿ç¨‹åœ¨è¿™ä¸ªçº¿ç¨‹æ£€æŸ¥URLæ˜¯å¦åœ¨å½“å‰çš„é›†åˆä¸­ä»¥åŠæ·»åŠ URLåˆ°é›†åˆä¸­çš„è¿™æ®µæ—¶é—´æ®µé‡Œæ·»åŠ è¿™ä¸ªURLåˆ°é›†åˆä¸­. æ­¤å¤–, æ·»åŠ åˆ°é›†åˆçš„æ“ä½œå¹¶ä¸æ˜¯åŸå­çš„, å› æ­¤åŒæ—¶å°è¯•æ·»åŠ åˆ°é›†åˆä¸­å¯èƒ½ä¼šå°†å†…éƒ¨æ•°æ®æŸåæ‰.</p>
<p>åœ¨è¿™æ®µä»£ç ä¸­, æˆ‘ä»¬å¿…é¡»è¦æ³¨æ„åœ¨æˆ‘ä»¬é‡Šæ”¾æ‰é”ä¹‹åæ‰èƒ½è¿”å›. ä¸€èˆ¬æ¥è¯´, æˆ‘ä»¬éœ€è¦ç¡®ä¿åœ¨ä¸éœ€è¦é”çš„æ—¶å€™é‡Šæ”¾æ‰å®ƒ. è¿™æ˜¯éå¸¸å®¹æ˜“å‡ºé”™çš„, å°¤å…¶æ˜¯åœ¨æœ‰ä¾‹å¤–çš„æƒ…å†µä¸‹, å› æ­¤Pythonæä¾›äº†<code>with</code>å¤åˆè¯­å¥ç”¨äºä¸ºæˆ‘ä»¬å¤„ç†è·å–ä»¥åŠé‡Šæ”¾é”çš„æ“ä½œ:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">already_seen</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">seen_lock</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span>
            <span class="n">seen</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">True</span>
</code></pre></td></tr></table>
</div>
</div><p><code>with</code>è¯­å¥åœ¨æ‰§è¡Œå†…éƒ¨è¯­å¥ä¹‹å‰ç¡®ä¿<code>seen_lock</code>æ˜¯èƒ½å¤Ÿè·å–åˆ°é”çš„å¹¶åœ¨å†…éƒ¨è¯­å¥ä»¥ä»»ä½•åŸå› é€€å‡ºæ—¶é‡Šæ”¾æ‰é”. (<code>with</code>è¯­å¥å®é™…ä¸Šå¯ä»¥è¢«ä½¿ç”¨åˆ°é”å®šä»¥å¤–çš„æ“ä½œ, å°½ç®¡æˆ‘ä»¬è¿™é‡Œä¸ä¼šä»‹ç»å…¶ä»–çš„ç”¨é€”.)</p>
<p>éœ€è¦å½¼æ­¤åŒæ­¥çš„æ“ä½œåº”è¯¥è¦ç”¨ç›¸åŒçš„é”. ç„¶è€Œ, éœ€è¦ä¸åŒä¸€é›†åˆä¸­çš„æ“ä½œåŒæ­¥çš„ä¸¤ä¸ªä¸ç›¸äº¤çš„æ“ä½œé›†åº”è¯¥ä½¿ç”¨ä¸¤ä¸ªä¸åŒçš„é”å®šå¯¹è±¡æ¥é¿å…è¿‡åº¦åŒæ­¥.</p>
<h4 id="486-å±éšœ">4.8.6 å±éšœ</h4>
<p>å¦ä¸€ä¸ªé¿å…å…±äº«æ•°æ®è®¿é—®å†²çªçš„æ–¹å¼æ˜¯å°†ç¨‹åºåˆ†æˆä¸€ä¸ªä¸ªçš„é˜¶æ®µ, ç¡®ä¿å…±äº«æ•°æ®åœ¨æ²¡æœ‰å…¶ä»–çº¿ç¨‹èƒ½å¤Ÿè®¿é—®å®ƒçš„é˜¶æ®µä¸­è¿›è¡Œçªå˜æ“ä½œ. _å±éšœ_å°†ç¨‹åºåˆ†æˆå‡ ä¸ªé˜¶æ®µ, è¦æ±‚æ‰€æœ‰çº¿ç¨‹ä¸­ä»»æ„ä¸€ä¸ªåœ¨å¯ä»¥æ‰§è¡Œåç»­è¿‡ç¨‹ä¹‹å‰å…ˆè·å–åˆ°è¿™ä¸ªæ•°æ®. åœ¨å±éšœä¹‹åæ‰§è¡Œçš„ä»£ç ä¸èƒ½ä¸å±éšœä¹‹å‰çš„ä»£ç å¹¶å‘æ‰§è¡Œ.</p>
<p>åœ¨Pythonä¸­, <code>threading</code>æ¨¡å—ä»¥<code>Barrier</code>å®ä¾‹çš„<code>wait</code>æ–¹æ³•çš„å½¢å¼æ¥æä¾›ä¸€ä¸ªå±éšœ:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">counters</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">barrier</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Barrier</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">count</span><span class="p">(</span><span class="n">thread_num</span><span class="p">,</span> <span class="n">steps</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">steps</span><span class="p">):</span>
        <span class="n">other</span> <span class="o">=</span> <span class="n">counters</span><span class="p">[</span><span class="mi">1</span> <span class="o">-</span> <span class="n">thread_num</span><span class="p">]</span>
        <span class="n">barrier</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span> <span class="c1"># wait for reads to complete</span>
        <span class="n">counters</span><span class="p">[</span><span class="n">thread_num</span><span class="p">]</span> <span class="o">=</span> <span class="n">other</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">barrier</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span> <span class="c1"># wait for writes to complete</span>

<span class="k">def</span> <span class="nf">threaded_count</span><span class="p">(</span><span class="n">steps</span><span class="p">):</span>
    <span class="n">other</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">count</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">steps</span><span class="p">))</span>
    <span class="n">other</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="n">count</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">steps</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;counters:&#39;</span><span class="p">,</span> <span class="n">counters</span><span class="p">)</span>

<span class="n">threaded_count</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­, è¯»å…¥ä»¥åŠå†™å…¥å…±äº«æ•°æ®å‘ç”Ÿåœ¨ä¸åŒé˜¶æ®µ, é€šè¿‡å±éšœæ¥åˆ†éš”å¼€. å†™å…¥å‘ç”Ÿåœ¨ç›¸åŒçš„é˜¶æ®µ, ä½†å®ƒä»¬æ˜¯ä¸ç›¸äº¤çš„; è¿™ç§ä¸ç›¸äº¤å¯¹äºé¿å…åŒæ—¶åœ¨ç›¸åŒé˜¶æ®µå†™å…¥ç›¸åŒæ•°æ®æ˜¯å¿…é¡»çš„. ç”±äºæ­¤ä»£ç å·²æ­£ç¡®åŒæ­¥, å› æ­¤ä¸¤ä¸ªè®¡æ•°å™¨å§‹ç»ˆåœ¨æœ€åä¸º10.</p>
<p>å¤šçº¿ç¨‹ç²’å­<a href="http://composingprograms.com/examples/parallel/particle.py.html">æ¨¡æ‹Ÿå™¨</a>ä½¿ç”¨å±éšœä»¥ç›¸ä¼¼çš„æ–¹å¼æ¥å®ç°åŒæ­¥è®¿é—®å…±äº«æ•°æ®. åœ¨æ¨¡æ‹Ÿå™¨ä¸­, æ¯ä¸ªçº¿ç¨‹æ‹¥æœ‰ä¸€å®šé‡çš„ç²’å­, æ‰€æœ‰è¿™äº›ç²’å­éƒ½åœ¨è®¸å¤šç¦»æ•£æ—¶é—´æ­¥é•¿çš„è¿‡ç¨‹ä¸­ç›¸äº’äº¤äº’. ç²’å­å…·æœ‰ä½ç½®, é€Ÿåº¦, ä»¥åŠåŠ é€Ÿåº¦, ä»¥åŠåœ¨æ¯ä¸ªæ—¶é—´æ­¥é•¿ä¸­åŸºäºå…¶ä»–ç²’å­ä½ç½®è€Œè®¡ç®—å‡ºçš„æ–°çš„åŠ é€Ÿåº¦. å¿…é¡»ç›¸åº”åœ°æ›´æ–°é¢—ç²’çš„é€Ÿåº¦, å¹¶æ ¹æ®å…¶é€Ÿåº¦æ›´æ–°å…¶ä½ç½®.</p>
<p>å’Œä¸Šé¢çš„ç®€å•ä¾‹å­ä¸€æ ·, è¿™é‡Œæœ‰ä¸€ä¸ªè¯»é˜¶æ®µ, å…¶ä¸­æ‰€æœ‰ä¾‹å­çš„ä½ç½®éƒ½è¢«æ‰€æœ‰çº¿ç¨‹è¯»å–. æ¯ä¸ªçº¿ç¨‹åœ¨æ­¤é˜¶æ®µæ›´æ–°è‡ªå·±çš„ç²’å­çš„åŠ é€Ÿåº¦, ä½†ç”±äºè¿™äº›éƒ½æ˜¯ä¸ç›¸äº¤çš„å†™æ“ä½œ, å› æ­¤å®ƒä»¬ä¸éœ€è¦åŒæ­¥. åœ¨å†™å…¥é˜¶æ®µ, æ¯ä¸ªçº¿ç¨‹æ›´æ–°å®ƒè‡ªå·±çš„ç²’å­çš„é€Ÿåº¦ä¸ä½ç½®. å†ä¸€æ¬¡åœ°, è¿™äº›æ˜¯ä¸ç›¸äº¤çš„å†™æ“ä½œ, åŒæ—¶å®ƒä»¬å—åˆ°é˜…è¯»é˜¶æ®µçš„å±éšœçš„ä¿æŠ¤.</p>
<h4 id="487-æ¶ˆæ¯ä¼ é€’">4.8.7 æ¶ˆæ¯ä¼ é€’</h4>
<p>æœ€åä¸€ç§é¿å…å…±äº«æ•°æ®è¢«ä¸å½“ä¿®æ”¹çš„æœ€ç»ˆæœºåˆ¶æ˜¯å®Œå…¨åœ°é¿å…åŒæ—¶è®¿é—®ç›¸åŒçš„æ•°æ®. åœ¨Pythonä¸­, ä½¿ç”¨å¤šè¿›ç¨‹è€Œä¸æ˜¯ä½¿ç”¨å¤šçº¿ç¨‹ä¼šè‡ªç„¶åœ°å¯¼è‡´è¿™ä¸€ç‚¹, å› ä¸ºè¿›ç¨‹åœ¨å…·æœ‰è‡ªå·±çš„æ•°æ®çš„å•ç‹¬çš„è§£æå™¨ä¸­è¿è¡Œ. å¤šä¸ªè¿›ç¨‹æ‰€éœ€çš„ä»»ä½•çŠ¶æ€å¯ä»¥é€šè¿‡è¿›ç¨‹é—´ä¼ è¾“æ¶ˆæ¯æ¥è¿›è¡Œæ²Ÿé€š.</p>
<p>åœ¨<code>multiprocessing</code>æ¨¡å—ä¸­çš„<code>Pipe</code>ç±»æä¾›äº†ä¸€ä¸ªè¿›ç¨‹ä¹‹é—´çš„é€šè®¯æ¸ é“. é»˜è®¤æƒ…å†µä¸‹, å®ƒæ˜¯åŒå·¥çš„, æ„å‘³ç€æ˜¯åŒå‘ä¿¡é“, é€šè¿‡ä¼ å…¥å‚æ•°<code>False</code>æ¥å¾—åˆ°ä¸€ä¸ªå•å‘çš„ä¿¡é“. <code>send</code>æ–¹æ³•åœ¨ä¿¡é“ä¸Šå‘é€ä¸€ä¸ªå¯¹è±¡, è€Œ<code>recv</code>æ–¹æ³•æ¥æ”¶ä¸€ä¸ªå¯¹è±¡. åè€…æ˜¯_é˜»å¡_çš„, æ„å‘³ç€ä¸€ä¸ªè¿›ç¨‹è°ƒç”¨<code>recv</code>æ–¹æ³•ä¹‹åä¼šç­‰å¾…ç›´åˆ°æ¥æ”¶åˆ°ä¸€ä¸ªå¯¹è±¡.</p>
<p>ä¸‹é¢çš„æ˜¯ä½¿ç”¨è¿›ç¨‹ä»¥åŠç®¡é“çš„ç”Ÿäº§è€…/æ¶ˆè´¹è€…çš„ä¾‹å­:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">process_consume</span><span class="p">(</span><span class="n">in_pipe</span><span class="p">):</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">in_pipe</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">item</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;got an item:&#39;</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">process_produce</span><span class="p">():</span>
    <span class="n">pipe</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Pipe</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">consumer</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">process_consume</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">pipe</span><span class="p">[</span><span class="mi">0</span><span class="p">],))</span>
    <span class="n">consumer</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
        <span class="n">pipe</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">pipe</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span> <span class="c1"># done signal</span>

<span class="n">process_produce</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­, æˆ‘ä»¬åªç”¨<code>None</code>æ¶ˆæ¯æ¥æ ‡è®°é€šä¿¡çš„ç»“æŸ. åœ¨åˆ›å»ºæ¶ˆè´¹è€…è¿›ç¨‹æ—¶, æˆ‘ä»¬ä¹Ÿåœ¨ä¼ å…¥ç®¡é“çš„ä¸€ç«¯, å°†å…¶ä½œä¸ºå‚æ•°ä¼ ç»™ç›®æ ‡å‡½. è¿™æ˜¯å¿…é¡»çš„, å› ä¸ºå¿…é¡»è¦åœ¨è¿›ç¨‹é—´å…±äº«çŠ¶æ€.</p>
<p>å¤šè¿›ç¨‹ç‰ˆæœ¬çš„ç²’å­<a href="http://composingprograms.com/examples/parallel/particle.py.html">æ¨¡æ‹Ÿå™¨</a>ä½¿ç”¨ç®¡é“åœ¨æ¯ä¸ªæ—¶é—´æ­¥é•¿ä¸­åœ¨è¿›ç¨‹é—´å¯¹ç²’å­çš„ä½ç½®è¿›è¡Œæ²Ÿé€š. å®é™…ä¸Š, ä½¿ç”¨ç®¡é“åœ¨è¿›ç¨‹ä¹‹é—´å»ºç«‹ä¸€ä¸ªå®Œæ•´çš„è½®æµ, ä¸ºäº†æœ€å°åŒ–é€šä¿¡. æ¯ä¸ªè¿›ç¨‹å°†è‡ªå·±ç²’å­çš„ä½ç½®æ³¨å…¥åˆ°å®ƒçš„ç®¡é“ä¼ é€’é˜¶æ®µ. æœ€ç»ˆé€šè¿‡æµæ°´çº¿æ¥å®Œæˆè½®æµ. åœ¨è¿™ä¸ªå›æ—‹çš„æ¯ä¸ªæ­¥éª¤ä¸­, ä¸€ä¸ªè¿›ç¨‹å°†åŠ›é‡ä»å½“å‰å¤„äºå…¶è‡ªèº«æµæ°´çº¿é˜¶æ®µçš„ä½ç½®åº”ç”¨åˆ°å…¶è‡ªèº«çš„ç²’å­ä¸Š, å› æ­¤åœ¨æ•´å®Œæˆæ•´ä¸ªè½®æµä¹‹å, æ‰€æœ‰çš„åŠ›å·²ç»è¢«åº”ç”¨åˆ°å®ƒçš„ç²’å­ä¸Š.</p>
<p><code>multiprocessing</code>æ¨¡å—æä¾›å…¶ä»–çš„è¿‡ç¨‹åŒæ­¥æœºåˆ¶, åŒ…æ‹¬åŒæ­¥é˜Ÿåˆ—, é”, ä»¥åŠPython3.3ä¸­çš„å±éšœ. ä¾‹å¦‚, ä¸€ä¸ªé”æˆ–è€…ä¸€ä¸ªå±éšœå¯ä»¥è¢«ç”¨æ¥åŒæ­¥æ‰“å°åˆ°å±å¹•ä¸­, é¿å…äº†æˆ‘ä»¬ä»¥å‰çœ‹åˆ°çš„ä¸æ­£ç¡®çš„æ˜¾ç¤ºè¾“å‡º.</p>
<h4 id="488-åŒæ­¥é™·é˜±">4.8.8 åŒæ­¥é™·é˜±</h4>
<p>è™½ç„¶åŒæ­¥æ–¹æ³•å¯¹ä¿æŠ¤å…±äº«æ•°æ®æ˜¯æœ‰æ•ˆçš„, ä½†æ˜¯å®ƒä»¬ä¹Ÿä¼šè¢«ä¸æ­£ç¡®ä½¿ç”¨, æœªèƒ½å®Œæˆæ­£ç¡®çš„åŒæ­¥, è¿‡åŒæ­¥, æˆ–è€…å¯¼è‡´ç¨‹åºæŒ‚èµ·çš„æ­»é”çš„ç»“æœ.</p>
<p><strong>åœ¨åŒæ­¥</strong>, ä¸€ä¸ªå¸¸è§çš„å¹¶è¡Œè®¡ç®—çš„é™·é˜±æ˜¯å¿½ç•¥æ­£ç¡®çš„åŒæ­¥å…±äº«è®¿é—®. åœ¨é›†åˆçš„ä¾‹å­ä¸­, æˆ‘ä»¬éœ€è¦å°†æˆå‘˜èµ„æ ¼æ£€æŸ¥ä»¥åŠæ’å…¥åŒæ­¥åœ¨ä¸€èµ·, å› æ­¤å…¶ä»–çº¿ç¨‹ä¸å¯ä»¥åœ¨è¿™ä¸¤ä¸ªæ“ä½œä¹‹é—´æ‰§è¡Œæ’å…¥. æœªèƒ½å°†è¿™ä¸¤ä¸ªæ“ä½œåŒæ­¥åœ¨ä¸€èµ·æ˜¯ä¸€ä¸ªé”™è¯¯, å³ä½¿å®ƒä»¬æ˜¯å•ç‹¬åŒæ­¥çš„.</p>
<p><strong>è¿‡åŒæ­¥</strong>, å¦ä¸€ç§å¸¸è§çš„é”™è¯¯æ˜¯è¿‡åº¦åŒæ­¥ç¨‹åº, ä½¿å¾—ä¸å†²çªçš„æ“ä½œä¸èƒ½åŒæ—¶å‘ç”Ÿ. ä½œä¸ºä¸€ä¸ªç®€å•çš„ä¾‹å­, æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨çº¿ç¨‹å¯åŠ¨æ—¶è·å–ä¸»é”è€Œåœ¨çº¿ç¨‹å®Œæˆæ—¶é‡Šæ”¾ä¸»é”æ¥é¿å…å¯¹å…±äº«æ•°æ®çš„æ‰€æœ‰å†²çªè®¿é—®. è¿™ä¼šä½¿å¾—æˆ‘ä»¬çš„ä»£ç åºåˆ—åŒ–, å› æ­¤æ²¡æœ‰ä»»ä½•éƒ¨åˆ†å¯ä»¥å¹¶è¡Œè¿è¡Œ. åœ¨æŸäº›æƒ…å†µä¸‹, è¿™ç”šè‡³ä¼šå¯¼è‡´æˆ‘ä»¬çš„ç¨‹åºæ— é™æœŸæŒ‚èµ·. ä¾‹å¦‚, æ€è€ƒä¸‹ç”Ÿäº§è€…/æ¶ˆè´¹è€…ç¨‹åºä¸­æ¶ˆè´¹è€…è·å–åˆ°é”åŒæ—¶æ°¸ä¸é‡Šæ”¾å®ƒ. è¿™é˜»æ­¢äº†ç”Ÿäº§è€…ç”Ÿäº§ä»»ä½•äº§å“, åè¿‡æ¥ä¹Ÿé˜»æ­¢äº†æ¶ˆè´¹è€…å»åšä»»ä½•äº‹æƒ…å› ä¸ºå®ƒæ²¡æœ‰ä¸œè¥¿å¯ä»¥è¿›è¡Œæ¶ˆè´¹.</p>
<p>è™½ç„¶è¿™ä¸ªä¾‹å­å¾ˆå¾®ä¸è¶³é“, ä½†æ˜¯åœ¨å®é™…ç”Ÿäº§ä¸­, ç¨‹åºå‘˜å¸¸å¸¸åœ¨ä¸€å®šç¨‹åº¦ä¸Šè¿‡åº¦åŒæ­¥ä»–ä»¬çš„ä»£ç , é˜»æ­¢ä»–ä»¬çš„ä»£ç å……åˆ†åˆ©ç”¨å¯ç”¨çš„å¹¶è¡Œæ€§.</p>
<p><strong>æ­»é”</strong>. å› ä¸ºå®ƒä»¬ä¼šå¯¼è‡´çº¿ç¨‹æˆ–è€…è¿›ç¨‹å½¼æ­¤ç­‰å¾…, åŒæ­¥æœºåˆ¶å®¹æ˜“å—åˆ°_æ­»é”_çš„å½±å“, è¿™ç§æƒ…å†µæ˜¯ä¸¤ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹æˆ–è¿›ç¨‹å¡ä½äº†, ç­‰å¾…å½¼æ­¤ä¹‹é—´ç»“æŸè¿è¡Œ. æˆ‘ä»¬åˆšåˆšå·²ç»çœ‹åˆ°å¿½ç•¥é‡Šæ”¾é”å¯èƒ½å¯¼è‡´çº¿ç¨‹æ— é™æœŸå¡ä½. ä½†å³ä½¿æ˜¯çº¿ç¨‹æˆ–è¿›ç¨‹æ­£ç¡®é‡Šæ”¾é”, ç¨‹åºä»ç„¶ä¼šé‡åˆ°æ­»é”.</p>
<p>æ­»é”æ¥æºäº_å¾ªç¯ç­‰å¾…_, å¦‚ä¸‹å›¾æ‰€ç¤º. æ²¡æœ‰ä¸€ä¸ªè¿‡ç¨‹å¯ä»¥ç»§ç»­æ‰§è¡Œ, å› ä¸ºä¸€ä¸ªè¿‡ç¨‹åœ¨ç­‰å¾…å…¶ä»–åœ¨ç­‰å¾…å¦ä¸€ä¸ªè¿‡ç¨‹ç»“æŸçš„ç­‰å¾…è¿™ä¸ªè¿‡ç¨‹ç»“æŸçš„è¿‡ç¨‹.</p>
<p><img src="http://composingprograms.com/img/deadlock.png" alt="æ­»é”" /></p>
<p>ä½œä¸ºä¾‹å­, æˆ‘ä»¬ä¼šå»ºç«‹ä¸¤ä¸ªè¿›ç¨‹çš„æ­»é”. å‡è®¾å®ƒä»¬å…±äº«åŒå·¥ä¿¡é“å¹¶å°è¯•ç›¸äº’é€šä¿¡, å¦‚ä¸‹æ‰€ç¤º:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">deadlock</span><span class="p">(</span><span class="n">in_pipe</span><span class="p">,</span> <span class="n">out_pipe</span><span class="p">):</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">in_pipe</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;got an item:&#39;</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
    <span class="n">out_pipe</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">item</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">create_deadlock</span><span class="p">():</span>
    <span class="n">pipe</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Pipe</span><span class="p">()</span>
    <span class="n">other</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">deadlock</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">pipe</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pipe</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">other</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="n">deadlock</span><span class="p">(</span><span class="n">pipe</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pipe</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="n">create_deadlock</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><p>ä¸¤ä¸ªè¿›ç¨‹éƒ½å°è¯•ç¬¬ä¸€æ—¶é—´æ¥æ”¶åˆ°æ•°æ®. å›æƒ³ä¸€ä¸‹å‰é¢è¯´åˆ°<code>recv</code>æ–¹æ³•é˜»å¡ç›´åˆ°æ¥æ”¶åˆ°ä¸€ä¸ªå¯ç”¨é¡¹ç›®. ç”±äºä»»ä½•è¿›ç¨‹éƒ½æ²¡æœ‰å‘é€ä»»ä½•å†…å®¹, æ‰€ä»¥ä¸¤è€…éƒ½å°†æ— é™æœŸç­‰å¾…å¦ä¸€ä¸ªå‘é€æ•°æ®, å› æ­¤å¯¼è‡´æ­»é”.</p>
<p>åŒæ­¥æ“ä½œå¿…é¡»è¦æ­£ç¡®å¯¹é½ä»¥é¿å…æ­»é”. è¿™å¯èƒ½éœ€è¦åœ¨æ¥æ”¶ä¹‹å‰é€šè¿‡ç®¡é“å‘é€, ä»¥ç›¸åŒçš„é¡ºåºæ¥æ”¶è·å–å¤šä¸ªé”, å¹¶ç¡®ä¿æ‰€æœ‰çº¿ç¨‹åœ¨æ­£ç¡®çš„æ—¶é—´åˆ°è¾¾æ­£ç¡®çš„å±éšœ.</p>
<h4 id="489-æ€»ç»“">4.8.9 æ€»ç»“</h4>
<p>æ­£å¦‚æˆ‘ä»¬çœ‹åˆ°çš„, å¹¶è¡Œæ€§åœ¨ç¼–å†™æ­£ç¡®å’Œæœ‰æ•ˆçš„ä»£ç æ–¹é¢æå‡ºäº†æ–°çš„æŒ‘æˆ˜. ç”±äºåœ¨å¯é‡è§çš„å°†æ¥ç¡¬ä»¶å±‚é¢ä¸Šçš„å¹¶è¡Œæ€§å°†ä¼šä¸æ–­å¢åŠ , å¹¶è¡Œè®¡ç®—åœ¨åº”ç”¨ç¨‹åºç¼–ç¨‹ä¸­å°†å˜å¾—è¶Šæ¥è¶Šé‡è¦. æœ‰ä¸€ä¸ªéå¸¸æ´»è·ƒçš„ç ”ç©¶æœºæ„, ä½¿å¹¶è¡Œæ€§æ›´å®¹æ˜“, ç¨‹åºå‘˜æ›´å°‘å‡ºé”™. æˆ‘ä»¬åœ¨è¿™é‡Œçš„è®¨è®ºåªæ˜¯å¯¹è¿™ä¸ªå…³é”®çš„è®¡ç®—æœºç§‘å­¦é¢†åŸŸçš„åŸºç¡€ä»‹ç».</p>
<p>ã€Šç¨‹åºæ„æˆã€‹æ¥è‡ªäº<a href="http://www.denero.org/">John DeNero</a>åŸºäºç”±<code>Harold Abelsonä»¥åŠGerald Jay Sussman</code>æ’°å†™çš„æ•™ç§‘ä¹¦<a href="http://mitpress.mit.edu/sicp/">è®¡ç®—æœºç¨‹åºçš„ç»“æ„å’Œè§£é‡Š</a>. åŸºäºå…±äº«åè®®: <a href="http://creativecommons.org/licenses/by-sa/3.0/">`Creative Commons Attribution-ShareAlike 3.0 Unported License.'</a></p>
    </article>
    
    <script>
  'use strict';
  
  function wrap(el, wrapper) {
    el.parentNode.insertBefore(wrapper, el);
    wrapper.appendChild(el);
  }

  (function () {
    var singleContentsElem = document.querySelector('.single__contents');
    singleContentsElem ? 
    singleContentsElem.querySelectorAll('pre > code').forEach(function(elem) {
      var dataLang = elem.getAttribute('data-lang');
      var dataLangWrapper = document.createElement('div');
      var code = null;
      var codeTitle = null;

      if (dataLang && dataLang.includes(':')) {
        code = dataLang.split(':')[0];
        codeTitle = dataLang.split(':')[1];

        dataLangWrapper.className = 'language-' + code;
        dataLangWrapper.setAttribute('data-lang', codeTitle);

        elem.className = 'language-' + code;
        elem.setAttribute('data-lang', codeTitle);
        elem.setAttribute('id', codeTitle);
      } else if (!dataLang) {
        dataLangWrapper.setAttribute('data-lang', 'Code');
        dataLangWrapper.className = 'language-code';
      }

      if (!dataLang || codeTitle) {
        wrap(elem.parentNode, dataLangWrapper);
      }

    }) : null;
  })();

  var langCodeElem = document.querySelectorAll('.language-code');
  langCodeElem ? langCodeElem.forEach(function (elem) {
    var newElem = document.createElement('span');
    newElem.className = 'copy-to-clipboard';
    newElem.setAttribute('title', 'Copy to clipboard');
    elem.append(newElem);
  }) : null;
  
</script>
    
<div class="donation">
  <div class="donation__message">
    Share on
  </div>
  <div class="donation__icons">
    
    
    
      
        <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fjmwill.github.io%2fblog%2f2017%2f06%2f11%2f%25E7%25A8%258B%25E5%25BA%258F%25E6%259E%2584%25E6%2588%2590-%25E7%25AC%25AC%25E5%259B%259B%25E7%25AB%25A0%2f" title="Facebook" aria-label="Facebook Share Button" class="donation__item" target="_blank" rel="noreferrer" data-type="share">
          <svg data-name="facebook" enable-background="new 0 0 24 24" viewBox="0 0 24 24" width="35" height="35" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="m15.997 3.985h2.191v-3.816c-.378-.052-1.678-.169-3.192-.169-3.159 0-5.323 1.987-5.323 5.639v3.361h-3.486v4.266h3.486v10.734h4.274v-10.733h3.345l.531-4.266h-3.877v-2.939c.001-1.233.333-2.077 2.051-2.077z"/></svg>
        </a>
      
    
      
        <a href="https://twitter.com/intent/tweet?text=%e7%a8%8b%e5%ba%8f%e6%9e%84%e6%88%90-%e7%ac%ac%e5%9b%9b%e7%ab%a0&url=https%3a%2f%2fjmwill.github.io%2fblog%2f2017%2f06%2f11%2f%25E7%25A8%258B%25E5%25BA%258F%25E6%259E%2584%25E6%2588%2590-%25E7%25AC%25AC%25E5%259B%259B%25E7%25AB%25A0%2f&hashtags=%e8%af%91%e6%96%87%2cDesign%20Programs&via=" title="Twitter" aria-label="Twitter Share Button" class="donation__item" target="_blank" rel="noreferrer" data-type="share">
          <svg data-name="twitter" enable-background="new 0 0 24 24" viewBox="0 0 24 24" width="35" height="35" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="m21.534 7.113c.976-.693 1.797-1.558 2.466-2.554v-.001c-.893.391-1.843.651-2.835.777 1.02-.609 1.799-1.566 2.165-2.719-.951.567-2.001.967-3.12 1.191-.903-.962-2.19-1.557-3.594-1.557-2.724 0-4.917 2.211-4.917 4.921 0 .39.033.765.114 1.122-4.09-.2-7.71-2.16-10.142-5.147-.424.737-.674 1.58-.674 2.487 0 1.704.877 3.214 2.186 4.089-.791-.015-1.566-.245-2.223-.606v.054c0 2.391 1.705 4.377 3.942 4.835-.401.11-.837.162-1.29.162-.315 0-.633-.018-.931-.084.637 1.948 2.447 3.381 4.597 3.428-1.674 1.309-3.8 2.098-6.101 2.098-.403 0-.79-.018-1.177-.067 2.18 1.405 4.762 2.208 7.548 2.208 8.683 0 14.342-7.244 13.986-14.637z"/></svg>
        </a>
      
    
  </div>
</div>

    
    
<div class="whoami__gutter"></div>
<hr class="hr-slash whoami-hr"/>
<section class="whoami">
  <div class="whoami__image-wrapper">
    
    
      
        <img data-src="/blog/images/whoami/avatar.jpg" src="data:image/svg+xml,%0A%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'%3E%3Cpath fill='none' d='M0 0h24v24H0V0z'/%3E%3Cpath fill='%23aaa' d='M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-1 16H6c-.55 0-1-.45-1-1V6c0-.55.45-1 1-1h12c.55 0 1 .45 1 1v12c0 .55-.45 1-1 1zm-4.44-6.19l-2.35 3.02-1.56-1.88c-.2-.25-.58-.24-.78.01l-1.74 2.23c-.26.33-.02.81.39.81h8.98c.41 0 .65-.47.4-.8l-2.55-3.39c-.19-.26-.59-.26-.79 0z'/%3E%3C/svg%3E" alt="Will" class="lazyload whoami__image"/>
      
    
  </div>
  <div class="whoami__contents">
    <div class="whoami__written-by">
      WRITTEN BY
    </div>
    <div class="whoami__title">
      
        Will
      
    </div>
    <div class="whoami__desc">
      
        Web Developer
      
    </div>
    <div class="whoami__social">
      
      
      
      
      
      
      
      
      <a href="mailto:willsurpriseyou@foxmail.com" title="email" aria-label="email">
        <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path fill="currentColor" d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm-.4 4.25l-7.07 4.42c-.32.2-.74.2-1.06 0L4.4 8.25c-.25-.16-.4-.43-.4-.72 0-.67.73-1.07 1.3-.72L12 11l6.7-4.19c.57-.35 1.3.05 1.3.72 0 .29-.15.56-.4.72z"/></svg>
      </a>
      
      
      
      <a href="http://example.org/" title="facebook" aria-label="facebook">
        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="25" height="25" viewBox="0 0 24 24" version="1.1">
<g id="surface2747">
<path fill="currentColor" d="M 11.664062 2.003906 C 6.621094 2.171875 2.375 6.25 2.023438 11.289062 C 1.65625 16.617188 5.46875 21.121094 10.507812 21.878906 L 10.507812 14.648438 L 8.890625 14.648438 C 8.164062 14.648438 7.578125 14.0625 7.578125 13.335938 C 7.578125 12.609375 8.164062 12.023438 8.890625 12.023438 L 10.503906 12.023438 L 10.503906 10.273438 C 10.503906 7.378906 11.914062 6.105469 14.324219 6.105469 C 14.679688 6.105469 14.984375 6.113281 15.242188 6.128906 C 15.878906 6.15625 16.371094 6.6875 16.371094 7.324219 C 16.371094 7.988281 15.835938 8.523438 15.171875 8.523438 L 14.730469 8.523438 C 13.710938 8.523438 13.351562 9.492188 13.351562 10.585938 L 13.351562 12.023438 L 15.222656 12.023438 C 15.8125 12.023438 16.265625 12.550781 16.175781 13.132812 L 16.066406 13.835938 C 15.992188 14.304688 15.589844 14.652344 15.113281 14.652344 L 13.351562 14.652344 L 13.351562 21.898438 C 18.234375 21.234375 22 17.0625 22 12 C 22 6.367188 17.339844 1.820312 11.664062 2.003906 Z M 11.664062 2.003906 "/>
</g>
</svg>

      </a>
      
      
      
      
      
      <a href="https://github.com/jmwill" title="github" aria-label="github">
        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="25" height="25" viewBox="0 0 24 24" version="1.1">
<g id="surface3680">
<path fill="currentColor" d="M 10.898438 2.101562 C 6.300781 2.601562 2.601562 6.300781 2.101562 10.800781 C 1.601562 15.5 4.300781 19.699219 8.398438 21.300781 C 8.699219 21.398438 9 21.199219 9 20.800781 L 9 19.199219 C 9 19.199219 8.601562 19.300781 8.101562 19.300781 C 6.699219 19.300781 6.101562 18.101562 6 17.398438 C 5.898438 17 5.699219 16.699219 5.398438 16.398438 C 5.101562 16.300781 5 16.300781 5 16.199219 C 5 16 5.300781 16 5.398438 16 C 6 16 6.5 16.699219 6.699219 17 C 7.199219 17.800781 7.800781 18 8.101562 18 C 8.5 18 8.800781 17.898438 9 17.800781 C 9.101562 17.101562 9.398438 16.398438 10 16 C 7.699219 15.5 6 14.199219 6 12 C 6 10.898438 6.5 9.800781 7.199219 9 C 7.101562 8.800781 7 8.300781 7 7.601562 C 7 7.199219 7 6.601562 7.300781 6 C 7.300781 6 8.699219 6 10.101562 7.300781 C 10.601562 7.101562 11.300781 7 12 7 C 12.699219 7 13.398438 7.101562 14 7.300781 C 15.300781 6 16.800781 6 16.800781 6 C 17 6.601562 17 7.199219 17 7.601562 C 17 8.398438 16.898438 8.800781 16.800781 9 C 17.5 9.800781 18 10.800781 18 12 C 18 14.199219 16.300781 15.5 14 16 C 14.601562 16.5 15 17.398438 15 18.300781 L 15 20.898438 C 15 21.199219 15.300781 21.5 15.699219 21.398438 C 19.398438 19.898438 22 16.300781 22 12.101562 C 22 6.101562 16.898438 1.398438 10.898438 2.101562 Z M 10.898438 2.101562 "/>
</g>
</svg>

      </a>
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      <a href="https://twitter.com/j_mwill" title="twitter" aria-label="twitter">
        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="25" height="25" viewBox="0 0 32 32" version="1.1">
<g id="surface676">
<path fill="currentColor" d="M 28 8.558594 C 27.117188 8.949219 26.167969 9.214844 25.171875 9.332031 C 26.1875 8.722656 26.96875 7.757812 27.335938 6.609375 C 26.386719 7.171875 25.332031 7.582031 24.210938 7.804688 C 23.3125 6.847656 22.03125 6.246094 20.617188 6.246094 C 17.898438 6.246094 15.691406 8.453125 15.691406 11.171875 C 15.691406 11.558594 15.734375 11.933594 15.820312 12.292969 C 11.726562 12.089844 8.097656 10.128906 5.671875 7.148438 C 5.246094 7.875 5.003906 8.722656 5.003906 9.625 C 5.003906 11.332031 5.871094 12.839844 7.195312 13.722656 C 6.386719 13.695312 5.628906 13.476562 4.964844 13.105469 C 4.964844 13.128906 4.964844 13.148438 4.964844 13.167969 C 4.964844 15.554688 6.660156 17.546875 8.914062 17.996094 C 8.5 18.109375 8.066406 18.171875 7.617188 18.171875 C 7.300781 18.171875 6.988281 18.140625 6.691406 18.082031 C 7.316406 20.039062 9.136719 21.460938 11.289062 21.503906 C 9.605469 22.824219 7.480469 23.609375 5.175781 23.609375 C 4.777344 23.609375 4.386719 23.585938 4 23.539062 C 6.179688 24.9375 8.765625 25.753906 11.546875 25.753906 C 20.605469 25.753906 25.558594 18.25 25.558594 11.742188 C 25.558594 11.53125 25.550781 11.316406 25.542969 11.105469 C 26.503906 10.410156 27.339844 9.542969 28 8.558594 Z M 28 8.558594 "/>
</g>
</svg>

      </a>
      
      
      
      
      
      
      
      
      
      
      
      
    </div>
  </div>
</section>
<hr class="hr-slash whoami-hr" />


    <section class="related">
    
    
    <h1 class="related__title">
      <hr class="hr-dots"/>
      <div>
        See Also
      </div>
      <hr class="hr-dots"/>
    </h1>
    <ul class="related-ul">
        
        <li>
          <a href="/blog/2017/06/11/%E7%A8%8B%E5%BA%8F%E6%9E%84%E6%88%90-%E7%AC%AC%E4%B8%89%E7%AB%A0/" class="related__link">ç¨‹åºæ„æˆ-ç¬¬ä¸‰ç« </a>
        </li>
        
        <li>
          <a href="/blog/2017/06/11/%E7%A8%8B%E5%BA%8F%E6%9E%84%E6%88%90-%E7%AC%AC%E4%BA%8C%E7%AB%A0/" class="related__link">ç¨‹åºæ„æˆ-ç¬¬äºŒç« </a>
        </li>
        
        <li>
          <a href="/blog/2017/03/09/%E7%A8%8B%E5%BA%8F%E6%9E%84%E6%88%90-%E7%AC%AC%E4%B8%80%E7%AB%A0/" class="related__link">ç¨‹åºæ„æˆ-ç¬¬ä¸€ç« </a>
        </li>
        
        <li>
          <a href="/blog/2016/12/16/%E8%AF%91es6%E7%9A%84350%E4%B8%AA%E8%A6%81%E7%82%B9%E6%A6%82%E8%BF%B0/" class="related__link">ã€è¯‘ã€‘ES6çš„350ä¸ªè¦ç‚¹æ¦‚è¿°</a>
        </li>
        
    </ul>
    
  </section>
    <div class="grow"></div>
<nav class="pagination-single">
  
    
      <a href="https://jmwill.github.io/blog/2017/06/11/%E7%A8%8B%E5%BA%8F%E6%9E%84%E6%88%90-%E7%AC%AC%E4%B8%89%E7%AB%A0/" class="pagination-single__left">
        <div class="pagination-single__icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path fill="currentColor" d="M19 11H7.83l4.88-4.88c.39-.39.39-1.03 0-1.42-.39-.39-1.02-.39-1.41 0l-6.59 6.59c-.39.39-.39 1.02 0 1.41l6.59 6.59c.39.39 1.02.39 1.41 0 .39-.39.39-1.02 0-1.41L7.83 13H19c.55 0 1-.45 1-1s-.45-1-1-1z"/></svg>
        </div>
        <div class="pagination-single__left-title">ç¨‹åºæ„æˆ-ç¬¬ä¸‰ç« </div>      
      </a>
    
    <div class="grow"></div>
    
      <a href="https://jmwill.github.io/blog/2020/04/19/%E5%A7%8B%E4%BA%8E-2020-%E7%9A%84-hugo-%E8%BF%81%E7%A7%BB/" class="pagination-single__right">      
        <div class="pagination-single__right-title">å§‹äº 2020 çš„ Hugo è¿ç§»</div>
        <div class="pagination-single__icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path fill="currentColor" d="M5 13h11.17l-4.88 4.88c-.39.39-.39 1.03 0 1.42.39.39 1.02.39 1.41 0l6.59-6.59c.39-.39.39-1.02 0-1.41l-6.58-6.6c-.39-.39-1.02-.39-1.41 0-.39.39-.39 1.02 0 1.41L16.17 11H5c-.55 0-1 .45-1 1s.45 1 1 1z"/></svg>
        </div>
      </a>
    
  
</nav>
    
  

    <div class="modal micromodal-slide" id="modal" aria-hidden="true">
  <div class="modal__overlay" tabindex="-1" data-micromodal-close>
    <div class="modal__container" role="dialog" aria-modal="true" aria-labelledby="modal-title">
      
      <div class="modal__content" id="modal-content">
        <div id="mySwipe" class="swipe">
          <div class="swipe-wrap">
          </div>
        </div>
      </div>

      <span class="modal__items">
        
        <span class="modal__header">
          <div class="modal__paging" title="Page Info" aria-label="Current Page">
          </div>
          <div class="modal__icon modal__toolbar modal__toolbar--close" title="Close" aria-label="Close Button" data-micromodal-close>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 26 26" width="25" height="25"><path fill="currentColor" d="M 21.734375 19.640625 L 19.636719 21.734375 C 19.253906 22.121094 18.628906 22.121094 18.242188 21.734375 L 13 16.496094 L 7.761719 21.734375 C 7.375 22.121094 6.746094 22.121094 6.363281 21.734375 L 4.265625 19.640625 C 3.878906 19.253906 3.878906 18.628906 4.265625 18.242188 L 9.503906 13 L 4.265625 7.761719 C 3.882813 7.371094 3.882813 6.742188 4.265625 6.363281 L 6.363281 4.265625 C 6.746094 3.878906 7.375 3.878906 7.761719 4.265625 L 13 9.507813 L 18.242188 4.265625 C 18.628906 3.878906 19.257813 3.878906 19.636719 4.265625 L 21.734375 6.359375 C 22.121094 6.746094 22.121094 7.375 21.738281 7.761719 L 16.496094 13 L 21.734375 18.242188 C 22.121094 18.628906 22.121094 19.253906 21.734375 19.640625 Z"/></svg>
          </div>
          <div class="modal__icon modal__toolbar modal__toolbar--full" title="Full Screen" aria-label="Full Screen Button">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="25" height="25"><path fill="currentColor" d="M 5 3 C 3.9069372 3 3 3.9069372 3 5 L 3 8 A 1.0001 1.0001 0 1 0 5 8 L 5 5 L 8 5 A 1.0001 1.0001 0 1 0 8 3 L 5 3 z M 16 3 A 1.0001 1.0001 0 1 0 16 5 L 19 5 L 19 8 A 1.0001 1.0001 0 1 0 21 8 L 21 5 C 21 3.9069372 20.093063 3 19 3 L 16 3 z M 3.984375 14.986328 A 1.0001 1.0001 0 0 0 3 16 L 3 19 C 3 20.093063 3.9069372 21 5 21 L 8 21 A 1.0001 1.0001 0 1 0 8 19 L 5 19 L 5 16 A 1.0001 1.0001 0 0 0 3.984375 14.986328 z M 19.984375 14.986328 A 1.0001 1.0001 0 0 0 19 16 L 19 19 L 16 19 A 1.0001 1.0001 0 1 0 16 21 L 19 21 C 20.093063 21 21 20.093063 21 19 L 21 16 A 1.0001 1.0001 0 0 0 19.984375 14.986328 z"/></svg>
          </div>
          <div class="modal__icon modal__toolbar modal__toolbar--normal" title="Normal Screen" aria-label="Normal Screen Button">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="25" height="25"><path fill="currentColor" d="M 16.96875 4.972656 C 15.867188 4.988281 14.984375 5.894531 15 7 L 15 15 L 7 15 C 6.277344 14.988281 5.609375 15.367188 5.246094 15.992188 C 4.878906 16.613281 4.878906 17.386719 5.246094 18.007813 C 5.609375 18.632813 6.277344 19.011719 7 19 L 19 19 L 19 7 C 19.007813 6.460938 18.796875 5.941406 18.414063 5.558594 C 18.03125 5.175781 17.511719 4.964844 16.96875 4.972656 Z M 32.96875 4.972656 C 31.921875 4.988281 31.0625 5.8125 31.003906 6.859375 C 31 6.90625 31 6.953125 31 7 L 31 19 L 43 19 C 43.066406 19 43.132813 19 43.199219 18.992188 C 44.269531 18.894531 45.070313 17.972656 45.015625 16.902344 C 44.964844 15.828125 44.074219 14.988281 43 15 L 35 15 L 35 7 C 35.007813 6.460938 34.796875 5.941406 34.414063 5.558594 C 34.03125 5.175781 33.511719 4.964844 32.96875 4.972656 Z M 7 31 C 6.277344 30.988281 5.609375 31.367188 5.246094 31.992188 C 4.878906 32.613281 4.878906 33.386719 5.246094 34.007813 C 5.609375 34.632813 6.277344 35.011719 7 35 L 15 35 L 15 43 C 14.988281 43.722656 15.367188 44.390625 15.992188 44.753906 C 16.613281 45.121094 17.386719 45.121094 18.007813 44.753906 C 18.632813 44.390625 19.011719 43.722656 19 43 L 19 31 Z M 31 31 L 31 43 C 30.988281 43.722656 31.367188 44.390625 31.992188 44.753906 C 32.613281 45.121094 33.386719 45.121094 34.007813 44.753906 C 34.632813 44.390625 35.011719 43.722656 35 43 L 35 35 L 43 35 C 43.722656 35.011719 44.390625 34.632813 44.753906 34.007813 C 45.121094 33.386719 45.121094 32.613281 44.753906 31.992188 C 44.390625 31.367188 43.722656 30.988281 43 31 Z"/></svg>
          </div>
        </span>
        
        <div class="modal__icon modal__arrow modal__arrow--left" title="Arrow Left" aria-label="Arrow Left Button">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 26 26" width="28" height="28"><path fill="currentColor" d="M 23.28125 11 L 10 10 L 10 6.851563 C 10 6.523438 9.839844 6.277344 9.519531 6.03125 C 9.199219 5.949219 8.878906 5.949219 8.640625 6.113281 C 5.359375 8.410156 2.238281 12.257813 2.160156 12.421875 C 2.082031 12.578125 2.007813 12.8125 2.003906 12.976563 C 2.003906 12.980469 2 12.988281 2 12.992188 C 2 13.15625 2.078125 13.402344 2.160156 13.484375 C 2.238281 13.648438 5.28125 17.507813 8.640625 19.804688 C 8.960938 19.96875 9.28125 20.050781 9.519531 19.886719 C 9.839844 19.722656 10 19.476563 10 19.148438 L 10 16 L 23.28125 15 C 23.679688 14.679688 24 13.875 24 12.992188 C 24 12.195313 23.761719 11.320313 23.28125 11 Z"/></svg>
        </div>
        
        <div class="modal__icon modal__arrow modal__arrow--right" title="Arrow Right" aria-label="Arrow Right Button">

          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 26 26" width="28" height="28"><path fill="currentColor" d="M 2.71875 11.023438 L 16 10.023438 L 16 6.875 C 16 6.546875 16.160156 6.300781 16.480469 6.054688 C 16.800781 5.972656 17.121094 5.972656 17.359375 6.136719 C 20.640625 8.433594 23.761719 12.28125 23.839844 12.445313 C 23.917969 12.601563 23.992188 12.835938 23.996094 13 C 23.996094 13.003906 24 13.011719 24 13.015625 C 24 13.179688 23.921875 13.425781 23.839844 13.507813 C 23.761719 13.671875 20.71875 17.53125 17.359375 19.828125 C 17.039063 19.992188 16.71875 20.074219 16.480469 19.910156 C 16.160156 19.746094 16 19.5 16 19.171875 L 16 16.023438 L 2.71875 15.023438 C 2.320313 14.703125 2 13.898438 2 13.015625 C 2 12.21875 2.238281 11.34375 2.71875 11.023438 Z"/></svg>
        </div>

        <div class="modal__caption">
          <div class="modal__caption--text">
          </div>
        </div>

      </span>
    </div>
  </div>
</div>


<script defer src="/blog/js/swipe.min.08ff2be1b74347bad9e267f732f1388d271b2f9d97b6a8a87bd6a510f17c5ad2.js"></script>

<script defer src="/blog/js/micromodal.min.de01b44b2f383056bbcaf6ee921fd385d79108ec1129afd0eb2f3f5a07e11f45.js"></script>

<script defer src="/blog/js/helper/fadeinout.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function () {
  
   
  var docElem = document.documentElement;

   
  function openFullscreen() {
    if (docElem.requestFullscreen) {
      docElem.requestFullscreen();
    } else if (docElem.mozRequestFullScreen) {  
      docElem.mozRequestFullScreen();
    } else if (docElem.webkitRequestFullscreen) {  
      docElem.webkitRequestFullscreen();
    } else if (docElem.msRequestFullscreen) {  
      docElem.msRequestFullscreen();
    }
  }

   
  function closeFullscreen() {
    if (document.fullscreenElement ||
      document.webkitFullscreenElement ||
      document.mozFullScreenElement) {
      if (document.exitFullscreen) {
        document.exitFullscreen();
      } else if (document.mozCancelFullScreen) {  
        document.mozCancelFullScreen();
      } else if (document.webkitExitFullscreen) {  
        document.webkitExitFullscreen();
      } else if (document.msExitFullscreen) {  
        document.msExitFullscreen();
      }
    }
  }

  var modal = document.getElementById('modal');
  var galleryContainerElem = document.querySelector('.gallery__container');
  var swipeWrapElem = document.querySelector('.swipe-wrap');
  var mySwipeElem = document.getElementById('mySwipe');
  var arrowLeftElem = document.querySelector('.modal__arrow--left');
  var arrowRightElem = document.querySelector('.modal__arrow--right');
  var closeElem = document.querySelector('.modal__toolbar--close');
  var fullElem = document.querySelector('.modal__toolbar--full');
  var normalElem = document.querySelector('.modal__toolbar--normal');
  var captionElem = document.querySelector('.modal__caption');
  var pagingElem = document.querySelector('.modal__paging');
  var itemsElem = document.querySelector('.modal__items');
  var imgTotalNum = null;
  var myFadeTimeout = null;
  var mySwipe = null;
  var keydownFunction = function (e) {
    if (e.key === 'ArrowRight') {
      if (modal && modal.classList.contains('is-open')) {
        mySwipe.next();
      }
    } else if (e.key === 'ArrowLeft') {
      if (modal && modal.classList.contains('is-open')) {
        mySwipe.prev();
      }
    }
  }

  if (galleryContainerElem) {
    imgTotalNum = galleryContainerElem.querySelectorAll('img').length;
  } else {
    galleryContainerElem = document.querySelector('.single__contents');
    imgTotalNum = galleryContainerElem.querySelectorAll('img').length;
  }

  MicroModal.init({
    onClose: function () {
      if (mySwipe) {
        mySwipe.kill();
        mySwipe = null;
        closeFullscreen();
      }
      window.removeEventListener('keydown', keydownFunction);
    },
    disableScroll: true,
    disableFocus: true,
    awaitOpenAnimation: false,
    awaitCloseAnimation: false,
    debugMode: false,
  });

  var imageLoad = function(src) {
    return new Promise(function(resolve, reject) {
      var newImg = new Image;
      newImg.onload = function() {
        resolve(newImg);
      }
      newImg.onerror = reject;
      newImg.src = src;
    });
  }

  galleryContainerElem.querySelectorAll('img').forEach(function (elem, idx) {
    elem.style.cursor = 'pointer';

    var clonedElem = elem.cloneNode(true);
    clonedElem.style.maxHeight = '100%';
    clonedElem.style.maxWidth = '100%';
    clonedElem.onclick = function (e) {
      e.stopPropagation();
    }

    var wrapper = document.createElement('div');
    wrapper.style.width = '100%';
    wrapper.style.height = '100vh';
    wrapper.setAttribute('data-micromodal-close', '');
    wrapper.onclick = function () {
      if (mySwipe) {
        mySwipe.kill();
        mySwipe = null;
      }
    }
    wrapper.onmouseenter = function () {
      clearTimeout(myFadeTimeout);
      fadeIn(itemsElem, 200);
    };
    wrapper.onmouseleave = function () {
      myFadeTimeout = setTimeout(function () {
        fadeOut(itemsElem, 200);
      }, 2500);
    }
    wrapper.ontouchstart = function() {
      fadeIn(itemsElem, 200);
    }
    wrapper.append(clonedElem);
    swipeWrapElem.append(wrapper);

    elem.addEventListener('click', async function (e) {
      MicroModal.show('modal');
      if (mySwipe) {
        mySwipe.kill();
        mySwipe = null;
      }

      var imgSrc = e.target.getAttribute('data-src') || e.target.getAttribute('src');
      var img = await imageLoad(imgSrc);
      clonedElem.style.width = img.width + 'px';
      clonedElem.style.height = img.height + 'px';
      
      
      mySwipe = new Swipe(mySwipeElem, {
        startSlide: idx,
        draggable: true,
        autoRestart: false,
        continuous: false,
        disableScroll: true,
        stopPropagation: true,
        callback: async function (index, element) {
          
          var imgElem = element.querySelector('img');
          var imgSrc = imgElem.getAttribute('data-src') || imgElem.getAttribute('src');
          var img = await imageLoad(imgSrc);
          imgElem.style.width = img.width + 'px';
          imgElem.style.height = img.height + 'px';

          
          if (captionElem && imgElem) {
            var caption = null;
            if (imgElem.getAttribute('data-caption')) {
              caption = imgElem.getAttribute('data-caption');
            } else if (imgElem.getAttribute('title')) {
              caption = imgElem.getAttribute('title');
            } else if (imgElem.getAttribute('alt')) {
              caption = imgElem.getAttribute('alt');
            } else {
              caption = imgElem.getAttribute('src');
            }

            captionElem.querySelector('.modal__caption--text').innerText = caption;
            pagingElem.innerText = (index + 1) + ' / ' + imgTotalNum;

            clearTimeout(myFadeTimeout);
            fadeIn(itemsElem, 200);
          }
        },
      });

      fadeIn(itemsElem);

      
      if (captionElem) {
        var caption = null;
        if (e.target.getAttribute('data-caption')) {
          caption = e.target.getAttribute('data-caption');
        } else if (e.target.getAttribute('title')) {
          caption = e.target.getAttribute('title');
        } else if (e.target.getAttribute('alt')) {
          caption = e.target.getAttribute('alt');
        } else {
          caption = e.target.getAttribute('src');
        }

        captionElem.querySelector('.modal__caption--text').innerText = caption;
        pagingElem.innerText = (idx + 1) + ' / ' + imgTotalNum;
      }

      if (normalElem && fullElem) {
        normalElem.style.zIndex = -1;
        normalElem.style.opacity = 0;
        fullElem.style.zIndex = 25;
        fullElem.style.opacity = 1;
      }
    });

    window.addEventListener('keydown', keydownFunction);
  });

  arrowLeftElem ?
    arrowLeftElem.addEventListener('click', function (e) {
      if (mySwipe) {
        mySwipe.prev();
      }
    }) : null;
  arrowRightElem ?
    arrowRightElem.addEventListener('click', function (e) {
      if (mySwipe) {
        mySwipe.next();
      }
    }) : null;

  closeElem ?
    closeElem.addEventListener('click', function () {
      if (mySwipe) {
        mySwipe.kill();
        mySwipe = null;
      }
      closeFullscreen();
      MicroModal.close('modal');
    }) : null;

  fullElem ?
    fullElem.addEventListener('click', function (e) {
      openFullscreen();
      if (normalElem) {
        normalElem.style.zIndex = 25;
        normalElem.style.opacity = 1;
        fullElem.style.zIndex = -1;
        fullElem.style.opacity = 0;
      }
    }) : null;

  normalElem ?
    normalElem.addEventListener('click', function (e) {
      closeFullscreen();
      if (fullElem) {
        fullElem.style.zIndex = 25;
        fullElem.style.opacity = 1;
        normalElem.style.zIndex = -1;
        normalElem.style.opacity = 0;
      }
    }) : null;
  
});
</script>

    <div class="hide">
      

<div class="search">
  <span class="icon">
    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="currentColor" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M15.5 14h-.79l-.28-.27c1.2-1.4 1.82-3.31 1.48-5.34-.47-2.78-2.79-5-5.59-5.34-4.23-.52-7.79 3.04-7.27 7.27.34 2.8 2.56 5.12 5.34 5.59 2.03.34 3.94-.28 5.34-1.48l.27.28v.79l4.25 4.25c.41.41 1.08.41 1.49 0 .41-.41.41-1.08 0-1.49L15.5 14zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
  </span>
  <input id="search" aria-label="Site Search" class="input" type="text" placeholder="Search" autocomplete="off">
  <div id="search-results" class="dropdown">
    <div id="search-menu" class="dropdown-menu" role="menu">
    </div>
  </div>
</div>


    </div>
  </div>
</main>


<aside class="single__side main-side">
  


<section class="sidebar hide">
  <script>document.querySelector('.sidebar').classList.remove('hide')</script>
  <div class="toc__flexbox" data-position="fixed">
    <h6 class="toc__title" data-ani="true">What&#39;s on this Page</h6>
    
      <label class="switch" data-ani="true">
        <input id="toggle-toc" aria-label="Toggle TOC" type="checkbox" checked>
        <span class="slider round"></span>
      </label>
    
  </div>
  <div class="toc " data-dir="ltr" data-folding="false" data-ani="true">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#ç¬¬å››ç« -æ•°æ®å¤„ç†">ç¬¬å››ç« : æ•°æ®å¤„ç†</a>
      <ul>
        <li><a href="#41-ä»‹ç»">4.1 ä»‹ç»</a></li>
        <li><a href="#42-éšå«åºåˆ—">4.2 éšå«åºåˆ—</a></li>
        <li><a href="#43-å£°æ˜å¼ç¼–ç¨‹">4.3 å£°æ˜å¼ç¼–ç¨‹</a></li>
        <li><a href="#44-é€»è¾‘ç¼–ç¨‹">4.4 é€»è¾‘ç¼–ç¨‹</a></li>
        <li><a href="#45-ç»Ÿä¸€">4.5 ç»Ÿä¸€</a></li>
        <li><a href="#46-åˆ†å¸ƒå¼è®¡ç®—">4.6 åˆ†å¸ƒå¼è®¡ç®—</a></li>
        <li><a href="#47-åˆ†å¸ƒå¼æ•°æ®å¤„ç†">4.7 åˆ†å¸ƒå¼æ•°æ®å¤„ç†</a></li>
        <li><a href="#48-å¹¶è¡Œè®¡ç®—">4.8 å¹¶è¡Œè®¡ç®—</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</section>



</aside>

<script>
  
  
  

  var enableToc = JSON.parse("true");
  var toc = JSON.parse("null");
  var tocPosition = JSON.parse("\"inner\"");
  
  var singleMainElem = document.querySelector('.single__main');
  var singleSideElem = document.querySelector('.single__side');

  enquire.register("screen and (max-width: 769px)", {
    match: function () {
      if ((enableToc || toc) && tocPosition !== "outer") {
        if (singleMainElem && singleSideElem) {
          singleMainElem.classList.remove('main-main');
          singleMainElem.classList.add('main');
          singleSideElem.classList.remove('main-side');
          singleSideElem.classList.add('hide');
        }
      } else if (tocPosition === "outer") {
        if (singleMainElem && !singleMainElem.classList.contains('main-main')) {
          singleMainElem.classList.remove('main-main');
          singleMainElem.classList.add('main');
        }
        if (singleSideElem && !singleSideElem.classList.contains('hide')) {
          singleSideElem.classList.add('hide');
        }
      }
    },
    unmatch: function () {
      if ((enableToc || toc) && tocPosition !== "outer") {
        singleMainElem.classList.remove('main');
        singleMainElem.classList.add('main-main');
        singleSideElem.classList.remove('hide');
        singleSideElem.classList.add('main-side');
      } else if (tocPosition === "outer") {
        if (singleMainElem && !singleMainElem.classList.contains('main-main')) {
          singleMainElem.classList.remove('main-main');
          singleMainElem.classList.add('main');
        }
        if (singleSideElem && !singleSideElem.classList.contains('hide')) {
          singleSideElem.classList.add('hide');
        }
      }

      var navCollapseBtn = document.querySelector('.navbar__burger');
      var navCollapse = document.getElementsByClassName('navbarm__collapse')[0];
      if (navCollapse) {
        navCollapse.setAttribute('data-open', false);
        navCollapse.style.maxHeight = 0;
        navCollapseBtn.classList.remove('is-active');
      }
      document.getElementsByClassName('navbar__menu')[0].classList.remove('is-active');
      document.getElementsByClassName('mobile-search')[0].classList.add('hide');
    },
    setup: function () { },
    deferSetup: true,
    destroy: function () { },
  });
</script>




<script defer src="/blog/js/clipboard.min.1626706afc88d95ebe1173b553ec732c6dc82a576989315fdf5e7779af738a44.js"></script>

<script defer src="/blog/js/helper/getParents.min.js"></script>

<script defer src="/blog/js/helper/closest.min.js"></script>

<script defer src="/blog/js/helper/prev.min.js"></script>

<script defer src="/blog/js/helper/prop.min.js"></script>

<script defer src="/blog/js/helper/fadeinout.min.js"></script>

















<script>
  'use strict';

  window.onload = function() {
    var navbar = document.querySelector('.navbar');
    var singleContentsElem = document.querySelector('.single__contents');

    
    
    
    var enableBusuanzi = JSON.parse("false");
    var busuanziPagePV = JSON.parse("true");
    
    if (enableBusuanzi && busuanziPagePV) {
      var pagePvElem = document.querySelector('#busuanzi_value_page_pv');
      pagePvElem.textContent = pagePvElem.textContent.replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1,");
    }    
    


    
    
    
    
    
    
    var enableToc = JSON.parse("true");
    var toc = JSON.parse("null");
    var hideToc = JSON.parse("false");
    var tocFlexbox = document.querySelector('.toc__flexbox');
    var tocFlexboxOuter = document.querySelector('.toc__flexbox--outer');
    var tocFolding = JSON.parse("false");
    
    if ((enableToc || toc) && document.querySelector('.toc')) {
      var tableOfContentsElem = document.querySelector('.toc').querySelector('#TableOfContents');

      if (false === tocFolding) {

      } else {
        tableOfContentsElem.querySelectorAll('ul') ?
          tableOfContentsElem.querySelectorAll('ul').forEach(function (rootUl) {
            rootUl.querySelectorAll('li').forEach(function (liElem) {
              liElem.querySelectorAll('ul').forEach(function (ulElem) {
                ulElem.style.display = 'none';
              });
            });
          }) : null;
      }

      if (tableOfContentsElem) {
        if (tableOfContentsElem.querySelectorAll('a').length > 0) {
          tableOfContentsElem.querySelectorAll('a').forEach(function (elem) {
            elem.addEventListener('click', function () {
              var id = elem.getAttribute('id');
              navbar.classList.remove('navbar--show');
              navbar.classList.remove('navbar--hide');
              navbar.classList.add('navbar--hide');

              document.querySelector('.toc').querySelectorAll('a').forEach(function (elem) {
                elem.classList.remove('active');
              });
              elem.classList.add('active');

              var curElem = tableOfContentsElem.querySelector('[href="#' + id + '"]');
              if (curElem && curElem.nextElementSibling) {
                curElem.nextElementSibling.style.display = 'block';
              }
              if (curElem) {
                getParents(curElem, 'ul') ?
                  getParents(curElem, 'ul').forEach(function (elem) {
                    elem.style.display = 'block';
                  }) : null;
              }
            });
          });
        } else {
          if (tocFlexbox) {
            tocFlexbox.setAttribute('data-position', '');
            if (!tocFlexbox.classList.contains('hide')) {
              tocFlexbox.classList.add('hide');
            }
          }
          if (tocFlexboxOuter) {
            tocFlexboxOuter.setAttribute('data-position', '');
            if (!tocFlexboxOuter.classList.contains('hide')) {
              tocFlexboxOuter.classList.add('hide');
            }
          }
        }
      }

      
      var toggleTocElem = document.getElementById("toggle-toc");
      var visibleTocElem = document.getElementById('visible-toc');
      var tocElem = document.querySelector('.toc');
      var mainElem = document.querySelector('main');
      var sideElem = document.querySelector('side');
      var tocFlexboxElem = document.querySelector('.toc__flexbox');

      toggleTocElem ? 
      toggleTocElem.addEventListener('change', function(e) {
        if (e.target.checked) {
          if (tocElem) {
            fadeIn(tocElem, 200);
          }
          if (tocFlexboxElem) {
            tocFlexboxElem.setAttribute('data-position', 'fixed');
          }

          if (mainElem) {
            mainElem.classList.remove('main-main');
            mainElem.classList.remove('main');
            mainElem.classList.add('main-main');
          }
          if (sideElem) {
            sideElem.classList.remove('main-side');
          }
        } else {
          if (tocElem) {
            fadeOut(tocElem, 200);
          }
          if (tocFlexboxElem) {
            tocFlexboxElem.setAttribute('data-position', 'absolute');
          }

          if (mainElem) {
            mainElem.classList.remove('main-main');
            mainElem.classList.remove('main');
            mainElem.classList.add('main');
          }
          if (sideElem) {
            sideElem.classList.remove('main-side');
          }
        }
      }) : null;

      visibleTocElem ?
      visibleTocElem.addEventListener('change', function(e) {
        if (e.target.checked) {
          if (tocElem) {
            fadeIn(tocElem, 200);
          }
        } else {
          if (tocElem) {
            fadeOut(tocElem, 200);
          }
        }
      }) : null;
    }
    


    
    var tables = document.querySelectorAll('.single__contents > table');
    for (let i = 0; i < tables.length; i++) {
      var table = tables[i];
      var wrapper = document.createElement('div');
      wrapper.className = 'table-wrapper';
      table.parentElement.replaceChild(wrapper, table);
      wrapper.appendChild(table);
    }
    


    
    var text, clip = new ClipboardJS('.anchor');
    var headers = singleContentsElem.querySelectorAll("h1, h2, h3, h4");

    
    var languagedir = JSON.parse("\"ltr\"");

    headers ? 
    headers.forEach(function (elem) {
      var url = encodeURI(document.location.origin + document.location.pathname);
      var link = url + "#" + elem.getAttribute('id');
      var newElemOuter = document.createElement('span');
      newElemOuter.classList.add('anchor');
      newElemOuter.classList.add('hide');
      newElemOuter.setAttribute('data-clipboard-text', link);
      newElemOuter.style.position = 'relative';

      var newElemInner = document.createElement('span');
      newElemInner.style.fontSize = '1rem';
      newElemInner.style.position = 'absolute';
      newElemInner.style.top = '50%';
      newElemInner.style.transform = 'translateY(-50%)';
      newElemInner.innerText = "ğŸ”—";

      if (languagedir === "rtl") {
        newElemInner.style.left = '-2rem';
      } else {
        newElemInner.style.right = '-2rem';
      }

      newElemOuter.append(newElemInner);
      elem.append(newElemOuter);

      elem.addEventListener('mouseenter', function() {
        this.querySelector('.anchor').classList.remove('hide');
      });
      elem.addEventListener('mouseleave', function () {
        this.querySelector('.anchor').classList.add('hide');
      });
    }) : null;

    document.querySelectorAll('.anchor').forEach(function(elem) {
      elem.addEventListener('mouseleave', function() {
        elem.setAttribute('aria-label', null);
        elem.classList.remove('tooltipped');
        elem.classList.remove('tooltipped-s');
        elem.classList.remove('tooltipped-w');
      });
    });

    clip.on('success', function (e) {
      e.clearSelection();
      e.trigger.setAttribute('aria-label', 'Link copied to clipboard!');
      e.trigger.classList.add('tooltipped');
      e.trigger.classList.add('tooltipped-s');
    });
    


    
    var clipInit = false;
    var preChromaElem = document.querySelectorAll('pre.chroma');
    var langCodeElem = document.querySelectorAll('.language-code');
    var dollarCodeElem = document.querySelectorAll('div.language-\\$');
    var gtCodeElem = document.querySelectorAll('div.language-\\>');

    var makeClipboard = function(elem) {
      var code = elem,
        text = elem.textContent;
        
      if (text.length > 15) {
        if (!clipInit) {
          var text, clip = new ClipboardJS('.copy-to-clipboard', {
            text: function (trigger) {
              var codeElem = prev(trigger).querySelectorAll('code');
              if (codeElem.length > 1) {
                text = prev(trigger).querySelector('code[class^="language-"]').textContent;
              } else {
                text = prev(trigger).querySelector('code').textContent;
              }

              return text.replace(/^\$\s/gm, '');
            }
          });

          var inPre;
          clip.on('success', function (e) {
            e.clearSelection();
            inPre = prop(e.trigger.parentNode, 'tagName') == 'PRE';
            e.trigger.setAttribute('aria-label', 'Copied to clipboard!');
            e.trigger.classList.add('tooltipped');
            e.trigger.classList.add('tooltipped-w');
          });

          clip.on('error', function (e) {
            inPre = prop(e.trigger.parentNode, 'tagName') == 'PRE';
            e.trigger.setAttribute('aria-label', e.action.toString());
            e.trigger.classList.add('tooltipped');
            e.trigger.classList.add('tooltipped-w');
          });

          clipInit = true;
        }

        var notAllowedClass = ['language-mermaid', 'language-viz', 'language-wave', 'language-chart', 'language-msc', 'language-flowchart'];
        var isNotAllowedIncluded = false;
        var curClassName = code.getAttribute('class');

        for (var i = 0; i < notAllowedClass.length; i++) {
          if (curClassName && curClassName.startsWith(notAllowedClass[i])) {
            isNotAllowedIncluded = true;
            break;
          }
        }

        if (!isNotAllowedIncluded) {
          if (curClassName) {
            var newClipboardElem = document.createElement('span');
            newClipboardElem.setAttribute('class', 'copy-to-clipboard');
            newClipboardElem.setAttribute('title', 'Copy to clipboard');
            elem.parentNode.parentNode.insertBefore(newClipboardElem, elem.parentNode.nextElementSibling);
          }
        }
      }
    }

    var makeSymbolClipboard = function(elem) {
      var clipboardSpan = document.createElement('span');
      clipboardSpan.setAttribute('class', 'copy-to-clipboard');
      clipboardSpan.setAttribute('title', 'Copy to clipboard');
      elem.parentNode.parentNode.insertBefore(clipboardSpan, elem.parentNode.nextElementSibling);
    }

    preChromaElem ? 
    preChromaElem.forEach(function(elem) {
      elem.querySelectorAll('code').forEach(function(codeElem) {
        makeClipboard(codeElem);
      });
    }) : null;
    
    langCodeElem ? 
    langCodeElem.forEach(function(elem) {
      elem.querySelectorAll('code').forEach(function (codeElem) {
        makeClipboard(codeElem);
      });
    }) : null;

    dollarCodeElem ? 
    dollarCodeElem.forEach(function(elem) {
      elem.querySelectorAll('code').forEach(function (codeElem) {
        makeSymbolClipboard(codeElem);
      });
    }) : null;

    gtCodeElem ?
    gtCodeElem.forEach(function(elem) {
      elem.querySelectorAll('code').forEach(function (codeElem) {
        makeSymbolClipboard(codeElem);
      });
    }) : null;
    


    
    dollarCodeElem ?
    dollarCodeElem.forEach(function(elem) {
      var lnts = elem.parentNode.parentNode ? elem.parentNode.parentNode.querySelectorAll('.lnt') : null;
      lnts ? 
      lnts.forEach(function(lnt) {
        lnt.innerHTML = '$<br/>';
      }) : null;
    }) : null;

    gtCodeElem ?
    gtCodeElem.forEach(function(elem) {
      var lnts = elem.parentNode.parentNode ? elem.parentNode.parentNode.querySelectorAll('.lnt') : null;
      lnts ? 
      lnts.forEach(function(lnt) {
        lnt.innerHTML = '><br/>';
      }) : null;
    }) : null;
    


    
    
    var lib = JSON.parse("null");

    if (lib && lib.includes('mermaid')) {
      
      var themeVariant = localStorage.getItem('theme') || JSON.parse("\"solarized\"");

      if (themeVariant === "dark" || themeVariant === "hacker") {
        mermaid.initialize({ theme: 'dark' });
      } else {
        mermaid.initialize({ theme: 'default' });
      }
      
      var mermaids = [];
      [].push.apply(mermaids, document.getElementsByClassName('language-mermaid'));
      mermaids.forEach(function(elem) {
        var elemParentNode = elem.parentNode;

        if (elemParentNode !== document.body) {
          elemParentNode.parentNode.insertBefore(elem, elemParentNode);
          elemParentNode.parentNode.removeChild(elemParentNode);
        }

        var newElemWrapper = document.createElement('div');
        newElemWrapper.classList.add('mermaid');
        newElemWrapper.style.padding = '34px 4px 6px';
        newElemWrapper.innerHTML = elem.innerHTML;
        elem.replaceWith(newElemWrapper);
      });
    }
    
    

    
    if (lib && lib.includes('katex')) {
      var mathElements = document.getElementsByClassName('math');
      var options = {
        delimiters: [
          { left: "$$", right: "$$", display: true },
          { left: "\\[", right: "\\]", display: true },
          { left: "$", right: "$", display: false },
          { left: "\\(", right: "\\)", display: false }
        ],
      };

      renderMathInElement(document.querySelector('.single__contents'), options);
    }
    


    
    if (lib && lib.includes('flowchartjs')) {
      
      var options = JSON.parse("{\"arrow-end\":\"block\",\"element-color\":\"black\",\"fill\":\"white\",\"flowstate\":{\"approved\":{\"fill\":\"#58C4A3\",\"font-size\":12,\"no-text\":\"n/a\",\"yes-text\":\"APPROVED\"},\"current\":{\"fill\":\"yellow\",\"font-color\":\"red\",\"font-weight\":\"bold\"},\"future\":{\"fill\":\"#FFFF99\"},\"invalid\":{\"fill\":\"#444444\"},\"past\":{\"fill\":\"#CCCCCC\",\"font-size\":12},\"rejected\":{\"fill\":\"#C45879\",\"font-size\":12,\"no-text\":\"REJECTED\",\"yes-text\":\"n/a\"},\"request\":{\"fill\":\"blue\"}},\"font-color\":\"black\",\"font-size\":14,\"line-color\":\"black\",\"line-length\":50,\"line-width\":3,\"no-text\":\"no\",\"scale\":1,\"symbols\":{\"end\":{\"class\":\"end-element\"},\"start\":{\"element-color\":\"green\",\"fill\":\"yellow\",\"font-color\":\"red\"}},\"text-margin\":10,\"x\":0,\"y\":0,\"yes-text\":\"yes\"}");
      var jsonContent = null;

      var flowchartPrefix = "language-flowchart";
      var index = 0;
      Array.prototype.forEach.call(document.querySelectorAll("[class^=" + flowchartPrefix + "]"), function(x){
          x.style.display = 'none'
          x.parentNode.style.backgroundColor = "transparent"
          jsonContent = x.innerText;

          var node0 = document.createElement('div');
          node0.id = 'flowchart' + index;
          x.parentNode.insertBefore(node0, x);

          var diagram = flowchart.parse(jsonContent);
          diagram.drawSVG("flowchart"+index, options);

          index +=1;
      });      
    }
    


    
    


    
    if (lib && lib.includes('msc')) {
      
      var options = JSON.parse("{\"theme\":\"hand\"}");
      var jsonContent = null;

      var index = 0;
      var chartPrefix = "language-msc";
      Array.prototype.forEach.call(document.querySelectorAll("[class^=" + chartPrefix + "]"), function (x) {
        x.style.display = 'none'
        x.parentNode.style.backgroundColor = "transparent"
        jsonContent = x.innerText;
        var node0 = document.createElement('div');
        node0.id = 'msc' + index;
        x.parentNode.insertBefore(node0, x);
        var diagram = Diagram.parse(jsonContent);
        diagram.drawSVG("msc" + index, options);
        index += 1;
      });
    }
    


    
    if (lib && lib.includes('chart')) {
      var borderColor = "#666";
      var bgColor = "#ddd";
      var borderWidth = 2;

      Chart.defaults.global.elements.rectangle.borderWidth = borderWidth;
      Chart.defaults.global.elements.rectangle.borderColor = borderColor;
      Chart.defaults.global.elements.rectangle.backgroundColor = bgColor;

      Chart.defaults.global.elements.line.borderWidth = borderWidth;
      Chart.defaults.global.elements.line.borderColor = borderColor;
      Chart.defaults.global.elements.line.backgroundColor = bgColor;

      Chart.defaults.global.elements.point.borderWidth = borderWidth;
      Chart.defaults.global.elements.point.borderColor = borderColor;
      Chart.defaults.global.elements.point.backgroundColor = bgColor;

      var chartPrefix = "language-chart";
      var index = 0;
      var jsonContent = null;

      Array.prototype.forEach.call(document.querySelectorAll("[class^=" + chartPrefix + "]"), function (x) {
        x.style.display = 'none'
        x.parentNode.style.backgroundColor = "transparent"
        jsonContent = x.innerText;
        var node0 = document.createElement('canvas');
        var source = null;
        node0.height = 200;
        node0.style.height = 200;
        node0.id = 'myChart' + index;
        source = JSON.parse(jsonContent);
        x.parentNode.insertBefore(node0, x);
        var ctx = document.getElementById('myChart' + index).getContext('2d');
        var myChart = new Chart(ctx, source);
        index += 1;
      });            
    }
    


    
    if (lib && lib.includes('wavedrom')) {
      var wavePrefix = "language-wave";
      var index = 0;
      var jsonContent = null;
      
      Array.prototype.forEach.call(document.querySelectorAll("[class^=" + wavePrefix + "]"), function (x) {
        x.style.display = 'none'
        x.parentNode.style.backgroundColor = "transparent"
        jsonContent = x.innerText;
        var node0 = document.createElement('div');
        var source = null;
        node0.id = 'WaveDrom_Display_' + index;
        source = JSON.parse(jsonContent);
        x.parentNode.insertBefore(node0, x);
        WaveDrom.RenderWaveForm(index, source, "WaveDrom_Display_");
        index += 1;
      });
    }
    


    
    if (lib && lib.includes('viz')) {
      var vizPrefix = "language-viz-";
      Array.prototype.forEach.call(document.querySelectorAll("[class^=" + vizPrefix + "]"), function (x) {
        x.style.display = 'none'
        x.parentNode.style.backgroundColor = "transparent"
        var engine;
        x.getAttribute("class").split(" ").forEach(function (cls) {
          if (cls.startsWith(vizPrefix)) {
            engine = cls.substr(vizPrefix.length);
          }
        });
        var viz = new Viz();
        viz.renderSVGElement(x.innerText, { engine: engine })
          .then(function (element) {
            element.style.width = "100%";
            x.parentNode.insertBefore(element, x);
          })
      });
    }
    
    
  }
</script>


            
            <footer class="footer">
    
<div class="dropdown">
  <button class="dropdown-trigger" aria-label="Select Theme Button">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path fill="currentColor" d="M12.65 15.67c.14-.36.05-.77-.23-1.05l-2.09-2.06.03-.03c1.74-1.94 2.98-4.17 3.71-6.53h1.94c.54 0 .99-.45.99-.99v-.02c0-.54-.45-.99-.99-.99H10V3c0-.55-.45-1-1-1s-1 .45-1 1v1H1.99c-.54 0-.99.45-.99.99 0 .55.45.99.99.99h10.18C11.5 7.92 10.44 9.75 9 11.35c-.81-.89-1.49-1.86-2.06-2.88-.16-.29-.45-.47-.78-.47-.69 0-1.13.75-.79 1.35.63 1.13 1.4 2.21 2.3 3.21L3.3 16.87c-.4.39-.4 1.03 0 1.42.39.39 1.02.39 1.42 0L9 14l2.02 2.02c.51.51 1.38.32 1.63-.35zM17.5 10c-.6 0-1.14.37-1.35.94l-3.67 9.8c-.24.61.22 1.26.87 1.26.39 0 .74-.24.88-.61l.89-2.39h4.75l.9 2.39c.14.36.49.61.88.61.65 0 1.11-.65.88-1.26l-3.67-9.8c-.22-.57-.76-.94-1.36-.94zm-1.62 7l1.62-4.33L19.12 17h-3.24z"/></svg>
  </button>
  <div class="dropdown-content">
    
    
    
  </div>
</div>

    
<div class="footer__social">
  <div class="social">
    
            
    
            
    
            
    
      
      <a href="mailto:willsurpriseyou@foxmail.com" title="email" aria-label="email">
        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path fill="currentColor" d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm-.4 4.25l-7.07 4.42c-.32.2-.74.2-1.06 0L4.4 8.25c-.25-.16-.4-.43-.4-.72 0-.67.73-1.07 1.3-.72L12 11l6.7-4.19c.57-.35 1.3.05 1.3.72 0 .29-.15.56-.4.72z"/></svg>
      </a>
            
    
      
      <a href="http://example.org/" title="facebook" aria-label="facebook">
        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32" height="32" viewBox="0 0 24 24" version="1.1">
<g id="surface2747">
<path fill="currentColor" d="M 11.664062 2.003906 C 6.621094 2.171875 2.375 6.25 2.023438 11.289062 C 1.65625 16.617188 5.46875 21.121094 10.507812 21.878906 L 10.507812 14.648438 L 8.890625 14.648438 C 8.164062 14.648438 7.578125 14.0625 7.578125 13.335938 C 7.578125 12.609375 8.164062 12.023438 8.890625 12.023438 L 10.503906 12.023438 L 10.503906 10.273438 C 10.503906 7.378906 11.914062 6.105469 14.324219 6.105469 C 14.679688 6.105469 14.984375 6.113281 15.242188 6.128906 C 15.878906 6.15625 16.371094 6.6875 16.371094 7.324219 C 16.371094 7.988281 15.835938 8.523438 15.171875 8.523438 L 14.730469 8.523438 C 13.710938 8.523438 13.351562 9.492188 13.351562 10.585938 L 13.351562 12.023438 L 15.222656 12.023438 C 15.8125 12.023438 16.265625 12.550781 16.175781 13.132812 L 16.066406 13.835938 C 15.992188 14.304688 15.589844 14.652344 15.113281 14.652344 L 13.351562 14.652344 L 13.351562 21.898438 C 18.234375 21.234375 22 17.0625 22 12 C 22 6.367188 17.339844 1.820312 11.664062 2.003906 Z M 11.664062 2.003906 "/>
</g>
</svg>

      </a>
            
    
            
    
      
      <a href="https://github.com/jmwill" title="github" aria-label="github">
        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32" height="32" viewBox="0 0 24 24" version="1.1">
<g id="surface3680">
<path fill="currentColor" d="M 10.898438 2.101562 C 6.300781 2.601562 2.601562 6.300781 2.101562 10.800781 C 1.601562 15.5 4.300781 19.699219 8.398438 21.300781 C 8.699219 21.398438 9 21.199219 9 20.800781 L 9 19.199219 C 9 19.199219 8.601562 19.300781 8.101562 19.300781 C 6.699219 19.300781 6.101562 18.101562 6 17.398438 C 5.898438 17 5.699219 16.699219 5.398438 16.398438 C 5.101562 16.300781 5 16.300781 5 16.199219 C 5 16 5.300781 16 5.398438 16 C 6 16 6.5 16.699219 6.699219 17 C 7.199219 17.800781 7.800781 18 8.101562 18 C 8.5 18 8.800781 17.898438 9 17.800781 C 9.101562 17.101562 9.398438 16.398438 10 16 C 7.699219 15.5 6 14.199219 6 12 C 6 10.898438 6.5 9.800781 7.199219 9 C 7.101562 8.800781 7 8.300781 7 7.601562 C 7 7.199219 7 6.601562 7.300781 6 C 7.300781 6 8.699219 6 10.101562 7.300781 C 10.601562 7.101562 11.300781 7 12 7 C 12.699219 7 13.398438 7.101562 14 7.300781 C 15.300781 6 16.800781 6 16.800781 6 C 17 6.601562 17 7.199219 17 7.601562 C 17 8.398438 16.898438 8.800781 16.800781 9 C 17.5 9.800781 18 10.800781 18 12 C 18 14.199219 16.300781 15.5 14 16 C 14.601562 16.5 15 17.398438 15 18.300781 L 15 20.898438 C 15 21.199219 15.300781 21.5 15.699219 21.398438 C 19.398438 19.898438 22 16.300781 22 12.101562 C 22 6.101562 16.898438 1.398438 10.898438 2.101562 Z M 10.898438 2.101562 "/>
</g>
</svg>

      </a>
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
      
      <a href="https://twitter.com/j_mwill" title="twitter" aria-label="twitter">
        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32" height="32" viewBox="0 0 32 32" version="1.1">
<g id="surface676">
<path fill="currentColor" d="M 28 8.558594 C 27.117188 8.949219 26.167969 9.214844 25.171875 9.332031 C 26.1875 8.722656 26.96875 7.757812 27.335938 6.609375 C 26.386719 7.171875 25.332031 7.582031 24.210938 7.804688 C 23.3125 6.847656 22.03125 6.246094 20.617188 6.246094 C 17.898438 6.246094 15.691406 8.453125 15.691406 11.171875 C 15.691406 11.558594 15.734375 11.933594 15.820312 12.292969 C 11.726562 12.089844 8.097656 10.128906 5.671875 7.148438 C 5.246094 7.875 5.003906 8.722656 5.003906 9.625 C 5.003906 11.332031 5.871094 12.839844 7.195312 13.722656 C 6.386719 13.695312 5.628906 13.476562 4.964844 13.105469 C 4.964844 13.128906 4.964844 13.148438 4.964844 13.167969 C 4.964844 15.554688 6.660156 17.546875 8.914062 17.996094 C 8.5 18.109375 8.066406 18.171875 7.617188 18.171875 C 7.300781 18.171875 6.988281 18.140625 6.691406 18.082031 C 7.316406 20.039062 9.136719 21.460938 11.289062 21.503906 C 9.605469 22.824219 7.480469 23.609375 5.175781 23.609375 C 4.777344 23.609375 4.386719 23.585938 4 23.539062 C 6.179688 24.9375 8.765625 25.753906 11.546875 25.753906 C 20.605469 25.753906 25.558594 18.25 25.558594 11.742188 C 25.558594 11.53125 25.550781 11.316406 25.542969 11.105469 C 26.503906 10.410156 27.339844 9.542969 28 8.558594 Z M 28 8.558594 "/>
</g>
</svg>

      </a>
            
    
            
    
            
    
            
    
            
    
            
    
    
  
  
    
      <a href="https://jmwill.github.io/blog/posts//index.xml" type="application/rss+xml" title="RSS" aria-label="RSS Feed Link">
        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><circle fill="currentColor" cx="6.18" cy="17.82" r="2.18"/><path fill="currentColor" d="M5.59 10.23c-.84-.14-1.59.55-1.59 1.4 0 .71.53 1.28 1.23 1.4 2.92.51 5.22 2.82 5.74 5.74.12.7.69 1.23 1.4 1.23.85 0 1.54-.75 1.41-1.59-.68-4.2-3.99-7.51-8.19-8.18zm-.03-5.71C4.73 4.43 4 5.1 4 5.93c0 .73.55 1.33 1.27 1.4 6.01.6 10.79 5.38 11.39 11.39.07.73.67 1.28 1.4 1.28.84 0 1.5-.73 1.42-1.56-.73-7.34-6.57-13.19-13.92-13.92z"/></svg>
      </a>
    
  

  </div>
</div>

    
<div id="gtt">
  <div class="gtt">
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" d="M8.12 14.71L12 10.83l3.88 3.88c.39.39 1.02.39 1.41 0 .39-.39.39-1.02 0-1.41L12.7 8.71c-.39-.39-1.02-.39-1.41 0L6.7 13.3c-.39.39-.39 1.02 0 1.41.39.38 1.03.39 1.42 0z"/></svg>
  </div>
</div>

    <hr />

    <div class="basicflex">
        
            <a href="" class="footer__link" target="_blank" rel="noreferrer"></a>
        
            <a href="" class="footer__link" target="_blank" rel="noreferrer"></a>
        
    </div>

    <div class="footer__poweredby">
        
                
            <p class="caption">
                
                    Â©2020, All Rights Reserved
                
            </p>
        

        
            <p class="caption">Powered by <a href="https://gohugo.io/" target="_blank" rel="noreferrer">Hugo</a> and the <a href="https://github.com/zzossig/hugo-theme-zzo" target="_blank" rel="noreferrer">Zzo theme</a></p>
        
        
    </div> 
</footer>
        </div>
        





<div class="wrapper__right hide" data-pad="true" dir="ltr">
  <script>document.querySelector('.wrapper__right').classList.remove('hide')</script>
  
</div>

    </div>
</body>

</html>